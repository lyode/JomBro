<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JomBro">
    <meta name="theme-color" content="#ff6b9d">
    <meta name="description" content="AI-Powered Social Challenge Platform - Connect, Challenge, Conquer!">
       
    <title>JomBro - Enhanced Challenge Proof System</title>

    <style>
        /* ===== ENHANCED LAYERED GLASS SYSTEM ===== */
        
        :root {
            --safe-area-top: env(safe-area-inset-top, 20px);
            --safe-area-bottom: env(safe-area-inset-bottom, 20px);
            --primary-pink: #ff6b9d;
            --primary-purple: #8b5cf6;
            --primary-blue: #00d4ff;
            --accent-pink: #ff8cc8;
            --accent-purple: #a855f7;
            --accent-blue: #3b82f6;
            --dark-bg: #0a0a0a;
            --glass-bg: rgba(15, 15, 15, 0.45);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-shadow: rgba(0, 0, 0, 0.8);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --error-red: #ef4444;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            
            /* Glass Layer System */
            --glass-distance: 3mm;
            --glass-blur: 25px;
            --glass-opacity: 0.15;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
        }

        html, body {
            height: 100vh;
            width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: #000000;
            color: var(--text-primary);
            user-select: none;
            overflow: hidden;
            perspective: 1000px;
        }

        /* ===== BOTTOM LAYER: ANIMATED BACKGROUNDS ===== */
        
        .background-layer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
            overflow: hidden;
            transform: translateZ(-var(--glass-distance));
        }

        .background-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .background-content.active {
            opacity: 1;
        }

        /* Space Background with Blinking Stars */
        .space-background {
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            position: relative;
        }

        .stars {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #eee, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: sparkle 3s linear infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.8);
            animation: shootingStar 4s linear infinite;
        }

        @keyframes shootingStar {
            0% {
                transform: translateX(-100px) translateY(-100px);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateX(100vw) translateY(100vh);
                opacity: 0;
            }
        }

        /* Space with Planets Background */
        .space-planets-background {
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            position: relative;
        }

        .planet {
            position: absolute;
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        .planet-1 {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at 30% 30%, #ff6b9d, #c44569);
            top: 20%;
            right: 15%;
            animation-delay: 0s;
        }

        .planet-2 {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #8b5cf6, #5b21b6);
            bottom: 30%;
            left: 10%;
            animation-delay: 2s;
        }

        .planet-3 {
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #00d4ff, #0284c7);
            top: 50%;
            left: 50%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        /* Animated Background */
        .animated-background {
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            position: relative;
        }

        .animated-shape {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-pink), var(--primary-purple));
            opacity: 0.1;
            animation: morphShapes 8s ease-in-out infinite;
        }

        .shape-1 {
            width: 100px;
            height: 100px;
            top: 20%;
            left: 20%;
            animation-delay: 0s;
        }

        .shape-2 {
            width: 150px;
            height: 150px;
            bottom: 20%;
            right: 20%;
            animation-delay: 2s;
        }

        .shape-3 {
            width: 80px;
            height: 80px;
            top: 60%;
            left: 60%;
            animation-delay: 4s;
        }

        @keyframes morphShapes {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                border-radius: 50%;
            }
            25% {
                transform: scale(1.2) rotate(90deg);
                border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            }
            50% {
                transform: scale(0.8) rotate(180deg);
                border-radius: 70% 30% 30% 70% / 70% 70% 30% 30%;
            }
            75% {
                transform: scale(1.1) rotate(270deg);
                border-radius: 50% 50% 25% 75% / 25% 75% 50% 50%;
            }
        }

        /* Video Background */
        .video-background {
            position: relative;
        }

        .video-background video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translateX(-50%) translateY(-50%);
            object-fit: cover;
            opacity: 0.6;
        }

        /* ===== TOP LAYER: GLASS UI INTERFACE ===== */
        
        .glass-layer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            transform: translateZ(var(--glass-distance));
            transform-style: preserve-3d;
            will-change: transform;
            pointer-events: auto;
        }

        /* Background Controls */
        .background-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .bg-control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            backdrop-filter: blur(10px);
        }

        .bg-control-btn:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.2);
        }

        .bg-control-btn.active {
            background: var(--primary-pink);
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        /* Auth Screen with Glass Effect */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            padding: 20px;
            backdrop-filter: blur(var(--glass-blur));
            background: rgba(0, 0, 0, 0.4);
        }

        .auth-container {
            background: rgba(15, 15, 15, 0.3);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            max-width: 350px;
            width: 100%;
            transform: translateZ(5px);
        }

        .auth-logo {
            font-size: 48px;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        .auth-title {
            font-size: 28px;
            font-weight: 300;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .auth-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .auth-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auth-btn.google {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            box-shadow: 0 8px 32px rgba(255, 255, 255, 0.1);
        }

        .auth-btn.facebook {
            background: rgba(24, 119, 242, 0.8);
            color: #fff;
            box-shadow: 0 8px 32px rgba(24, 119, 242, 0.3);
        }

        .auth-btn.phone {
            background: rgba(255, 107, 157, 0.8);
            color: #fff;
            box-shadow: 0 8px 32px rgba(255, 107, 157, 0.3);
        }

        .auth-btn.test {
            background: rgba(102, 102, 102, 0.8);
            color: white;
            box-shadow: 0 8px 32px rgba(102, 102, 102, 0.3);
        }

        .auth-btn:hover {
            transform: translateY(-2px) translateZ(2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.3);
        }

        /* Main App with Glass Effect */
        .phone-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .glass-interface {
            width: 100%;
            max-width: 400px;
            height: calc(100vh - 20px);
            background: rgba(15, 15, 15, 0.25);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 25px;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 0 60px rgba(255, 107, 157, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transform: translateZ(3px);
        }

        .glass-header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: calc(var(--safe-area-top) + 20px) 25px 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            background: rgba(15, 15, 15, 0.4);
            backdrop-filter: blur(40px);
        }

        .logo-section {
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .logo-text {
            font-size: 26px;
            font-weight: 200;
            color: var(--text-primary);
            letter-spacing: -1px;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.4);
        }

        .logo-slogan {
            font-size: 10px;
            color: var(--primary-pink);
            margin-top: -2px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.9;
            animation: pulse 3s infinite;
            text-shadow: 0 0 10px rgba(255, 107, 157, 0.6);
        }

        .logo-subtitle {
            font-size: 9px;
            color: var(--text-secondary);
            margin-top: 2px;
            opacity: 0.8;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .header-btn {
            width: 30px;
            height: 30px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            transition: all 0.3s ease;
            position: relative;
        }

        .header-btn:hover {
            background: rgba(255, 107, 157, 0.15);
            border-color: var(--primary-pink);
            transform: scale(1.1) translateZ(1px);
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 16px;
            height: 16px;
            background: var(--primary-pink);
            border-radius: 50%;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            box-shadow: 0 0 10px rgba(255, 107, 157, 0.5);
        }

        .glass-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        .glass-section {
            padding: 15px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
        }

        .live-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .live-dot {
            width: 6px;
            height: 6px;
            background: #ff4757;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px #ff4757;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
                box-shadow: 0 0 10px rgba(255, 71, 87, 0.8);
            }
            50% { 
                opacity: 0.8; 
                transform: scale(1.02);
                box-shadow: 0 0 20px rgba(255, 71, 87, 1);
            }
        }

        .user-status {
            background: rgba(255, 107, 157, 0.1);
            border: 1px solid rgba(255, 107, 157, 0.3);
            color: var(--primary-pink);
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(15px);
            box-shadow: 0 0 15px rgba(255, 107, 157, 0.2);
        }

        .live-players {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .player-avatar {
            position: relative;
            flex-shrink: 0;
        }

        .avatar-ring {
            width: 44px;
            height: 44px;
            border-radius: 22px;
            background: linear-gradient(45deg, var(--primary-pink), var(--primary-purple));
            padding: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.3);
        }

        .avatar-ring:hover {
            transform: scale(1.1) translateZ(2px);
            box-shadow: 0 0 30px rgba(255, 107, 157, 0.5);
        }

        .avatar-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            overflow: hidden;
        }

        .avatar-status {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 10px;
            height: 10px;
            background: var(--success-green);
            border: 2px solid rgba(10, 10, 10, 0.8);
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 8px var(--success-green);
        }

        .avatar-status.offline {
            background: var(--text-secondary);
            box-shadow: 0 0 8px var(--text-secondary);
            animation: none;
        }

        .player-level {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-purple);
            color: white;
            font-size: 8px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.3);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
            min-width: 20px;
            text-align: center;
        }

        /* Enhanced Modal System */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: rgba(15, 15, 15, 0.3);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            width: 100%;
            max-width: 400px;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.7),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: translateZ(5px);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            color: var(--text-primary);
            transform: scale(1.1);
        }

        /* Enhanced Buttons */
        .btn-primary {
            background: linear-gradient(145deg, rgba(255, 107, 157, 0.8), rgba(196, 69, 105, 0.8));
            backdrop-filter: blur(20px);
            color: #fff;
            border: 1px solid rgba(255, 107, 157, 0.3);
            padding: 16px 24px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 
                0 6px 20px rgba(255, 107, 157, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-3px) translateZ(2px);
            box-shadow: 
                0 8px 25px rgba(255, 107, 157, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px) translateZ(1px);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
        }

        /* Challenge Cards with Enhanced Glass Effect */
        .challenge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .challenge-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .challenge-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-5px) translateZ(3px);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(255, 107, 157, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .challenge-category-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ===== NEW: CHALLENGE PROOF SYSTEM ===== */

        /* Gallery/Showcase Section */
        .showcase-section {
            padding: 20px 25px;
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.05), rgba(139, 92, 246, 0.05));
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .showcase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .showcase-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-pink);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .showcase-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .showcase-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .showcase-item:hover {
            transform: scale(1.05) translateZ(2px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.3);
        }

        .showcase-media {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .showcase-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            padding: 8px;
            color: white;
            font-size: 10px;
            text-align: center;
        }

        .success-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }

        .success-badge.genius {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
        }

        .success-badge.winner {
            background: linear-gradient(45deg, #c0c0c0, #e5e5e5);
            color: #000;
        }

        .success-badge.achiever {
            background: linear-gradient(45deg, #cd7f32, #e6a85c);
            color: #fff;
        }

        .success-badge.excellence {
            background: linear-gradient(45deg, #ff6b9d, #8b5cf6);
            color: #fff;
        }

        /* Challenge Proof Submission Modal */
        .proof-modal .modal-content {
            max-width: 450px;
        }

        .proof-upload-area {
            border: 2px dashed rgba(255, 107, 157, 0.3);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: rgba(255, 107, 157, 0.05);
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .proof-upload-area:hover {
            border-color: rgba(255, 107, 157, 0.5);
            background: rgba(255, 107, 157, 0.1);
        }

        .proof-upload-area.dragover {
            border-color: var(--primary-pink);
            background: rgba(255, 107, 157, 0.15);
            transform: scale(1.02);
        }

        .proof-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .proof-progress {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .proof-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-pink), var(--primary-purple));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Title Assignment System */
        .title-award {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 107, 157, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .title-award::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .title-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(45deg, #ffd700, #ff6b9d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .title-description {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        /* Failure Consequences System */
        .failure-section {
            padding: 20px 25px;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(245, 158, 11, 0.05));
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .failure-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .failure-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--error-red);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .failure-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }

        .failure-item {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .failure-item:hover {
            background: rgba(239, 68, 68, 0.15);
            transform: translateY(-3px);
        }

        .failure-badge {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .failure-name {
            font-size: 10px;
            font-weight: 600;
            color: var(--error-red);
            margin-bottom: 3px;
        }

        .failure-consequence {
            font-size: 8px;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Form Elements with Glass Effect */
        .form-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-pink);
            box-shadow: 0 0 0 2px rgba(255, 107, 157, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        /* Enhanced Chat Interface */
        .chat-interface {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60%;
            background: rgba(15, 15, 15, 0.3);
            backdrop-filter: blur(40px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px 20px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5);
        }

        .chat-interface.open {
            transform: translateY(0);
        }

        .chat-toggle {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: rgba(255, 107, 157, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 107, 157, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #fff;
            cursor: pointer;
            box-shadow: 
                0 4px 20px rgba(255, 107, 157, 0.4),
                0 0 30px rgba(255, 107, 157, 0.3);
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .chat-toggle:hover {
            transform: scale(1.1) translateZ(2px);
            box-shadow: 
                0 6px 25px rgba(255, 107, 157, 0.5),
                0 0 40px rgba(255, 107, 157, 0.4);
        }

        /* File Upload Styling */
        input[type="file"] {
            display: none;
        }

        .file-upload-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .file-upload-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--primary-pink);
            color: var(--text-primary);
        }

        /* Utility Classes */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: var(--text-primary);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        /* Feature Hide/Show Classes */
        .feature-hidden {
            display: none !important;
        }

        .glass-reduced {
            backdrop-filter: blur(5px) !important;
        }

        .animations-disabled * {
            animation: none !important;
            transition: none !important;
        }

        .hover-disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        /* Performance Optimizations */
        .glass-layer * {
            will-change: transform;
            backface-visibility: hidden;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .glass-interface {
                max-width: 100%;
                height: 100vh;
                border-radius: 0;
                margin: 0;
            }
            
            .phone-container {
                padding: 0;
            }
            
            .background-controls {
                top: 10px;
                right: 10px;
                transform: scale(0.9);
            }
            
            .header-actions {
                flex-wrap: wrap;
                gap: 6px;
            }
            
            .header-btn {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Bottom Layer: Animated Backgrounds -->
    <div class="background-layer">
        <!-- Space with Blinking Stars -->
        <div class="background-content space-background active" id="spaceBackground">
            <div class="stars"></div>
            <div class="shooting-star" style="top: 20%; left: 10%;"></div>
            <div class="shooting-star" style="top: 60%; left: 30%; animation-delay: 2s;"></div>
            <div class="shooting-star" style="top: 80%; left: 60%; animation-delay: 4s;"></div>
        </div>

        <!-- Space with Planets -->
        <div class="background-content space-planets-background" id="spacePlanetsBackground">
            <div class="stars"></div>
            <div class="planet planet-1"></div>
            <div class="planet planet-2"></div>
            <div class="planet planet-3"></div>
        </div>

        <!-- Animated Shapes -->
        <div class="background-content animated-background" id="animatedBackground">
            <div class="animated-shape shape-1"></div>
            <div class="animated-shape shape-2"></div>
            <div class="animated-shape shape-3"></div>
        </div>

        <!-- Custom Video Background -->
        <div class="background-content video-background" id="videoBackground">
            <video autoplay muted loop id="customVideo">
                <!-- Video source will be added dynamically -->
            </video>
        </div>
    </div>

    <!-- Top Layer: Glass UI Interface -->
    <div class="glass-layer">
        <!-- Auth Screen -->
        <div id="authScreen" class="auth-screen">
            <div class="auth-container">
                <div class="auth-logo">üöÄ</div>
                <div class="auth-title">Welcome to JomBro</div>
                <div class="auth-subtitle">Connect with friends and tackle challenges together!</div>
                
                <div id="errorMessage" class="error-message" style="display: none;"></div>
                <div id="successMessage" class="success-message" style="display: none;"></div>
                
                <!-- Main Auth Screen -->
                <div id="mainAuth">
                    <button class="auth-btn google" onclick="signInWithGoogle()">
                        üîç Continue with Google
                    </button>
                    
                    <button class="auth-btn facebook" onclick="signInWithFacebook()">
                        üìò Continue with Facebook
                    </button>
                    
                    <button class="auth-btn phone" onclick="showPhoneForm()">
                        üì± Continue with Phone
                    </button>
                    
                    <button class="auth-btn test" onclick="signInAnonymously()">
                        üß™ Test Mode (Skip Login)
                    </button>
                </div>

                <!-- Phone Form -->
                <div id="phoneForm" style="display: none; margin-top: 20px;">
                    <input type="tel" id="phoneInput" class="form-input" placeholder="+60123456789" required>
                    <div id="recaptcha-container"></div>
                    <input type="text" id="otpInput" class="form-input" placeholder="Enter OTP" style="display:none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                        <button class="btn-secondary" onclick="showMainAuth()">Back</button>
                        <button class="btn-primary" id="phoneSubmitBtn" onclick="signInWithPhone()">Send OTP</button>
                    </div>
                </div>

                <!-- User Info (After Login) -->
                <div id="userInfo" style="display: none;">
                    <h3 style="color: var(--text-primary); margin-bottom: 15px;">Welcome!</h3>
                    <p id="userDetails" style="color: var(--text-secondary); margin-bottom: 20px;"></p>
                    <button class="btn-primary" onclick="signOut()">Sign Out</button>
                </div>
                
                <div style="margin-top: 20px; font-size: 12px; color: var(--text-secondary);">
                    By continuing, you agree to our Terms & Privacy Policy
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="mainApp" class="phone-container" style="display: none;">
            <div class="glass-interface">
                <!-- Header -->
                <div class="glass-header">
                    <div class="logo-section" onclick="showProfile()">
                        <div class="logo-text">JomBro</div>
                        <div class="logo-slogan">Challenge & Conquer!</div>
                        <div class="logo-subtitle" id="userDisplayName">Loading...</div>
                    </div>
                    <div class="header-actions">
                        <div class="header-btn" onclick="showMyTasks()" title="My Tasks">
                            üìã
                            <div class="notification-badge" id="tasksNotifications" style="display: none;">2</div>
                        </div>
                        <div class="header-btn" onclick="showProofGallery()" title="Success Gallery">
                            üèÜ
                            <div class="notification-badge" id="galleryNotifications">12</div>
                        </div>
                        <div class="header-btn" onclick="showFailureHall()" title="Hall of Shame">
                            üö®
                            <div class="notification-badge" id="failureNotifications">3</div>
                        </div>
                        <div class="header-btn" onclick="toggleChat()" title="Group Chat">
                            üí¨
                            <div class="notification-badge" id="chatNotifications" style="display: none;">3</div>
                        </div>
                        <div class="header-btn" onclick="showOnlineUsers()" title="Online Users">
                            üë•
                            <div class="notification-badge" id="onlineUsersNotifications">5</div>
                        </div>
                        <div class="header-btn" onclick="showGroups()" title="Groups">üè†</div>
                        <div class="header-btn" onclick="showEnhancedProfile()" title="Enhanced Profile">üë§</div>
                        <div class="header-btn" onclick="showSettings()" title="Settings">‚öôÔ∏è</div>
                        <div class="header-btn" onclick="signOut()" title="Sign Out">üö™</div>
                    </div>
                </div>

                <div class="glass-content">
                    <!-- SUCCESS SHOWCASE SECTION -->
                    <div class="showcase-section" id="successShowcase">
                        <div class="showcase-header">
                            <div class="showcase-title">
                                üèÜ Hall of Champions
                                <div style="background: var(--gold); color: #000; padding: 2px 6px; border-radius: 6px; font-size: 8px; font-weight: 700;">LIVE</div>
                            </div>
                            <button class="btn-secondary" onclick="showProofGallery()" style="padding: 6px 12px; font-size: 12px;">View All</button>
                        </div>
                        <div class="showcase-gallery" id="showcaseGallery">
                            <!-- Success submissions will appear here -->
                        </div>
                    </div>

                    <!-- FAILURE CONSEQUENCES SECTION -->
                    <div class="failure-section" id="failureSection">
                        <div class="failure-header">
                            <div class="failure-title">
                                üö® Hall of Shame
                                <div style="background: var(--error-red); color: white; padding: 2px 6px; border-radius: 6px; font-size: 8px; font-weight: 700;">BUSTED</div>
                            </div>
                            <button class="btn-secondary" onclick="showFailureHall()" style="padding: 6px 12px; font-size: 12px; background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3);">View All</button>
                        </div>
                        <div class="failure-gallery" id="failureGallery">
                            <!-- Failure consequences will appear here -->
                        </div>
                    </div>

                    <!-- Live Players Section -->
                    <div class="glass-section">
                        <div class="live-header">
                            <div class="live-indicator">
                                <div class="live-dot"></div>
                                <span>LIVE</span>
                                <span class="online-count" id="onlineCount" style="background: rgba(0, 255, 150, 0.2); color: var(--success-green); padding: 2px 8px; border-radius: 10px; font-size: 10px; margin-left: 8px;">5 online</span>
                            </div>
                            <div class="user-status" id="userStatus" onclick="showProfile()">
                                <span id="userLevel">Level 1</span>
                            </div>
                        </div>
                        <div class="live-players" id="livePlayersContainer">
                            <!-- Real users appear here -->
                        </div>
                    </div>

                    <!-- Current Challenge Status -->
                    <div id="currentChallengeStatus" class="glass-section" style="display: none;">
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 15px; margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div>
                                    <div style="padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; background: var(--success-green); color: white; display: inline-block;">In Progress</div>
                                    <div style="font-size: 14px; font-weight: 600; margin-top: 5px;" id="currentChallengeTitle">Coffee Shop Poetry Challenge</div>
                                </div>
                                <div style="font-size: 18px; font-weight: 700; color: var(--primary-pink);" id="challengeTimer">2h 45m left</div>
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 10px;">
                                <span id="challengeProgress">Ready to submit proof</span>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn-secondary" onclick="openProofSubmission()" style="flex: 1;">üì∏ Submit Proof</button>
                                <button class="btn-secondary" onclick="viewChallenge()" style="flex: 1;">üëÄ View Details</button>
                            </div>
                        </div>
                    </div>

                    <!-- Main Challenge Selection -->
                    <div style="flex: 1; padding: 20px 25px; min-height: 300px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary);">üéØ Choose Your Challenge</h3>
                                <div style="background: rgba(255, 255, 255, 0.1); color: var(--text-secondary); padding: 4px 8px; border-radius: 8px; font-size: 10px; backdrop-filter: blur(10px);">AI Generated</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="refreshChallenges()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-primary); padding: 6px 8px; border-radius: 8px; cursor: pointer; font-size: 12px; backdrop-filter: blur(15px);" title="Generate New">‚ú®</button>
                            </div>
                        </div>
                        
                        <div id="challengeSelection" class="challenge-grid">
                            <!-- AI Generated challenges appear here -->
                        </div>
                    </div>

                    <!-- Action Section -->
                    <div style="padding: 18px 25px; background: linear-gradient(180deg, transparent 0%, rgba(255, 255, 255, 0.03) 100%); border-top: 1px solid rgba(255, 255, 255, 0.06);">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px; color: var(--text-primary);">Ready to become a champion?</div>
                            <div style="font-size: 11px; color: var(--text-secondary);">Complete challenges, upload proof, earn prestigious titles!</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <button class="btn-secondary" onclick="showProofGallery()" style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                                üèÜ Champions
                            </button>
                            <button class="btn-secondary" onclick="showMyTasks()" style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                                üìã My Tasks
                            </button>
                        </div>
                        <button class="btn-primary" id="mainActionBtn" onclick="showChallengeAgreement()">
                            üéØ START CHALLENGE
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Modals -->

        <!-- Challenge Proof Submission Modal -->
        <div id="proofSubmissionModal" class="modal proof-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">üì∏ Submit Challenge Proof</div>
                    <button class="modal-close" onclick="hideModal('proofSubmission')">&times;</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px; color: var(--primary-pink);" id="proofChallengeTitle">Coffee Shop Poetry Challenge</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 15px;">Upload a photo or video showing you completed this challenge!</div>
                </div>

                <div class="proof-upload-area" id="proofUploadArea" onclick="document.getElementById('proofFileInput').click()">
                    <div style="font-size: 48px; margin-bottom: 10px;">üì∏</div>
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px; color: var(--primary-pink);">Click to Upload Proof</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">Photos, Videos, or Screenshots accepted</div>
                    <div style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;">Max 50MB ‚Ä¢ JPG, PNG, MP4, MOV</div>
                </div>

                <input type="file" id="proofFileInput" accept="image/*,video/*" onchange="handleProofUpload(event)">

                <div id="proofPreviewContainer" style="display: none;">
                    <img id="proofPreview" class="proof-preview" style="display: none;">
                    <video id="proofVideoPreview" class="proof-preview" controls style="display: none;"></video>
                    
                    <div class="proof-progress" id="proofProgress" style="display: none;">
                        <div class="proof-progress-bar" id="proofProgressBar"></div>
                    </div>
                </div>

                <div style="margin: 20px 0;">
                    <textarea class="form-input" id="proofDescription" placeholder="Describe your experience completing this challenge..." rows="3" style="resize: vertical;"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn-secondary" onclick="hideModal('proofSubmission')">Cancel</button>
                    <button class="btn-primary" onclick="submitProof()" id="submitProofBtn">
                        üöÄ Submit Proof
                    </button>
                </div>
            </div>
        </div>

        <!-- Success Gallery Modal -->
        <div id="proofGalleryModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <div class="modal-title">üèÜ Hall of Champions</div>
                    <button class="modal-close" onclick="hideModal('proofGallery')">&times;</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 14px; color: var(--text-secondary);">Champion Submissions</div>
                        <div style="font-size: 12px; color: var(--primary-pink); background: rgba(255, 107, 157, 0.1); padding: 4px 8px; border-radius: 8px;">12 Heroes</div>
                    </div>
                    
                    <div id="fullGalleryContainer" class="showcase-gallery" style="max-height: 400px;">
                        <!-- Full gallery will be populated here -->
                    </div>
                </div>

                <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 12px; border: 1px solid rgba(255, 215, 0, 0.3);">
                    <div style="font-size: 24px; margin-bottom: 8px;">üëë</div>
                    <div style="font-size: 14px; font-weight: 600; color: var(--gold); margin-bottom: 5px;">Become a Champion</div>
                    <div style="font-size: 11px; color: var(--text-secondary);">Complete challenges and upload proof to earn prestigious titles!</div>
                </div>
            </div>
        </div>

        <!-- Failure Hall Modal -->
        <div id="failureHallModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <div class="modal-title">üö® Hall of Shame</div>
                    <button class="modal-close" onclick="hideModal('failureHall')">&times;</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 14px; color: var(--text-secondary);">Challenge Dropouts & Failures</div>
                        <div style="font-size: 12px; color: var(--error-red); background: rgba(239, 68, 68, 0.1); padding: 4px 8px; border-radius: 8px;">3 Busted</div>
                    </div>
                    
                    <div id="fullFailureContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; max-height: 400px; overflow-y: auto;">
                        <!-- Full failure gallery will be populated here -->
                    </div>
                </div>

                <div style="text-align: center; padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 12px; border: 1px solid rgba(239, 68, 68, 0.3);">
                    <div style="font-size: 24px; margin-bottom: 8px;">‚öñÔ∏è</div>
                    <div style="font-size: 14px; font-weight: 600; color: var(--error-red); margin-bottom: 5px;">Justice System</div>
                    <div style="font-size: 11px; color: var(--text-secondary);">Don't abandon challenges or face playful consequences!</div>
                </div>
            </div>
        </div>

        <!-- Title Award Modal -->
        <div id="titleAwardModal" class="modal">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <div class="modal-title">üèÜ Title Awarded!</div>
                    <button class="modal-close" onclick="hideModal('titleAward')">&times;</button>
                </div>

                <div class="title-award">
                    <div id="awardedTitle" class="title-text">CHALLENGE GENIUS</div>
                    <div id="awardedDescription" class="title-description">You've demonstrated exceptional skill and creativity in completing this challenge!</div>
                    
                    <div style="display: flex; justify-content: center; gap: 15px; margin: 20px 0;">
                        <div style="text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 5px;">üèÜ</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Title Earned</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 20px; font-weight: 700; color: var(--gold); margin-bottom: 5px;" id="awardedTokens">+1000</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Bonus Tokens</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 20px; font-weight: 700; color: var(--primary-purple); margin-bottom: 5px;">+50</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">XP Points</div>
                        </div>
                    </div>
                    
                    <button class="btn-primary" onclick="shareTitle()">
                        üì§ Share Achievement
                    </button>
                </div>
            </div>
        </div>

        <!-- Other existing modals would go here... -->
        <!-- (keeping the existing modal code from previous version) -->

        <!-- Enhanced Chat Interface -->
        <div id="chatInterface" class="chat-interface">
            <div style="padding: 15px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);" id="chatTitle">Challenge Group Chat</div>
                    <div style="font-size: 12px; color: var(--text-secondary);" id="chatMembers">5 members online</div>
                </div>
                <button style="background: none; border: none; color: var(--text-secondary); font-size: 18px; cursor: pointer;" onclick="toggleChat()">‚úï</button>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px;" id="chatMessages">
                <!-- Messages appear here -->
            </div>
            <div style="padding: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1); display: flex; gap: 10px; align-items: center;">
                <input type="text" style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 10px 15px; color: var(--text-primary); font-size: 14px; outline: none; backdrop-filter: blur(15px);" id="chatInput" placeholder="Type a message..." onkeypress="handleChatKeyPress(event)">
                <button style="background: var(--primary-pink); border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #fff; font-size: 16px;" onclick="sendMessage()">‚û§</button>
            </div>
        </div>

        <!-- Floating Chat Toggle -->
        <button id="chatToggle" class="chat-toggle" onclick="toggleChat()" style="display: none;">
            üí¨
        </button>
    </div>

    <script>
        // ===== ENHANCED CHALLENGE PROOF SYSTEM =====

        // Proof Submission System
        let currentProofFile = null;
        let currentChallengeForProof = null;

        // Success Titles System with AI-generated options
        const SUCCESS_TITLES = {
            GENIUS: {
                name: "CHALLENGE GENIUS",
                icon: "üß†",
                description: "Demonstrates exceptional intelligence and creativity",
                color: "#ffd700",
                multiplier: 2.0
            },
            WINNER: {
                name: "ULTIMATE WINNER",
                icon: "üèÜ",
                description: "Achieves victory with style and determination",
                color: "#c0c0c0",
                multiplier: 1.8
            },
            EXCELLENCE: {
                name: "EXCELLENCE ACHIEVER",
                icon: "‚≠ê",
                description: "Maintains highest standards in every challenge",
                color: "#ff6b9d",
                multiplier: 1.6
            },
            ACHIEVER: {
                name: "SUPER ACHIEVER",
                icon: "üéØ",
                description: "Consistently reaches goals and targets",
                color: "#cd7f32",
                multiplier: 1.4
            },
            CHAMPION: {
                name: "CHALLENGE CHAMPION",
                icon: "üëë",
                description: "Rules the challenge arena with mastery",
                color: "#8b5cf6",
                multiplier: 2.2
            },
            LEGEND: {
                name: "LIVING LEGEND",
                icon: "üåü",
                description: "Creates stories that inspire generations",
                color: "#10b981",
                multiplier: 2.5
            },
            MASTER: {
                name: "CHALLENGE MASTER",
                icon: "üéñÔ∏è",
                description: "Has mastered the art of challenge completion",
                color: "#f59e0b",
                multiplier: 1.9
            },
            INNOVATOR: {
                name: "CREATIVE INNOVATOR",
                icon: "üí°",
                description: "Brings unique solutions and fresh perspectives",
                color: "#06b6d4",
                multiplier: 1.7
            }
        };

        // Failure Consequences System with playful titles
        const FAILURE_CONSEQUENCES = {
            WANTED: {
                name: "WANTED",
                icon: "üîç",
                description: "Wanted for abandoning challenges",
                consequence: "Must complete 2 challenges to clear record",
                severity: "medium"
            },
            LOSER: {
                name: "CHALLENGE LOSER",
                icon: "üò¢",
                description: "Failed to complete assigned challenge",
                consequence: "Banned from premium challenges for 24h",
                severity: "low"
            },
            JAILED: {
                name: "JAILED",
                icon: "üîí",
                description: "Imprisoned for repeated failures",
                consequence: "Must get 3 friends to vouch for release",
                severity: "high"
            },
            COURT: {
                name: "ON TRIAL",
                icon: "‚öñÔ∏è",
                description: "Standing trial for challenge abandonment",
                consequence: "Community will vote on your fate",
                severity: "high"
            },
            SUSPECT: {
                name: "PRIME SUSPECT",
                icon: "üïµÔ∏è",
                description: "Under investigation for suspicious activity",
                consequence: "Must provide proof of next 3 challenges",
                severity: "medium"
            },
            RUNAWAY: {
                name: "RUNAWAY",
                icon: "üèÉ",
                description: "Fled from challenge responsibilities",
                consequence: "GPS tracking activated (just kidding!)",
                severity: "low"
            },
            BANNED: {
                name: "TEMPORARILY BANNED",
                icon: "üö´",
                description: "Banned for unsportsmanlike conduct",
                consequence: "48h cooldown period activated",
                severity: "high"
            },
            SHAME: {
                name: "WALK OF SHAME",
                icon: "üîî",
                description: "Must wear the badge of shame",
                consequence: "Everyone will see your failure badge",
                severity: "medium"
            }
        };

        // Mock data for showcases
        let successSubmissions = [
            {
                id: 1,
                user: "Alex Chen",
                avatar: "üòé",
                challenge: "Coffee Shop Poetry",
                media: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzMzNzNkYyIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Q29mZmVlIOKYlTwvdGV4dD48L3N2Zz4=",
                title: "CHALLENGE GENIUS",
                description: "Got a beautiful haiku written on my cup!",
                timestamp: new Date(Date.now() - 60000 * 30), // 30 minutes ago
                tokens: 1000,
                type: "image"
            },
            {
                id: 2,
                user: "Maya Patel",
                avatar: "üåü",
                challenge: "Sunrise Workout",
                media: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmOTUwMCIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+U3VucmlzZSDwn4yFPC90ZXh0Pjwvc3ZnPg==",
                title: "ULTIMATE WINNER",
                description: "5AM workout with golden sunrise view!",
                timestamp: new Date(Date.now() - 60000 * 120), // 2 hours ago
                tokens: 800,
                type: "image"
            },
            {
                id: 3,
                user: "Jordan Kim",
                avatar: "üöÄ",
                challenge: "Street Art Hunt",
                media: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzhmNWNmNiIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QXJ0IPCfiaY8L3RleHQ+PC9zdmc+",
                title: "EXCELLENCE ACHIEVER",
                description: "Found 10 amazing murals in one afternoon!",
                timestamp: new Date(Date.now() - 60000 * 180), // 3 hours ago
                tokens: 750,
                type: "image"
            }
        ];

        let failureConsequences = [
            {
                id: 1,
                user: "Lazy Larry",
                avatar: "üò¥",
                challenge: "Morning Jog",
                consequence: "WANTED",
                reason: "Abandoned challenge after 5 minutes",
                timestamp: new Date(Date.now() - 60000 * 60), // 1 hour ago
            },
            {
                id: 2,
                user: "Quitter Quinn",
                avatar: "üèÉ",
                challenge: "Cook New Recipe",
                consequence: "JAILED",
                reason: "Ordered takeout instead of cooking",
                timestamp: new Date(Date.now() - 60000 * 240), // 4 hours ago
            },
            {
                id: 3,
                user: "Excuse Eddie",
                avatar: "ü§•",
                challenge: "Read 30 Pages",
                consequence: "ON TRIAL",
                reason: "Claimed book was written in alien language",
                timestamp: new Date(Date.now() - 60000 * 300), // 5 hours ago
            }
        ];

        // Proof Submission Functions
        window.openProofSubmission = function(challengeData = null) {
            currentChallengeForProof = challengeData || {
                title: "Coffee Shop Poetry Challenge",
                description: "Visit a coffee shop and ask for a poem on your cup"
            };
            
            document.getElementById('proofChallengeTitle').textContent = currentChallengeForProof.title;
            showModal('proofSubmission');
        }

        window.handleProofUpload = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file size (50MB max)
            if (file.size > 50 * 1024 * 1024) {
                showToast('‚ùå File too large! Maximum 50MB allowed.', 'error');
                return;
            }

            // Validate file type
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'video/mp4', 'video/mov', 'video/avi'];
            if (!allowedTypes.includes(file.type)) {
                showToast('‚ùå Invalid file type! Only images and videos allowed.', 'error');
                return;
            }

            currentProofFile = file;
            const isVideo = file.type.startsWith('video/');
            
            // Show preview
            const previewContainer = document.getElementById('proofPreviewContainer');
            const imagePreview = document.getElementById('proofPreview');
            const videoPreview = document.getElementById('proofVideoPreview');
            
            previewContainer.style.display = 'block';
            
            if (isVideo) {
                imagePreview.style.display = 'none';
                videoPreview.style.display = 'block';
                videoPreview.src = URL.createObjectURL(file);
            } else {
                videoPreview.style.display = 'none';
                imagePreview.style.display = 'block';
                imagePreview.src = URL.createObjectURL(file);
            }

            // Update upload area
            const uploadArea = document.getElementById('proofUploadArea');
            uploadArea.innerHTML = `
                <div style="font-size: 24px; margin-bottom: 10px;">‚úÖ</div>
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px; color: var(--success-green);">File Ready!</div>
                <div style="font-size: 12px; color: var(--text-secondary);">${file.name}</div>
                <div style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;">Click to change file</div>
            `;

            showToast(`üì∏ ${isVideo ? 'Video' : 'Image'} uploaded successfully!`, 'success');
        }

        window.submitProof = function() {
            if (!currentProofFile) {
                showToast('‚ùå Please upload a proof file first!', 'error');
                return;
            }

            const description = document.getElementById('proofDescription').value.trim();
            if (!description) {
                showToast('‚ùå Please describe your experience!', 'error');
                return;
            }

            // Show progress
            const progressContainer = document.getElementById('proofProgress');
            const progressBar = document.getElementById('proofProgressBar');
            const submitBtn = document.getElementById('submitProofBtn');
            
            progressContainer.style.display = 'block';
            submitBtn.disabled = true;
            submitBtn.textContent = 'Uploading...';

            // Simulate upload progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Simulate processing time
                    setTimeout(() => {
                        processProofSubmission(description);
                    }, 1000);
                }
            }, 200);
        }

        function processProofSubmission(description) {
            // Add to success submissions
            const newSubmission = {
                id: Date.now(),
                user: document.getElementById('userDisplayName').textContent || 'You',
                avatar: 'ü§ó',
                challenge: currentChallengeForProof.title,
                media: URL.createObjectURL(currentProofFile),
                title: assignSuccessTitle(),
                description: description,
                timestamp: new Date(),
                tokens: calculateTokenReward(),
                type: currentProofFile.type.startsWith('video/') ? 'video' : 'image'
            };

            successSubmissions.unshift(newSubmission);
            updateSuccessShowcase();
            
            // Hide proof modal
            hideModal('proofSubmission');
            
            // Show title award
            showTitleAward(newSubmission.title, newSubmission.tokens);
            
            // Update stats
            updateUserStats(newSubmission.tokens);
            
            showToast('üèÜ Challenge completed successfully! Title awarded!', 'success');
        }

        function assignSuccessTitle() {
            const titles = Object.keys(SUCCESS_TITLES);
            const weights = [30, 25, 20, 15, 5, 3, 1, 1]; // Higher chance for common titles
            
            let randomValue = Math.random() * 100;
            let cumulativeWeight = 0;
            
            for (let i = 0; i < titles.length; i++) {
                cumulativeWeight += weights[i] || 1;
                if (randomValue <= cumulativeWeight) {
                    return titles[i];
                }
            }
            
            return 'ACHIEVER'; // Fallback
        }

        function calculateTokenReward() {
            const baseTokens = 500;
            const difficultyMultiplier = Math.random() * 1.5 + 0.5; // 0.5x to 2x
            const qualityBonus = Math.random() * 500; // Up to 500 bonus
            
            return Math.round(baseTokens * difficultyMultiplier + qualityBonus);
        }

        function showTitleAward(titleKey, tokens) {
            const title = SUCCESS_TITLES[titleKey];
            
            document.getElementById('awardedTitle').textContent = title.name;
            document.getElementById('awardedDescription').textContent = title.description;
            document.getElementById('awardedTokens').textContent = `+${tokens}`;
            
            showModal('titleAward');
            
            // Add visual celebration
            setTimeout(() => {
                createCelebrationEffect();
            }, 500);
        }

        function createCelebrationEffect() {
            // Create floating emojis
            const emojis = ['üéâ', 'üèÜ', '‚≠ê', 'üéä', 'üî•', 'üí´'];
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.cssText = `
                        position: fixed;
                        font-size: 24px;
                        left: ${Math.random() * window.innerWidth}px;
                        top: ${window.innerHeight}px;
                        pointer-events: none;
                        z-index: 9999;
                        animation: float-up 3s ease-out forwards;
                    `;
                    
                    document.body.appendChild(emoji);
                    
                    setTimeout(() => {
                        if (emoji.parentNode) {
                            emoji.parentNode.removeChild(emoji);
                        }
                    }, 3000);
                }, i * 200);
            }
        }

        // Add CSS for floating animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float-up {
                0% {
                    transform: translateY(0) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(-${window.innerHeight}px) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Gallery Functions
        function updateSuccessShowcase() {
            const gallery = document.getElementById('showcaseGallery');
            const recentSubmissions = successSubmissions.slice(0, 6); // Show latest 6
            
            gallery.innerHTML = recentSubmissions.map(submission => {
                const titleInfo = SUCCESS_TITLES[submission.title];
                const timeAgo = getTimeAgo(submission.timestamp);
                
                return `
                    <div class="showcase-item" onclick="viewSubmissionDetails(${submission.id})">
                        ${submission.type === 'video' ? 
                            `<video class="showcase-media" src="${submission.media}" muted></video>` :
                            `<img class="showcase-media" src="${submission.media}" alt="Challenge proof">`
                        }
                        <div class="success-badge ${submission.title.toLowerCase()}">
                            ${titleInfo ? titleInfo.icon : 'üèÜ'}
                        </div>
                        <div class="showcase-overlay">
                            <div style="font-weight: 600;">${submission.user}</div>
                            <div style="opacity: 0.8;">${timeAgo}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateFailureShowcase() {
            const gallery = document.getElementById('failureGallery');
            const recentFailures = failureConsequences.slice(0, 4); // Show latest 4
            
            gallery.innerHTML = recentFailures.map(failure => {
                const consequence = FAILURE_CONSEQUENCES[failure.consequence];
                const timeAgo = getTimeAgo(failure.timestamp);
                
                return `
                    <div class="failure-item" onclick="viewFailureDetails(${failure.id})">
                        <div class="failure-badge">${consequence ? consequence.icon : 'üò¢'}</div>
                        <div class="failure-name">${failure.user}</div>
                        <div class="failure-consequence">${failure.consequence}</div>
                        <div style="font-size: 7px; margin-top: 2px; opacity: 0.7;">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(timestamp) {
            const now = new Date();
            const diff = now - new Date(timestamp);
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (days > 0) return `${days}d ago`;
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            return 'just now';
        }

        // Modal Functions
        window.showModal = function(id) {
            document.getElementById(id + 'Modal').classList.add('show');
        }

        window.hideModal = function(id) {
            document.getElementById(id + 'Modal').classList.remove('show');
            
            // Reset proof modal if needed
            if (id === 'proofSubmission') {
                resetProofModal();
            }
        }

        function resetProofModal() {
            currentProofFile = null;
            document.getElementById('proofFileInput').value = '';
            document.getElementById('proofDescription').value = '';
            document.getElementById('proofPreviewContainer').style.display = 'none';
            document.getElementById('proofProgress').style.display = 'none';
            document.getElementById('submitProofBtn').disabled = false;
            document.getElementById('submitProofBtn').textContent = 'üöÄ Submit Proof';
            
            // Reset upload area
            document.getElementById('proofUploadArea').innerHTML = `
                <div style="font-size: 48px; margin-bottom: 10px;">üì∏</div>
                <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px; color: var(--primary-pink);">Click to Upload Proof</div>
                <div style="font-size: 12px; color: var(--text-secondary);">Photos, Videos, or Screenshots accepted</div>
                <div style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;">Max 50MB ‚Ä¢ JPG, PNG, MP4, MOV</div>
            `;
        }

        window.showProofGallery = function() {
            updateFullGallery();
            showModal('proofGallery');
        }

        window.showFailureHall = function() {
            updateFullFailureGallery();
            showModal('failureHall');
        }

        function updateFullGallery() {
            const container = document.getElementById('fullGalleryContainer');
            
            container.innerHTML = successSubmissions.map(submission => {
                const titleInfo = SUCCESS_TITLES[submission.title];
                const timeAgo = getTimeAgo(submission.timestamp);
                
                return `
                    <div class="showcase-item" onclick="viewSubmissionDetails(${submission.id})">
                        ${submission.type === 'video' ? 
                            `<video class="showcase-media" src="${submission.media}" muted></video>` :
                            `<img class="showcase-media" src="${submission.media}" alt="Challenge proof">`
                        }
                        <div class="success-badge ${submission.title.toLowerCase()}">
                            ${titleInfo ? titleInfo.icon : 'üèÜ'}
                        </div>
                        <div class="showcase-overlay">
                            <div style="font-weight: 600;">${submission.user}</div>
                            <div style="opacity: 0.8; font-size: 9px;">${submission.challenge}</div>
                            <div style="opacity: 0.6; font-size: 8px;">${timeAgo}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateFullFailureGallery() {
            const container = document.getElementById('fullFailureContainer');
            
            container.innerHTML = failureConsequences.map(failure => {
                const consequence = FAILURE_CONSEQUENCES[failure.consequence];
                const timeAgo = getTimeAgo(failure.timestamp);
                
                return `
                    <div class="failure-item" onclick="viewFailureDetails(${failure.id})" style="padding: 20px;">
                        <div class="failure-badge" style="font-size: 36px; margin-bottom: 10px;">${consequence ? consequence.icon : 'üò¢'}</div>
                        <div class="failure-name" style="font-size: 14px; margin-bottom: 5px;">${failure.user}</div>
                        <div class="failure-consequence" style="font-size: 12px; margin-bottom: 8px;">${failure.consequence}</div>
                        <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 5px;">${failure.challenge}</div>
                        <div style="font-size: 9px; opacity: 0.7;">${timeAgo}</div>
                        <div style="font-size: 8px; margin-top: 5px; padding: 4px; background: rgba(239, 68, 68, 0.1); border-radius: 4px; color: var(--error-red);">
                            ${consequence ? consequence.consequence : 'Must redeem themselves'}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Detail View Functions
        window.viewSubmissionDetails = function(id) {
            const submission = successSubmissions.find(s => s.id === id);
            if (!submission) return;
            
            const titleInfo = SUCCESS_TITLES[submission.title];
            
            showToast(`üèÜ ${submission.user} - ${titleInfo ? titleInfo.name : submission.title}\n"${submission.description}"\n+${submission.tokens} tokens earned!`, 'success');
        }

        window.viewFailureDetails = function(id) {
            const failure = failureConsequences.find(f => f.id === id);
            if (!failure) return;
            
            const consequence = FAILURE_CONSEQUENCES[failure.consequence];
            
            showToast(`üö® ${failure.user} - ${consequence ? consequence.name : failure.consequence}\nReason: ${failure.reason}\nConsequence: ${consequence ? consequence.consequence : 'Unknown'}`, 'error');
        }

        // Challenge Management Functions (keeping existing ones)
        window.takeChallenge = function(index) {
            const challenge = currentChallengeSet[index];
            if (!challenge) {
                showToast('‚ö†Ô∏è Challenge not found!', 'error');
                return;
            }

            if (confirm(`üéØ Ready to take on "${challenge.title}"?\n\n${challenge.aiGenerated ? 'ü§ñ This AI-generated challenge' : 'This challenge'} will reward you with ${challenge.tokens} tokens!\n\nClick OK to accept!`)) {
                showToast(`üéØ Challenge "${challenge.title}" accepted! ${challenge.aiGenerated ? 'ü§ñ AI Challenge' : ''}`, 'success');
                
                // Enable proof submission
                currentChallengeForProof = challenge;
                
                // Show current challenge status
                document.getElementById('currentChallengeStatus').style.display = 'block';
                document.getElementById('currentChallengeTitle').textContent = challenge.title;
                
                // Update main action button
                document.getElementById('mainActionBtn').textContent = 'üì∏ SUBMIT PROOF';
                document.getElementById('mainActionBtn').onclick = function() {
                    openProofSubmission(challenge);
                };
                
                // Track challenge acceptance
                challengeHistory.push({
                    challenge,
                    timestamp: new Date(),
                    accepted: true
                });
            }
        }

        // Failure System Functions
        function simulateRandomFailures() {
            // Randomly add failures for demo purposes
            if (Math.random() < 0.1) { // 10% chance every few seconds
                const users = ['Lazy Larry', 'Quitter Quinn', 'Excuse Eddie', 'Sleepy Sam', 'Procrastinator Pete'];
                const challenges = ['Morning Jog', 'Cook Healthy Meal', 'Read 30 Pages', 'Learn New Skill', 'Clean Room'];
                const consequences = Object.keys(FAILURE_CONSEQUENCES);
                
                const newFailure = {
                    id: Date.now(),
                    user: users[Math.floor(Math.random() * users.length)],
                    avatar: ['üò¥', 'üèÉ', 'ü§•', 'üòµ', 'ü´•'][Math.floor(Math.random() * 5)],
                    challenge: challenges[Math.floor(Math.random() * challenges.length)],
                    consequence: consequences[Math.floor(Math.random() * consequences.length)],
                    reason: generateFailureReason(),
                    timestamp: new Date()
                };
                
                failureConsequences.unshift(newFailure);
                if (failureConsequences.length > 10) {
                    failureConsequences = failureConsequences.slice(0, 10);
                }
                
                updateFailureShowcase();
                
                // Update notification badge
                document.getElementById('failureNotifications').textContent = failureConsequences.length;
            }
        }

        function generateFailureReason() {
            const reasons = [
                "Claimed their alarm clock was broken",
                "Said their dog ate the challenge instructions",
                "Insisted the weather wasn't cooperating",
                "Blamed it on a full moon affecting their energy",
                "Declared the challenge was 'too mainstream'",
                "Said they were saving the environment by not trying",
                "Claimed their horoscope advised against it",
                "Insisted they were testing the system's forgiveness",
                "Said they were on a challenge detox diet",
                "Blamed it on Mercury being in retrograde"
            ];
            
            return reasons[Math.floor(Math.random() * reasons.length)];
        }

        // Share Functions
        window.shareTitle = function() {
            const title = document.getElementById('awardedTitle').textContent;
            const tokens = document.getElementById('awardedTokens').textContent;
            
            if (navigator.share) {
                navigator.share({
                    title: `I earned the title: ${title}!`,
                    text: `Just earned "${title}" on JomBro and got ${tokens} tokens! üèÜ`,
                    url: window.location.href
                });
            } else {
                const text = `I just earned "${title}" on JomBro and got ${tokens} tokens! üèÜ Join me at ${window.location.href}`;
                navigator.clipboard?.writeText(text);
                showToast('üîó Achievement shared to clipboard!', 'success');
            }
            
            hideModal('titleAward');
        }

        // User Stats Functions
        function updateUserStats(tokensEarned) {
            // Update user level and tokens (mock implementation)
            const currentTokens = parseInt(document.getElementById('profileTokensDisplay')?.textContent || '1250');
            const newTokens = currentTokens + tokensEarned;
            
            if (document.getElementById('profileTokensDisplay')) {
                document.getElementById('profileTokensDisplay').textContent = newTokens.toLocaleString();
            }
            
            // Update level if needed
            const newLevel = Math.floor(newTokens / 1000) + 1;
            if (document.getElementById('profileLevelDisplay')) {
                document.getElementById('profileLevelDisplay').textContent = `Level ${newLevel}`;
            }
            
            if (document.getElementById('userLevel')) {
                document.getElementById('userLevel').textContent = `Level ${newLevel}`;
            }
        }

        // Initialize the proof system
        function initializeProofSystem() {
            updateSuccessShowcase();
            updateFailureShowcase();
            
            // Update notification badges
            document.getElementById('galleryNotifications').textContent = successSubmissions.length;
            document.getElementById('failureNotifications').textContent = failureConsequences.length;
            
            // Simulate random failures for demo
            setInterval(simulateRandomFailures, 10000); // Every 10 seconds
            
            // Add drag and drop support for proof upload
            const uploadArea = document.getElementById('proofUploadArea');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const event = { target: { files: [files[0]] } };
                    handleProofUpload(event);
                }
            });
        }

        // ===== EXISTING SYSTEM INTEGRATION =====
        // (Keep all the existing code from the previous version)

        // Background Management System
        let currentBackground = 'space';
        
        function switchBackground(type) {
            // Update active button in profile modal
            document.querySelectorAll('.background-option').forEach(option => option.classList.remove('active'));
            const activeOption = document.querySelector(`[data-bg="${type}"]`);
            if (activeOption) {
                activeOption.classList.add('active');
            }
            
            // Hide all backgrounds
            document.querySelectorAll('.background-content').forEach(bg => bg.classList.remove('active'));
            
            // Show selected background
            switch(type) {
                case 'space':
                    document.getElementById('spaceBackground').classList.add('active');
                    break;
                case 'planets':
                    document.getElementById('spacePlanetsBackground').classList.add('active');
                    break;
                case 'animated':
                    document.getElementById('animatedBackground').classList.add('active');
                    break;
                case 'video':
                    document.getElementById('videoBackground').classList.add('active');
                    break;
            }
            
            currentBackground = type;
            showToast(`‚ú® Background changed to ${type}!`, 'success');
        }
        
        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('video/')) {
                const video = document.getElementById('customVideo');
                const url = URL.createObjectURL(file);
                video.src = url;
                
                // Switch to video background
                switchBackground('video');
                showToast('üìπ Custom video uploaded!', 'success');
            } else {
                showToast('‚ùå Please select a valid video file!', 'error');
            }
        }

        // Mock Authentication Functions
        window.signInWithGoogle = function() {
            showSuccess('Google sign-in successful!');
            setTimeout(() => {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('chatToggle').style.display = 'block';
                document.getElementById('userDisplayName').textContent = 'Demo User';
                initializeApp();
            }, 1000);
        }

        window.signInWithFacebook = function() {
            showSuccess('Facebook sign-in successful!');
            setTimeout(() => {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('chatToggle').style.display = 'block';
                document.getElementById('userDisplayName').textContent = 'Demo User';
                initializeApp();
            }, 1000);
        }

        window.signInAnonymously = function() {
            showSuccess('Test mode activated!');
            setTimeout(() => {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('chatToggle').style.display = 'block';
                document.getElementById('userDisplayName').textContent = 'Test User';
                initializeApp();
            }, 1000);
        }

        window.showPhoneForm = function() {
            document.getElementById('mainAuth').style.display = 'none';
            document.getElementById('phoneForm').style.display = 'block';
        }

        window.showMainAuth = function() {
            document.getElementById('phoneForm').style.display = 'none';
            document.getElementById('mainAuth').style.display = 'block';
        }

        window.signInWithPhone = function() {
            showSuccess('Phone verification successful!');
            setTimeout(() => {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('chatToggle').style.display = 'block';
                document.getElementById('userDisplayName').textContent = 'Phone User';
                initializeApp();
            }, 1000);
        }

        window.signOut = function() {
            document.getElementById('authScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('chatToggle').style.display = 'none';
            showSuccess('Signed out successfully!');
        }

        // App Initialization
        function initializeApp() {
            initializeChallenges();
            initializeOnlineUsers();
            initializeProofSystem(); // Initialize the new proof system
            console.log('üì± App fully loaded with Enhanced Challenge Proof System!');
        }

        // Comprehensive Challenge Database (keeping existing challenges)
        const MASTER_CHALLENGE_DATABASE = {
            SOCIAL: {
                name: 'Social Connection',
                icon: 'üë•',
                color: '#ff6b9d',
                challenges: [
                    {
                        id: 'social_001',
                        title: 'Coffee Shop Poetry Challenge',
                        description: 'Visit any coffee shop and ask the barista to write a short poem on your cup or napkin! Share your experience with friends and see who gets the most creative poem!',
                        difficulty: 'Easy',
                        duration: '30m',
                        tokens: 500,
                        hashtags: ['#CoffeePoetry', '#Connection', '#JomBro'],
                        aiPrompt: 'Create a social challenge involving coffee shops and creativity'
                    },
                    {
                        id: 'social_002',
                        title: 'Random Compliment Challenge',
                        description: 'Give genuine compliments to 5 strangers today. Watch how their faces light up and document the positive reactions!',
                        difficulty: 'Easy',
                        duration: '1h',
                        tokens: 400,
                        hashtags: ['#Kindness', '#Social', '#GoodVibes'],
                        aiPrompt: 'Create a kindness-based social interaction challenge'
                    },
                    {
                        id: 'social_003',
                        title: 'Language Exchange Adventure',
                        description: 'Find someone who speaks a different language and teach each other 10 words. Record a video of your mini language lesson!',
                        difficulty: 'Medium',
                        duration: '45m',
                        tokens: 650,
                        hashtags: ['#Language', '#Cultural', '#Learning'],
                        aiPrompt: 'Create a cultural exchange challenge involving language'
                    },
                    {
                        id: 'social_004',
                        title: 'Elderly Wisdom Quest',
                        description: 'Spend 30 minutes talking to an elderly person and learn one life lesson from them. Share their wisdom (with permission)!',
                        difficulty: 'Medium',
                        duration: '45m',
                        tokens: 700,
                        hashtags: ['#Wisdom', '#Respect', '#Generations'],
                        aiPrompt: 'Create an intergenerational connection challenge'
                    },
                    {
                        id: 'social_005',
                        title: 'Public Thank You Mission',
                        description: 'Publicly thank 3 service workers (cashier, cleaner, security guard, etc.) and tell them specifically why you appreciate their work!',
                        difficulty: 'Easy',
                        duration: '1h',
                        tokens: 450,
                        hashtags: ['#Gratitude', '#ServiceWorkers', '#Appreciation'],
                        aiPrompt: 'Create a gratitude-focused social challenge'
                    }
                ]
            },
            FITNESS: {
                name: 'Fitness & Health',
                icon: 'üí™',
                color: '#10b981',
                challenges: [
                    {
                        id: 'fitness_001',
                        title: 'Sunrise Workout Challenge',
                        description: 'Wake up early and do a 20-minute workout outside during sunrise. Capture the golden hour and inspire others with your dedication!',
                        difficulty: 'Medium',
                        duration: '45m',
                        tokens: 600,
                        hashtags: ['#SunriseWorkout', '#Fitness', '#EarlyBird'],
                        aiPrompt: 'Create a morning fitness challenge with nature'
                    },
                    {
                        id: 'fitness_002',
                        title: 'Stair Climbing Marathon',
                        description: 'For one full day, take stairs instead of elevators/escalators. Count total floors climbed and celebrate your achievement!',
                        difficulty: 'Easy',
                        duration: '1 day',
                        tokens: 400,
                        hashtags: ['#Stairs', '#Fitness', '#HealthyChoices'],
                        aiPrompt: 'Create a daily fitness habit challenge'
                    },
                    {
                        id: 'fitness_003',
                        title: 'Dance Battle Flashmob',
                        description: 'Learn a 1-minute dance routine and perform it in a public space. Record the reactions and spread joy through movement!',
                        difficulty: 'Hard',
                        duration: '2h',
                        tokens: 800,
                        hashtags: ['#Dance', '#PublicPerformance', '#Joy'],
                        aiPrompt: 'Create a dance-based fitness challenge'
                    },
                    {
                        id: 'fitness_004',
                        title: 'Nature Obstacle Course',
                        description: 'Create and complete an obstacle course using only natural elements (logs, rocks, trees). Document your creative course!',
                        difficulty: 'Medium',
                        duration: '1h',
                        tokens: 550,
                        hashtags: ['#Nature', '#Obstacle', '#Creativity'],
                        aiPrompt: 'Create a nature-based fitness challenge'
                    },
                    {
                        id: 'fitness_005',
                        title: 'Walking Meeting Challenge',
                        description: 'Replace all your meetings/calls today with walking meetings. Track distance and share how movement improved your conversations!',
                        difficulty: 'Easy',
                        duration: '1 day',
                        tokens: 350,
                        hashtags: ['#Walking', '#Productivity', '#Health'],
                        aiPrompt: 'Create a workplace fitness integration challenge'
                    }
                ]
            },
            CREATIVE: {
                name: 'Creative Expression',
                icon: 'üé®',
                color: '#8b5cf6',
                challenges: [
                    {
                        id: 'creative_001',
                        title: 'One-Minute Story Challenge',
                        description: 'Record yourself telling a complete story in exactly 60 seconds. It can be real or fictional - just make it engaging and memorable!',
                        difficulty: 'Medium',
                        duration: '30m',
                        tokens: 550,
                        hashtags: ['#Storytelling', '#Creative', '#VideoChallenge'],
                        aiPrompt: 'Create a storytelling-based creative challenge'
                    },
                    {
                        id: 'creative_002',
                        title: 'Food Art Masterpiece',
                        description: 'Create art using only food items. Make a face with your breakfast, build a landscape with vegetables, or design edible sculptures!',
                        difficulty: 'Easy',
                        duration: '20m',
                        tokens: 350,
                        hashtags: ['#FoodArt', '#Creative', '#Breakfast'],
                        aiPrompt: 'Create a food-based artistic challenge'
                    },
                    {
                        id: 'creative_003',
                        title: 'Trash to Treasure Challenge',
                        description: 'Create something beautiful or useful from items you would normally throw away. Document your transformation process!',
                        difficulty: 'Medium',
                        duration: '1h',
                        tokens: 600,
                        hashtags: ['#Upcycle', '#Sustainability', '#Art'],
                        aiPrompt: 'Create an eco-friendly creative challenge'
                    },
                    {
                        id: 'creative_004',
                        title: 'Shadow Art Photography',
                        description: 'Create and photograph 5 different artistic shadows using everyday objects. Play with light, angles, and creativity!',
                        difficulty: 'Medium',
                        duration: '45m',
                        tokens: 500,
                        hashtags: ['#Shadow', '#Photography', '#Light'],
                        aiPrompt: 'Create a light and shadow photography challenge'
                    },
                    {
                        id: 'creative_005',
                        title: 'Musical Instrument Innovation',
                        description: 'Create a musical instrument from household items and compose a 30-second song. Record your performance!',
                        difficulty: 'Hard',
                        duration: '1h',
                        tokens: 750,
                        hashtags: ['#Music', '#Innovation', '#DIY'],
                        aiPrompt: 'Create a music creation challenge with household items'
                    }
                ]
            },
            ADVENTURE: {
                name: 'Adventure & Exploration',
                icon: 'üó∫Ô∏è',
                color: '#f59e0b',
                challenges: [
                    {
                        id: 'adventure_001',
                        title: 'Mystery Location Challenge',
                        description: 'Close your eyes, point to a spot on a map within 10km, and visit that exact location. Discover something new about your area!',
                        difficulty: 'Hard',
                        duration: '3h',
                        tokens: 900,
                        hashtags: ['#Adventure', '#Exploration', '#Mystery'],
                        aiPrompt: 'Create a random exploration adventure challenge'
                    },
                    {
                        id: 'adventure_002',
                        title: 'Photo Scavenger Hunt',
                        description: 'Find and photograph: something blue, something old, something that makes you smile, something unexpected, and something moving!',
                        difficulty: 'Medium',
                        duration: '1h',
                        tokens: 650,
                        hashtags: ['#ScavengerHunt', '#Photography', '#Adventure'],
                        aiPrompt: 'Create a photo-based scavenger hunt challenge'
                    },
                    {
                        id: 'adventure_003',
                        title: 'Transportation Roulette',
                        description: 'Use 3 different modes of transportation in one journey (bus, bike, walking, etc.). Document your multi-modal adventure!',
                        difficulty: 'Medium',
                        duration: '2h',
                        tokens: 700,
                        hashtags: ['#Transport', '#Urban', '#Journey'],
                        aiPrompt: 'Create a transportation variety challenge'
                    },
                    {
                        id: 'adventure_004',
                        title: 'Sunrise to Sunset Quest',
                        description: 'Document your city from sunrise to sunset by taking photos every 2 hours. Create a time-lapse of your day!',
                        difficulty: 'Hard',
                        duration: '1 day',
                        tokens: 1000,
                        hashtags: ['#TimelineRoulette', '#Photography', '#FullDay'],
                        aiPrompt: 'Create a full-day documentation challenge'
                    },
                    {
                        id: 'adventure_005',
                        title: 'Local Legend Investigation',
                        description: 'Research a local legend, myth, or historical story, then visit the location and create content about your findings!',
                        difficulty: 'Medium',
                        duration: '2h',
                        tokens: 800,
                        hashtags: ['#History', '#Local', '#Research'],
                        aiPrompt: 'Create a local history investigation challenge'
                    }
                ]
            },
            MINDFULNESS: {
                name: 'Mindfulness & Growth',
                icon: 'üß†',
                color: '#06b6d4',
                challenges: [
                    {
                        id: 'mindful_001',
                        title: 'Digital Detox Hour',
                        description: 'Spend 1 hour completely disconnected from all digital devices. Document what you discovered about yourself during this time!',
                        difficulty: 'Hard',
                        duration: '1h',
                        tokens: 600,
                        hashtags: ['#DigitalDetox', '#Mindfulness', '#SelfCare'],
                        aiPrompt: 'Create a mindfulness and digital wellness challenge'
                    },
                    {
                        id: 'mindful_002',
                        title: 'Gratitude Photography',
                        description: 'Take photos of 10 things you\'re grateful for today. Write a short caption for each explaining why it matters to you!',
                        difficulty: 'Easy',
                        duration: '30m',
                        tokens: 400,
                        hashtags: ['#Gratitude', '#Photography', '#Positive'],
                        aiPrompt: 'Create a gratitude-based mindfulness challenge'
                    },
                    {
                        id: 'mindful_003',
                        title: 'Random Acts Documentation',
                        description: 'Perform 3 random acts of kindness and document the impact (with permission). Spread positivity and track the ripple effect!',
                        difficulty: 'Medium',
                        duration: '2h',
                        tokens: 750,
                        hashtags: ['#Kindness', '#Impact', '#Community'],
                        aiPrompt: 'Create a kindness documentation challenge'
                    },
                    {
                        id: 'mindful_004',
                        title: 'Fear Facing Challenge',
                        description: 'Do something that scares you (but is safe) - public speaking, trying new food, talking to strangers. Document your growth!',
                        difficulty: 'Hard',
                        duration: '1h',
                        tokens: 800,
                        hashtags: ['#GrowthMindset', '#Courage', '#PersonalDevelopment'],
                        aiPrompt: 'Create a courage and personal growth challenge'
                    },
                    {
                        id: 'mindful_005',
                        title: 'Meditation Spot Hunt',
                        description: 'Find the most peaceful spot in your area and meditate there for 15 minutes. Share your hidden gem with others!',
                        difficulty: 'Easy',
                        duration: '45m',
                        tokens: 450,
                        hashtags: ['#Meditation', '#PeacefulPlaces', '#Mindfulness'],
                        aiPrompt: 'Create a meditation and peaceful space discovery challenge'
                    }
                ]
            }
        };

        // Challenge Management System (keeping existing)
        let challengeHistory = [];
        let availableChallenges = [];
        let currentChallengeSet = [];
        let usedChallengeIds = new Set();

        // Keep all existing functions for challenge management, online users, chat, etc.
        // (The rest of the code remains the same as in the previous version)

        function getAllChallenges() {
            const allChallenges = [];
            Object.keys(MASTER_CHALLENGE_DATABASE).forEach(categoryKey => {
                const category = MASTER_CHALLENGE_DATABASE[categoryKey];
                category.challenges.forEach(challenge => {
                    allChallenges.push({
                        ...challenge,
                        category: categoryKey,
                        categoryInfo: category
                    });
                });
            });
            return allChallenges;
        }

        async function generateSmartChallengeSet(count = 3) {
            const allChallenges = getAllChallenges();
            const totalChallenges = allChallenges.length;
            
            if (usedChallengeIds.size >= totalChallenges) {
                usedChallengeIds.clear();
                challengeHistory = [];
                showToast('üîÑ Challenge cycle completed! Starting fresh rotation.', 'info');
            }
            
            const unusedChallenges = allChallenges.filter(challenge => 
                !usedChallengeIds.has(challenge.id)
            );
            
            let selectedChallenges = [];
            
            if (unusedChallenges.length >= count) {
                const categoriesUsed = new Set();
                const finalChallenges = [];
                
                const shuffled = unusedChallenges.sort(() => 0.5 - Math.random());
                
                for (const challenge of shuffled) {
                    if (finalChallenges.length >= count) break;
                    
                    if (!categoriesUsed.has(challenge.category) || finalChallenges.length >= count - 1) {
                        finalChallenges.push(challenge);
                        categoriesUsed.add(challenge.category);
                        usedChallengeIds.add(challenge.id);
                    }
                }
                
                selectedChallenges = [...selectedChallenges, ...finalChallenges];
            } else {
                selectedChallenges = [...selectedChallenges, ...unusedChallenges];
                const stillNeeded = count - selectedChallenges.length;
                
                if (stillNeeded > 0) {
                    const usedChallenges = allChallenges
                        .filter(c => usedChallengeIds.has(c.id))
                        .sort(() => 0.5 - Math.random())
                        .slice(0, stillNeeded);
                    selectedChallenges = [...selectedChallenges, ...usedChallenges];
                }
            }
            
            selectedChallenges.forEach(challenge => {
                usedChallengeIds.add(challenge.id);
                challengeHistory.push({
                    challenge,
                    timestamp: new Date(),
                    used: true
                });
            });
            
            return selectedChallenges.slice(0, count);
        }

        // Enhanced Challenge Display
        function initializeChallenges() {
            generateAndDisplayChallenges();
        }

        async function generateAndDisplayChallenges() {
            try {
                currentChallengeSet = await generateSmartChallengeSet(3);
                displayChallengeSelection();
                
                const totalChallenges = getAllChallenges().length;
                const used = usedChallengeIds.size;
                const progress = Math.round((used / totalChallenges) * 100);
                
                if (used > 0) {
                    showToast(`üéØ Challenge ${used}/${totalChallenges} (${progress}% explored)`, 'info');
                }
            } catch (error) {
                console.error('Challenge generation failed:', error);
                showToast('‚ö†Ô∏è Challenge generation failed, using fallback', 'error');
                currentChallengeSet = getAllChallenges().slice(0, 3);
                displayChallengeSelection();
            }
        }

        function displayChallengeSelection() {
            const container = document.getElementById('challengeSelection');
            container.innerHTML = '';

            currentChallengeSet.forEach((challenge, index) => {
                const challengeCard = document.createElement('div');
                challengeCard.className = 'challenge-card';
                
                challengeCard.innerHTML = `
                    <div class="challenge-category-badge" style="background: ${challenge.categoryInfo.color}">
                        ${challenge.categoryInfo.icon} ${challenge.categoryInfo.name}
                    </div>
                    <div style="margin-top: 30px;">
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px; color: var(--primary-pink);">
                            ${challenge.title}
                        </div>
                        <div style="font-size: 13px; line-height: 1.4; margin-bottom: 15px; opacity: 0.9; color: var(--text-secondary);">
                            ${challenge.description}
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;">
                            <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px; backdrop-filter: blur(15px);">
                                <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${challenge.tokens}</div>
                                <div style="font-size: 9px; color: var(--text-secondary);">TOKENS</div>
                            </div>
                            <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px; backdrop-filter: blur(15px);">
                                <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${challenge.difficulty}</div>
                                <div style="font-size: 9px; color: var(--text-secondary);">LEVEL</div>
                            </div>
                            <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px; backdrop-filter: blur(15px);">
                                <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${challenge.duration}</div>
                                <div style="font-size: 9px; color: var(--text-secondary);">TIME</div>
                            </div>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 15px;">
                            ${challenge.hashtags.map(tag => `<span style="font-size: 9px; padding: 2px 6px; background: rgba(255, 107, 157, 0.1); color: var(--primary-pink); border-radius: 6px;">${tag}</span>`).join('')}
                        </div>
                        <button class="btn-primary" onclick="takeChallenge(${index})" style="width: 100%; padding: 12px; font-size: 13px;">
                            üöÄ TAKE CHALLENGE
                        </button>
                    </div>
                `;

                container.appendChild(challengeCard);
            });
        }

        window.refreshChallenges = async function() {
            const refreshBtn = document.querySelector('[onclick="refreshChallenges()"]');
            refreshBtn.style.opacity = '0.5';
            refreshBtn.style.pointerEvents = 'none';
            
            try {
                await generateAndDisplayChallenges();
                showToast('‚ú® New challenges generated!', 'success');
            } catch (error) {
                showToast('‚ö†Ô∏è Challenge refresh failed', 'error');
            } finally {
                refreshBtn.style.opacity = '1';
                refreshBtn.style.pointerEvents = 'auto';
            }
        }

        // Online Users System
        function initializeOnlineUsers() {
            const players = [
                { name: 'Alex Chen', avatar: 'üòé', activity: 'Coffee Shop Challenge', level: 5, status: 'online' },
                { name: 'Maya Patel', avatar: 'üåü', activity: 'Sunrise Workout', level: 3, status: 'online' },
                { name: 'Jordan Kim', avatar: 'üöÄ', activity: 'Street Art Hunt', level: 7, status: 'online' },
                { name: 'Sam Wilson', avatar: 'üé®', activity: 'Reading in park', level: 2, status: 'online' },
                { name: 'Rio Martinez', avatar: '‚ö°', activity: 'Coding challenge', level: 6, status: 'online' },
                { name: 'Casey Wong', avatar: 'ü¶ã', activity: 'Food art creating', level: 4, status: 'online' },
                { name: 'Robin Lee', avatar: 'üî•', activity: 'Mystery exploration', level: 8, status: 'online' },
                { name: 'Taylor Swift', avatar: 'üí´', activity: 'Photo scavenger hunt', level: 3, status: 'online' }
            ];
            
            const offlineUsers = [
                { name: 'Emma Stone', avatar: 'üåô', activity: 'Last seen 2h ago', level: 4, status: 'offline' },
                { name: 'Chris Evans', avatar: '‚≠ê', activity: 'Last seen 5h ago', level: 6, status: 'offline' },
                { name: 'Zoe Clark', avatar: 'üéØ', activity: 'Last seen 1d ago', level: 2, status: 'offline' }
            ];
            
            window.allUsers = [...players, ...offlineUsers];
            window.onlineUsers = players;
            
            updateOnlineCount();
            updateLivePlayersDisplay();
        }

        function updateOnlineCount() {
            const onlineCount = window.onlineUsers?.length || 0;
            document.getElementById('onlineCount').textContent = `${onlineCount} online`;
            document.getElementById('onlineUsersNotifications').textContent = onlineCount;
        }

        function updateLivePlayersDisplay() {
            const container = document.getElementById('livePlayersContainer');
            const onlineNow = window.onlineUsers?.slice(0, 8) || [];
            
            container.innerHTML = onlineNow.map(user => `
                <div class="player-avatar" onclick="viewUserProfile('${user.name}')" title="${user.name} - ${user.activity}">
                    <div class="avatar-ring">
                        <div class="avatar-inner">
                            <span style="font-size: 18px;">${user.avatar}</span>
                        </div>
                    </div>
                    <div class="avatar-status ${user.status}"></div>
                    <div class="player-level">L${user.level}</div>
                </div>
            `).join('');
        }

        // Additional Modal Functions
        window.showMyTasks = function() {
            showToast('üìã Tasks feature coming soon!', 'info');
        }

        window.showEnhancedProfile = function() {
            showToast('üë§ Enhanced profile coming soon!', 'info');
        }

        window.showProfile = function() {
            showToast('üë§ Profile coming soon!', 'info');
        }

        window.showGroups = function() {
            showToast('üè† Groups feature coming soon!', 'info');
        }

        window.showOnlineUsers = function() {
            showToast('üë• Online users feature coming soon!', 'info');
        }

        window.showSettings = function() {
            showToast('‚öôÔ∏è Settings coming soon!', 'info');
        }

        window.showChallengeAgreement = function() {
            showToast('üéØ Ready to challenge! Choose any challenge above!', 'success');
        }

        window.viewChallenge = function() {
            showToast('üëÄ Challenge details coming soon!', 'info');
        }

        window.viewUserProfile = function(userName) {
            showToast(`üë§ Viewing ${userName}'s profile - Coming soon!`, 'info');
        }

        // Chat Functions
        window.toggleChat = function() {
            const chatInterface = document.getElementById('chatInterface');
            const chatToggle = document.getElementById('chatToggle');
            
            if (chatInterface.classList.contains('open')) {
                chatInterface.classList.remove('open');
                chatToggle.style.display = 'block';
            } else {
                chatInterface.classList.add('open');
                chatToggle.style.display = 'none';
                initializeChat();
            }
        }

        function initializeChat() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div style="display: flex; justify-content: center; margin: 10px 0;">
                    <div style="background: rgba(255, 255, 255, 0.1); color: var(--text-secondary); font-size: 12px; text-align: center; max-width: 80%; padding: 8px 12px; border-radius: 12px;">
                        Welcome to the challenge group chat! Start discussing your challenges here.
                    </div>
                </div>
            `;
            
            setTimeout(() => addChatMessage('Alex Chen', 'üòé', 'Anyone want to join the coffee shop challenge? ‚òï', false), 1000);
            setTimeout(() => addChatMessage('Maya Patel', 'üåü', 'I\'m in! Which coffee shop should we try? üöÄ', false), 2000);
            setTimeout(() => addChatMessage('Jordan Kim', 'üöÄ', 'There\'s a great one downtown with amazing poetry vibes!', false), 3000);
        }

        function addChatMessage(sender, avatar, text, isOwn) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.innerHTML = `
                <div style="display: flex; ${isOwn ? 'flex-direction: row-reverse;' : ''} gap: 10px; margin-bottom: 10px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: ${isOwn ? 'var(--primary-pink)' : 'linear-gradient(45deg, var(--primary-blue), var(--primary-purple))'}; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0;">${avatar}</div>
                    <div style="background: ${isOwn ? 'var(--primary-pink)' : 'rgba(255,255,255,0.1)'}; padding: 8px 12px; border-radius: 12px; max-width: 70%; word-wrap: break-word;">
                        <div style="font-size: 14px; line-height: 1.4;">${text}</div>
                        <div style="font-size: 11px; color: ${isOwn ? 'rgba(255,255,255,0.8)' : 'var(--text-secondary)'}; margin-top: 4px;">now</div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        window.sendMessage = function() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            addChatMessage('You', 'ü§ó', text, true);
            input.value = '';
            
            setTimeout(() => {
                const responses = [
                    { sender: 'Maya Patel', avatar: 'üåü', text: 'That sounds awesome! üéâ' },
                    { sender: 'Alex Chen', avatar: 'üòé', text: 'Count me in! When do we start?' },
                    { sender: 'Jordan Kim', avatar: 'üöÄ', text: 'Great idea! Let\'s do this together!' }
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                addChatMessage(response.sender, response.avatar, response.text, false);
            }, 1500);
        }

        window.handleChatKeyPress = function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Utility Functions
        function showError(message) {
            showToast(message, 'error');
        }

        function showSuccess(message) {
            showToast(message, 'success');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.textContent = message;
            
            Object.assign(toast.style, {
                position: 'fixed',
                top: '20px',
                left: '50%',
                transform: 'translateX(-50%)',
                background: type === 'success' ? 'var(--success-green)' : 
                           type === 'error' ? 'var(--error-red)' : 'var(--primary-pink)',
                color: 'white',
                padding: '12px 20px',
                borderRadius: '10px',
                zIndex: '4000',
                fontSize: '14px',
                fontWeight: '600',
                opacity: '0',
                transition: 'all 0.3s ease',
                maxWidth: '90%',
                textAlign: 'center',
                backdropFilter: 'blur(20px)',
                border: '1px solid rgba(255, 255, 255, 0.1)',
                boxShadow: '0 8px 32px rgba(0, 0, 0, 0.3)'
            });
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(-50%) translateY(10px)';
            }, 100);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Initialize the app when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ JomBro Enhanced Challenge Proof System Loaded!');
            console.log('‚ú® New Features: Success Showcase, Failure Consequences, Title Awards');
            console.log('üèÜ Success Titles: Genius, Winner, Excellence, Achiever, Champion, Legend, Master, Innovator');
            console.log('üö® Failure Consequences: Wanted, Jailed, On Trial, Suspect, Banned, Walk of Shame');
            console.log('üì∏ Upload proof photos/videos to earn prestigious titles!');
        });
    </script>
</body>
</html>
