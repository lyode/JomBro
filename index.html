// Helper function to safely get serverTimestamp
        function getServerTimestamp() {
            return firebase && firebase.firestore && firebase.firestore.FieldValue 
                ? firebase.firestore.FieldValue.serverTimestamp() 
                : new Date();
        }

        // Helper function to safely use field increment
        function getFieldIncrement(value) {
            return firebase && firebase.firestore && firebase.firestore.FieldValue 
                ? firebase.firestore.FieldValue.increment(value) 
                : value;
        }

        // Utility Functions - Define these first before using them
        function showMessage(message, type = 'info') {
            // Remove existing messages
            document.querySelectorAll('.message').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `message ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 4000);
        }

        function setButtonLoading(button, loading) {
            if (loading) {
                button.disabled = true;
                button.classList.add('loading');
            } else {
                button.disabled = false;
                button.classList.remove('loading');
            }
        }

        function getRandomAvatar() {
            const avatars = ['ğŸ˜', 'ğŸŒ¸', 'ğŸš€', 'ğŸ’ª', 'ğŸµ', 'ğŸ¨', 'ğŸ¤ ', 'ğŸŒŸ', 'ğŸ¯', 'ğŸ­', 'ğŸª', 'ğŸŒˆ', 'ğŸ²', 'ğŸŠ', 'ğŸŒº', 'âš¡', 'ğŸŒ™', 'ğŸ”¥'];
            return avatars[Math.floor(Math.random() * avatars.length)];
        }

        // Initialize App
        async function initApp() {
            try {
                console.log('ğŸš€ Initializing JomBro App...');
                
                // Wait for Firebase to be ready
                let attempts = 0;
                while (!initializeFirebase() && attempts < 10) {
                    console.log('â³ Waiting for Firebase...');
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (!db || !auth) {
                    throw new Error('Firebase failed to initialize');
                }
                
                createStarfield();
                setupEventListeners();
                
                // Check for existing session
                checkExistingSession();
                
                console.log('âœ… JomBro initialization complete');
                
            } catch (error) {
                console.error('âŒ App initialization error:', error);
                showMessage('âš ï¸ Failed to initialize JomBro. Please refresh the page.', 'error');
            }
        }
