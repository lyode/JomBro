/* ===== BETA LAUNCH ELEMENTS ===== */
        .beta-feedback-btn {
            position: fixed;
            top: calc(var(--safe-area-top) + 150px);
            left: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 215, 0, 0.9);
            border: 2px solid #FFD700;
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1100;
            color: #000;
            font-weight: 700;
            text-shadow: none;
            box-shadow: 
                0 4px 12px rgba(255, 215, 0, 0.4),
                0 0 20px rgba(255, 215, 0, 0.2);
            animation: betaPulse 3s ease-in-out infinite;
            transition: all var(--animation-duration) ease;
        }

        .beta-feedback-btn:hover {
            transform: scale(1.1);
            box-shadow: 
                0 6px 16px rgba(255, 215, 0, 0.6),
                0 0 30px rgba(255, 215, 0, 0.4);
        }

        @keyframes betaPulse {
            0%, 100% { 
                transform: scale(1);
                opacity: 0.9;
            }
            50% { 
                transform: scale(1.05);
                opacity: 1;
            }
        }

        /* Beta Welcome Modal Enhancements */
        .beta-welcome-content {
            background: linear-gradient(135deg, 
                rgba(0, 255, 150, 0.1) 0%, 
                rgba(255, 215, 0, 0.1) 100%);
            border: 2px solid rgba(0, 255, 150, 0.3);
        }

        /* Onboarding Steps */
        .onboarding-step {
            text-align: center;
            padding: 30px 20px;
        }

        .onboarding-icon {
            font-size: 72px;
            margin-bottom: 25px;
            filter: drop-shadow(0 0 20px rgba(0, 255, 150, 0.5));
        }

        .onboarding-title {
            font-size: 24px;
            font-weight: 700;
            color: #00FF96;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(0, 255, 150, 0.5);
        }

        .onboarding-description {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .onboarding-progress {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.3);
            transition: all var(--animation-duration) ease;
        }

        .progress-dot.active {
            background: #00FF96;
            box-shadow: 0 0 10px rgba(0, 255, 150, 0.5);
        }

        /* Launch Ready Indicators */
        .launch-ready-badge {
            position: fixed;
            bottom: calc(var(--safe-area-bottom) + 100px);
            left: 20px;
            background: rgba(0, 255, 150, 0.9);
            color: #000;
            padding: 8px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 700;
            z-index: 1000;
            border: 2px solid #00FF96;
            animation: launchPulse 2s ease-in-out infinite;
        }

        @keyframes launchPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Beta Disclaimer */
        .beta-disclaimer {
            position: fixed;
            bottom: calc(var(--safe-area-bottom) + 5px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 4px 12px;
            font-size: 10px;
            z-index: 999;
            backdrop-filter: blur(10px);
            text-align: center;
        }    <!-- Beta Launch Welcome Modal -->
    <div id="betaWelcomeModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 64px; margin-bottom: 20px;">üöÄ</div>
                <h2 style="color: #00FF96; margin-bottom: 15px;">Welcome to JomBro Beta!</h2>
                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 25px; line-height: 1.6;">
                    You're part of our exclusive beta launch! Complete real-world challenges, 
                    earn tokens, and help us build the future of social challenges.
                </p>
                
                <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 12px; padding: 15px; margin: 20px 0;">
                    <div style="color: #FFD700; font-weight: 600; margin-bottom: 8px;">üéâ Beta Perks</div>
                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px; line-height: 1.4;">
                        ‚Ä¢ Free access to all features<br>
                        ‚Ä¢ Exclusive founder badge<br>
                        ‚Ä¢ Direct feedback to developers<br>
                        ‚Ä¢ Early access to new challenges
                    </div>
                </div>
                
                <div style="background: rgba(0, 255, 150, 0.1); border: 1px solid rgba(0, 255, 150, 0.3); border-radius: 12px; padding: 15px; margin: 20px 0;">
                    <div style="color: #00FF96; font-weight: 600; margin-bottom: 8px;">üíù 100% Free</div>
                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">
                        No payments, no subscriptions. Just pure challenge fun!
                    </div>
                </div>
            </div>
            
            <button class="btn-primary" onclick="startOnboarding(); hideModal('betaWelcome');">
                üéØ Let's Go! Let's Go!
            </button>
            <button class="btn-secondary" onclick="skipOnboarding(); hideModal('betaWelcome');">
                Skip Tutorial
            </button>
        </div>
    </div>

    <!-- Onboarding Tutorial -->
    <div id="onboardingModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div id="onboardingContent">
                <!-- Dynamic onboarding content -->
            </div>
        </div>
    </div>

    <!-- Beta Feedback Floating Button -->
    <div class="beta-feedback-btn" onclick="showQuickFeedback()" title="Send Beta Feedback">
        <span style="font-size: 18px;">üìù</span>
        <span style="font-size: 8px; margin-top: 2px;">BETA</span>
    </div>        /* ===== COMPREHENSIVE PROFILE PAGE ===== */
        .profile-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 2000;
            padding: var(--safe-area-top) 0 calc(var(--safe-area-bottom) + 20px) 0;
            overflow-y: auto;
        }

        .profile-page.show {
            display: block !important;
            animation: slideInFromRight 0.4s ease;
        }

        .profile-page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }

        .profile-page-title {
            font-size: 24px;
            font-weight: 600;
            color: #00FF96;
            text-shadow: 0 0 20px rgba(0, 255, 150, 0.6);
        }

        .profile-share-btn {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #fff;
            font-size: 18px;
            transition: all var(--animation-duration) ease;
        }

        .profile-share-btn:hover {
            background: rgba(0, 255, 150, 0.2);
            border-color: rgba(0, 255, 150, 0.5);
        }

        /* Profile Hero Section */
        .profile-hero {
            display: flex;
            align-items: center;
            padding: 0 20px 30px 20px;
            gap: 20px;
        }

        .profile-avatar-large {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 40px;
            background: linear-gradient(45deg, rgba(0, 255, 150, 0.8), rgba(64, 93, 230, 0.8));
            padding: 4px;
            flex-shrink: 0;
        }

        .profile-avatar-large-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .profile-avatar-large-inner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .profile-level-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: linear-gradient(45deg, #FFD700, #FF6B47);
            color: #000;
            font-weight: 700;
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 12px;
            border: 2px solid rgba(0, 0, 0, 0.8);
            min-width: 24px;
            text-align: center;
        }

        .profile-user-info {
            flex: 1;
            min-width: 0;
        }

        .profile-display-name {
            font-size: 24px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 4px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .profile-username {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .profile-rank {
            display: inline-block;
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.5);
            color: #FFD700;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
        }

        .profile-qr-code {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
        }

        .profile-qr-code:hover {
            background: rgba(0, 255, 150, 0.1);
            border-color: rgba(0, 255, 150, 0.5);
        }

        /* Profile Stats Grid */
        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 0 20px 30px 20px;
        }

        .profile-stat-card {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 16px 8px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 20px;
            font-weight: 700;
            color: #00FF96;
            margin-bottom: 4px;
            text-shadow: 0 0 15px rgba(0, 255, 150, 0.5);
        }

        .stat-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        /* Profile Sections */
        .profile-section {
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .profile-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .profile-section-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #FFFFFF;
            margin: 0;
        }

        .section-action {
            font-size: 14px;
            color: #00FF96;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 12px;
            background: rgba(0, 255, 150, 0.1);
            border: 1px solid rgba(0, 255, 150, 0.3);
            transition: all var(--animation-duration) ease;
        }

        .section-action:hover {
            background: rgba(0, 255, 150, 0.2);
        }

        /* Achievement Carousel */
        .achievement-carousel {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: none;
        }

        .achievement-carousel::-webkit-scrollbar {
            display: none;
        }

        .achievement-card {
            min-width: 120px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
        }

        .achievement-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(255, 215, 0, 0.3);
        }

        .achievement-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .achievement-title {
            font-size: 12px;
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 4px;
        }

        .achievement-desc {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.3;
        }

        /* Challenge History */
        .challenge-history-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .history-tab {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all var(--animation-duration) ease;
        }

        .history-tab.active {
            background: rgba(0, 255, 150, 0.2);
            border-color: rgba(0, 255, 150, 0.5);
            color: #00FF96;
        }

        .challenge-history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .history-item {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
        }

        .history-item:hover {
            background: rgba(0, 0, 0, 0.8);
            border-color: rgba(0, 255, 150, 0.3);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .history-title {
            font-size: 16px;
            font-weight: 600;
            color: #FFFFFF;
        }

        .history-points {
            font-size: 14px;
            color: #00FF96;
            font-weight: 600;
        }

        .history-desc {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .history-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Activity Feed */
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .activity-item {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
        }

        .activity-content {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }

        .activity-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
        }

        /* Quick Actions */
        .profile-quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 0 20px 20px 20px;
        }

        .profile-action-btn {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 16px;
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .profile-action-btn:hover {
            background: rgba(0, 255, 150, 0.1);
            border-color: rgba(0, 255, 150, 0.5);
            transform: translateY(-2px);
        }

        .profile-action-btn span:first-child {
            font-size: 24px;
        }    <!-- Comprehensive Profile Page -->
    <div class="profile-page" id="profilePage" style="display: none;">
        <div class="profile-page-header">
            <div class="back-btn" onclick="closeProfilePage()">‚Üê</div>
            <div class="profile-page-title">My Profile</div>
            <div class="profile-share-btn" onclick="shareProfile()">üì§</div>
        </div>

        <!-- Profile Hero Section -->
        <div class="profile-hero">
            <div class="profile-avatar-large">
                <div class="profile-avatar-large-inner" id="profileAvatarLarge">
                    <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' fill='%2300FF96'/><text x='50' y='55' text-anchor='middle' fill='white' font-size='20'>AS</text></svg>" alt="Avatar">
                </div>
                <div class="profile-level-badge" id="profileLevelBadge">27</div>
            </div>
            
            <div class="profile-user-info">
                <div class="profile-display-name" id="profileDisplayName">Alexandra Stone</div>
                <div class="profile-username" id="profileUsername">@alexandra_stone</div>
                <div class="profile-rank" id="profileRankDisplay">Elite Gladiator</div>
            </div>
            
            <div class="profile-qr-code" onclick="showQRCode()">
                <div style="font-size: 24px;">üì±</div>
                <div style="font-size: 10px;">QR Code</div>
            </div>
        </div>

        <!-- Profile Stats Grid -->
        <div class="profile-stats-grid">
            <div class="profile-stat-card">
                <div class="stat-number" id="profileTokenCount">15,247</div>
                <div class="stat-label">ü™ô Tokens</div>
            </div>
            <div class="profile-stat-card">
                <div class="stat-number" id="profileChallengeCount">143</div>
                <div class="stat-label">‚úÖ Completed</div>
            </div>
            <div class="profile-stat-card">
                <div class="stat-number" id="profileStreakCount">12</div>
                <div class="stat-label">üî• Streak</div>
            </div>
            <div class="profile-stat-card">
                <div class="stat-number" id="profileFollowerCount">2.5K</div>
                <div class="stat-label">üë• Followers</div>
            </div>
        </div>

        <!-- Achievement Showcase -->
        <div class="profile-section">
            <div class="profile-section-header">
                <h3>üèÜ Recent Achievements</h3>
                <div class="section-action" onclick="showAllAchievements()">View All</div>
            </div>
            <div class="achievement-carousel" id="achievementCarousel">
                <!-- Achievements will be populated dynamically -->
            </div>
        </div>

        <!-- Challenge History -->
        <div class="profile-section">
            <div class="profile-section-header">
                <h3>üìä Challenge History</h3>
                <div class="section-action" onclick="showChallengeFilter()">Filter</div>
            </div>
            
            <div class="challenge-history-tabs">
                <div class="history-tab active" onclick="switchHistoryTab(this, 'recent')">Recent</div>
                <div class="history-tab" onclick="switchHistoryTab(this, 'completed')">Completed</div>
                <div class="history-tab" onclick="switchHistoryTab(this, 'favorites')">Favorites</div>
            </div>
            
            <div class="challenge-history-list" id="challengeHistoryList">
                <!-- Challenge history will be populated dynamically -->
            </div>
        </div>

        <!-- Social Activity -->
        <div class="profile-section">
            <div class="profile-section-header">
                <h3>‚ö° Recent Activity</h3>
                <div class="section-action" onclick="showActivitySettings()">Settings</div>
            </div>
            <div class="activity-feed" id="profileActivityFeed">
                <!-- Activity feed will be populated dynamically -->
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="profile-quick-actions">
            <button class="profile-action-btn" onclick="showModal('settings')">
                <span>‚öôÔ∏è</span>
                <span>Settings</span>
            </button>
            <button class="profile-action-btn" onclick="showInviteFriends()">
                <span>üë•</span>
                <span>Invite Friends</span>
            </button>
            <button class="profile-action-btn" onclick="showHelpCenter()">
                <span>‚ùì</span>
                <span>Help</span>
            </button>
            <button class="profile-action-btn" onclick="showFeedback()">
                <span>üí¨</span>
                <span>Feedback</span>
            </button>
        </div>
    </div><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content, minimal-ui">
    
    <!-- Enhanced Mobile Viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JomBro">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#000000">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json,{%22name%22:%22JomBro%20-%20Social%20Challenge%20App%22,%22short_name%22:%22JomBro%22,%22description%22:%22Advanced%20social%20challenge%20platform%20with%20AI-powered%20challenges%22,%22start_url%22:%22/%22,%22display%22:%22standalone%22,%22background_color%22:%22%23000000%22,%22theme_color%22:%22%23000000%22,%22orientation%22:%22portrait%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%3E%3Crect%20width='512'%20height='512'%20fill='%23000'/%3E%3Ctext%20x='50%25'%20y='50%25'%20dominant-baseline='middle'%20text-anchor='middle'%20font-size='280'%20fill='%2300FF96'%3EüöÄ%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">
    
    <title>JomBro - Complete Social Challenge Platform</title>

    <style>
        /* ===== COMPLETE PRODUCTION STYLES ===== */
        :root {
            --safe-area-top: env(safe-area-inset-top, 20px);
            --safe-area-bottom: env(safe-area-inset-bottom, 20px);
            --safe-area-left: env(safe-area-inset-left, 0px);
            --safe-area-right: env(safe-area-inset-right, 0px);
            
            /* Animation System */
            --animation-duration: 0.4s;
            
            /* Design System Colors */
            --primary-50: #E6FFF5;
            --primary-500: #00FF96;
            --primary-600: #00E085;
            --primary-900: #003D25;
            
            --secondary-500: #405DE6;
            --accent-500: #FFD700;
            --error-500: #FF6B6B;
            --success-500: #00FF96;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
        }

        html, body {
            height: 100vh;
            height: 100svh;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }

        /* ===== FIXED TRANSPARENCY & BACKGROUND ===== */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: #000000; /* SOLID BLACK BASE - NO TRANSPARENCY */
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(0, 255, 150, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(64, 93, 230, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at center, #0f0f23 0%, #000000 70%);
            color: #FFFFFF;
            position: fixed;
            width: 100vw;
            height: 100vh;
            height: 100svh;
            font-weight: 300;
            transition: all 1s ease;
            font-size: 16px;
            line-height: 1.5;
        }

        /* ===== ENHANCED ANIMATED STARFIELD BACKGROUND ===== */
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(2px 2px at 20px 30px, #ffffff, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #ddd, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            z-index: 0;
            opacity: 0.4;
            animation: starfieldMove 120s linear infinite;
        }

        .starfield::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(3px 3px at 50px 20px, rgba(255, 255, 255, 0.9), transparent),
                radial-gradient(2px 2px at 150px 80px, rgba(255, 255, 255, 0.7), transparent),
                radial-gradient(4px 4px at 250px 50px, rgba(255, 255, 255, 0.6), transparent),
                radial-gradient(1px 1px at 300px 120px, rgba(255, 255, 255, 0.8), transparent);
            background-size: 400px 200px;
            animation: blinkingStars 4s ease-in-out infinite alternate;
        }

        .starfield::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle, rgba(64, 93, 230, 0.3) 0%, transparent 70%),
                radial-gradient(circle, rgba(0, 255, 150, 0.2) 0%, transparent 60%),
                radial-gradient(circle, rgba(255, 107, 71, 0.25) 0%, transparent 80%);
            background-size: 800px 600px, 600px 400px, 900px 700px;
            background-position: -200px -100px, 400px 200px, -300px 300px;
            animation: planetsMove 180s linear infinite;
        }

        @keyframes starfieldMove {
            0% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(-10px) translateY(-5px); }
            50% { transform: translateX(-5px) translateY(-10px); }
            75% { transform: translateX(5px) translateY(-5px); }
            100% { transform: translateX(0) translateY(0); }
        }

        @keyframes blinkingStars {
            0% { opacity: 0.3; }
            50% { opacity: 0.8; }
            100% { opacity: 0.3; }
        }

        @keyframes planetsMove {
            0% { 
                background-position: -200px -100px, 400px 200px, -300px 300px;
                opacity: 0.1;
            }
            25% { 
                background-position: 200px 100px, 600px 400px, 100px 500px;
                opacity: 0.2;
            }
            50% { 
                background-position: 600px 300px, 800px 600px, 500px 700px;
                opacity: 0.15;
            }
            75% { 
                background-position: 1000px 500px, 1200px 800px, 900px 900px;
                opacity: 0.1;
            }
            100% { 
                background-position: 1400px 700px, 1600px 1000px, 1300px 1100px;
                opacity: 0.05;
            }
        }

        /* ===== MAIN CONTAINER ===== */
        .main-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10;
            display: flex;
            flex-direction: column;
            width: 100vw;
            height: 100vh;
            height: 100svh;
            overflow: hidden;
        }

        /* ===== HEADER WITH PROPER POSITIONING ===== */
        .dark-header {
            position: fixed;
            top: calc(var(--safe-area-top) + 10px);
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85); /* MORE OPAQUE */
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 28px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            height: 68px;
            width: calc(100vw - 40px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .dark-logo {
            font-size: 28px;
            font-weight: 300;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.4),
                2px 2px 6px rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .dark-slogan {
            font-size: 12px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            margin-top: 2px;
            font-style: italic;
            letter-spacing: 0.5px;
        }

        .dark-header-icons {
            display: flex;
            align-items: center;
            gap: 12px; /* ADJUSTED GAP FOR BETTER VISIBILITY */
        }

        /* ===== IMPROVED BUTTONS ===== */
        .round-btn {
            width: 44px;
            height: 44px;
            background: rgba(0, 0, 0, 0.7); /* MORE OPAQUE */
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 2px solid rgba(64, 93, 230, 0.9);
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.8),
                2px 2px 6px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                0 0 25px rgba(255, 255, 255, 0.3);
            position: relative;
            touch-action: manipulation;
            transition: all var(--animation-duration) ease;
        }

        .round-btn:hover {
            transform: translateY(-4px) scale(1.05);
            background: rgba(0, 0, 0, 0.8);
            border-color: rgba(64, 93, 230, 1);
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(64, 93, 230, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        /* ===== PLAYER INFO DISPLAY ===== */
        .player-info {
            position: fixed;
            top: calc(var(--safe-area-top) + 84px);
            right: 24px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(0, 255, 150, 0.4);
            border-radius: 20px;
            padding: 12px 16px;
            z-index: 950;
            text-align: center;
        }

        .player-rank {
            font-size: 12px;
            color: #FFD700;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            margin-bottom: 4px;
        }

        .player-tokens {
            font-size: 14px;
            color: #00FF96;
            font-weight: 700;
            text-shadow: 0 0 12px rgba(0, 255, 150, 0.8);
        }

        /* ===== FEED SECTION WITH IMPROVED VISIBILITY ===== */
        .dark-feed {
            position: fixed;
            top: calc(var(--safe-area-top) + 160px);
            left: 0;
            right: 0;
            bottom: calc(90px + var(--safe-area-bottom));
            overflow: hidden;
            z-index: 100;
            padding: 0 20px;
            perspective: 1000px;
        }

        .feed-pages {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        /* ===== IMPROVED CHALLENGE CARDS ===== */
        .challenge-card {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            width: calc(100% - 40px);
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background: rgba(0, 0, 0, 0.85); /* MORE OPAQUE */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 28px;
            overflow: hidden;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform-style: preserve-3d;
            transform-origin: bottom center;
            transition: all var(--animation-duration) ease;
        }

        .challenge-card.current {
            transform: translateZ(0px) rotateX(0deg);
            z-index: 10;
            opacity: 1;
        }

        .challenge-card.next {
            transform: translateZ(-100px) rotateX(-90deg);
            z-index: 5;
            opacity: 0.7;
        }

        .challenge-card.prev {
            transform: translateZ(-100px) rotateX(90deg);
            z-index: 5;
            opacity: 0.7;
        }

        /* ===== CHALLENGE CONTENT WITH BETTER DESCRIPTION VISIBILITY ===== */
        .challenge-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 36px;
            z-index: 150;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .challenge-user {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 18px;
            flex-shrink: 0;
        }

        .challenge-avatar {
            width: 48px;
            height: 48px;
            border-radius: 24px;
            background: linear-gradient(45deg, 
                rgba(0, 255, 150, 0.6), 
                rgba(64, 93, 230, 0.6), 
                rgba(138, 43, 226, 0.6), 
                rgba(255, 255, 255, 0.4));
            padding: 3px;
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 255, 150, 0.2);
        }

        .challenge-avatar-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid rgba(0, 0, 0, 0.1);
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.1);
        }

        .challenge-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            filter: brightness(1.2) contrast(1.1);
        }

        .challenge-username {
            color: #FFFFFF;
            font-weight: 400;
            font-size: 18px;
            text-shadow: 
                0 0 15px rgba(255, 255, 255, 0.5),
                2px 2px 6px rgba(0, 0, 0, 0.9);
        }

        .challenge-type {
            display: inline-block;
            padding: 4px 8px;
            background: rgba(255, 215, 0, 0.8);
            color: #000;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .challenge-type.daily {
            background: rgba(0, 255, 150, 0.8);
        }

        .challenge-type.treasure {
            background: rgba(255, 215, 0, 0.8);
        }

        .challenge-type.vip {
            background: rgba(138, 43, 226, 0.8);
            color: #fff;
        }

        .challenge-type.business {
            background: rgba(255, 107, 53, 0.8);
        }

        /* ===== IMPROVED CHALLENGE TEXT CONTAINER (FIXES DESCRIPTION VISIBILITY) ===== */
        .challenge-text-container {
            flex: 1;
            margin-bottom: 24px;
            background: rgba(0, 0, 0, 0.6); /* DARKER BACKGROUND */
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 24px;
            overflow-y: auto;
            max-height: 350px; /* ALLOWS SCROLLING */
            backdrop-filter: blur(10px);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .challenge-title {
            font-size: 24px;
            font-weight: 600;
            color: #00FF96;
            margin-bottom: 16px;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.6),
                2px 2px 4px rgba(0, 0, 0, 0.8);
            line-height: 1.3;
        }

        .challenge-text {
            font-size: 18px;
            font-weight: 300;
            color: #FFFFFF;
            text-shadow: 
                0 0 18px rgba(255, 255, 255, 0.5),
                2px 2px 8px rgba(0, 0, 0, 0.9);
            margin-bottom: 18px;
            line-height: 1.6;
            word-wrap: break-word;
        }

        .challenge-hashtags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }

        .challenge-hashtag {
            color: #4FC3F7;
            font-size: 15px;
            font-weight: 400;
            text-shadow: 
                0 0 8px rgba(79, 195, 247, 0.5),
                1px 1px 2px rgba(0, 0, 0, 0.8);
            padding: 8px 14px;
            background: rgba(79, 195, 247, 0.1);
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 18px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .challenge-hashtag:hover {
            background: rgba(79, 195, 247, 0.2);
            color: #4FC3F7;
            border-color: rgba(79, 195, 247, 0.5);
        }

        .challenge-reward {
            background: rgba(0, 255, 150, 0.15);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(0, 255, 150, 0.6);
            color: #FFFFFF;
            padding: 16px 20px;
            border-radius: 22px;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 28px;
            text-align: center;
            flex-shrink: 0;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(0, 255, 150, 0.3);
        }

        .challenge-difficulty {
            display: inline-block;
            margin-left: 12px;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            text-shadow: none;
        }

        .difficulty-easy {
            background: rgba(0, 255, 150, 0.8);
            color: #000;
        }

        .difficulty-medium {
            background: rgba(255, 193, 7, 0.8);
            color: #000;
        }

        .difficulty-hard {
            background: rgba(255, 87, 34, 0.8);
            color: #fff;
        }

        .difficulty-epic {
            background: rgba(156, 39, 176, 0.8);
            color: #fff;
        }

        .difficulty-legendary {
            background: linear-gradient(45deg, #FFD700, #FF6B47);
            color: #000;
            animation: legendaryGlow 2s ease infinite;
        }

        /* ===== CHALLENGE ACTIONS ===== */
        .challenge-actions {
            display: flex;
            gap: 16px;
            flex-shrink: 0;
        }

        .challenge-btn {
            flex: 1;
            padding: 18px 24px;
            border: none;
            border-radius: 24px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
            touch-action: manipulation;
            min-height: 44px;
            transition: all 0.3s ease;
        }

        .btn-accept {
            background: rgba(0, 255, 150, 0.2);
            border: 1px solid rgba(0, 255, 150, 0.6);
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(0, 255, 150, 0.25);
        }

        .btn-accept:hover {
            background: rgba(0, 255, 150, 0.3);
            transform: translateY(-2px);
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(0, 255, 150, 0.4);
        }

        .btn-decline {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 255, 255, 0.1);
        }

        .btn-decline:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        /* ===== FIXED SIDE ACTIONS - PROPERLY ARRANGED ===== */
        .side-actions {
            position: fixed;
            right: 24px;
            bottom: calc(140px + var(--safe-area-bottom)); /* ADJUSTED FOR BETTER POSITIONING */
            display: flex;
            flex-direction: column;
            gap: 16px; /* PROPER SPACING */
            z-index: 200;
        }

        .action-btn {
            width: 56px;
            height: 56px;
            background: rgba(0, 0, 0, 0.85); /* MORE OPAQUE */
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 2px solid rgba(0, 191, 255, 0.9);
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.6),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                0 0 30px rgba(255, 255, 255, 0.3);
            position: relative;
            touch-action: manipulation;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 
                0 15px 30px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(0, 191, 255, 0.4);
        }

        .points-btn {
            flex-direction: column;
            background: rgba(0, 255, 150, 0.15);
            border-color: rgba(0, 255, 150, 0.6);
            height: 72px;
            padding: 10px;
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.3),
                0 0 35px rgba(0, 255, 150, 0.3);
        }

        .points-number {
            font-size: 14px;
            font-weight: 700;
            line-height: 1;
            color: #FFFFFF;
            text-shadow: 
                0 0 15px rgba(0, 255, 150, 0.6),
                1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .points-label {
            font-size: 16px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* ===== FIXED BOTTOM NAVIGATION - PUSHED TO EDGE ===== */
        .dark-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95); /* MORE OPAQUE */
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            justify-content: space-around;
            padding: 16px 20px calc(var(--safe-area-bottom) + 16px) 20px; /* PROPER EDGE POSITIONING */
            z-index: 1000;
            width: 100vw;
            min-height: calc(80px + var(--safe-area-bottom));
            box-shadow: 
                0 -8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
            touch-action: manipulation;
            min-height: 44px;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
            transition: all 0.3s ease;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }

        .nav-item.active {
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            background: rgba(0, 255, 150, 0.15);
            border: 1px solid rgba(0, 255, 150, 0.5);
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(0, 255, 150, 0.3);
            transform: translateY(-2px);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
            text-shadow: 
                0 0 12px rgba(0, 255, 150, 0.8),
                0 0 8px rgba(255, 255, 255, 0.3);
        }

        /* ===== CHALLENGE ACCEPTANCE PAGE ===== */
        .challenge-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 2000;
            display: none;
            padding: var(--safe-area-top) 20px calc(var(--safe-area-bottom) + 20px) 20px;
            overflow-y: auto;
        }

        .challenge-page.show {
            display: block;
            animation: slideInFromRight 0.4s ease;
        }

        .challenge-page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        .back-btn {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #fff;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .challenge-page-title {
            font-size: 24px;
            font-weight: 600;
            color: #00FF96;
            text-shadow: 0 0 20px rgba(0, 255, 150, 0.6);
        }

        .challenge-detail-card {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
        }

        .challenge-detail-title {
            font-size: 28px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            line-height: 1.3;
        }

        .challenge-detail-description {
            font-size: 18px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 25px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .challenge-requirements {
            background: rgba(0, 255, 150, 0.08);
            border: 1px solid rgba(0, 255, 150, 0.2);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .challenge-requirements h3 {
            color: #00FF96;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .challenge-requirements ul {
            list-style: none;
            padding: 0;
        }

        .challenge-requirements li {
            padding: 8px 0;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            padding-left: 25px;
        }

        .challenge-requirements li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #00FF96;
            font-weight: bold;
        }

        /* ===== MODAL SYSTEM ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 24px;
        }

        .modal.show {
            display: flex;
            animation: modalFadeIn 0.3s ease;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 28px;
            padding: 36px;
            max-width: 90%;
            max-height: 85%;
            overflow-y: auto;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 28px;
            text-align: center;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.6),
                2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px;
            color: #FFFFFF;
            font-size: 16px;
            font-weight: 400;
            outline: none;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: rgba(0, 255, 150, 0.7);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 35px rgba(0, 255, 150, 0.3);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn-primary {
            width: 100%;
            padding: 18px;
            background: rgba(0, 255, 150, 0.2);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(0, 255, 150, 0.6);
            border-radius: 18px;
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 14px;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(0, 255, 150, 0.25);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(0, 255, 150, 0.4);
        }

        .btn-secondary {
            width: 100%;
            padding: 18px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 18px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 16px rgba(255, 255, 255, 0.2);
        }

        /* ===== TOAST NOTIFICATIONS ===== */
        .toast {
            position: fixed;
            top: calc(var(--safe-area-top) + 170px);
            left: 24px;
            right: 24px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(35px);
            border: 1px solid rgba(0, 255, 150, 0.5);
            color: #FFFFFF;
            padding: 16px 20px;
            border-radius: 18px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            z-index: 4000;
            transform: translateY(-100px);
            opacity: 0;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(0, 255, 150, 0.3);
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            border-color: rgba(255, 107, 107, 0.5);
            background: rgba(0, 0, 0, 0.9);
            text-shadow: 
                0 0 20px rgba(255, 107, 107, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(255, 107, 107, 0.3);
        }

        /* ===== RATING SYSTEM ===== */
        .rating-stars {
            display: flex;
            gap: 8px;
            margin: 15px 0;
            justify-content: center;
        }

        .star {
            font-size: 32px;
            cursor: pointer;
            opacity: 0.3;
            transition: all 0.2s ease;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.3));
        }

        .star:hover, .star.active {
            opacity: 1;
            transform: scale(1.1);
            filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.8));
        }

        /* ===== ANIMATIONS ===== */
        @keyframes slideInFromRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutToRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes legendaryGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 107, 71, 0.8); }
        }

        /* ===== RESPONSIVE IMPROVEMENTS ===== */
        @media screen and (max-width: 430px) {
            .dark-header {
                height: 64px;
                padding: 14px 20px;
            }
            
            .dark-logo {
                font-size: 26px;
            }
            
            .round-btn {
                width: 42px;
                height: 42px;
                font-size: 17px;
            }

            .dark-header-icons {
                gap: 8px;
            }
            
            .challenge-content {
                padding: 24px;
            }
            
            .challenge-text-container {
                max-height: 280px;
            }
            
            .side-actions {
                right: 16px;
                bottom: calc(120px + var(--safe-area-bottom));
            }
            
            .action-btn {
                width: 48px;
                height: 48px;
                font-size: 18px;
            }
            
            .points-btn {
                height: 64px;
            }
        }

        @media screen and (max-height: 700px) {
            .challenge-text-container {
                max-height: 250px;
            }
            
            .dark-feed {
                top: calc(var(--safe-area-top) + 140px);
            }
        }

        /* ===== LOADING STATES ===== */
        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ===== FOCUS STATES FOR ACCESSIBILITY ===== */
        .round-btn:focus-visible,
        .action-btn:focus-visible,
        .challenge-btn:focus-visible,
        .nav-item:focus-visible {
            outline: 2px solid rgba(0, 255, 150, 0.8);
            outline-offset: 2px;
        }

        /* ===== PERFORMANCE OPTIMIZATIONS ===== */
        * {
            will-change: auto;
        }

        .challenge-card {
            contain: layout style paint;
        }

        .starfield {
            contain: strict;
        }
    </style>
</head>
<body>
    <!-- Starfield Background -->
    <div class="starfield"></div>

    <!-- Main Container -->
    <div class="main-container">
        
        <!-- Header -->
        <div class="dark-header">
            <div class="dark-logo">
                <div>JomBro</div>
                <div class="dark-slogan">Let's Go! Let's Go!</div>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
                <div id="challengeCounter" style="background: rgba(0, 255, 150, 0.2); border: 1px solid rgba(0, 255, 150, 0.5); color: #00FF96; padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                    1/5
                </div>
                <div class="dark-header-icons">
                    <div class="round-btn" onclick="showHowToPlay()" title="How to Play">‚ùì</div>
                    <div class="round-btn" onclick="showLiveActivity()" title="Live Activity">‚ö°</div>
                    <div class="round-btn" onclick="showModal('create')" title="Create Challenge">‚ûï</div>
                    <div class="round-btn" onclick="showModal('groups')" title="Groups">üë•</div>
                    <div class="round-btn" onclick="showNotifications()" title="Notifications">üîî</div>
                    <div class="round-btn" onclick="showModal('settings')" title="Settings">‚öôÔ∏è</div>
                </div>
            </div>
        </div>

        <!-- Player Info Display -->
        <div class="player-info">
            <div class="player-rank" id="playerRank">Elite Gladiator</div>
            <div class="player-tokens" id="playerTokens">ü™ô 15,247</div>
        </div>

        <!-- Feed Section -->
        <div class="dark-feed">
            <div class="feed-pages" id="feedPages">
                <!-- Challenge cards will be dynamically populated -->
            </div>

            <!-- Side Actions - Fixed and Properly Arranged -->
            <div class="side-actions">
                <div class="action-btn points-btn" onclick="likeChallenge()" title="Like Challenge">
                    <div class="points-number" id="currentChallengePoints">2.5K</div>
                    <div class="points-label">‚ù§Ô∏è</div>
                </div>
                <div class="action-btn" onclick="shareChallenge()" title="Comment">üí¨</div>
                <div class="action-btn" onclick="bookmarkChallenge()" title="Bookmark">üîñ</div>
                <div class="action-btn" onclick="shareChallenge()" title="Share">üì§</div>
            </div>
        </div>

        <!-- Bottom Navigation - Pushed to Edge -->
        <div class="dark-nav">
            <div class="nav-item active" onclick="navAction(this, 'home')">
                <div class="nav-icon">üè†</div>
                <div>Home</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'leaderboard')">
                <div class="nav-icon">üèÜ</div>
                <div>Leaderboard</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'create')">
                <div class="nav-icon">‚ûï</div>
                <div>Create</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'shop')">
                <div class="nav-icon">üõçÔ∏è</div>
                <div>Shop</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'profile')">
                <div class="nav-icon">üë§</div>
                <div>Profile</div>
            </div>
        </div>
        
        <!-- Beta Disclaimer -->
        <div class="beta-disclaimer">
            <span style="color: #FFD700; font-weight: 600;">BETA</span>
            <span style="color: rgba(255, 255, 255, 0.7);">100% Free ‚Ä¢ No Payments</span>
        </div>
    </div>

    <!-- Challenge Acceptance Page with Full Description -->
    <div class="challenge-page" id="challengePage">
        <div class="challenge-page-header">
            <div class="back-btn" onclick="closeChallengeePage()">‚Üê</div>
            <div class="challenge-page-title">Challenge Details</div>
            <div></div>
        </div>

        <div class="challenge-detail-card">
            <div class="challenge-detail-title" id="challengeDetailTitle">
                Loading Challenge...
            </div>
            
            <div class="challenge-detail-description" id="challengeDetailDescription">
                Please wait while we load the complete challenge details...
            </div>

            <div class="challenge-requirements">
                <h3>üìã Requirements to Complete:</h3>
                <ul id="challengeRequirementsList">
                    <li>Loading requirements...</li>
                </ul>
            </div>

            <div style="display: flex; gap: 20px; margin: 20px 0;">
                <div style="flex: 1; text-align: center; padding: 15px; background: rgba(0, 255, 150, 0.1); border-radius: 12px;">
                    <div style="font-size: 24px; color: #00FF96; font-weight: 700;" id="challengeDetailTokens">0</div>
                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">Tokens</div>
                </div>
                <div style="flex: 1; text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 12px;">
                    <div style="font-size: 24px; color: #FFD700; font-weight: 700;" id="challengeDetailDifficulty">Easy</div>
                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">Difficulty</div>
                </div>
                <div style="flex: 1; text-align: center; padding: 15px; background: rgba(79, 195, 247, 0.1); border-radius: 12px;">
                    <div style="font-size: 24px; color: #4FC3F7; font-weight: 700;" id="challengeDetailDuration">30 min</div>
                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">Duration</div>
                </div>
            </div>

            <div class="challenge-actions">
                <button class="challenge-btn btn-accept" onclick="startChallenge()" style="flex: 2;">
                    üöÄ Start Challenge Now
                </button>
                <button class="challenge-btn btn-decline" onclick="closeChallengeePage()" style="flex: 1;">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Challenge Completion Modal with AI Review -->
    <div id="challengeCompletionModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">üì∏ Complete Challenge</div>
            
            <div id="challengeCompletionContent">
                <div class="form-group">
                    <label class="form-label">Upload Photo/Video</label>
                    <input type="file" class="form-control" id="challengeMedia" accept="image/*,video/*">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Describe Your Experience</label>
                    <textarea class="form-control" id="challengeCompletionDesc" rows="4" 
                        placeholder="Tell us about your experience completing this challenge..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Rate Your Experience</label>
                    <div class="rating-stars" id="ratingStars">
                        <span class="star" onclick="setRating(1)">‚≠ê</span>
                        <span class="star" onclick="setRating(2)">‚≠ê</span>
                        <span class="star" onclick="setRating(3)">‚≠ê</span>
                        <span class="star" onclick="setRating(4)">‚≠ê</span>
                        <span class="star" onclick="setRating(5)">‚≠ê</span>
                    </div>
                </div>
                
                <button class="btn-primary" onclick="submitChallengeCompletion()">ü§ñ Submit for AI Review</button>
                <button class="btn-secondary" onclick="hideModal('challengeCompletion')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Create Challenge Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">‚ú® Create New Challenge</div>
            
            <div class="form-group">
                <label class="form-label">Challenge Title</label>
                <input type="text" class="form-control" id="challengeTitle" placeholder="Enter an engaging title...">
            </div>
            
            <div class="form-group">
                <label class="form-label">Challenge Description</label>
                <textarea class="form-control" id="challengeDesc" rows="4" placeholder="Describe your epic challenge in detail..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Difficulty & Reward</label>
                <select class="form-control" id="challengePoints">
                    <option value="500">500 Tokens (Easy)</option>
                    <option value="1200">1,200 Tokens (Medium)</option>
                    <option value="2500">2,500 Tokens (Hard)</option>
                    <option value="5000">5,000 Tokens (Epic)</option>
                    <option value="10000">10,000 Tokens (Legendary)</option>
                </select>
            </div>
            
            <button class="btn-primary" onclick="createChallenge()">üöÄ Create Challenge</button>
            <button class="btn-secondary" onclick="hideModal('create')">Cancel</button>
        </div>
    </div>

    <!-- Enhanced User Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-title">‚öôÔ∏è User Settings</div>
            
            <!-- User Profile Section -->
            <div style="background: rgba(0, 255, 150, 0.1); border: 1px solid rgba(0, 255, 150, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #00FF96; margin-bottom: 15px; font-size: 18px;">üë§ Profile Settings</h3>
                
                <div class="form-group">
                    <label class="form-label">Display Name</label>
                    <input type="text" class="form-control" id="userDisplayName" 
                        placeholder="Your display name" value="Alexandra Stone">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" id="userUsername" 
                        placeholder="@username" value="alexandra_stone">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Avatar Style</label>
                    <select class="form-control" id="avatarStyle">
                        <option value="initials">üìù Initials (AS)</option>
                        <option value="emoji">üòé Emoji Avatar</option>
                        <option value="geometric">üî∑ Geometric Pattern</option>
                        <option value="gradient">üåà Gradient Design</option>
                    </select>
                </div>
            </div>
            
            <!-- Notification Settings -->
            <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #FFD700; margin-bottom: 15px; font-size: 18px;">üîî Notifications</h3>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <label style="color: rgba(255, 255, 255, 0.9);">New Challenges</label>
                    <input type="checkbox" id="notifyNewChallenges" checked style="width: 20px; height: 20px;">
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <label style="color: rgba(255, 255, 255, 0.9);">Challenge Reminders</label>
                    <input type="checkbox" id="notifyReminders" checked style="width: 20px; height: 20px;">
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <label style="color: rgba(255, 255, 255, 0.9);">Achievement Unlocked</label>
                    <input type="checkbox" id="notifyAchievements" checked style="width: 20px; height: 20px;">
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label style="color: rgba(255, 255, 255, 0.9);">Friend Activity</label>
                    <input type="checkbox" id="notifyFriends" style="width: 20px; height: 20px;">
                </div>
            </div>
            
            <!-- Privacy Settings -->
            <div style="background: rgba(138, 43, 226, 0.1); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #8A2BE2; margin-bottom: 15px; font-size: 18px;">üîí Privacy</h3>
                
                <div class="form-group">
                    <label class="form-label">Profile Visibility</label>
                    <select class="form-control" id="profileVisibility">
                        <option value="public">üåç Public - Everyone can see</option>
                        <option value="friends">üë• Friends Only</option>
                        <option value="private">üîí Private</option>
                    </select>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <label style="color: rgba(255, 255, 255, 0.9);">Show Real Name</label>
                    <input type="checkbox" id="showRealName" style="width: 20px; height: 20px;">
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label style="color: rgba(255, 255, 255, 0.9);">Location Tracking</label>
                    <input type="checkbox" id="locationTracking" checked style="width: 20px; height: 20px;">
                </div>
            </div>
            
            <!-- App Preferences -->
            <div style="background: rgba(79, 195, 247, 0.1); border: 1px solid rgba(79, 195, 247, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #4FC3F7; margin-bottom: 15px; font-size: 18px;">üé® App Preferences</h3>
                
                <div class="form-group">
                    <label class="form-label">Background Theme</label>
                    <select class="form-control" id="backgroundTheme">
                        <option value="space">üåå Outer Space (Default)</option>
                        <option value="underwater">üåä Underwater</option>
                        <option value="forest">üå≤ Forest</option>
                        <option value="cyberpunk">üîÆ Cyberpunk</option>
                        <option value="sunset">üåÖ Sunset</option>
                        <option value="minimal">‚ö´ Minimal Dark</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Animation Speed</label>
                    <select class="form-control" id="animationSpeed">
                        <option value="fast">‚ö° Fast</option>
                        <option value="normal" selected>üîÑ Normal</option>
                        <option value="slow">üêå Slow</option>
                        <option value="off">‚ùå Disabled</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Challenge Difficulty Filter</label>
                    <select class="form-control" id="difficultyFilter">
                        <option value="all">üéØ All Difficulties</option>
                        <option value="easy">üü¢ Easy Only</option>
                        <option value="medium">üü° Easy + Medium</option>
                        <option value="hard">üü† Medium + Hard</option>
                        <option value="epic">üî¥ Hard + Epic Only</option>
                    </select>
                </div>
            </div>
            
            <!-- Technical Settings -->
            <div style="background: rgba(255, 107, 107, 0.1); border: 1px solid rgba(255, 107, 107, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #FF6B6B; margin-bottom: 15px; font-size: 18px;">ü§ñ Technical Settings</h3>
                
                <div class="form-group">
                    <label class="form-label">AI Review API Key</label>
                    <input type="password" class="form-control" id="openaiApiKey" 
                        placeholder="sk-... (OpenAI API Key for AI reviews)">
                    <small style="color: rgba(255,255,255,0.6); margin-top: 5px; display: block;">
                        Get your API key from: <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #00FF96;">https://platform.openai.com/api-keys</a>
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">‚òÅÔ∏è Cloudinary Settings</label>
                    <input type="text" class="form-control" id="cloudinaryCloudName" 
                        placeholder="Cloud Name" style="margin-bottom: 10px;">
                    <input type="text" class="form-control" id="cloudinaryApiKey" 
                        placeholder="API Key" style="margin-bottom: 10px;">
                    <input type="password" class="form-control" id="cloudinaryApiSecret" 
                        placeholder="API Secret">
                    <small style="color: rgba(255,255,255,0.6); margin-top: 5px; display: block;">
                        Get free account at: <a href="https://cloudinary.com/" target="_blank" style="color: #00FF96;">https://cloudinary.com/</a>
                    </small>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn-primary" onclick="saveSettings()" style="flex: 2;">üíæ Save All Settings</button>
                <button class="btn-secondary" onclick="resetSettings()" style="flex: 1;">üîÑ Reset</button>
            </div>
            <button class="btn-secondary" onclick="hideModal('settings')" style="margin-top: 10px;">Cancel</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span id="toastText">Ready!</span>
    </div>

    <script>
        // ===== COMPLETE JOMBRO PRODUCTION JAVASCRIPT =====

        // Global state management
        let playerData = {
            id: 'player_001',
            username: 'alexandra_stone',
            displayName: 'Alexandra Stone',
            avatar: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%2300FF96"/><text x="50" y="55" text-anchor="middle" fill="white" font-size="20">AS</text></svg>',
            tokens: 15247,
            level: 27,
            rank: 'Elite Gladiator',
            completedChallenges: 143,
            currentStreak: 12
        };

        let challengeData = [];
        let currentPage = 0;
        let currentChallenge = null;
        let selectedRating = 0;
        // Enhanced settings with user preferences
        let appSettings = {
            // User Profile
            displayName: 'Alexandra Stone',
            username: 'alexandra_stone',
            avatarStyle: 'initials',
            
            // Notifications
            notifyNewChallenges: true,
            notifyReminders: true,
            notifyAchievements: true,
            notifyFriends: false,
            
            // Privacy
            profileVisibility: 'public',
            showRealName: false,
            locationTracking: true,
            
            // App Preferences
            backgroundTheme: 'space',
            animationSpeed: 'normal',
            difficultyFilter: 'all',
            
            // Technical
            openaiApiKey: '',
            cloudinaryCloudName: '',
            cloudinaryApiKey: '',
            cloudinaryApiSecret: ''
        };

        // Enhanced load settings with proper validation
        function loadSettings() {
            try {
                const saved = localStorage.getItem('jombro_settings');
                if (saved) {
                    const savedSettings = JSON.parse(saved);
                    appSettings = { ...appSettings, ...savedSettings };
                }
                
                // Apply saved settings to UI elements (with validation)
                const settingsMapping = {
                    'userDisplayName': appSettings.displayName,
                    'userUsername': appSettings.username,
                    'avatarStyle': appSettings.avatarStyle,
                    'backgroundTheme': appSettings.backgroundTheme,
                    'animationSpeed': appSettings.animationSpeed,
                    'difficultyFilter': appSettings.difficultyFilter,
                    'profileVisibility': appSettings.profileVisibility,
                    'openaiApiKey': appSettings.openaiApiKey
                };
                
                Object.entries(settingsMapping).forEach(([elementId, value]) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.value = value;
                    }
                });
                
                // Handle checkboxes separately
                const checkboxMapping = {
                    'notifyNewChallenges': appSettings.notifyNewChallenges,
                    'notifyReminders': appSettings.notifyReminders,
                    'notifyAchievements': appSettings.notifyAchievements,
                    'notifyFriends': appSettings.notifyFriends,
                    'showRealName': appSettings.showRealName,
                    'locationTracking': appSettings.locationTracking
                };
                
                Object.entries(checkboxMapping).forEach(([elementId, value]) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.checked = value;
                    }
                });
                
                // Apply visual settings
                applyBackgroundTheme(appSettings.backgroundTheme);
                applyAnimationSpeed(appSettings.animationSpeed);
                updatePlayerName();
                
                console.log('Settings loaded successfully');
                
            } catch (error) {
                console.error('Error loading settings:', error);
                showToast('‚ö†Ô∏è Settings loading failed, using defaults', true);
            }
        }

        // Enhanced save settings with validation
        function saveSettings() {
            try {
                // Validate all form elements exist before saving
                const requiredElements = [
                    'userDisplayName', 'userUsername', 'avatarStyle',
                    'backgroundTheme', 'animationSpeed', 'difficultyFilter'
                ];
                
                let missingElements = [];
                requiredElements.forEach(id => {
                    if (!document.getElementById(id)) {
                        missingElements.push(id);
                    }
                });
                
                if (missingElements.length > 0) {
                    console.warn('Missing form elements:', missingElements);
                    showToast('‚ö†Ô∏è Some settings could not be saved', true);
                    return;
                }
                
                // Update settings object safely
                const displayNameEl = document.getElementById('userDisplayName');
                const usernameEl = document.getElementById('userUsername');
                
                if (displayNameEl && displayNameEl.value.trim()) {
                    appSettings.displayName = displayNameEl.value.trim();
                }
                
                if (usernameEl && usernameEl.value.trim()) {
                    appSettings.username = usernameEl.value.trim();
                }
                
                // Continue with other settings...
                const settingsToUpdate = [
                    'avatarStyle', 'backgroundTheme', 'animationSpeed', 
                    'difficultyFilter', 'profileVisibility', 
                    'openaiApiKey', 'cloudinaryCloudName', 
                    'cloudinaryApiKey', 'cloudinaryApiSecret'
                ];
                
                settingsToUpdate.forEach(setting => {
                    const element = document.getElementById(setting);
                    if (element) {
                        appSettings[setting] = element.value;
                    }
                });
                
                // Handle checkboxes
                const checkboxSettings = [
                    'notifyNewChallenges', 'notifyReminders', 'notifyAchievements',
                    'notifyFriends', 'showRealName', 'locationTracking'
                ];
                
                checkboxSettings.forEach(setting => {
                    const element = document.getElementById(setting);
                    if (element) {
                        appSettings[setting] = element.checked;
                    }
                });
                
                // Save to localStorage (with error handling)
                try {
                    localStorage.setItem('jombro_settings', JSON.stringify(appSettings));
                    console.log('Settings saved to localStorage');
                } catch (storageError) {
                    console.log('localStorage not available:', storageError);
                }
                
                // Apply changes
                applyBackgroundTheme(appSettings.backgroundTheme);
                applyAnimationSpeed(appSettings.animationSpeed);
                updatePlayerName();
                updateChallengeDisplay(); // Refresh challenges with new difficulty filter
                
                hideModal('settings');
                showToast('‚öôÔ∏è All settings saved successfully!');
                
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('‚ùå Settings save failed!', true);
            }
        }

        // Reset settings to defaults
        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to default values?')) {
                // Reset to defaults
                document.getElementById('userDisplayName').value = 'Alexandra Stone';
                document.getElementById('userUsername').value = 'alexandra_stone';
                document.getElementById('avatarStyle').value = 'initials';
                
                document.getElementById('notifyNewChallenges').checked = true;
                document.getElementById('notifyReminders').checked = true;
                document.getElementById('notifyAchievements').checked = true;
                document.getElementById('notifyFriends').checked = false;
                
                document.getElementById('profileVisibility').value = 'public';
                document.getElementById('showRealName').checked = false;
                document.getElementById('locationTracking').checked = true;
                
                document.getElementById('backgroundTheme').value = 'space';
                document.getElementById('animationSpeed').value = 'normal';
                document.getElementById('difficultyFilter').value = 'all';
                
                document.getElementById('openaiApiKey').value = '';
                document.getElementById('cloudinaryCloudName').value = '';
                document.getElementById('cloudinaryApiKey').value = '';
                document.getElementById('cloudinaryApiSecret').value = '';
                
                showToast('üîÑ Settings reset to defaults!');
            }
        }

        // Update player name in UI
        function updatePlayerName() {
            playerData.displayName = appSettings.displayName;
            // Update any displayed names in the UI
            const usernameElements = document.querySelectorAll('.challenge-username');
            usernameElements.forEach(el => {
                if (el.textContent.includes(playerData.displayName)) {
                    el.textContent = appSettings.displayName;
                }
            });
        }

        // Apply animation speed settings
        function applyAnimationSpeed(speed) {
            const root = document.documentElement;
            
            switch(speed) {
                case 'fast':
                    root.style.setProperty('--animation-duration', '0.2s');
                    break;
                case 'slow':
                    root.style.setProperty('--animation-duration', '0.8s');
                    break;
                case 'off':
                    root.style.setProperty('--animation-duration', '0s');
                    break;
                default: // normal
                    root.style.setProperty('--animation-duration', '0.4s');
            }
        }

        // Apply background theme
        function applyBackgroundTheme(theme) {
            const body = document.body;
            // Remove all theme classes
            body.classList.remove('underwater', 'forest', 'cyberpunk', 'sunset', 'space');
            
            if (theme !== 'space') {
                body.classList.add(theme);
            }
        }

        // ===== BETA LAUNCH & ONBOARDING SYSTEM =====
        
        let onboardingStep = 0;
        let isFirstLaunch = true;

        // ===== INTERFACE VALIDATION & ERROR PREVENTION =====
        
        // Safe element update function
        function safeUpdateElement(elementId, content, isHTML = false) {
            const element = document.getElementById(elementId);
            if (element) {
                if (isHTML) {
                    element.innerHTML = content;
                } else {
                    element.textContent = content;
                }
                return true;
            } else {
                console.warn(`Element ${elementId} not found`);
                return false;
            }
        }

        // Enhanced player display update with validation
        function updatePlayerDisplay() {
            safeUpdateElement('playerRank', playerData.rank);
            safeUpdateElement('playerTokens', `ü™ô ${playerData.tokens.toLocaleString()}`);
            
            // Update profile elements if they exist
            safeUpdateElement('profileDisplayName', appSettings.displayName);
            safeUpdateElement('profileUsername', `@${appSettings.username}`);
            safeUpdateElement('profileRankDisplay', playerData.rank);
            safeUpdateElement('profileLevelBadge', playerData.level.toString());
            safeUpdateElement('profileTokenCount', playerData.tokens.toLocaleString());
            safeUpdateElement('profileChallengeCount', playerData.completedChallenges.toString());
            safeUpdateElement('profileStreakCount', playerData.currentStreak.toString());
        }

        // Validation for challenge creation form
        function validateChallengeForm() {
            const title = document.getElementById('challengeTitle');
            const description = document.getElementById('challengeDesc');
            const points = document.getElementById('challengePoints');
            
            if (!title || !description || !points) {
                console.error('Challenge form elements missing');
                return false;
            }
            
            if (!title.value.trim()) {
                showToast('‚ùå Please enter a challenge title!', true);
                return false;
            }
            
            if (!description.value.trim()) {
                showToast('‚ùå Please enter a challenge description!', true);
                return false;
            }
            
            return true;
        }

        // Enhanced create challenge with validation
        function createChallenge() {
            if (!validateChallengeForm()) return;
            
            const title = document.getElementById('challengeTitle').value;
            const description = document.getElementById('challengeDesc').value;
            const tokens = parseInt(document.getElementById('challengePoints').value);

            const newChallenge = {
                id: 'user_' + Date.now(),
                title: title,
                description: description,
                hashtags: ["#UserChallenge", "#JomBro", "#Community"],
                difficulty: tokens >= 5000 ? "epic" : tokens >= 2500 ? "hard" : "medium",
                tokens: tokens,
                type: "daily",
                creator: appSettings.displayName || playerData.displayName,
                avatar: playerData.avatar,
                requirements: [
                    "Complete the challenge as described",
                    "Document your experience with photos/videos",
                    "Share your results with the community",
                    "Rate your overall experience"
                ],
                duration: "Variable"
            };

            challengeData.unshift(newChallenge);
            currentPage = 0; // Reset to show new challenge first
            updateChallengeDisplay();
            
            hideModal('create');
            showToast('‚ú® Challenge created successfully!');
            
            // Clear form
            safeUpdateElement('challengeTitle', '', false);
            safeUpdateElement('challengeDesc', '', false);
            document.getElementById('challengeTitle').value = '';
            document.getElementById('challengeDesc').value = '';
        }

        // Validation for submission form
        function validateSubmissionForm() {
            const description = document.getElementById('challengeCompletionDesc');
            const mediaFile = document.getElementById('challengeMedia');
            
            if (!description || !mediaFile) {
                console.error('Submission form elements missing');
                return false;
            }
            
            if (!description.value.trim()) {
                showToast('‚ùå Please describe what you did!', true);
                return false;
            }
            
            if (selectedRating === 0) {
                showToast('‚ùå Please rate your experience!', true);
                return false;
            }
            
            return true;
        }

        // Fix modal show/hide with validation
        function showModal(modalId) {
            const modal = document.getElementById(modalId + 'Modal');
            if (modal) {
                modal.classList.add('show');
                console.log(`Modal ${modalId} shown`);
            } else {
                console.error(`Modal ${modalId}Modal not found`);
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId + 'Modal');
            if (modal) {
                modal.classList.remove('show');
                console.log(`Modal ${modalId} hidden`);
            } else {
                console.error(`Modal ${modalId}Modal not found`);
            }
        }

        // Enhanced initialization with better error handling
        function initializeApp() {
            try {
                console.log('üöÄ JomBro Beta Launch App Starting...');
                
                loadSettings();
                generateSampleChallenges();
                updatePlayerDisplay();
                updateChallengeDisplay();
                
                // Validate essential elements exist
                const essentialElements = [
                    'feedPages',
                    'challengeContainer', 
                    'playerRank',
                    'playerTokens',
                    'toast',
                    'toastText'
                ];
                
                let missingElements = [];
                essentialElements.forEach(id => {
                    if (!document.getElementById(id)) {
                        missingElements.push(id);
                    }
                });
                
                if (missingElements.length > 0) {
                    console.warn('Missing elements:', missingElements);
                } else {
                    console.log('‚úÖ All essential elements found');
                }
                
                // Check if first launch
                checkFirstLaunch();
                
                // Add launch ready indicator
                addLaunchReadyBadge();
                
                console.log('‚úÖ JomBro Beta Ready for Real Users!');
                
            } catch (error) {
                console.error('Initialization error:', error);
                showToast('‚ö†Ô∏è App initialization error. Please refresh the page.', true);
            }
        }

        // Replace the DOMContentLoaded listener
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Check if this is the user's first launch
        function checkFirstLaunch() {
            try {
                const hasLaunchedBefore = localStorage.getItem('jombro_launched');
                if (!hasLaunchedBefore) {
                    isFirstLaunch = true;
                    // Show beta welcome after a brief delay
                    setTimeout(() => {
                        showModal('betaWelcome');
                    }, 1500);
                } else {
                    isFirstLaunch = false;
                    // Show returning user message
                    setTimeout(() => {
                        showToast('üéâ Welcome back to JomBro Beta! Ready for new challenges?');
                    }, 1000);
                }
            } catch (error) {
                // If localStorage isn't available, treat as first launch
                isFirstLaunch = true;
                setTimeout(() => {
                    showModal('betaWelcome');
                }, 1500);
            }
        }

        // Start onboarding tutorial
        function startOnboarding() {
            onboardingStep = 0;
            showOnboardingStep();
            showModal('onboarding');
            
            // Mark as launched
            try {
                localStorage.setItem('jombro_launched', 'true');
            } catch (error) {
                console.log('LocalStorage not available');
            }
        }

        // Skip onboarding
        function skipOnboarding() {
            try {
                localStorage.setItem('jombro_launched', 'true');
            } catch (error) {
                console.log('LocalStorage not available');
            }
            showToast('üéØ Ready to explore! Swipe up for next challenge or tap Accept!');
        }

        // Show onboarding steps
        function showOnboardingStep() {
            const steps = [
                {
                    icon: 'üéØ',
                    title: 'Welcome to Challenges!',
                    description: 'JomBro brings real-world challenges to life. Complete activities, earn tokens, and level up your social experience!'
                },
                {
                    icon: 'üì±',
                    title: 'How to Play',
                    description: 'Swipe up/down to browse challenges. Tap "Accept Challenge" to start. Complete the activity and submit proof!'
                },
                {
                    icon: 'üì∏',
                    title: 'Submit Your Proof',
                    description: 'Take photos or videos of your completed challenges. Our AI reviews submissions and awards tokens based on quality!'
                },
                {
                    icon: 'üèÜ',
                    title: 'Earn & Level Up',
                    description: 'Collect tokens, unlock achievements, and climb the ranks. Share your progress with friends!'
                },
                {
                    icon: 'üöÄ',
                    title: 'Ready to Start?',
                    description: 'You\'re all set! Remember: Be creative, be authentic, and most importantly - have fun! Let\'s Go! Let\'s Go!'
                }
            ];

            const step = steps[onboardingStep];
            const isLastStep = onboardingStep === steps.length - 1;
            
            document.getElementById('onboardingContent').innerHTML = `
                <div class="onboarding-step">
                    <div class="onboarding-icon">${step.icon}</div>
                    <div class="onboarding-title">${step.title}</div>
                    <div class="onboarding-description">${step.description}</div>
                    
                    <div class="onboarding-progress">
                        ${steps.map((_, index) => `
                            <div class="progress-dot ${index === onboardingStep ? 'active' : ''}"></div>
                        `).join('')}
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    ${onboardingStep > 0 ? `
                        <button class="btn-secondary" onclick="previousOnboardingStep()" style="flex: 1;">
                            ‚Üê Previous
                        </button>
                    ` : ''}
                    <button class="btn-primary" onclick="${isLastStep ? 'completeOnboarding()' : 'nextOnboardingStep()'}" style="flex: 2;">
                        ${isLastStep ? 'üéØ Start Challenging!' : 'Next ‚Üí'}
                    </button>
                </div>
                
                ${!isLastStep ? `
                    <button class="btn-secondary" onclick="completeOnboarding()" style="margin-top: 10px; width: 100%;">
                        Skip Tutorial
                    </button>
                ` : ''}
            `;
        }

        // Navigate onboarding
        function nextOnboardingStep() {
            onboardingStep++;
            showOnboardingStep();
        }

        function previousOnboardingStep() {
            onboardingStep--;
            showOnboardingStep();
        }

        function completeOnboarding() {
            hideModal('onboarding');
            showToast('üéâ Tutorial complete! Swipe up for your first challenge!');
            
            // Highlight the first challenge
            setTimeout(() => {
                showToast('üëÜ Tap "Accept Challenge" to start your first challenge!', false);
            }, 2000);
        }

        // Quick feedback for beta testing
        function showQuickFeedback() {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üìù</div>
                        <h3 style="color: #FFD700; margin-bottom: 10px;">Beta Feedback</h3>
                        <p style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">
                            Help us improve JomBro with your quick feedback!
                        </p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Quick Rating</label>
                        <div style="display: flex; justify-content: center; gap: 10px; margin: 15px 0;">
                            <button class="rating-btn" onclick="setQuickRating(this, 1)" data-rating="1">üòû</button>
                            <button class="rating-btn" onclick="setQuickRating(this, 2)" data-rating="2">üòê</button>
                            <button class="rating-btn" onclick="setQuickRating(this, 3)" data-rating="3">üôÇ</button>
                            <button class="rating-btn" onclick="setQuickRating(this, 4)" data-rating="4">üòä</button>
                            <button class="rating-btn" onclick="setQuickRating(this, 5)" data-rating="5">ü§©</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">What's your experience?</label>
                        <textarea class="form-control" id="quickFeedbackText" rows="3" 
                            placeholder="Love it? Found a bug? Want a feature? Tell us!"></textarea>
                    </div>
                    
                    <button class="btn-primary" onclick="submitQuickFeedback(); this.closest('.modal').remove();">
                        üì§ Send Beta Feedback
                    </button>
                    <button class="btn-secondary" onclick="this.closest('.modal').remove();">
                        Maybe Later
                    </button>
                    
                    <style>
                        .rating-btn {
                            width: 40px;
                            height: 40px;
                            border: 2px solid rgba(255, 255, 255, 0.3);
                            border-radius: 20px;
                            background: rgba(255, 255, 255, 0.1);
                            font-size: 20px;
                            cursor: pointer;
                            transition: all 0.2s ease;
                        }
                        .rating-btn:hover, .rating-btn.selected {
                            border-color: #FFD700;
                            background: rgba(255, 215, 0, 0.2);
                            transform: scale(1.1);
                        }
                    </style>
                </div>
            `;
            document.body.appendChild(modal);
        }

        let quickRating = 0;
        function setQuickRating(button, rating) {
            quickRating = rating;
            document.querySelectorAll('.rating-btn').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
        }

        function submitQuickFeedback() {
            const feedback = document.getElementById('quickFeedbackText').value;
            
            // Log feedback for beta testing
            console.log('Beta Feedback:', {
                rating: quickRating,
                feedback: feedback,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                screenSize: `${window.innerWidth}x${window.innerHeight}`
            });
            
            showToast('üìù Thank you! Your beta feedback helps us improve JomBro!');
            
            // Reset for next time
            quickRating = 0;
        }

        // Add launch ready badge
        function addLaunchReadyBadge() {
            const badge = document.createElement('div');
            badge.className = 'launch-ready-badge';
            badge.innerHTML = 'üöÄ BETA LIVE';
            badge.onclick = () => {
                showToast('‚úÖ JomBro Beta is live and ready for real users!');
                setTimeout(() => {
                    badge.style.display = 'none';
                }, 3000);
            };
            document.body.appendChild(badge);
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (badge.parentNode) {
                    badge.style.animation = 'fadeOut 1s ease';
                    setTimeout(() => badge.remove(), 1000);
                }
            }, 10000);
        }

        // ===== LAUNCH PREPARATION ENHANCEMENTS =====
        
        // Enhanced challenge acceptance for real launch
        function acceptChallengeWithPage(challengeId) {
            const challenge = challengeData.find(c => c.id === challengeId) || challengeData[currentPage];
            if (!challenge) return;
            
            currentChallenge = challenge;
            
            // Add launch tracking
            console.log('Challenge Accepted:', {
                challengeId: challenge.id,
                title: challenge.title,
                difficulty: challenge.difficulty,
                tokens: challenge.tokens,
                timestamp: new Date().toISOString()
            });
            
            // Populate challenge page
            document.getElementById('challengeDetailTitle').textContent = challenge.title;
            document.getElementById('challengeDetailDescription').textContent = challenge.description;
            document.getElementById('challengeDetailTokens').textContent = challenge.tokens.toLocaleString();
            document.getElementById('challengeDetailDifficulty').textContent = challenge.difficulty.charAt(0).toUpperCase() + challenge.difficulty.slice(1);
            document.getElementById('challengeDetailDuration').textContent = challenge.duration || '30 min';
            
            // Populate requirements
            const requirementsList = document.getElementById('challengeRequirementsList');
            requirementsList.innerHTML = '';
            if (challenge.requirements) {
                challenge.requirements.forEach(req => {
                    const li = document.createElement('li');
                    li.textContent = req;
                    requirementsList.appendChild(li);
                });
            }
            
            // Show challenge page
            document.getElementById('challengePage').classList.add('show');
        }

        // Enhanced submission with comprehensive validation
        async function submitChallengeCompletion() {
            // Validate form before proceeding
            if (!validateSubmissionForm()) {
                return;
            }
            
            if (!currentChallenge) {
                showToast('‚ùå No active challenge found!', true);
                return;
            }
            
            const description = document.getElementById('challengeCompletionDesc').value;
            const mediaFile = document.getElementById('challengeMedia').files[0];

            // Launch analytics
            console.log('Challenge Submission:', {
                challengeId: currentChallenge.id,
                challengeTitle: currentChallenge.title,
                descriptionLength: description.length,
                hasMedia: !!mediaFile,
                rating: selectedRating,
                timestamp: new Date().toISOString()
            });

            showToast('ü§ñ AI is reviewing your submission...');
            
            try {
                let reviewResult;
                
                // AI review with fallback for launch
                if (appSettings.openaiApiKey && appSettings.openaiApiKey.startsWith('sk-')) {
                    reviewResult = await submitForAIReview(description, mediaFile);
                } else {
                    // Enhanced mock review for beta
                    reviewResult = generateMockReview(description);
                }
                
                // Ensure player data is properly updated
                if (typeof playerData.tokens !== 'number') {
                    playerData.tokens = 15247; // Reset to default if corrupted
                }
                if (typeof playerData.completedChallenges !== 'number') {
                    playerData.completedChallenges = 143; // Reset to default if corrupted
                }
                
                // Award tokens
                playerData.tokens += reviewResult.tokensAwarded;
                playerData.completedChallenges++;
                
                updatePlayerDisplay();
                showReviewResults(reviewResult);
                
            } catch (error) {
                console.error('Submission failed:', error);
                showToast('‚ùå Review failed. Using backup scoring.', true);
                
                // Guaranteed fallback for launch stability
                const fallbackResult = {
                    overallScore: 70,
                    tokensAwarded: Math.floor(currentChallenge.tokens * 0.7),
                    feedback: "Great effort! Your submission has been recorded.",
                    percentage: 70
                };
                
                playerData.tokens += fallbackResult.tokensAwarded;
                showReviewResults(fallbackResult);
            }
            
            hideModal('challengeCompletion');
            resetChallengeForm();
        }

        // App sharing for organic growth
        function shareApp() {
            const shareData = {
                title: 'JomBro - Real World Challenge App',
                text: 'Join me on JomBro Beta! Complete real challenges, earn tokens, and have fun! üöÄ #JomBroBeta #ChallengeApp',
                url: window.location.href + '?ref=share'
            };

            if (navigator.share) {
                navigator.share(shareData).then(() => {
                    showToast('üì§ Thanks for sharing JomBro! üöÄ');
                    // Track sharing for beta metrics
                    console.log('App shared successfully');
                }).catch(() => {
                    fallbackShareApp(shareData);
                });
            } else {
                fallbackShareApp(shareData);
            }
        }

        // Enhanced error handling for launch
        window.addEventListener('error', function(e) {
            console.error('JomBro Error:', e.error);
            // Don't show error to users, just log for debugging
        });

        // Performance monitoring for launch
        window.addEventListener('load', function() {
            const loadTime = Date.now() - performance.timing.navigationStart;
            console.log('JomBro Load Time:', loadTime + 'ms');
        });

        // Generate sample challenges with complete descriptions
        function generateSampleChallenges() {
            challengeData = generateAllChallenges();
            console.log(`Generated ${challengeData.length} challenges`);
        }

        // Update player display
        function updatePlayerDisplay() {
            document.getElementById('playerRank').textContent = playerData.rank;
            document.getElementById('playerTokens').textContent = `ü™ô ${playerData.tokens.toLocaleString()}`;
        }

        // ===== INTERFACE VALIDATION & NUMBERING FIXES =====
        
        // Fix challenge numbering and display
        function updateCurrentChallenge() {
            const cards = document.querySelectorAll('.challenge-card');
            const totalChallenges = challengeData.length;
            
            // Ensure currentPage is within bounds
            if (currentPage >= totalChallenges) {
                currentPage = 0;
            } else if (currentPage < 0) {
                currentPage = totalChallenges - 1;
            }
            
            cards.forEach((card, index) => {
                card.className = 'challenge-card';
                if (index === currentPage) {
                    card.classList.add('current');
                } else if (index === (currentPage + 1) % totalChallenges) {
                    card.classList.add('next');
                } else {
                    card.classList.add('prev');
                }
            });

            // Update points display with proper formatting
            if (challengeData[currentPage]) {
                const pointsDisplay = document.getElementById('currentChallengePoints');
                if (pointsDisplay) {
                    const tokens = challengeData[currentPage].tokens;
                    if (tokens >= 1000) {
                        pointsDisplay.textContent = (tokens / 1000).toFixed(1) + 'K';
                    } else {
                        pointsDisplay.textContent = tokens.toString();
                    }
                }
            }
            
            // Update challenge counter in header (if exists)
            updateChallengeCounter();
        }

        // Add challenge counter display
        function updateChallengeCounter() {
            const existingCounter = document.getElementById('challengeCounter');
            if (existingCounter) {
                existingCounter.textContent = `${currentPage + 1}/${challengeData.length}`;
            }
        }

        // Fix navigation with proper index handling
        function nextChallenge() {
            const totalChallenges = challengeData.length;
            if (totalChallenges === 0) return;
            
            currentPage = (currentPage + 1) % totalChallenges;
            updateCurrentChallenge();
            showToast(`‚è≠Ô∏è Challenge ${currentPage + 1}/${totalChallenges}`);
        }

        // Fix previous challenge navigation
        function previousChallenge() {
            const totalChallenges = challengeData.length;
            if (totalChallenges === 0) return;
            
            currentPage = currentPage === 0 ? totalChallenges - 1 : currentPage - 1;
            updateCurrentChallenge();
            showToast(`‚èÆÔ∏è Challenge ${currentPage + 1}/${totalChallenges}`);
        }

        // Fix challenge display with proper numbering
        function updateChallengeDisplay() {
            const feedPages = document.getElementById('feedPages');
            if (!feedPages) return;
            
            feedPages.innerHTML = '';

            // Filter challenges based on difficulty setting
            let filteredChallenges = challengeData;
            const difficultyFilter = appSettings.difficultyFilter;
            
            if (difficultyFilter !== 'all') {
                const difficultyLevels = {
                    'easy': ['easy'],
                    'medium': ['easy', 'medium'],
                    'hard': ['medium', 'hard'],
                    'epic': ['hard', 'epic', 'legendary']
                };
                
                const allowedDifficulties = difficultyLevels[difficultyFilter] || ['easy', 'medium', 'hard', 'epic', 'legendary'];
                filteredChallenges = challengeData.filter(challenge => 
                    allowedDifficulties.includes(challenge.difficulty)
                );
            }

            // Reset currentPage if it's out of bounds after filtering
            if (currentPage >= filteredChallenges.length) {
                currentPage = 0;
            }

            // Create challenge cards with proper indexing
            filteredChallenges.forEach((challenge, index) => {
                const card = createChallengeCard(challenge, index);
                feedPages.appendChild(card);
            });

            // Update challenge data reference for filtered view
            challengeData = filteredChallenges;

            if (filteredChallenges.length > 0) {
                updateCurrentChallenge();
            } else {
                showToast('üéØ No challenges match your difficulty filter. Try adjusting settings!', true);
                // Reset to show all challenges if filter results in empty list
                challengeData = generateAllChallenges();
                currentPage = 0;
                updateChallengeDisplay();
            }
        }

        // Get all challenges without filtering
        function generateAllChallenges() {
            return [
                {
                    id: 'daily_001',
                    title: "Coffee Shop Poetry Challenge",
                    description: "Visit any coffee shop and ask the barista to write a short poem on your cup or napkin! This is a wonderful way to connect with people and brighten someone's day. Share the creative moment and spread some joy in your community. Take a photo of the poem and share your experience.",
                    hashtags: ["#CoffeePoetry", "#BaristArt", "#JomBro", "#Connection"],
                    difficulty: "easy",
                    tokens: 500,
                    type: "daily",
                    creator: "JomBro AI System",
                    avatar: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23FFD700"/><text x="50" y="55" text-anchor="middle" fill="white" font-size="30">‚òï</text></svg>',
                    requirements: [
                        "Visit any coffee shop or caf√©",
                        "Politely ask the barista to write a poem",
                        "Take a photo of the poem with your coffee",
                        "Share your experience and the barista's reaction",
                        "Rate your overall experience (1-5 stars)"
                    ],
                    duration: "30 minutes"
                },
                {
                    id: 'business_001',
                    title: "McDonald's Random Order Challenge",
                    description: "üí∞ BUSINESS PARTNERSHIP: Close your eyes and point at the menu to order! This exciting challenge will surprise your taste buds and create a fun dining experience. Rate your surprise meal and post your genuine reaction. Perfect for adventurous food lovers who want to try something new!",
                    hashtags: ["#McDonaldsPartner", "#SurpriseMenu", "#BusinessChallenge", "#FoodAdventure"],
                    difficulty: "medium",
                    tokens: 1800,
                    realRewards: "RM 50 McDonald's Voucher + Free Delivery",
                    type: "business",
                    partner: "McDonald's Malaysia",
                    creator: "McDonald's Malaysia",
                    avatar: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23FF6B47"/><text x="50" y="55" text-anchor="middle" fill="white" font-size="30">üçü</text></svg>',
                    requirements: [
                        "Visit any McDonald's restaurant",
                        "Close your eyes and point at the menu",
                        "Order whatever you pointed at",
                        "Take photos of your meal and reaction",
                        "Write a detailed review of your experience",
                        "Share on social media with hashtags"
                    ],
                    duration: "45 minutes"
                },
                {
                    id: 'adventure_001',
                    title: "Urban Explorer: Hidden Gems Hunt",
                    description: "üó∫Ô∏è Discover 5 hidden gems in your city that aren't on tourist maps! This challenge will help you explore your local area like never before. Document each location and share the story behind it. Perfect for curious minds who love discovering new places and creating content about local culture.",
                    hashtags: ["#UrbanExplorer", "#HiddenGems", "#LocalDiscovery", "#Adventure"],
                    difficulty: "hard",
                    tokens: 2500,
                    type: "daily",
                    creator: "Adventure Mike",
                    avatar: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%234FC3F7"/><text x="50" y="55" text-anchor="middle" fill="white" font-size="30">üó∫Ô∏è</text></svg>',
                    requirements: [
                        "Research and find 5 hidden local spots",
                        "Visit each location and take photos",
                        "Document the story or history of each place",
                        "Interview locals about the significance",
                        "Create a mini-guide for other explorers",
                        "Share your discovery journey"
                    ],
                    duration: "3-4 hours"
                },
                {
                    id: 'treasure_001',
                    title: "TREASURE: City Scavenger Hunt",
                    description: "üèÜ MONTHLY TREASURE: Complete a massive city-wide scavenger hunt with 10 hidden locations! This is our biggest challenge yet - solve clues, find hidden QR codes, and race against other players. First 50 players to complete get massive rewards including cash prizes and exclusive merchandise!",
                    hashtags: ["#TreasureHunt", "#CityWide", "#MonthlyChallenge", "#Competition"],
                    difficulty: "legendary",
                    tokens: 25000,
                    realRewards: "iPhone 15 Pro Max + RM 5,000 Cash + Exclusive Merchandise",
                    type: "treasure",
                    creator: "JomBro Treasure System",
                    avatar: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23FFD700"/><text x="50" y="55" text-anchor="middle" fill="white" font-size="30">üèÜ</text></svg>',
                    requirements: [
                        "Download the treasure hunt map",
                        "Solve 10 location-based clues",
                        "Find and scan QR codes at each location",
                        "Complete bonus mini-challenges",
                        "Submit proof of all 10 locations",
                        "Finish within the time limit"
                    ],
                    duration: "6-8 hours"
                },
                {
                    id: 'fitness_001',
                    title: "Public Workout Inspiration",
                    description: "üí™ Do 50 push-ups in a public place and inspire at least 2 people to join you! This challenge is about spreading fitness motivation and building community connections. Document the reactions and interactions you have with people who join in. Perfect for fitness enthusiasts who want to motivate others.",
                    hashtags: ["#PublicWorkout", "#FitnessMotivation", "#CommunityHealth", "#Inspiration"],
                    difficulty: "medium",
                    tokens: 1200,
                    type: "daily",
                    creator: "Fitness Ryan",
                    avatar: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23FF6B47"/><text x="50" y="55" text-anchor="middle" fill="white" font-size="30">üí™</text></svg>',
                    requirements: [
                        "Choose a busy public location",
                        "Start doing push-ups with good form",
                        "Invite at least 2 people to join you",
                        "Record their reactions and participation",
                        "Share fitness tips with participants",
                        "Document the entire experience"
                    ],
                    duration: "20-30 minutes"
                }
            ];
        }

        // Fix profile stats with proper number formatting
        function updateProfileDisplay() {
            // Ensure all elements exist before updating
            const elements = {
                'profileDisplayName': appSettings.displayName,
                'profileUsername': `@${appSettings.username}`,
                'profileRankDisplay': playerData.rank,
                'profileLevelBadge': playerData.level.toString(),
                'profileTokenCount': playerData.tokens.toLocaleString(),
                'profileChallengeCount': playerData.completedChallenges.toString(),
                'profileStreakCount': playerData.currentStreak.toString(),
                'profileFollowerCount': '2.5K' // Mock data
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            });
        }

        // Fix achievement numbering
        function populateAchievements() {
            const achievements = [
                { icon: 'üöÄ', title: 'First Launch', desc: 'Completed first challenge', number: 1 },
                { icon: 'üî•', title: 'Hot Streak', desc: '10 day challenge streak', number: 2 },
                { icon: '‚≠ê', title: 'Rising Star', desc: '100+ total points', number: 3 },
                { icon: 'üëë', title: 'Elite Status', desc: 'Reached Elite Gladiator', number: 4 },
                { icon: 'üéØ', title: 'Marksman', desc: '50 challenges completed', number: 5 },
                { icon: 'üíé', title: 'Diamond Tier', desc: '10,000+ tokens earned', number: 6 }
            ];
            
            const carousel = document.getElementById('achievementCarousel');
            if (carousel) {
                carousel.innerHTML = achievements.map((achievement, index) => `
                    <div class="achievement-card" onclick="showAchievementDetail('${achievement.title}')">
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-title">${achievement.title}</div>
                        <div class="achievement-desc">${achievement.desc}</div>
                        <div style="font-size: 10px; color: rgba(255,255,255,0.5); margin-top: 4px;">#${achievement.number}</div>
                    </div>
                `).join('');
            }
        }

        // Fix swipe gesture handling with proper bounds checking
        document.addEventListener('touchend', (e) => {
            if (!startY || !startX) return;

            const endY = e.changedTouches[0].clientY;
            const endX = e.changedTouches[0].clientX;
            const deltaY = startY - endY;
            const deltaX = startX - endX;

            // Only handle vertical swipes on the feed
            if (Math.abs(deltaY) > Math.abs(deltaX) && Math.abs(deltaY) > 50) {
                if (e.target.closest('.dark-feed')) {
                    if (deltaY > 0) {
                        nextChallenge(); // Swipe up for next
                    } else {
                        previousChallenge(); // Swipe down for previous
                    }
                }
            }

            startY = 0;
            startX = 0;
        });

        // Fix modal numbering and indexing
        function showOnboardingStep() {
            const steps = [
                {
                    icon: 'üéØ',
                    title: 'Welcome to Challenges!',
                    description: 'JomBro brings real-world challenges to life. Complete activities, earn tokens, and level up your social experience!',
                    number: 1
                },
                {
                    icon: 'üì±',
                    title: 'How to Play',
                    description: 'Swipe up/down to browse challenges. Tap "Accept Challenge" to start. Complete the activity and submit proof!',
                    number: 2
                },
                {
                    icon: 'üì∏',
                    title: 'Submit Your Proof',
                    description: 'Take photos or videos of your completed challenges. Our AI reviews submissions and awards tokens based on quality!',
                    number: 3
                },
                {
                    icon: 'üèÜ',
                    title: 'Earn & Level Up',
                    description: 'Collect tokens, unlock achievements, and climb the ranks. Share your progress with friends!',
                    number: 4
                },
                {
                    icon: 'üöÄ',
                    title: 'Ready to Start?',
                    description: 'You\'re all set! Remember: Be creative, be authentic, and most importantly - have fun! Let\'s Go! Let\'s Go!',
                    number: 5
                }
            ];

            // Ensure onboardingStep is within bounds
            if (onboardingStep >= steps.length) {
                onboardingStep = steps.length - 1;
            } else if (onboardingStep < 0) {
                onboardingStep = 0;
            }

            const step = steps[onboardingStep];
            const isLastStep = onboardingStep === steps.length - 1;
            const isFirstStep = onboardingStep === 0;
            
            const contentElement = document.getElementById('onboardingContent');
            if (contentElement) {
                contentElement.innerHTML = `
                    <div class="onboarding-step">
                        <div class="onboarding-icon">${step.icon}</div>
                        <div class="onboarding-title">${step.title}</div>
                        <div class="onboarding-description">${step.description}</div>
                        
                        <div class="onboarding-progress">
                            ${steps.map((_, index) => `
                                <div class="progress-dot ${index === onboardingStep ? 'active' : ''}"></div>
                            `).join('')}
                        </div>
                        
                        <div style="text-align: center; margin: 15px 0; color: rgba(255,255,255,0.6); font-size: 14px;">
                            Step ${step.number} of ${steps.length}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        ${!isFirstStep ? `
                            <button class="btn-secondary" onclick="previousOnboardingStep()" style="flex: 1;">
                                ‚Üê Previous
                            </button>
                        ` : ''}
                        <button class="btn-primary" onclick="${isLastStep ? 'completeOnboarding()' : 'nextOnboardingStep()'}" style="flex: 2;">
                            ${isLastStep ? 'üéØ Start Challenging!' : 'Next ‚Üí'}
                        </button>
                    </div>
                    
                    ${!isLastStep ? `
                        <button class="btn-secondary" onclick="completeOnboarding()" style="margin-top: 10px; width: 100%;">
                            Skip Tutorial
                        </button>
                    ` : ''}
                `;
            }
        }

        // Fix onboarding navigation with bounds checking
        function nextOnboardingStep() {
            const maxSteps = 5; // Total number of onboarding steps
            if (onboardingStep < maxSteps - 1) {
                onboardingStep++;
                showOnboardingStep();
            }
        }

        function previousOnboardingStep() {
            if (onboardingStep > 0) {
                onboardingStep--;
                showOnboardingStep();
            }
        }

        // Create challenge card
        function createChallengeCard(challenge, index) {
            const card = document.createElement('div');
            card.className = `challenge-card ${index === currentPage ? 'current' : (index === currentPage + 1 ? 'next' : 'prev')}`;
            card.setAttribute('data-index', index);

            const getDifficultyClass = (difficulty) => {
                const classes = {
                    'easy': 'difficulty-easy',
                    'medium': 'difficulty-medium',
                    'hard': 'difficulty-hard',
                    'epic': 'difficulty-epic',
                    'legendary': 'difficulty-legendary'
                };
                return classes[difficulty] || 'difficulty-easy';
            };

            const getTypeClass = (type) => {
                const classes = {
                    'daily': 'daily',
                    'treasure': 'treasure',
                    'vip': 'vip',
                    'business': 'business'
                };
                return classes[type] || 'daily';
            };

            card.innerHTML = `
                <div class="challenge-content">
                    <div class="challenge-user">
                        <div class="challenge-avatar">
                            <div class="challenge-avatar-inner">
                                <img src="${challenge.avatar}" alt="${challenge.creator}">
                            </div>
                        </div>
                        <div>
                            <div class="challenge-username">
                                ${challenge.creator}
                                <span class="challenge-type ${getTypeClass(challenge.type)}">${challenge.type.toUpperCase()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="challenge-text-container">
                        <div class="challenge-title">${challenge.title}</div>
                        <div class="challenge-text">${challenge.description}</div>
                        
                        <div class="challenge-hashtags">
                            ${challenge.hashtags.map(tag => `<span class="challenge-hashtag">${tag}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="challenge-reward">
                        ü™ô ${challenge.tokens.toLocaleString()} Tokens
                        <span class="challenge-difficulty ${getDifficultyClass(challenge.difficulty)}">${challenge.difficulty.toUpperCase()}</span>
                        ${challenge.realRewards ? `<br><small>üéÅ Real Reward: ${challenge.realRewards}</small>` : ''}
                    </div>
                    
                    <div class="challenge-actions">
                        <button class="challenge-btn btn-accept" onclick="acceptChallengeWithPage('${challenge.id}')">
                            üöÄ Accept Challenge
                        </button>
                        <button class="challenge-btn btn-decline" onclick="nextChallenge()">
                            Skip
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        // Update current challenge
        function updateCurrentChallenge() {
            const cards = document.querySelectorAll('.challenge-card');
            cards.forEach((card, index) => {
                card.className = 'challenge-card';
                if (index === currentPage) {
                    card.classList.add('current');
                } else if (index === currentPage + 1) {
                    card.classList.add('next');
                } else {
                    card.classList.add('prev');
                }
            });

            // Update points display
            if (challengeData[currentPage]) {
                const pointsDisplay = document.getElementById('currentChallengePoints');
                if (pointsDisplay) {
                    const tokens = challengeData[currentPage].tokens;
                    pointsDisplay.textContent = tokens >= 1000 ? (tokens / 1000).toFixed(1) + 'K' : tokens.toString();
                }
            }
        }

        // Accept challenge with detail page
        function acceptChallengeWithPage(challengeId) {
            const challenge = challengeData.find(c => c.id === challengeId) || challengeData[currentPage];
            if (!challenge) return;
            
            currentChallenge = challenge;
            
            // Populate challenge page
            document.getElementById('challengeDetailTitle').textContent = challenge.title;
            document.getElementById('challengeDetailDescription').textContent = challenge.description;
            document.getElementById('challengeDetailTokens').textContent = challenge.tokens.toLocaleString();
            document.getElementById('challengeDetailDifficulty').textContent = challenge.difficulty.charAt(0).toUpperCase() + challenge.difficulty.slice(1);
            document.getElementById('challengeDetailDuration').textContent = challenge.duration || '30 min';
            
            // Populate requirements
            const requirementsList = document.getElementById('challengeRequirementsList');
            requirementsList.innerHTML = '';
            if (challenge.requirements) {
                challenge.requirements.forEach(req => {
                    const li = document.createElement('li');
                    li.textContent = req;
                    requirementsList.appendChild(li);
                });
            }
            
            // Show challenge page
            document.getElementById('challengePage').classList.add('show');
        }

        // Close challenge page
        function closeChallengeePage() {
            const challengePage = document.getElementById('challengePage');
            challengePage.style.animation = 'slideOutToRight 0.4s ease';
            setTimeout(() => {
                challengePage.classList.remove('show');
                challengePage.style.animation = '';
            }, 400);
        }

        // Start challenge
        function startChallenge() {
            closeChallengeePage();
            showToast('üöÄ Challenge started! Complete it and submit for review.');
            
            // Show completion modal after delay
            setTimeout(() => {
                showModal('challengeCompletion');
            }, 2000);
        }

        // Next challenge
        function nextChallenge() {
            currentPage = (currentPage + 1) % challengeData.length;
            updateCurrentChallenge();
            showToast('‚è≠Ô∏è Next challenge loaded!');
        }

        // Submit challenge completion with AI review
        async function submitChallengeCompletion() {
            const description = document.getElementById('challengeCompletionDesc').value;
            const mediaFile = document.getElementById('challengeMedia').files[0];

            if (!description.trim()) {
                showToast('‚ùå Please describe what you did!', true);
                return;
            }

            if (selectedRating === 0) {
                showToast('‚ùå Please rate your experience!', true);
                return;
            }

            showToast('ü§ñ AI is reviewing your submission...');
            
            try {
                let reviewResult;
                
                // Try AI review if API key is available
                if (appSettings.openaiApiKey && appSettings.openaiApiKey.startsWith('sk-')) {
                    reviewResult = await submitForAIReview(description, mediaFile);
                } else {
                    // Fallback to mock review
                    reviewResult = generateMockReview(description);
                }
                
                // Award tokens
                playerData.tokens += reviewResult.tokensAwarded;
                playerData.completedChallenges++;
                
                updatePlayerDisplay();
                showReviewResults(reviewResult);
                
            } catch (error) {
                console.error('Submission failed:', error);
                showToast('‚ùå Review failed. Using backup scoring.', true);
                
                // Fallback review
                const fallbackResult = {
                    overallScore: 60,
                    tokensAwarded: Math.floor(currentChallenge.tokens * 0.6),
                    feedback: "Great effort! Your submission has been recorded."
                };
                
                playerData.tokens += fallbackResult.tokensAwarded;
                showReviewResults(fallbackResult);
            }
            
            hideModal('challengeCompletion');
            resetChallengeForm();
        }

        // Submit for AI review (mock for demo)
        async function submitForAIReview(description, mediaFile) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Generate realistic mock score
            return generateMockReview(description);
        }

        // Generate mock review (fallback)
        function generateMockReview(description) {
            const wordCount = description.split(' ').length;
            const hasDetails = description.length > 100;
            const hasEmotions = /exciting|fun|amazing|awesome|great|love|enjoy|fantastic/.test(description.toLowerCase());
            
            let score = 50; // Base score
            if (wordCount > 20) score += 15;
            if (hasDetails) score += 15; 
            if (hasEmotions) score += 10;
            if (selectedRating >= 4) score += 10;
            
            score = Math.min(score, 95); // Cap at 95
            
            return calculateTokenReward(score);
        }

        // Calculate token reward based on score
        function calculateTokenReward(score) {
            let percentage;
            if (score >= 90) percentage = 1.0;
            else if (score >= 80) percentage = 0.9;
            else if (score >= 70) percentage = 0.8;
            else if (score >= 60) percentage = 0.7;
            else if (score >= 50) percentage = 0.5;
            else if (score >= 30) percentage = 0.3;
            else percentage = 0.1;

            const tokensAwarded = Math.floor(currentChallenge.tokens * percentage);
            
            let feedback;
            if (score >= 85) feedback = "üéâ Exceptional work! You've mastered this challenge!";
            else if (score >= 70) feedback = "üëç Great job! You completed the challenge well!";
            else if (score >= 50) feedback = "‚≠ê Good effort! Nice work on completing the challenge!";
            else feedback = "üí™ Keep trying! Every attempt makes you stronger!";
            
            return {
                overallScore: score,
                tokensAwarded,
                percentage: Math.round(percentage * 100),
                feedback
            };
        }

        // Show review results
        function showReviewResults(result) {
            const resultHTML = `
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 60px; margin-bottom: 20px;">
                        ${result.overallScore >= 80 ? 'üéâ' : result.overallScore >= 60 ? '‚≠ê' : 'üí™'}
                    </div>
                    
                    <h2 style="color: #fff; margin-bottom: 15px;">
                        ${result.overallScore >= 80 ? 'Excellent Work!' : result.overallScore >= 60 ? 'Great Job!' : 'Nice Try!'}
                    </h2>
                    
                    <div style="background: rgba(0, 255, 150, 0.1); border: 1px solid rgba(0, 255, 150, 0.3); padding: 20px; border-radius: 16px; margin: 20px 0;">
                        <div style="font-size: 24px; color: #00FF96; font-weight: 700; margin-bottom: 10px;">
                            +${result.tokensAwarded.toLocaleString()} Tokens
                        </div>
                        <div style="color: rgba(255, 255, 255, 0.8); font-size: 14px;">
                            ${result.percentage}% of maximum reward
                        </div>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 12px; margin: 20px 0;">
                        <div style="color: #FFD700; font-weight: 600; margin-bottom: 10px;">AI Review Score: ${result.overallScore}/100</div>
                        <p style="color: rgba(255, 255, 255, 0.9); line-height: 1.5;">${result.feedback}</p>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    ${resultHTML}
                    <button class="btn-primary" onclick="this.closest('.modal').remove(); nextChallenge();">
                        üöÄ Next Challenge
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Set rating
        function setRating(rating) {
            selectedRating = rating;
            const stars = document.querySelectorAll('.star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                    star.style.opacity = '1';
                } else {
                    star.classList.remove('active');
                    star.style.opacity = '0.3';
                }
            });
        }

        // Reset challenge form
        function resetChallengeForm() {
            selectedRating = 0;
            document.querySelectorAll('.star').forEach(star => {
                star.classList.remove('active');
                star.style.opacity = '0.3';
            });
            document.getElementById('challengeCompletionDesc').value = '';
            document.getElementById('challengeMedia').value = '';
        }

        // Create new challenge
        function createChallenge() {
            const title = document.getElementById('challengeTitle').value;
            const description = document.getElementById('challengeDesc').value;
            const tokens = parseInt(document.getElementById('challengePoints').value);

            if (!title.trim() || !description.trim()) {
                showToast('‚ùå Please fill in title and description!', true);
                return;
            }

            const newChallenge = {
                id: 'user_' + Date.now(),
                title: title,
                description: description,
                hashtags: ["#UserChallenge", "#JomBro", "#Community"],
                difficulty: tokens >= 5000 ? "epic" : tokens >= 2500 ? "hard" : "medium",
                tokens: tokens,
                type: "daily",
                creator: playerData.displayName,
                avatar: playerData.avatar,
                requirements: [
                    "Complete the challenge as described",
                    "Document your experience with photos/videos",
                    "Share your results with the community",
                    "Rate your overall experience"
                ],
                duration: "Variable"
            };

            challengeData.unshift(newChallenge);
            updateChallengeDisplay();
            
            hideModal('create');
            showToast('‚ú® Challenge created successfully!');
            
            // Clear form
            document.getElementById('challengeTitle').value = '';
            document.getElementById('challengeDesc').value = '';
        }

        // Action functions
        function likeChallenge() {
            showToast('‚ù§Ô∏è Challenge liked!');
            // Update like count
            const pointsEl = document.getElementById('currentChallengePoints');
            if (pointsEl && challengeData[currentPage]) {
                const currentLikes = parseFloat(pointsEl.textContent);
                pointsEl.textContent = (currentLikes + 0.1).toFixed(1) + 'K';
            }
        }

        function shareChallenge() {
            if (navigator.share && currentChallenge) {
                navigator.share({
                    title: currentChallenge.title,
                    text: currentChallenge.description,
                    url: window.location.href
                }).then(() => {
                    showToast('üì§ Challenge shared successfully!');
                }).catch(() => {
                    showToast('üì§ Challenge copied to clipboard!');
                });
            } else {
                showToast('üì§ Challenge shared!');
            }
        }

        function bookmarkChallenge() {
            showToast('üîñ Challenge bookmarked!');
        }

        // Enhanced navigation with profile page
        function navAction(element, section) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            element.classList.add('active');
            
            switch(section) {
                case 'profile':
                    showProfilePage();
                    break;
                default:
                    showToast(`üì± Navigated to ${section}`);
            }
        }

        // ===== COMPREHENSIVE PROFILE PAGE FUNCTIONS =====
        
        // Show profile page
        function showProfilePage() {
            updateProfileDisplay();
            populateAchievements();
            populateChallengeHistory();
            populateActivityFeed();
            
            document.getElementById('profilePage').classList.add('show');
            document.getElementById('profilePage').style.display = 'block';
        }

        // Close profile page
        function closeProfilePage() {
            const profilePage = document.getElementById('profilePage');
            profilePage.style.animation = 'slideOutToRight 0.4s ease';
            setTimeout(() => {
                profilePage.classList.remove('show');
                profilePage.style.display = 'none';
                profilePage.style.animation = '';
            }, 400);
        }

        // Update profile display with current data
        function updateProfileDisplay() {
            document.getElementById('profileDisplayName').textContent = appSettings.displayName;
            document.getElementById('profileUsername').textContent = `@${appSettings.username}`;
            document.getElementById('profileRankDisplay').textContent = playerData.rank;
            document.getElementById('profileLevelBadge').textContent = playerData.level;
            document.getElementById('profileTokenCount').textContent = playerData.tokens.toLocaleString();
            document.getElementById('profileChallengeCount').textContent = playerData.completedChallenges;
            document.getElementById('profileStreakCount').textContent = playerData.currentStreak;
            document.getElementById('profileFollowerCount').textContent = '2.5K'; // Mock data
        }

        // Populate achievements carousel
        function populateAchievements() {
            const achievements = [
                { icon: 'üöÄ', title: 'First Launch', desc: 'Completed first challenge' },
                { icon: 'üî•', title: 'Hot Streak', desc: '10 day challenge streak' },
                { icon: '‚≠ê', title: 'Rising Star', desc: '100+ total points' },
                { icon: 'üëë', title: 'Elite Status', desc: 'Reached Elite Gladiator' },
                { icon: 'üéØ', title: 'Marksman', desc: '50 challenges completed' },
                { icon: 'üíé', title: 'Diamond Tier', desc: '10,000+ tokens earned' }
            ];
            
            const carousel = document.getElementById('achievementCarousel');
            carousel.innerHTML = achievements.map(achievement => `
                <div class="achievement-card" onclick="showAchievementDetail('${achievement.title}')">
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-title">${achievement.title}</div>
                    <div class="achievement-desc">${achievement.desc}</div>
                </div>
            `).join('');
        }

        // Populate challenge history
        function populateChallengeHistory() {
            const recentChallenges = [
                {
                    title: 'Coffee Shop Poetry Challenge',
                    description: 'Asked barista to write a poem on my cup',
                    points: 500,
                    date: '2 hours ago',
                    status: 'Completed',
                    rating: 5
                },
                {
                    title: 'Urban Explorer: Hidden Gems',
                    description: 'Found 5 hidden gems in downtown area',
                    points: 2500,
                    date: '1 day ago',
                    status: 'Completed',
                    rating: 4
                },
                {
                    title: 'Public Workout Inspiration',
                    description: 'Did 50 push-ups and inspired 3 people to join',
                    points: 1200,
                    date: '3 days ago',
                    status: 'Completed',
                    rating: 5
                }
            ];
            
            const historyList = document.getElementById('challengeHistoryList');
            historyList.innerHTML = recentChallenges.map(challenge => `
                <div class="history-item" onclick="showChallengeDetail('${challenge.title}')">
                    <div class="history-item-header">
                        <div class="history-title">${challenge.title}</div>
                        <div class="history-points">+${challenge.points}</div>
                    </div>
                    <div class="history-desc">${challenge.description}</div>
                    <div class="history-meta">
                        <span>${challenge.status} ‚Ä¢ ${'‚≠ê'.repeat(challenge.rating)}</span>
                        <span>${challenge.date}</span>
                    </div>
                </div>
            `).join('');
        }

        // Populate activity feed
        function populateActivityFeed() {
            const activities = [
                { content: 'üéâ Earned "Rising Star" achievement!', time: '2 hours ago' },
                { content: '‚úÖ Completed Coffee Shop Poetry Challenge', time: '2 hours ago' },
                { content: 'üî• Extended challenge streak to 12 days', time: '1 day ago' },
                { content: 'üèÜ Reached Elite Gladiator rank!', time: '2 days ago' },
                { content: 'üë• 3 friends joined from your invite', time: '3 days ago' },
                { content: 'üì∏ Submitted photo for Urban Explorer challenge', time: '3 days ago' }
            ];
            
            const activityFeed = document.getElementById('profileActivityFeed');
            activityFeed.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-content">${activity.content}</div>
                    <div class="activity-time">${activity.time}</div>
                </div>
            `).join('');
        }

        // Switch history tabs
        function switchHistoryTab(element, tab) {
            document.querySelectorAll('.history-tab').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
            
            // Filter history based on tab
            if (tab === 'completed') {
                populateChallengeHistory(); // Show completed challenges
            } else if (tab === 'favorites') {
                showFavoriteChallenges();
            } else {
                populateChallengeHistory(); // Default to recent
            }
        }

        // Show favorite challenges
        function showFavoriteChallenges() {
            const historyList = document.getElementById('challengeHistoryList');
            historyList.innerHTML = `
                <div class="history-item">
                    <div class="history-item-header">
                        <div class="history-title">McDonald's Random Order</div>
                        <div class="history-points">Saved</div>
                    </div>
                    <div class="history-desc">Business partnership challenge with real rewards</div>
                    <div class="history-meta">
                        <span>Bookmarked ‚Ä¢ üçü Business</span>
                        <span>Available</span>
                    </div>
                </div>
                <div class="history-item">
                    <div class="history-item-header">
                        <div class="history-title">TREASURE: City Scavenger Hunt</div>
                        <div class="history-points">Saved</div>
                    </div>
                    <div class="history-desc">Monthly treasure hunt with iPhone prize</div>
                    <div class="history-meta">
                        <span>Bookmarked ‚Ä¢ üèÜ Treasure</span>
                        <span>Available</span>
                    </div>
                </div>
            `;
        }

        // Share profile
        function shareProfile() {
            const shareData = {
                title: `${appSettings.displayName} on JomBro`,
                text: `Check out my profile! I've completed ${playerData.completedChallenges} challenges and earned ${playerData.tokens.toLocaleString()} tokens!`,
                url: window.location.href + '?profile=' + appSettings.username
            };

            if (navigator.share) {
                navigator.share(shareData).then(() => {
                    showToast('üì§ Profile shared successfully!');
                }).catch(() => {
                    fallbackShareProfile(shareData);
                });
            } else {
                fallbackShareProfile(shareData);
            }
        }

        // Fallback share profile
        function fallbackShareProfile(shareData) {
            const shareText = `${shareData.text}\n\n${shareData.url}`;
            navigator.clipboard.writeText(shareText).then(() => {
                showToast('üìã Profile link copied to clipboard!');
            }).catch(() => {
                showToast('üì§ Share profile manually: JomBro challenges app');
            });
        }

        // Show QR code for profile
        function showQRCode() {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content" style="text-align: center;">
                    <div class="modal-title">üì± Share Profile QR Code</div>
                    
                    <div style="background: white; padding: 20px; border-radius: 16px; margin: 20px 0; display: inline-block;">
                        <div style="width: 200px; height: 200px; background: #000; color: white; display: flex; align-items: center; justify-content: center; font-size: 48px; border-radius: 8px;">
                            üì±
                        </div>
                    </div>
                    
                    <p style="color: rgba(255, 255, 255, 0.8); margin: 20px 0; line-height: 1.5;">
                        Scan this QR code to view<br>
                        <strong>${appSettings.displayName}'s</strong> profile
                    </p>
                    
                    <button class="btn-primary" onclick="this.closest('.modal').remove();">
                        Close
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Helper functions for profile actions
        function showAllAchievements() {
            showToast('üèÜ Opening full achievements gallery...');
        }

        function showAchievementDetail(title) {
            showToast(`üèÜ Achievement: ${title}`);
        }

        function showChallengeDetail(title) {
            showToast(`üìä Challenge: ${title}`);
        }

        function showChallengeFilter() {
            showToast('üîç Opening challenge filters...');
        }

        function showActivitySettings() {
            showToast('‚ö° Opening activity settings...');
        }

        function showInviteFriends() {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üë• Invite Friends</div>
                    
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üéâ</div>
                        <h3 style="color: #00FF96; margin-bottom: 15px;">Share JomBro with Friends!</h3>
                        <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 25px; line-height: 1.5;">
                            Invite your friends to join the challenge revolution!<br>
                            More friends = More fun challenges together!
                        </p>
                        
                        <div style="background: rgba(0, 255, 150, 0.1); border: 1px solid rgba(0, 255, 150, 0.3); border-radius: 12px; padding: 15px; margin: 20px 0;">
                            <div style="color: #00FF96; font-weight: 600; margin-bottom: 5px;">Beta Launch Special!</div>
                            <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">
                                Early adopters get exclusive founder badges!
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn-primary" onclick="shareApp(); this.closest('.modal').remove();">
                        üì§ Share JomBro
                    </button>
                    <button class="btn-secondary" onclick="this.closest('.modal').remove();">
                        Close
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showHelpCenter() {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">‚ùì Help Center</div>
                    
                    <div style="padding: 20px 0;">
                        <h4 style="color: #00FF96; margin-bottom: 15px;">üöÄ Getting Started</h4>
                        <ul style="color: rgba(255, 255, 255, 0.8); margin-bottom: 20px; line-height: 1.6;">
                            <li style="margin-bottom: 8px;">‚Ä¢ Accept challenges by tapping "Accept Challenge"</li>
                            <li style="margin-bottom: 8px;">‚Ä¢ Complete activities in real life</li>
                            <li style="margin-bottom: 8px;">‚Ä¢ Submit photos/videos as proof</li>
                            <li style="margin-bottom: 8px;">‚Ä¢ Earn tokens and climb the ranks!</li>
                        </ul>
                        
                        <h4 style="color: #00FF96; margin-bottom: 15px;">üèÜ Earning Tokens</h4>
                        <ul style="color: rgba(255, 255, 255, 0.8); margin-bottom: 20px; line-height: 1.6;">
                            <li style="margin-bottom: 8px;">‚Ä¢ Easy challenges: 500-1,000 tokens</li>
                            <li style="margin-bottom: 8px;">‚Ä¢ Medium challenges: 1,200-2,500 tokens</li>
                            <li style="margin-bottom: 8px;">‚Ä¢ Hard challenges: 2,500-5,000 tokens</li>
                            <li style="margin-bottom: 8px;">‚Ä¢ Epic/Legendary: 5,000+ tokens</li>
                        </ul>
                        
                        <div style="background: rgba(0, 255, 150, 0.1); border: 1px solid rgba(0, 255, 150, 0.3); border-radius: 12px; padding: 15px; margin: 20px 0;">
                            <div style="color: #00FF96; font-weight: 600; margin-bottom: 5px;">üí° Pro Tips</div>
                            <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px; line-height: 1.4;">
                                ‚Ä¢ Be creative and authentic in your submissions<br>
                                ‚Ä¢ Take clear photos/videos as proof<br>
                                ‚Ä¢ Write detailed descriptions for better AI scores<br>
                                ‚Ä¢ Try different challenge types for variety
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn-primary" onclick="this.closest('.modal').remove();">
                        Got it!
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showFeedback() {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üí¨ Send Feedback</div>
                    
                    <div class="form-group">
                        <label class="form-label">Feedback Type</label>
                        <select class="form-control" id="feedbackType">
                            <option value="bug">üêõ Report Bug</option>
                            <option value="feature">üí° Feature Request</option>
                            <option value="improvement">‚ö° Improvement Suggestion</option>
                            <option value="general">üí¨ General Feedback</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Your Message</label>
                        <textarea class="form-control" id="feedbackMessage" rows="4" 
                            placeholder="Tell us what you think! Your feedback helps us improve JomBro..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contact Email (Optional)</label>
                        <input type="email" class="form-control" id="feedbackEmail" 
                            placeholder="your.email@example.com">
                    </div>
                    
                    <button class="btn-primary" onclick="submitFeedback(); this.closest('.modal').remove();">
                        üì§ Send Feedback
                    </button>
                    <button class="btn-secondary" onclick="this.closest('.modal').remove();">
                        Cancel
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Submit feedback
        function submitFeedback() {
            const type = document.getElementById('feedbackType').value;
            const message = document.getElementById('feedbackMessage').value;
            const email = document.getElementById('feedbackEmail').value;
            
            if (!message.trim()) {
                showToast('‚ùå Please enter your feedback message!', true);
                return;
            }
            
            // Mock feedback submission
            console.log('Feedback submitted:', { type, message, email });
            showToast('üì§ Thank you! Your feedback has been sent.');
        }

        // Share app function
        function shareApp() {
            const shareData = {
                title: 'JomBro - Social Challenge App',
                text: 'Join me on JomBro! Complete real-world challenges, earn tokens, and have fun! üöÄ',
                url: window.location.href
            };

            if (navigator.share) {
                navigator.share(shareData).then(() => {
                    showToast('üì§ JomBro shared successfully!');
                }).catch(() => {
                    fallbackShareApp(shareData);
                });
            } else {
                fallbackShareApp(shareData);
            }
        }

        // Fallback share app
        function fallbackShareApp(shareData) {
            const shareText = `${shareData.text}\n\nDownload: ${shareData.url}`;
            navigator.clipboard.writeText(shareText).then(() => {
                showToast('üìã Share link copied to clipboard!');
            }).catch(() => {
                showToast('üì§ Tell your friends about JomBro!');
            });
        }

        // Modal functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId + 'Modal');
            if (modal) {
                modal.classList.add('show');
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId + 'Modal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // Other functions
        function showHowToPlay() {
            showToast('‚ùì Opening tutorial... (Feature coming soon!)');
        }

        function showLiveActivity() {
            showToast('‚ö° Opening live activity feed... (Feature coming soon!)');
        }

        function showNotifications() {
            showToast('üîî Opening notifications... (Feature coming soon!)');
        }

        // Toast notification system
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const toastText = document.getElementById('toastText');
            
            toastText.textContent = message;
            toast.className = `toast ${isError ? 'error' : ''}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        // Swipe gesture handling
        let startY = 0;
        let startX = 0;

        document.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            startX = e.touches[0].clientX;
        });

        document.addEventListener('touchend', (e) => {
            if (!startY || !startX) return;

            const endY = e.changedTouches[0].clientY;
            const endX = e.changedTouches[0].clientX;
            const deltaY = startY - endY;
            const deltaX = startX - endX;

            // Only handle vertical swipes on the feed
            if (Math.abs(deltaY) > Math.abs(deltaX) && Math.abs(deltaY) > 50) {
                if (e.target.closest('.dark-feed')) {
                    if (deltaY > 0) {
                        nextChallenge(); // Swipe up for next
                    } else {
                        // Previous challenge
                        currentPage = currentPage === 0 ? challengeData.length - 1 : currentPage - 1;
                        updateCurrentChallenge();
                        showToast('‚èÆÔ∏è Previous challenge loaded!');
                    }
                }
            }

            startY = 0;
            startX = 0;
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // PWA installation
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showToast('üì± App can be installed! Check settings.');
        });

        console.log('‚úÖ JomBro Beta Launch Ready');
        console.log('üéØ Features: Comprehensive Profile, Real Launch Ready, 100% Free');
        console.log('üöÄ Ready for real users with no payment barriers!');
    </script>
</body>
</html>
