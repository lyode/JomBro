/* Mobile responsive adjustments */
        @media (max-width: 480px) {
            .top-right-buttons {
                top: 10px;
                right: 10px;
                gap: 6px;
            }

            .top-feature-btn {
                padding: 8px 12px;
                font-size: 12px;
            }

            .top-feature-btn span:last-child {
                display: none;
            }

            .right-overlay-buttons {
                right: 10px;
                gap: 8px;
            }

            .overlay-button {
                width: 48px;
                height: 48px;
                font-size: 16px;
            }

            .overlay-button::after {
                right: 60px;
            }

            .overlay-button:hover::after {
                right: 55px;
            }

            .feature-modal {
                padding: 20px;
                max-width: 95%;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }

            .online-players-overlay {
                top: 60px;
                right: 10px;
                max-width: 180px;
            }

            .chat-container {
                height: 300px;
            }

            .champion-item {
                flex-direction: column;
                text-align: center;
            }

            .champion-stats {
                text-align: center;
                margin-top: 10px;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Global Functions - Updated list */
        window.toggleMode = toggleMode;
        window.signOut = signOut;
        window.takeChallenge = takeChallenge;
        window.togglePasswordVisibility = togglePasswordVisibility;
        window.showChallenges = showChallenges;
        window.toggleNotifications = toggleNotifications;
        window.toggleDarkMode = toggleDarkMode;
        window.togglePrivacy = togglePrivacy;
        window.showModal = showModal;
        window.closeModal = closeModal;
        window.showShop = showShop;
        window.showFriends = showFriends;
        window.showStats = showStats;
        window.showInventory = showInventory;
        window.quickAction = quickAction;
        window.generateAIChallenge = generateAIChallenge;
        window.toggleOnlinePlayers = toggleOnlinePlayers;
        window.claimDailyReward = claimDailyReward;<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JomBro">
    <meta name="theme-color" content="#ff6b9d">
    <meta name="description" content="AI-Powered Social Challenge Platform - Connect, Challenge, Conquer!">
       
    <title>JomBro - Challenge Platform</title>

    <style>
        :root {
            --safe-area-top: env(safe-area-inset-top, 20px);
            --safe-area-bottom: env(safe-area-inset-bottom, 20px);
            --primary-pink: #ff6b9d;
            --primary-purple: #8b5cf6;
            --primary-blue: #00d4ff;
            --accent-pink: #ff8cc8;
            --dark-bg: #0a0a0a;
            --glass-bg: rgba(15, 15, 15, 0.45);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --error-red: #ef4444;
            
            /* Animation Variables */
            --animation-speed-fast: 0.2s;
            --animation-speed-normal: 0.3s;
            --animation-speed-slow: 0.5s;
            --easing-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --easing-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
        }

        html, body {
            height: 100vh;
            width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: #000000;
            color: var(--text-primary);
            user-select: none;
            overflow: hidden;
            perspective: 2000px;
            perspective-origin: center center;
        }

        /* Animations */
        @keyframes float-in {
            from {
                opacity: 0;
                transform: translate3d(0, 20px, 0) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translate3d(0, 0, 0) scale(1);
            }
        }
        
        @keyframes slide-up {
            from {
                opacity: 0;
                transform: translate3d(0, 100%, 0);
            }
            to {
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }
        
        @keyframes scale-in {
            from {
                opacity: 0;
                transform: scale3d(0.8, 0.8, 1);
            }
            to {
                opacity: 1;
                transform: scale3d(1, 1, 1);
            }
        }
        
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 107, 157, 0.3);
                transform: scale3d(1, 1, 1);
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 107, 157, 0.6);
                transform: scale3d(1.02, 1.02, 1);
            }
        }

        @keyframes online-pulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);
            }
            50% { 
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
        }

        @keyframes ai-generate {
            0%, 100% { 
                background: linear-gradient(135deg, #ff6b9d, #8b5cf6);
            }
            50% { 
                background: linear-gradient(135deg, #8b5cf6, #00d4ff);
            }
        }

        /* Space Background */
        .background-layer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
            overflow: hidden;
        }

        .space-background {
            background: 
                linear-gradient(180deg, 
                    #000011 0%, 
                    #001122 15%, 
                    #002244 25%, 
                    #001a3a 35%,
                    #002850 45%, 
                    #001133 55%, 
                    #001428 65%,
                    #000822 75%, 
                    #000511 85%,
                    #000208 100%
                );
            position: relative;
            overflow: hidden;
            height: 100%;
        }

        .stars {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(3px 3px at 25px 30px, #ffffff, transparent),
                radial-gradient(2px 2px at 85px 20px, rgba(255,255,255,0.9), transparent),
                radial-gradient(3px 3px at 145px 40px, #ffffff, transparent),
                radial-gradient(2px 2px at 205px 65px, rgba(255,255,255,0.8), transparent),
                radial-gradient(3px 3px at 265px 25px, #ffffff, transparent),
                radial-gradient(2px 2px at 325px 55px, rgba(255,255,255,0.9), transparent),
                radial-gradient(1.5px 1.5px at 55px 50px, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 115px 75px, rgba(255,255,255,0.6), transparent),
                radial-gradient(1.5px 1.5px at 175px 15px, rgba(255,255,255,0.8), transparent);
            background-repeat: repeat;
            background-size: 400px 120px;
            animation: starTwinkle 4s ease-in-out infinite;
        }

        @keyframes starTwinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: linear-gradient(45deg, #ffffff, #00bfff);
            border-radius: 50%;
            box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.8);
            animation: meteorShower 8s linear infinite;
        }

        @keyframes meteorShower {
            0% {
                transform: translate3d(-100px, -100px, 0) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
                transform: translate3d(-50px, -50px, 0) scale(1);
            }
            90% {
                opacity: 1;
                transform: translate3d(calc(100vw + 50px), calc(100vh + 50px), 0) scale(1);
            }
            100% {
                transform: translate3d(calc(100vw + 100px), calc(100vh + 100px), 0) scale(0);
                opacity: 0;
            }
        }

        /* Glass UI Layer */
        .glass-layer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Top Right Feature Buttons */
        .top-right-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 4500;
        }

        .top-feature-btn {
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .top-feature-btn:hover {
            background: rgba(255, 107, 157, 0.2);
            border-color: var(--primary-pink);
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
        }

        .top-feature-btn.active {
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
            border-color: var(--primary-pink);
            color: white;
        }

        /* Enhanced Right Side Overlay Buttons */
        .right-overlay-buttons {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 4000;
        }

        .overlay-button {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .overlay-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .overlay-button:hover::before {
            left: 100%;
        }

        .overlay-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
        }

        .overlay-button.champions {
            background: linear-gradient(135deg, #ffd700, #ff6b9d);
        }

        .overlay-button.shames {
            background: linear-gradient(135deg, #ff4757, #ff3838);
        }

        .overlay-button.chat {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
        }

        .overlay-button.online {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .overlay-button.groups {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .overlay-button.profile {
            background: linear-gradient(135deg, #ff6b9d, #e91e63);
        }

        .overlay-button.ai-generating {
            animation: ai-generate 2s infinite;
        }

        /* Notification badges for buttons */
        .button-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            animation: notificationBounce 2s ease infinite;
        }

        /* Button labels on hover */
        .overlay-button::after {
            content: attr(data-label);
            position: absolute;
            right: 70px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 1000;
        }

        .overlay-button:hover::after {
            opacity: 1;
            visibility: visible;
            right: 65px;
        }

        /* Enhanced Modal Styles */
        .feature-modal {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        .feature-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .feature-icon {
            font-size: 32px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feature-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .feature-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .feature-content {
            margin-bottom: 20px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .task-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary-pink);
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary-pink);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .task-checkbox.completed {
            background: var(--primary-pink);
            color: white;
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .task-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            gap: 15px;
        }

        .champions-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .champion-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .champion-item:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
        }

        .champion-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffd700, #ff6b9d);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
        }

        .champion-info {
            flex: 1;
        }

        .champion-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .champion-achievement {
            font-size: 12px;
            color: #ffd700;
            margin-top: 2px;
        }

        .champion-stats {
            text-align: right;
            font-size: 14px;
            font-weight: 700;
            color: #ffd700;
        }

        /* Chat Interface */
        .chat-container {
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .chat-message {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
        }

        .chat-message.own {
            background: rgba(255, 107, 157, 0.2);
            margin-left: 20px;
        }

        .chat-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .chat-content {
            flex: 1;
        }

        .chat-username {
            font-size: 12px;
            color: var(--primary-pink);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .chat-text {
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .chat-time {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 14px;
        }

        .chat-input input:focus {
            outline: none;
            border-color: var(--primary-pink);
        }

        .chat-send-btn {
            background: var(--primary-pink);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            background: var(--accent-pink);
            transform: scale(1.05);
        }

        /* Online Players Overlay - Updated styles */
        .online-players-overlay {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 15px;
            z-index: 5000;
            min-width: 200px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .online-players-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            background: var(--success-green);
            border-radius: 50%;
            animation: online-pulse 2s infinite;
        }

        .online-player {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .online-player:last-child {
            border-bottom: none;
        }

        .player-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .player-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* AI Challenge Notification */
        .ai-challenge-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ff6b9d, #8b5cf6);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            z-index: 6000;
            animation: float-in 0.5s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        /* Auth Screen */
        .auth-screen {
            width: 100%;
            max-width: 420px;
            animation: float-in var(--animation-speed-slow) var(--easing-smooth);
        }

        .auth-container {
            background: rgba(15, 15, 15, 0.2);
            backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: 40px 35px;
            text-align: center;
            box-shadow: 
                0 8mm 16mm rgba(0, 0, 0, 0.3),
                0 2mm 8mm rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            animation: scale-in var(--animation-speed-normal) var(--easing-bounce);
        }

        .auth-logo {
            font-size: 48px;
            margin-bottom: 15px;
            animation: pulse-glow 3s ease-in-out infinite;
        }

        .auth-title {
            font-size: 28px;
            font-weight: 300;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        .auth-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.4;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            padding-left: 5px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            color: var(--text-primary);
            font-size: 16px;
            transition: all var(--animation-speed-normal) var(--easing-smooth);
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-pink);
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.2);
            background: rgba(255, 255, 255, 0.08);
            transform: scale3d(1.01, 1.01, 1);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .form-input:invalid {
            border-color: var(--error-red);
        }

        /* Password field specific */
        .password-container {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
            border-radius: 4px;
            transition: color var(--animation-speed-fast);
        }

        .password-toggle:hover {
            color: var(--text-primary);
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(145deg, rgba(255, 107, 157, 0.9), rgba(196, 69, 105, 0.9));
            backdrop-filter: blur(20px);
            color: #fff;
            border: 1px solid rgba(255, 107, 157, 0.3);
            padding: 18px 24px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all var(--animation-speed-normal) var(--easing-smooth);
            width: 100%;
            box-shadow: 
                0 6px 20px rgba(255, 107, 157, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            margin: 25px 0 15px 0;
            font-family: inherit;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left var(--animation-speed-normal) var(--easing-smooth);
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translate3d(0, -4px, 0) scale(1.02);
            box-shadow: 
                0 12px 40px rgba(255, 107, 157, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-primary:active {
            transform: translate3d(0, -2px, 0) scale(0.98);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--animation-speed-normal) var(--easing-smooth);
            font-family: inherit;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .toggle-btn {
            background: none;
            border: none;
            color: var(--primary-pink);
            margin-top: 15px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            text-decoration: underline;
            transition: color var(--animation-speed-normal);
            font-family: inherit;
            padding: 10px;
            border-radius: 8px;
        }

        .toggle-btn:hover {
            color: var(--accent-pink);
            background: rgba(255, 107, 157, 0.1);
        }

        /* Loading State */
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .loading .btn-text {
            opacity: 0;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            margin: -12px 0 0 -12px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Messages */
        .message {
            padding: 15px 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            animation: slide-up var(--animation-speed-normal) var(--easing-smooth);
            line-height: 1.4;
        }

        .message.error {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
        }

        .message.success {
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #6ee7b7;
        }

        .message.info {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #93c5fd;
        }

        .message.warning {
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #fbbf24;
        }

        /* Connection Status */
        .connection-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 12px;
        }

        .connection-status.connected {
            color: var(--success-green);
        }

        .connection-status.disconnected {
            color: var(--error-red);
        }

        .connection-status.connecting {
            color: var(--warning-orange);
        }

        /* Main App Interface */
        .glass-interface {
            width: 100%;
            max-width: 400px;
            height: calc(100vh - 20px);
            background: rgba(15, 15, 15, 0.15);
            backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            box-shadow: 
                0 10mm 20mm rgba(0, 0, 0, 0.3),
                0 3mm 10mm rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 0 100px rgba(255, 107, 157, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            animation: slide-up var(--animation-speed-slow) var(--easing-smooth);
        }

        .glass-header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: calc(var(--safe-area-top) + 20px) 25px 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.12);
            background: rgba(15, 15, 15, 0.1);
            backdrop-filter: blur(30px) saturate(180%);
        }

        .logo-slogan {
            font-size: 10px;
            color: var(--primary-pink);
            margin-top: -2px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.9;
        }

        .glass-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            position: relative;
            z-index: 2;
            padding: 20px 25px;
        }

        .challenge-card {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all var(--animation-speed-normal) var(--easing-smooth);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            animation: float-in var(--animation-speed-normal) var(--easing-smooth);
        }

        .challenge-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translate3d(0, -8px, 0) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(255, 107, 157, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .ai-challenge-card {
            border: 2px solid rgba(255, 107, 157, 0.5);
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(139, 92, 246, 0.1));
        }

        .ai-challenge-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 157, 0.2), transparent);
            animation: ai-generate 3s linear infinite;
        }

        /* Category Button Styles */
        .category-btn {
            transition: all var(--animation-speed-normal) var(--easing-smooth);
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
        }

        .category-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .category-btn:active {
            transform: translateY(0) scale(0.95);
        }

        /* Achievement Badge */
        .achievement-badge {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all var(--animation-speed-normal) var(--easing-smooth);
        }

        .achievement-badge:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .achievement-badge.earned {
            border-color: var(--primary-pink);
            box-shadow: 0 0 15px rgba(255, 107, 157, 0.3);
        }

        /* Leaderboard Entry */
        .leaderboard-entry {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .leaderboard-entry:last-child {
            border-bottom: none;
        }

        .leaderboard-rank {
            font-size: 18px;
            font-weight: 700;
            width: 30px;
            text-align: center;
        }

        .leaderboard-rank.gold { color: var(--gold); }
        .leaderboard-rank.silver { color: var(--silver); }
        .leaderboard-rank.bronze { color: var(--bronze); }

        /* Settings Toggle */
        .settings-toggle {
            transition: all var(--animation-speed-normal) var(--easing-smooth);
            font-family: inherit;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-50px) scale(0.9); }
            to { transform: translateY(0) scale(1); }
        }

        /* Mobile responsive */
        @media (max-width: 480px) {
            .glass-interface {
                max-width: 100%;
                height: 100vh;
                border-radius: 0;
                margin: 0;
            }
            
            .glass-layer {
                padding: 0;
            }

            .auth-container {
                padding: 30px 25px;
            }

            .online-players-overlay {
                top: 10px;
                right: 10px;
                max-width: 180px;
            }

            .right-overlay-buttons {
                right: 10px;
            }

            .overlay-button {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Background Layer -->
    <div class="background-layer">
        <div class="space-background">
            <div class="stars"></div>
            <div class="shooting-star" style="top: 15%; left: 5%; animation-delay: 0s;"></div>
            <div class="shooting-star" style="top: 35%; left: 20%; animation-delay: 2s;"></div>
            <div class="shooting-star" style="top: 60%; left: 30%; animation-delay: 4s;"></div>
            <div class="shooting-star" style="top: 25%; left: 50%; animation-delay: 6s;"></div>
        </div>
    </div>

    <!-- Top Right Feature Buttons -->
    <div id="topRightButtons" class="top-right-buttons hidden">
        <button class="top-feature-btn" onclick="showCreateChallenge()" data-feature="create">
            <span>‚ûï</span>
            <span>Create Challenge</span>
        </button>
        <button class="top-feature-btn" onclick="showMyTasks()" data-feature="tasks">
            <span>üìã</span>
            <span>My Tasks</span>
        </button>
        <button class="top-feature-btn" onclick="showSettings()" data-feature="settings">
            <span>‚öôÔ∏è</span>
            <span>Settings</span>
        </button>
    </div>

    <!-- Online Players Overlay -->
    <div id="onlinePlayersOverlay" class="online-players-overlay hidden">
        <div class="online-players-header">
            <div class="online-indicator"></div>
            <span style="font-size: 14px; font-weight: 600;">Online Players</span>
            <span id="onlineCount" style="font-size: 12px; color: var(--text-secondary);">0</span>
        </div>
        <div id="onlinePlayersList"></div>
    </div>

    <!-- Right Side Overlay Buttons -->
    <div id="rightOverlayButtons" class="right-overlay-buttons hidden">
        <button class="overlay-button champions" onclick="showChampions()" data-label="Champions">
            üèÜ
            <span class="button-badge" id="championsBadge">3</span>
        </button>
        <button class="overlay-button shames" onclick="showShames()" data-label="Hall of Shame">
            üòÖ
            <span class="button-badge" id="shamesBadge">1</span>
        </button>
        <button class="overlay-button chat" onclick="showChat()" data-label="Global Chat">
            üí¨
            <span class="button-badge" id="chatBadge">7</span>
        </button>
        <button class="overlay-button online" onclick="toggleOnlinePlayers()" data-label="Online Players">
            üë•
        </button>
        <button class="overlay-button groups" onclick="showGroups()" data-label="Groups">
            üèòÔ∏è
            <span class="button-badge" id="groupsBadge">2</span>
        </button>
        <button class="overlay-button profile" onclick="showProfile()" data-label="My Profile">
            üë§
        </button>
    </div>

    <!-- AI Challenge Notification -->
    <div id="aiChallengeNotification" class="ai-challenge-notification hidden">
        ü§ñ AI Generated new challenge!
    </div>

    <!-- Glass UI Layer -->
    <div class="glass-layer">
        <!-- Auth Screen -->
        <div id="authScreen" class="auth-screen">
            <div class="auth-container">
                <div class="auth-logo">üöÄ</div>
                <div class="auth-title">Welcome to JomBro</div>
                <div class="auth-subtitle">Join the ultimate challenge platform and push your limits!</div>
                
                <!-- Connection Status -->
                <div id="connectionStatus" class="connection-status connecting">
                    <span>üîÑ</span>
                    <span>Connecting to Firebase...</span>
                </div>
                
                <div id="messageContainer"></div>
                
                <!-- Authentication Form -->
                <form id="authForm" novalidate>
                    <div class="form-group">
                        <label for="emailInput" class="form-label">Email Address</label>
                        <input 
                            type="email" 
                            id="emailInput" 
                            class="form-input" 
                            placeholder="Enter your email address"
                            required 
                            autocomplete="email"
                            spellcheck="false"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="passwordInput" class="form-label">Password</label>
                        <div class="password-container">
                            <input 
                                type="password" 
                                id="passwordInput" 
                                class="form-input" 
                                placeholder="Enter your password (6+ characters)"
                                required 
                                autocomplete="new-password"
                                minlength="6"
                            >
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility()">
                                <span id="passwordToggleIcon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-primary" id="submitBtn">
                        <span class="btn-text" id="authBtnText">Create Account</span>
                    </button>
                </form>
                
                <button type="button" class="toggle-btn" onclick="toggleMode()">
                    <span id="toggleText">Already have an account? Sign In</span>
                </button>
                
                <div style="margin-top: 25px; font-size: 12px; color: var(--text-secondary); line-height: 1.4;">
                    By continuing, you agree to our Terms of Service and Privacy Policy.<br>
                    Your data is secured with Firebase Authentication.
                </div>
            </div>
        </div>

        <!-- Main App Interface -->
        <div id="mainApp" class="hidden">
            <div class="glass-interface">
                <!-- Header -->
                <div class="glass-header">
                    <div class="logo-section">
                        <div class="logo-text" style="font-size: 26px; font-weight: 200; color: var(--text-primary); letter-spacing: -1px;">JomBro</div>
                        <div class="logo-slogan">Let's Go! Let's Go!</div>
                        <div style="font-size: 9px; color: var(--text-secondary); margin-top: 2px; opacity: 0.8;" id="userDisplayName">Welcome!</div>
                    </div>
                    <div class="header-actions">
                        <button style="background: none; border: none; color: var(--text-secondary); font-size: 18px; cursor: pointer; padding: 8px; border-radius: 8px; transition: all 0.2s;" onclick="signOut()" title="Sign Out">üö™</button>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="glass-content">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="font-size: 48px; margin-bottom: 15px; animation: pulse-glow 3s infinite;">üéØ</div>
                        <div style="font-size: 20px; font-weight: 600; margin-bottom: 10px;">Welcome to JomBro!</div>
                        <div style="color: var(--text-secondary); margin-bottom: 20px;">Your personal challenge platform is ready.</div>
                        <!-- Enhanced Stats Display -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;">
                            <div style="background: rgba(255, 107, 157, 0.1); padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(255, 107, 157, 0.3); text-align: center;">
                                <div style="font-size: 10px; color: var(--text-secondary);">TOKENS</div>
                                <div style="font-size: 16px; font-weight: 700; color: var(--primary-pink);" id="userTokens">0</div>
                            </div>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(139, 92, 246, 0.3); text-align: center;">
                                <div style="font-size: 10px; color: var(--text-secondary);">LEVEL</div>
                                <div style="font-size: 16px; font-weight: 700; color: var(--primary-purple);" id="userLevel">1</div>
                            </div>
                            <div style="background: rgba(0, 212, 255, 0.1); padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(0, 212, 255, 0.3); text-align: center;">
                                <div style="font-size: 10px; color: var(--text-secondary);">STREAK</div>
                                <div style="font-size: 16px; font-weight: 700; color: var(--primary-blue);" id="userStreak">0</div>
                            </div>
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3); text-align: center;">
                                <div style="font-size: 10px; color: var(--text-secondary);">RANK</div>
                                <div style="font-size: 16px; font-weight: 700; color: var(--success-green);" id="userRank">Beginner</div>
                            </div>
                        </div>
                        
                        <!-- XP Progress Bar -->
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="font-size: 12px; color: var(--text-secondary);">XP Progress</span>
                                <span style="font-size: 12px; color: var(--text-secondary);" id="xpProgress">0 / 1000</span>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden; height: 8px;">
                                <div style="height: 100%; background: linear-gradient(90deg, var(--primary-pink), var(--primary-purple)); width: 0%; transition: width 0.5s ease;" id="xpFill"></div>
                            </div>
                        </div>
                        
                        <!-- Energy & Gems -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                            <div style="background: rgba(255, 140, 0, 0.1); padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(255, 140, 0, 0.3); text-align: center;">
                                <div style="font-size: 10px; color: var(--text-secondary);">‚ö° ENERGY</div>
                                <div style="font-size: 16px; font-weight: 700; color: #ff8c00;" id="userEnergy">100</div>
                            </div>
                            <div style="background: rgba(0, 255, 136, 0.1); padding: 8px 12px; border-radius: 8px; border: 1px solid rgba(0, 255, 136, 0.3); text-align: center;">
                                <div style="font-size: 10px; color: var(--text-secondary);">üíé GEMS</div>
                                <div style="font-size: 16px; font-weight: 700; color: #00ff88;" id="userGems">0</div>
                            </div>
                        </div>
                        
                        <!-- Premium Status Banner -->
                        <div id="premiumBanner" style="display: none; background: linear-gradient(135deg, #ffd700, #ff6b9d); padding: 12px; border-radius: 12px; margin-bottom: 20px; text-align: center; color: white; font-weight: 700; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                            <div style="font-size: 16px; margin-bottom: 5px;">üëë PREMIUM ACCOUNT ACTIVE</div>
                            <div style="font-size: 12px; opacity: 0.9;" id="premiumStatus">All features unlocked</div>
                        </div>
                        
                        <!-- Special Events Banner -->
                        <div id="specialEventBanner" style="display: none; margin-bottom: 20px;"></div>
                        
                        <!-- Daily Rewards -->
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 14px; font-weight: 600; color: var(--text-primary);">üéÅ Daily Rewards</span>
                                <button onclick="claimDailyReward()" id="dailyRewardBtn" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Claim</button>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;" id="dailyRewardsGrid"></div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div style="margin-bottom: 20px;">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 10px; color: var(--text-primary);">‚ö° Quick Actions</div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                                <button class="btn-secondary" onclick="showShop()" style="padding: 8px; font-size: 12px;">üõí Shop</button>
                                <button class="btn-secondary" onclick="showFriends()" style="padding: 8px; font-size: 12px;">üë• Friends</button>
                                <button class="btn-secondary" onclick="showStats()" style="padding: 8px; font-size: 12px;">üìä Stats</button>
                            </div>
                        </div>
                        
                        <!-- Power-ups -->
                        <div style="margin-bottom: 20px;">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 10px; color: var(--text-primary);">üí™ Active Power-ups</div>
                            <div id="activePowerUps" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;"></div>
                        </div>
                    </div>

                    <!-- AI Generated Challenges -->
                    <div style="margin-bottom: 25px;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: var(--text-primary);">
                            ü§ñ AI Generated Challenges
                            <span style="font-size: 10px; background: linear-gradient(135deg, #ff6b9d, #8b5cf6); color: white; padding: 2px 6px; border-radius: 8px; margin-left: 8px;">LIVE</span>
                        </div>
                        <div id="aiChallenges"></div>
                    </div>

                    <!-- Challenge Categories -->
                    <div style="margin-bottom: 25px;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: var(--text-primary);">üéÆ Challenge Categories</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                            <button class="category-btn" onclick="showChallenges('fitness')" style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); color: #10b981; padding: 10px; border-radius: 8px; cursor: pointer;">
                                üí™ Fitness
                            </button>
                            <button class="category-btn" onclick="showChallenges('mental')" style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); color: #8b5cf6; padding: 10px; border-radius: 8px; cursor: pointer;">
                                üß† Mental
                            </button>
                            <button class="category-btn" onclick="showChallenges('social')" style="background: rgba(255, 107, 157, 0.1); border: 1px solid rgba(255, 107, 157, 0.3); color: #ff6b9d; padding: 10px; border-radius: 8px; cursor: pointer;">
                                üë• Social
                            </button>
                            <button class="category-btn" onclick="showChallenges('creative')" style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); color: #f59e0b; padding: 10px; border-radius: 8px; cursor: pointer;">
                                üé® Creative
                            </button>
                        </div>
                    </div>

                    <!-- Daily Challenges -->
                    <div style="margin-bottom: 25px;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: var(--text-primary);">üåü Daily Challenges</div>
                        <div id="dailyChallenges"></div>
                    </div>

                    <!-- Weekly Challenges -->
                    <div style="margin-bottom: 25px;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: var(--text-primary);">üî• Weekly Challenges</div>
                        <div id="weeklyChallenges"></div>
                    </div>

                    <!-- Leaderboard -->
                    <div style="margin-bottom: 25px;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: var(--text-primary);">üèÜ Leaderboard</div>
                        <div id="leaderboard" style="background: rgba(255, 255, 255, 0.04); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 20px;"></div>
                    </div>

                    <!-- Achievement System -->
                    <div style="margin-bottom: 25px;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: var(--text-primary);">üéñÔ∏è Achievements</div>
                        <div id="achievements" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px;"></div>
                    </div>

                    <!-- Profile Settings -->
                    <div style="margin-bottom: 25px;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: var(--text-primary);">‚öôÔ∏è Profile Settings</div>
                        <div style="background: rgba(255, 255, 255, 0.04); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 20px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                                <span style="font-size: 14px;">üîî Notifications</span>
                                <button onclick="toggleNotifications()" id="notificationToggle" style="background: var(--primary-pink); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">ON</button>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                                <span style="font-size: 14px;">üåô Dark Mode</span>
                                <button onclick="toggleDarkMode()" id="darkModeToggle" style="background: var(--primary-purple); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">ON</button>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="font-size: 14px;">üîê Privacy</span>
                                <button onclick="togglePrivacy()" id="privacyToggle" style="background: var(--primary-blue); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">PRIVATE</button>
                            </div>
                        </div>
                    </div>

                    <!-- User Info Section -->
                    <div style="margin-top: 30px; text-align: center; color: var(--text-secondary);">
                        <div style="font-size: 14px; margin-bottom: 10px;">üéÆ Account Status:</div>
                        <div style="font-size: 12px; line-height: 1.6;" id="accountInfo">
                            ‚úÖ Authenticated with Firebase<br>
                            üîê Account Secured<br>
                            üéØ Challenge System Active<br>
                            üìä Progress Tracking Ready<br>
                            üé® Premium UI Experience
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Container -->
    <div id="modalContainer"></div>

    <!-- Firebase Scripts - Latest Version -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        console.log('üöÄ JomBro Enhanced - Live Players & AI Challenges');
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC_orriRUuf1ynDiFaJAPrO6-Gu3GeURxQ",
            authDomain: "jombro-9d129.firebaseapp.com",
            databaseURL: "https://jombro-9d129-default-rtdb.firebaseio.com",
            projectId: "jombro-9d129",
            storageBucket: "jombro-9d129.firebasestorage.app",
            messagingSenderId: "390572076435",
            appId: "1:390572076435:web:2a90027c66dc34d9834c66",
            measurementId: "G-YPQ5R5GLP8"
        };

        // Global State
        let firebaseApp = null;
        let firebaseAuth = null;
        let firebaseDb = null;
        let currentUser = null;
        let isSignUpMode = true;
        let isInitialized = false;
        let aiChallengeInterval = null;
        let onlinePlayersInterval = null;
        let isOnlinePlayersVisible = false;
        let userStats = {
            tokens: 0,
            level: 1,
            streak: 0,
            achievements: [],
            completedChallenges: [],
            accountType: 'standard',
            powerUps: [],
            friends: [],
            inventory: [],
            tournamentWins: 0,
            totalChallenges: 0,
            bestStreak: 0,
            rank: 'Beginner',
            xp: 0,
            gems: 0,
            energy: 100,
            dailyRewards: 0
        };

        // Enhanced Game Features
        const gameFeatures = {
            powerUps: [
                { id: 'double_tokens', name: 'Double Tokens', icon: 'üí∞', description: 'Double token rewards for 1 hour', cost: 100, duration: 3600 },
                { id: 'energy_boost', name: 'Energy Boost', icon: '‚ö°', description: 'Unlimited energy for 30 minutes', cost: 50, duration: 1800 },
                { id: 'streak_shield', name: 'Streak Shield', icon: 'üõ°Ô∏è', description: 'Protect your streak for 24 hours', cost: 200, duration: 86400 },
                { id: 'challenge_multiplier', name: 'Challenge Multiplier', icon: 'üöÄ', description: '3x XP for next 5 challenges', cost: 150, uses: 5 },
                { id: 'instant_complete', name: 'Instant Complete', icon: '‚è±Ô∏è', description: 'Instantly complete any challenge', cost: 300, uses: 1 }
            ],
            
            ranks: [
                { name: 'Beginner', minTokens: 0, color: '#888888', icon: 'ü•â' },
                { name: 'Rookie', minTokens: 1000, color: '#cd7f32', icon: 'ü•à' },
                { name: 'Skilled', minTokens: 5000, color: '#c0c0c0', icon: 'ü•á' },
                { name: 'Expert', minTokens: 15000, color: '#ffd700', icon: 'üèÜ' },
                { name: 'Master', minTokens: 50000, color: '#ff6b9d', icon: 'üíé' },
                { name: 'Legend', minTokens: 100000, color: '#8b5cf6', icon: 'üëë' },
                { name: 'Mythic', minTokens: 500000, color: '#00d4ff', icon: 'üåü' },
                { name: 'Godlike', minTokens: 1000000, color: '#ff0000', icon: 'üî•' }
            ],
            
            dailyRewards: [
                { day: 1, reward: { tokens: 100, type: 'tokens' } },
                { day: 2, reward: { tokens: 200, type: 'tokens' } },
                { day: 3, reward: { gems: 5, type: 'gems' } },
                { day: 4, reward: { tokens: 300, type: 'tokens' } },
                { day: 5, reward: { powerUp: 'double_tokens', type: 'powerup' } },
                { day: 6, reward: { tokens: 500, type: 'tokens' } },
                { day: 7, reward: { gems: 20, tokens: 1000, type: 'mega' } }
            ]
        };

        // Premium Founder Accounts - Updated creator name
        const founderAccounts = {
            'stonne@jombro.com': {
                password: 'stonne123',
                displayName: 'Stonne',
                level: 10,
                tokens: 500000,
                streak: 365,
                accountType: 'founder',
                badge: 'üëë',
                achievements: ['first_challenge', 'token_collector', 'streak_master', 'social_butterfly', 'fitness_guru', 'mind_master', 'creative_genius', 'level_up'],
                specialPerks: ['unlimited_challenges', 'exclusive_content', 'priority_support', 'custom_themes'],
                joinDate: '2024-01-01',
                completedChallenges: Array.from({length: 150}, (_, i) => ({
                    name: `Challenge ${i + 1}`,
                    category: ['fitness', 'mental', 'social', 'creative'][i % 4],
                    tokens: Math.floor(Math.random() * 500) + 100,
                    completedAt: Date.now() - (i * 24 * 60 * 60 * 1000)
                }))
            },
            'creator@jombro.com': {
                password: 'creator123',
                displayName: 'Pepp',
                level: 15,
                tokens: 1000000,
                streak: 500,
                accountType: 'master',
                badge: 'üéØ',
                achievements: ['first_challenge', 'token_collector', 'streak_master', 'social_butterfly', 'fitness_guru', 'mind_master', 'creative_genius', 'level_up'],
                specialPerks: ['admin_access', 'unlimited_challenges', 'exclusive_content', 'priority_support', 'custom_themes', 'challenge_creator'],
                joinDate: '2023-12-01',
                completedChallenges: Array.from({length: 250}, (_, i) => ({
                    name: `Challenge ${i + 1}`,
                    category: ['fitness', 'mental', 'social', 'creative'][i % 4],
                    tokens: Math.floor(Math.random() * 800) + 200,
                    completedAt: Date.now() - (i * 24 * 60 * 60 * 1000)
                }))
            }
        };

        // AI Challenge Templates
        const aiChallengeTemplates = {
            fitness: [
                { name: 'Power Walk Adventure', description: 'Walk continuously for 25 minutes while listening to music', tokens: 300, difficulty: 'Medium' },
                { name: 'Flexibility Focus', description: 'Stretch for 15 minutes focusing on problem areas', tokens: 200, difficulty: 'Easy' },
                { name: 'Stair Climbing Sprint', description: 'Find stairs and climb up and down 10 times', tokens: 250, difficulty: 'Hard' },
                { name: 'Dance Energy Burst', description: 'Dance to 3 upbeat songs without stopping', tokens: 280, difficulty: 'Medium' },
                { name: 'Wall Push Challenge', description: 'Do wall push-ups for 5 minutes straight', tokens: 220, difficulty: 'Easy' },
                { name: 'Hydration Hero', description: 'Drink a full glass of water every hour for 6 hours', tokens: 180, difficulty: 'Easy' },
                { name: 'Speed Cleaning', description: 'Clean your room/workspace in under 15 minutes', tokens: 150, difficulty: 'Medium' }
            ],
            mental: [
                { name: 'Memory Palace', description: 'Memorize and recite 10 random objects in order', tokens: 250, difficulty: 'Medium' },
                { name: 'Digital Detox Hour', description: 'Turn off all devices for 1 hour and focus on one task', tokens: 400, difficulty: 'Hard' },
                { name: 'Speed Learning', description: 'Learn 5 new facts about a topic that interests you', tokens: 200, difficulty: 'Easy' },
                { name: 'Mindful Breathing', description: 'Practice deep breathing for 10 minutes without distraction', tokens: 180, difficulty: 'Easy' },
                { name: 'Brain Puzzle Rush', description: 'Solve 3 different types of puzzles within 30 minutes', tokens: 320, difficulty: 'Hard' },
                { name: 'Language Challenge', description: 'Learn 10 new words in a foreign language', tokens: 220, difficulty: 'Medium' },
                { name: 'Focus Sprint', description: 'Work on one task for 45 minutes without any breaks', tokens: 350, difficulty: 'Hard' }
            ],
            social: [
                { name: 'Random Kindness', description: 'Do something unexpectedly nice for a stranger', tokens: 300, difficulty: 'Medium' },
                { name: 'Gratitude Message', description: 'Send a heartfelt thank you message to someone', tokens: 150, difficulty: 'Easy' },
                { name: 'Active Listening', description: 'Have a 20-minute conversation where you only listen', tokens: 250, difficulty: 'Medium' },
                { name: 'Compliment Challenge', description: 'Give genuine compliments to 5 different people', tokens: 200, difficulty: 'Easy' },
                { name: 'Story Sharing', description: 'Share an interesting story from your week with someone', tokens: 180, difficulty: 'Easy' },
                { name: 'Community Helper', description: 'Volunteer or help in your local community for 30 minutes', tokens: 400, difficulty: 'Hard' },
                { name: 'Connection Bridge', description: 'Introduce two people who would enjoy meeting each other', tokens: 350, difficulty: 'Medium' }
            ],
            creative: [
                { name: 'Quick Sketch', description: 'Draw something you see around you in under 10 minutes', tokens: 150, difficulty: 'Easy' },
                { name: 'Haiku Moment', description: 'Write 3 haikus about your current mood', tokens: 200, difficulty: 'Medium' },
                { name: 'Color Hunt', description: 'Find and photograph 7 different shades of your favorite color', tokens: 180, difficulty: 'Easy' },
                { name: 'Story Starter', description: 'Write the first 200 words of a story with an unusual premise', tokens: 250, difficulty: 'Medium' },
                { name: 'Remix Challenge', description: 'Take a song you love and rewrite the lyrics', tokens: 320, difficulty: 'Hard' },
                { name: 'Doodle Therapy', description: 'Fill a page with doodles while listening to calming music', tokens: 160, difficulty: 'Easy' },
                { name: 'Innovation Hour', description: 'Come up with 3 creative solutions to a daily problem', tokens: 280, difficulty: 'Medium' }
            ]
        };

        // Online Players Data
        const onlinePlayersData = [
            { name: 'Stonne', status: 'Completing fitness challenge', avatar: 'üëë', level: 10, isFounder: true },
            { name: 'Pepp', status: 'Creating new challenges', avatar: 'üéØ', level: 15, isCreator: true },
            { name: 'FitnessGuru', status: 'On a 12-day streak', avatar: 'üí™', level: 8 },
            { name: 'MindMaster', status: 'Meditating', avatar: 'üß†', level: 7 },
            { name: 'CreativeArt', status: 'Drawing challenge', avatar: 'üé®', level: 6 },
            { name: 'SocialBee', status: 'Helping others', avatar: 'üåü', level: 5 },
            { name: 'ChallengePro', status: 'Level grinding', avatar: 'üèÜ', level: 9 },
            { name: 'NewPlayer', status: 'First day!', avatar: 'üå±', level: 1 }
        ];

        // Challenge Categories
        const challengeCategories = {
            fitness: [
                { name: 'Morning Workout', description: 'Complete a 30-minute workout', tokens: 250, difficulty: 'Medium', time: '30min' },
                { name: '10,000 Steps', description: 'Walk 10,000 steps today', tokens: 200, difficulty: 'Easy', time: 'All day' },
                { name: 'Drink 8 Glasses', description: 'Drink 8 glasses of water', tokens: 150, difficulty: 'Easy', time: 'All day' },
                { name: 'Plank Challenge', description: 'Hold a plank for 2 minutes', tokens: 300, difficulty: 'Hard', time: '2min' },
                { name: 'Marathon Training', description: 'Run 5 miles at steady pace', tokens: 500, difficulty: 'Expert', time: '45min', premium: true }
            ],
            mental: [
                { name: 'Meditation', description: 'Meditate for 15 minutes', tokens: 200, difficulty: 'Easy', time: '15min' },
                { name: 'Read 20 Pages', description: 'Read 20 pages of a book', tokens: 250, difficulty: 'Medium', time: '30min' },
                { name: 'Learn Something New', description: 'Learn a new skill or fact', tokens: 300, difficulty: 'Medium', time: '45min' },
                { name: 'No Social Media', description: 'Avoid social media for 4 hours', tokens: 400, difficulty: 'Hard', time: '4hrs' },
                { name: 'Deep Focus Session', description: 'Work on one task for 3 hours straight', tokens: 600, difficulty: 'Expert', time: '3hrs', premium: true }
            ],
            social: [
                { name: 'Call a Friend', description: 'Have a meaningful conversation', tokens: 200, difficulty: 'Easy', time: '20min' },
                { name: 'Help Someone', description: 'Do something kind for someone', tokens: 300, difficulty: 'Medium', time: '30min' },
                { name: 'Share Achievement', description: 'Share your progress with friends', tokens: 150, difficulty: 'Easy', time: '5min' },
                { name: 'Group Activity', description: 'Join a group activity or event', tokens: 350, difficulty: 'Medium', time: '1hr' },
                { name: 'Network Builder', description: 'Connect with 5 new people professionally', tokens: 750, difficulty: 'Expert', time: '2hrs', premium: true }
            ],
            creative: [
                { name: 'Draw or Paint', description: 'Create some art for 30 minutes', tokens: 250, difficulty: 'Medium', time: '30min' },
                { name: 'Write a Story', description: 'Write a short story or poem', tokens: 300, difficulty: 'Medium', time: '45min' },
                { name: 'Take Photos', description: 'Take 10 creative photos', tokens: 200, difficulty: 'Easy', time: '30min' },
                { name: 'Music Practice', description: 'Practice an instrument or sing', tokens: 250, difficulty: 'Medium', time: '30min' },
                { name: 'Master Creation', description: 'Create and publish original content', tokens: 800, difficulty: 'Expert', time: '2hrs', premium: true }
            ]
        };

        const achievements = [
            { id: 'first_challenge', name: 'First Steps', icon: 'üéØ', description: 'Complete your first challenge' },
            { id: 'token_collector', name: 'Token Collector', icon: 'üí∞', description: 'Earn 1000 tokens' },
            { id: 'streak_master', name: 'Streak Master', icon: 'üî•', description: 'Maintain a 7-day streak' },
            { id: 'social_butterfly', name: 'Social Butterfly', icon: 'üë•', description: 'Complete 5 social challenges' },
            { id: 'fitness_guru', name: 'Fitness Guru', icon: 'üí™', description: 'Complete 10 fitness challenges' },
            { id: 'mind_master', name: 'Mind Master', icon: 'üß†', description: 'Complete 10 mental challenges' },
            { id: 'creative_genius', name: 'Creative Genius', icon: 'üé®', description: 'Complete 5 creative challenges' },
            { id: 'level_up', name: 'Level Up', icon: '‚≠ê', description: 'Reach level 5' },
            { id: 'founder_status', name: 'Founder', icon: 'üëë', description: 'Original JomBro founder', premium: true },
            { id: 'master_status', name: 'Master', icon: 'üéØ', description: 'JomBro master creator', premium: true },
            { id: 'legend_status', name: 'Legend', icon: 'üèÜ', description: 'Legendary JomBro player', premium: true }
        ];

        // Sample data for new features
        const championsData = [
            { name: 'Pepp', avatar: 'üéØ', achievement: 'Master Creator - 50 challenges created', stats: '1M tokens' },
            { name: 'Stonne', avatar: 'üëë', achievement: 'Founder - 365 day streak', stats: '500K tokens' },
            { name: 'FitnessGuru', avatar: 'üí™', achievement: 'Marathon Master - 100 fitness challenges', stats: '25K tokens' },
            { name: 'MindMaster', avatar: 'üß†', achievement: 'Zen Master - 200 meditation sessions', stats: '22K tokens' },
            { name: 'CreativeArt', avatar: 'üé®', achievement: 'Artist - 150 creative challenges', stats: '18K tokens' }
        ];

        const shamesToday = [
            { name: 'LazyBones', avatar: 'üò¥', shame: 'Broke 47-day streak by oversleeping', penalty: '-1000 tokens' }
        ];

        const chatMessages = [
            { id: 1, user: 'Pepp', avatar: 'üéØ', message: 'Hey everyone! New AI challenges are live!', time: '2 mins ago', own: false },
            { id: 2, user: 'FitnessGuru', avatar: 'üí™', message: 'Just completed my morning workout challenge!', time: '5 mins ago', own: false },
            { id: 3, user: 'You', avatar: 'üéÆ', message: 'Great job everyone! Keep pushing!', time: '8 mins ago', own: true },
            { id: 4, user: 'MindMaster', avatar: 'üß†', message: 'Anyone up for a meditation challenge?', time: '12 mins ago', own: false },
            { id: 5, user: 'CreativeArt', avatar: 'üé®', message: 'Check out my latest artwork challenge!', time: '15 mins ago', own: false }
        ];

        const userGroups = [
            { id: 1, name: 'Fitness Warriors', members: 24, avatar: 'üí™', description: 'Daily fitness challenges and motivation' },
            { id: 2, name: 'Creative Minds', members: 18, avatar: 'üé®', description: 'Art, writing, and creative challenges' },
            { id: 3, name: 'Mind & Soul', members: 31, avatar: 'üß†', description: 'Meditation, mindfulness, and mental health' },
            { id: 4, name: 'Social Butterflies', members: 15, avatar: 'üë•', description: 'Social challenges and community building' }
        ];

        const myTasks = [
            { id: 1, title: 'Morning Workout', category: 'fitness', completed: false, tokens: 250, deadline: '2 hours' },
            { id: 2, title: 'Meditation Session', category: 'mental', completed: true, tokens: 200, deadline: 'completed' },
            { id: 3, title: 'Call a Friend', category: 'social', completed: false, tokens: 200, deadline: '6 hours' },
            { id: 4, title: 'Creative Writing', category: 'creative', completed: false, tokens: 300, deadline: '1 day' },
            { id: 5, title: 'AI Challenge: Power Walk', category: 'fitness', completed: false, tokens: 280, deadline: '45 mins' }
        ];

        // Global Functions for new features
        window.showCreateChallenge = showCreateChallenge;
        window.showMyTasks = showMyTasks;
        window.showSettings = showSettings;
        window.showChampions = showChampions;
        window.showShames = showShames;
        window.showChat = showChat;
        window.showGroups = showGroups;
        window.showProfile = showProfile;
        window.sendChatMessage = sendChatMessage;
        window.joinGroup = joinGroup;
        window.completeTask = completeTask;
        window.createCustomChallenge = createCustomChallenge;

        // Initialize Firebase with enhanced stability
        async function initializeFirebase() {
            try {
                console.log('üî• Initializing Firebase Authentication...');
                updateConnectionStatus('connecting', 'Connecting to Firebase...');
                
                // Check if Firebase SDK is loaded
                if (typeof firebase === 'undefined') {
                    console.error('‚ùå Firebase SDK not loaded');
                    throw new Error('Firebase SDK not loaded. Please check your internet connection.');
                }
                
                console.log('‚úÖ Firebase SDK loaded successfully');
                
                // Initialize Firebase only if not already initialized
                if (!firebaseApp) {
                    try {
                        firebaseApp = firebase.initializeApp(firebaseConfig);
                        console.log('‚úÖ Firebase app initialized');
                    } catch (error) {
                        if (error.code === 'app/duplicate-app') {
                            firebaseApp = firebase.app();
                            console.log('‚úÖ Using existing Firebase app');
                        } else {
                            throw error;
                        }
                    }
                }
                
                firebaseAuth = firebase.auth();
                firebaseDb = firebase.database();
                
                console.log('‚úÖ Firebase services connected');
                
                // Configure Auth settings
                firebaseAuth.useDeviceLanguage();
                
                // Set up auth state persistence with error handling
                try {
                    await firebaseAuth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
                    console.log('‚úÖ Auth persistence configured');
                } catch (persistenceError) {
                    console.warn('‚ö†Ô∏è Auth persistence failed, continuing without it:', persistenceError);
                }
                
                // Set up auth state listener with better error handling
                firebaseAuth.onAuthStateChanged((user) => {
                    console.log('üîÑ Auth state changed:', user ? `User: ${user.email}` : 'No user');
                    
                    if (user) {
                        currentUser = user;
                        console.log('‚úÖ User authenticated:', {
                            email: user.email,
                            emailVerified: user.emailVerified,
                            uid: user.uid,
                            displayName: user.displayName
                        });
                        
                        // Delay to ensure UI is ready
                        setTimeout(() => {
                            completeAuthentication(user);
                        }, 500);
                    } else {
                        currentUser = null;
                        console.log('üîå User signed out');
                        showAuthScreen();
                    }
                }, (error) => {
                    console.error('‚ùå Auth state listener error:', error);
                    updateConnectionStatus('disconnected', 'Auth Error');
                    showMessage('‚ùå Authentication error occurred', 'error');
                });
                
                console.log('‚úÖ Auth state listener configured');
                
                // Test Firebase connection with proper timeout
                try {
                    const connectionPromise = firebaseDb.ref('.info/connected').once('value');
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Connection timeout')), 8000)
                    );
                    
                    await Promise.race([connectionPromise, timeoutPromise]);
                    console.log('‚úÖ Firebase database connection verified');
                } catch (connectionError) {
                    console.warn('‚ö†Ô∏è Database connection test failed, but auth may still work:', connectionError);
                    // Don't fail initialization for database connection issues
                }
                
                // Mark as initialized
                isInitialized = true;
                updateConnectionStatus('connected', 'Firebase Ready');
                console.log('‚úÖ Firebase initialization completed successfully');
                
                return true;
                
            } catch (error) {
                console.error('‚ùå Firebase initialization failed:', error);
                updateConnectionStatus('disconnected', 'Connection Failed');
                
                // More specific error messages
                let errorMessage = 'Firebase connection failed. ';
                if (error.message.includes('SDK not loaded')) {
                    errorMessage += 'Please check your internet connection and refresh the page.';
                } else if (error.message.includes('network')) {
                    errorMessage += 'Network error. Please check your connection.';
                } else if (error.message.includes('timeout')) {
                    errorMessage += 'Connection timeout. Please try again.';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage += 'Network request failed. Please check your internet connection.';
                } else {
                    errorMessage += error.message;
                }
                
                showMessage(`‚ùå ${errorMessage}`, 'error');
                return false;
            }
        }

        // Authentication Functions
        function handleAuthSubmit(event) {
            event.preventDefault();
            console.log('üî• Auth form submitted');
            
            const emailInput = document.getElementById('emailInput');
            const passwordInput = document.getElementById('passwordInput');
            
            if (!emailInput || !passwordInput) {
                console.error('‚ùå Form inputs not found');
                showMessage('‚ùå Form error - please refresh the page', 'error');
                return;
            }
            
            const email = emailInput.value.trim().toLowerCase();
            const password = passwordInput.value;
            
            console.log(`üìß Email: ${email}, Mode: ${isSignUpMode ? 'Sign Up' : 'Sign In'}`);
            
            // Check for founder accounts first
            if (founderAccounts[email]) {
                console.log('üëë Founder account detected');
                handleFounderLogin(email, password);
                return;
            }
            
            // Basic validation first
            if (!validateForm(email, password)) {
                console.log('‚ùå Form validation failed');
                return;
            }
            
            // Check Firebase initialization
            if (!isInitialized || !firebaseAuth) {
                console.log('‚ùå Firebase not ready');
                showMessage('‚ùå Please wait for Firebase to connect...', 'error');
                // Retry initialization
                setTimeout(() => {
                    initializeFirebase().then(success => {
                        if (success) {
                            showMessage('‚úÖ Firebase connected! Please try again.', 'success');
                        }
                    });
                }, 1000);
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            setLoadingState(submitBtn, true);
            
            console.log('üöÄ Starting Firebase authentication...');
            
            // Add timeout to prevent hanging
            const authTimeout = setTimeout(() => {
                console.log('‚è∞ Auth timeout - resetting');
                setLoadingState(submitBtn, false);
                showMessage('‚ùå Authentication timed out. Please try again.', 'error');
            }, 15000);
            
            const authPromise = isSignUpMode ? 
                firebaseAuth.createUserWithEmailAndPassword(email, password) : 
                firebaseAuth.signInWithEmailAndPassword(email, password);
            
            authPromise
                .then((userCredential) => {
                    clearTimeout(authTimeout);
                    const user = userCredential.user;
                    console.log(`‚úÖ ${isSignUpMode ? 'Sign up' : 'Sign in'} successful:`, user.email);
                    
                    if (isSignUpMode) {
                        setupNewUser(user, email);
                    }
                    
                    showMessage(isSignUpMode ? 
                        'üéâ Account created successfully! Welcome to JomBro!' : 
                        `‚úÖ Welcome back, ${user.displayName || getDisplayNameFromEmail(email)}!`, 
                        'success'
                    );
                })
                .catch((error) => {
                    clearTimeout(authTimeout);
                    console.error(`‚ùå ${isSignUpMode ? 'Sign up' : 'Sign in'} failed:`, error);
                    handleAuthError(error);
                })
                .finally(() => {
                    clearTimeout(authTimeout);
                    setLoadingState(submitBtn, false);
                });
        }

        function handleFounderLogin(email, password) {
            const founderData = founderAccounts[email];
            
            if (founderData.password !== password) {
                showMessage('‚ùå Invalid founder credentials!', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            setLoadingState(submitBtn, true);
            
            setTimeout(() => {
                userStats = {
                    tokens: founderData.tokens,
                    level: founderData.level,
                    streak: founderData.streak,
                    achievements: [...founderData.achievements],
                    completedChallenges: [...founderData.completedChallenges],
                    accountType: founderData.accountType,
                    badge: founderData.badge,
                    specialPerks: founderData.specialPerks,
                    joinDate: founderData.joinDate,
                    xp: founderData.level * 1000,
                    gems: Math.floor(founderData.tokens / 100),
                    energy: 100,
                    dailyRewards: 1
                };
                
                if (founderData.accountType === 'founder') {
                    userStats.achievements.push('founder_status');
                } else if (founderData.accountType === 'master') {
                    userStats.achievements.push('master_status', 'founder_status');
                }
                
                const mockUser = {
                    email: email,
                    displayName: founderData.displayName,
                    emailVerified: true,
                    uid: email.split('@')[0],
                    isFounder: true,
                    accountType: founderData.accountType
                };
                
                currentUser = mockUser;
                
                setLoadingState(submitBtn, false);
                
                showMessage(`üëë Welcome back, ${founderData.displayName}! Premium features unlocked.`, 'success');
                
                setTimeout(() => {
                    completeAuthentication(mockUser);
                }, 500);
                
            }, 1500);
        }

        function setupNewUser(user, email) {
            try {
                const displayName = getDisplayNameFromEmail(email);
                
                user.updateProfile({
                    displayName: displayName
                }).then(() => {
                    console.log('‚úÖ Display name updated:', displayName);
                }).catch((error) => {
                    console.warn('‚ö†Ô∏è Display name update failed:', error);
                });
                
                user.sendEmailVerification().then(() => {
                    setTimeout(() => {
                        showMessage('üìß Verification email sent! Please check your inbox.', 'info');
                    }, 2000);
                }).catch((error) => {
                    console.warn('‚ö†Ô∏è Verification email failed:', error);
                });
                
                if (firebaseDb) {
                    const userData = {
                        email: email,
                        displayName: displayName,
                        createdAt: firebase.database.ServerValue.TIMESTAMP,
                        lastLogin: firebase.database.ServerValue.TIMESTAMP,
                        emailVerified: user.emailVerified
                    };
                    
                    firebaseDb.ref(`users/${user.uid}`).set(userData).catch((error) => {
                        console.warn('‚ö†Ô∏è User data save failed:', error);
                    });
                }
                
            } catch (error) {
                console.error('‚ùå New user setup failed:', error);
            }
        }

        // Enhanced form validation with better error handling
        function validateForm(email, password) {
            // Clear any existing messages first
            clearMessages();
            
            // Email validation
            if (!email || email.length === 0) {
                showMessage('‚ùå Please enter your email address!', 'error');
                focusField('emailInput');
                return false;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showMessage('‚ùå Please enter a valid email address!', 'error');
                focusField('emailInput');
                return false;
            }
            
            // Password validation
            if (!password || password.length === 0) {
                showMessage('‚ùå Please enter your password!', 'error');
                focusField('passwordInput');
                return false;
            }
            
            if (password.length < 6) {
                showMessage('‚ùå Password must be at least 6 characters long!', 'error');
                focusField('passwordInput');
                return false;
            }
            
            // Additional validation for sign up
            if (isSignUpMode) {
                if (password.length < 8) {
                    showMessage('üí° For better security, consider using 8+ characters with numbers and symbols', 'info');
                }
                
                // Check for common weak passwords
                const weakPasswords = ['password', '123456', 'password123', 'admin', 'user'];
                if (weakPasswords.includes(password.toLowerCase())) {
                    showMessage('‚ùå Please choose a stronger password!', 'error');
                    focusField('passwordInput');
                    return false;
                }
            }
            
            console.log('‚úÖ Form validation passed');
            return true;
        }

        // Enhanced error handling for authentication
        function handleAuthError(error) {
            console.error('üî• Auth error:', error.code, error.message);
            
            let message = '';
            let shouldSwitchMode = false;
            let shouldFocusField = '';
            
            switch (error.code) {
                case 'auth/user-not-found':
                    message = '‚ùå No account found with this email address.';
                    if (!isSignUpMode) {
                        message += ' Would you like to create an account instead?';
                        shouldSwitchMode = true;
                    }
                    shouldFocusField = 'emailInput';
                    break;
                    
                case 'auth/wrong-password':
                    message = '‚ùå Incorrect password. Please check your password and try again.';
                    shouldFocusField = 'passwordInput';
                    break;
                    
                case 'auth/email-already-in-use':
                    message = '‚ùå An account already exists with this email address.';
                    if (isSignUpMode) {
                        message += ' Would you like to sign in instead?';
                        shouldSwitchMode = true;
                    }
                    shouldFocusField = 'emailInput';
                    break;
                    
                case 'auth/weak-password':
                    message = '‚ùå Password is too weak. Please use at least 6 characters with letters, numbers, and symbols.';
                    shouldFocusField = 'passwordInput';
                    break;
                    
                case 'auth/network-request-failed':
                    message = '‚ùå Network error. Please check your internet connection and try again.';
                    break;
                    
                case 'auth/too-many-requests':
                    message = '‚ùå Too many failed attempts. Please wait a few minutes before trying again.';
                    break;
                    
                case 'auth/invalid-email':
                    message = '‚ùå Invalid email format. Please enter a valid email address.';
                    shouldFocusField = 'emailInput';
                    break;
                    
                case 'auth/user-disabled':
                    message = '‚ùå This account has been disabled. Please contact support for assistance.';
                    break;
                    
                case 'auth/operation-not-allowed':
                    message = '‚ùå Email/password authentication is not enabled. Please contact support.';
                    break;
                    
                case 'auth/internal-error':
                    message = '‚ùå Internal error occurred. Please try again in a few moments.';
                    break;
                    
                case 'auth/invalid-credential':
                    message = '‚ùå Invalid credentials. Please check your email and password.';
                    break;
                    
                default:
                    message = `‚ùå Authentication failed: ${error.message}`;
                    break;
            }
            
            showMessage(message, 'error');
            
            // Focus the appropriate field
            if (shouldFocusField) {
                focusField(shouldFocusField);
            }
            
            // Auto-switch mode if appropriate
            if (shouldSwitchMode) {
                setTimeout(() => {
                    toggleMode();
                    showMessage('üîÑ Switched modes automatically', 'info');
                }, 3000);
            }
        }

        function toggleMode() {
            try {
                isSignUpMode = !isSignUpMode;
                updateModeUI();
                clearMessages();
            } catch (error) {
                console.error('‚ùå Error in toggleMode:', error);
            }
        }

        function updateModeUI() {
            const toggleText = document.getElementById('toggleText');
            const authBtnText = document.getElementById('authBtnText');
            const passwordInput = document.getElementById('passwordInput');
            
            if (isSignUpMode) {
                if (toggleText) toggleText.textContent = 'Already have an account? Sign In';
                if (authBtnText) authBtnText.textContent = 'Create Account';
                if (passwordInput) {
                    passwordInput.placeholder = 'Create a strong password (6+ characters)';
                    passwordInput.autocomplete = 'new-password';
                }
            } else {
                if (toggleText) toggleText.textContent = "Don't have an account? Create one";
                if (authBtnText) authBtnText.textContent = 'Sign In';
                if (passwordInput) {
                    passwordInput.placeholder = 'Enter your password';
                    passwordInput.autocomplete = 'current-password';
                }
            }
        }

        function togglePasswordVisibility() {
            try {
                const passwordInput = document.getElementById('passwordInput');
                const toggleIcon = document.getElementById('passwordToggleIcon');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    toggleIcon.textContent = 'üôà';
                } else {
                    passwordInput.type = 'password';
                    toggleIcon.textContent = 'üëÅÔ∏è';
                }
            } catch (error) {
                console.error('‚ùå Error toggling password visibility:', error);
            }
        }

        function completeAuthentication(user) {
            try {
                clearMessages();
                
                if (!user.isFounder) {
                    loadUserData(user);
                }
                
                const userDisplayName = document.getElementById('userDisplayName');
                const accountInfo = document.getElementById('accountInfo');
                
                if (userDisplayName) {
                    const displayName = user.displayName || getDisplayNameFromEmail(user.email);
                    const badge = userStats.badge || '';
                    // Remove the title display as requested
                    userDisplayName.textContent = `${badge} ${displayName}`;
                }
                
                if (accountInfo) {
                    const premiumStatus = userStats.accountType !== 'standard' ? 
                        `üëë Premium Account: ${userStats.accountType.toUpperCase()}<br>` : '';
                    const specialPerks = userStats.specialPerks ? 
                        `üéÅ Special Perks: ${userStats.specialPerks.join(', ')}<br>` : '';
                    
                    accountInfo.innerHTML = `
                        ‚úÖ Authenticated: ${user.email}<br>
                        üîê Account Secured<br>
                        ${premiumStatus}
                        ${specialPerks}
                        ${user.emailVerified ? '‚úÖ' : '‚ö†Ô∏è'} Email ${user.emailVerified ? 'Verified' : 'Pending Verification'}<br>
                        üéØ Challenge System Active<br>
                        üé® Premium UI Experience
                    `;
                }
                
                if (firebaseDb && user.uid && !user.isFounder) {
                    firebaseDb.ref(`users/${user.uid}/lastLogin`).set(firebase.database.ServerValue.TIMESTAMP);
                }
                
                showMainApp();
                initializeAppFeatures();
                
                const welcomeMessage = userStats.accountType === 'founder' ? 
                    `üëë Welcome back, Founder! All premium features unlocked.` :
                    userStats.accountType === 'master' ? 
                    `üéØ Welcome back, Master! Ultimate access granted.` :
                    `üéâ Welcome to JomBro, ${user.displayName || getDisplayNameFromEmail(user.email)}!`;
                
                showMessage(welcomeMessage, 'success');
                
                // Start AI challenge generation and online players
                startAIChallengeGeneration();
                startOnlinePlayersUpdate();
                
            } catch (error) {
                console.error('‚ùå Error in completeAuthentication:', error);
                showMessage('‚ùå Error completing login. Please try again.', 'error');
            }
        }

        async function signOut() {
            try {
                // Stop intervals
                if (aiChallengeInterval) {
                    clearInterval(aiChallengeInterval);
                    aiChallengeInterval = null;
                }
                if (onlinePlayersInterval) {
                    clearInterval(onlinePlayersInterval);
                    onlinePlayersInterval = null;
                }
                
                if (firebaseAuth && currentUser) {
                    await firebaseAuth.signOut();
                } else {
                    showAuthScreen();
                }
                
                showMessage('üëã Signed out successfully!', 'success');
            } catch (error) {
                console.error('‚ùå Sign-out error:', error);
                showMessage('‚ö†Ô∏è Sign-out error, but logged out locally', 'warning');
                showAuthScreen();
            }
        }

        // Online Players Functions
        function startOnlinePlayersUpdate() {
            if (onlinePlayersInterval) clearInterval(onlinePlayersInterval);
            
            updateOnlinePlayers();
            onlinePlayersInterval = setInterval(updateOnlinePlayers, 15000); // Update every 15 seconds
        }

        function updateOnlinePlayers() {
            const onlinePlayersList = document.getElementById('onlinePlayersList');
            const onlineCount = document.getElementById('onlineCount');
            
            if (!onlinePlayersList || !onlineCount) return;
            
            // Simulate dynamic online players
            const activeCount = Math.floor(Math.random() * 3) + 5; // 5-7 players
            const activePlayers = onlinePlayersData.slice(0, activeCount);
            
            // Add current user if authenticated
            if (currentUser) {
                const userPlayer = {
                    name: currentUser.displayName || 'You',
                    status: 'Online now',
                    avatar: userStats.badge || 'üéÆ',
                    level: userStats.level,
                    isCurrentUser: true
                };
                activePlayers.unshift(userPlayer);
            }
            
            onlineCount.textContent = activePlayers.length;
            
            onlinePlayersList.innerHTML = activePlayers.map(player => `
                <div class="online-player" style="${player.isCurrentUser ? 'background: rgba(255, 107, 157, 0.1);' : ''}">
                    <div class="player-avatar">${player.avatar}</div>
                    <div class="player-info">
                        <div class="player-name">
                            ${player.name}
                            ${player.isFounder ? '<span style="font-size: 10px; color: #ffd700;">üëë</span>' : ''}
                            ${player.isCreator ? '<span style="font-size: 10px; color: #ff6b9d;">üéØ</span>' : ''}
                        </div>
                        <div class="player-status">${player.status}</div>
                    </div>
                </div>
            `).join('');
        }

        function toggleOnlinePlayers() {
            const overlay = document.getElementById('onlinePlayersOverlay');
            if (!overlay) return;
            
            isOnlinePlayersVisible = !isOnlinePlayersVisible;
            
            if (isOnlinePlayersVisible) {
                overlay.classList.remove('hidden');
                updateOnlinePlayers();
            } else {
                overlay.classList.add('hidden');
            }
        }

        // AI Challenge Functions
        function startAIChallengeGeneration() {
            if (aiChallengeInterval) clearInterval(aiChallengeInterval);
            
            generateAIChallenge();
            aiChallengeInterval = setInterval(generateAIChallenge, 60000); // Generate every 1 minute
        }

        function generateAIChallenge() {
            const categories = Object.keys(aiChallengeTemplates);
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const categoryTemplates = aiChallengeTemplates[randomCategory];
            const randomTemplate = categoryTemplates[Math.floor(Math.random() * categoryTemplates.length)];
            
            const aiChallengesContainer = document.getElementById('aiChallenges');
            const aiChallengeBtn = document.getElementById('aiChallengeBtn');
            const notification = document.getElementById('aiChallengeNotification');
            
            if (!aiChallengesContainer) return;
            
            // Add animation to button
            if (aiChallengeBtn) {
                aiChallengeBtn.classList.add('ai-generating');
                setTimeout(() => {
                    aiChallengeBtn.classList.remove('ai-generating');
                }, 2000);
            }
            
            // Show notification
            if (notification) {
                notification.classList.remove('hidden');
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 3000);
            }
            
            // Create AI challenge card
            const aiChallenge = {
                ...randomTemplate,
                category: randomCategory,
                id: Date.now(),
                isAI: true,
                time: `${Math.floor(Math.random() * 30) + 15}min`
            };
            
            aiChallengesContainer.innerHTML = `
                <div class="challenge-card ai-challenge-card" onclick="takeChallenge('${aiChallenge.name}', ${aiChallenge.tokens}, '${aiChallenge.category}')">
                    <div style="position: absolute; top: 10px; right: 10px; background: linear-gradient(45deg, #ff6b9d, #8b5cf6); color: white; padding: 4px 8px; border-radius: 10px; font-size: 10px; font-weight: 700;">
                        ü§ñ AI GENERATED
                    </div>
                    <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px; color: var(--primary-pink);">
                        ${getCategoryIcon(aiChallenge.category)} ${aiChallenge.name}
                    </div>
                    <div style="font-size: 14px; line-height: 1.4; margin-bottom: 15px; opacity: 0.9; color: var(--text-secondary);">
                        ${aiChallenge.description}
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;">
                        <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${aiChallenge.tokens}</div>
                            <div style="font-size: 9px; color: var(--text-secondary);">TOKENS</div>
                        </div>
                        <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${aiChallenge.difficulty}</div>
                            <div style="font-size: 9px; color: var(--text-secondary);">LEVEL</div>
                        </div>
                        <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${aiChallenge.time}</div>
                            <div style="font-size: 9px; color: var(--text-secondary);">TIME</div>
                        </div>
                    </div>
                    <button class="btn-primary" style="width: 100%; background: linear-gradient(135deg, #ff6b9d, #8b5cf6);">ü§ñ TAKE AI CHALLENGE</button>
                </div>
            `;
        }

        // UI Helper Functions
        function showMainApp() {
            const authScreen = document.getElementById('authScreen');
            const mainApp = document.getElementById('mainApp');
            const rightButtons = document.getElementById('rightOverlayButtons');
            const topButtons = document.getElementById('topRightButtons');
            
            if (authScreen) authScreen.style.display = 'none';
            if (mainApp) {
                mainApp.classList.remove('hidden');
                mainApp.style.display = 'flex';
            }
            if (rightButtons) rightButtons.classList.remove('hidden');
            if (topButtons) topButtons.classList.remove('hidden');
        }

        function showAuthScreen() {
            const authScreen = document.getElementById('authScreen');
            const mainApp = document.getElementById('mainApp');
            const rightButtons = document.getElementById('rightOverlayButtons');
            const topButtons = document.getElementById('topRightButtons');
            const onlineOverlay = document.getElementById('onlinePlayersOverlay');
            
            if (authScreen) authScreen.style.display = 'block';
            if (mainApp) {
                mainApp.style.display = 'none';
                mainApp.classList.add('hidden');
            }
            if (rightButtons) rightButtons.classList.add('hidden');
            if (topButtons) topButtons.classList.add('hidden');
            if (onlineOverlay) onlineOverlay.classList.add('hidden');
            
            const authForm = document.getElementById('authForm');
            if (authForm) authForm.reset();
            
            const passwordInput = document.getElementById('passwordInput');
            const toggleIcon = document.getElementById('passwordToggleIcon');
            if (passwordInput) passwordInput.type = 'password';
            if (toggleIcon) toggleIcon.textContent = 'üëÅÔ∏è';
        }

        // Top Feature Functions
        function showCreateChallenge() {
            showModal(`
                <div class="feature-modal">
                    <div class="feature-header">
                        <div class="feature-icon">‚ûï</div>
                        <div>
                            <div class="feature-title">Create Challenge</div>
                            <div class="feature-subtitle">Design your own custom challenge</div>
                        </div>
                    </div>
                    <div class="feature-content">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Challenge Name</label>
                            <input type="text" id="challengeName" placeholder="Enter challenge name..." style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text-primary);">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Description</label>
                            <textarea id="challengeDescription" placeholder="Describe your challenge..." style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text-primary); height: 80px; resize: vertical;"></textarea>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Category</label>
                                <select id="challengeCategory" style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text-primary);">
                                    <option value="fitness">üí™ Fitness</option>
                                    <option value="mental">üß† Mental</option>
                                    <option value="social">üë• Social</option>
                                    <option value="creative">üé® Creative</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Difficulty</label>
                                <select id="challengeDifficulty" style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text-primary);">
                                    <option value="Easy">Easy</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Hard">Hard</option>
                                    <option value="Expert">Expert</option>
                                </select>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Token Reward</label>
                                <input type="number" id="challengeTokens" placeholder="250" min="50" max="1000" style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text-primary);">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Time Limit</label>
                                <input type="text" id="challengeTime" placeholder="30min" style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--text-primary);">
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button onclick="closeModal()" class="btn-secondary">Cancel</button>
                        <button onclick="createCustomChallenge()" class="btn-primary">Create Challenge</button>
                    </div>
                </div>
            `);
        }

        function showMyTasks() {
            const tasksHtml = myTasks.map(task => `
                <div class="task-item" data-task-id="${task.id}">
                    <div class="task-checkbox ${task.completed ? 'completed' : ''}" onclick="completeTask(${task.id})">
                        ${task.completed ? '‚úì' : ''}
                    </div>
                    <div class="task-info">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            <span>${getCategoryIcon(task.category)} ${task.category}</span>
                            <span>üí∞ ${task.tokens} tokens</span>
                            <span>‚è∞ ${task.deadline}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            showModal(`
                <div class="feature-modal">
                    <div class="feature-header">
                        <div class="feature-icon">üìã</div>
                        <div>
                            <div class="feature-title">My Tasks</div>
                            <div class="feature-subtitle">Track your active challenges</div>
                        </div>
                    </div>
                    <div class="feature-content">
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <span style="font-weight: 600;">Active Tasks (${myTasks.filter(t => !t.completed).length})</span>
                                <span style="font-size: 14px; color: var(--text-secondary);">Completed: ${myTasks.filter(t => t.completed).length}</span>
                            </div>
                            ${tasksHtml}
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button onclick="closeModal()" class="btn-primary">Close</button>
                    </div>
                </div>
            `);
        }

        function showSettings() {
            showModal(`
                <div class="feature-modal">
                    <div class="feature-header">
                        <div class="feature-icon">‚öôÔ∏è</div>
                        <div>
                            <div class="feature-title">Settings</div>
                            <div class="feature-subtitle">Customize your JomBro experience</div>
                        </div>
                    </div>
                    <div class="feature-content">
                        <div class="feature-grid">
                            <div class="feature-card">
                                <div style="font-size: 24px; margin-bottom: 10px;">üîî</div>
                                <div style="font-weight: 600; margin-bottom: 5px;">Notifications</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 10px;">Manage your notification preferences</div>
                                <button onclick="toggleNotifications()" id="notificationToggle" style="background: var(--primary-pink); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">ON</button>
                            </div>
                            <div class="feature-card">
                                <div style="font-size: 24px; margin-bottom: 10px;">üåô</div>
                                <div style="font-weight: 600; margin-bottom: 5px;">Dark Mode</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 10px;">Toggle dark/light theme</div>
                                <button onclick="toggleDarkMode()" id="darkModeToggle" style="background: var(--primary-purple); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">ON</button>
                            </div>
                            <div class="feature-card">
                                <div style="font-size: 24px; margin-bottom: 10px;">üîê</div>
                                <div style="font-weight: 600; margin-bottom: 5px;">Privacy</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 10px;">Control your profile visibility</div>
                                <button onclick="togglePrivacy()" id="privacyToggle" style="background: var(--primary-blue); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">PRIVATE</button>
                            </div>
                            <div class="feature-card">
                                <div style="font-size: 24px; margin-bottom: 10px;">üìä</div>
                                <div style="font-weight: 600; margin-bottom: 5px;">Data Export</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 10px;">Download your challenge data</div>
                                <button onclick="exportData()" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Export</button>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button onclick="closeModal()" class="btn-primary">Close</button>
                    </div>
                </div>
            `);
        }

        // Right Overlay Functions
        function showChampions() {
            const championsHtml = championsData.map(champion => `
                <div class="champion-item">
                    <div class="champion-avatar">${champion.avatar}</div>
                    <div class="champion-info">
                        <div class="champion-name">${champion.name}</div>
                        <div class="champion-achievement">${champion.achievement}</div>
                    </div>
                    <div class="champion-stats">${champion.stats}</div>
                </div>
            `).join('');

            showModal(`
                <div class="feature-modal">
                    <div class="feature-header">
                        <div class="feature-icon">üèÜ</div>
                        <div>
                            <div class="feature-title">Champions</div>
                            <div class="feature-subtitle">Celebrate our top performers</div>
                        </div>
                    </div>
                    <div class="feature-content">
                        <div class="champions-list">
                            ${championsHtml}
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button onclick="closeModal()" class="btn-primary">Close</button>
                    </div>
                </div>
            `);
        }

        function showShames() {
            const shamesTodayHtml = shamesToday.map(shame => `
                <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(255, 68, 68, 0.1); border: 1px solid rgba(255, 68, 68, 0.3); border-radius: 12px; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #ff4757, #ff3838); display: flex; align-items: center; justify-content: center; font-size: 20px;">${shame.avatar}</div>
                    <div style="flex: 1;">
                        <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);">${shame.name}</div>
                        <div style="font-size: 12px; color: #ff6b6b; margin-top: 2px;">${shame.shame}</div>
                    </div>
                    <div style="text-align: right; font-size: 14px; font-weight: 700; color: #ff4757;">${shame.penalty}</div>
                </div>
            `).join('');

            showModal(`
                <div class="feature-modal">
                    <div class="feature-header">
                        <div class="feature-icon">üòÖ</div>
                        <div>
                            <div class="feature-title">Hall of Shame</div>
                            <div class="feature-subtitle">Learn from others' mistakes</div>
                        </div>
                    </div>
                    <div class="feature-content">
                        <div style="margin-bottom: 20px;">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 15px;">Today's Shame</div>
                            ${shamesTodayHtml}
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 16px; margin-bottom: 10px;">üí™ Stay Strong!</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">Learn from mistakes and keep pushing forward. Every setback is a setup for a comeback!</div>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button onclick="closeModal()" class="btn-primary">Close</button>
                    </div>
                </div>
            `);
        }

        function showChat() {
            const messagesHtml = chatMessages.map(msg => `
                <div class="chat-message ${msg.own ? 'own' : ''}">
                    <div class="chat-avatar">${msg.avatar}</div>
                    <div class="chat-content">
                        <div class="chat-username">${msg.user}</div>
                        <div class="chat-text">${msg.message}</div>
                        <div class="chat-time">${msg.time}</div>
                    </div>
                </div>
            `).join('');

            showModal(`
                <div class="feature-modal">
                    <div class="feature-header">
                        <div class="feature-icon">üí¨</div>
                        <div>
                            <div class="feature-title">Global Chat</div>
                            <div class="feature-subtitle">Connect with the JomBro community</div>
                        </div>
                    </div>
                    <div class="feature-content">
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages">
                                ${messagesHtml}
                            </div>
                            <div class="chat-input">
                                <input type="text" id="chatInput" placeholder="Type your message..." maxlength="200">
                                <button onclick="sendChatMessage()" class="chat-send-btn">Send</button>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button onclick="closeModal()" class="btn-primary">Close</button>
                    </div>
                </div>
            `);

            // Auto-scroll to bottom
            const chatContainer = document.getElementById('chatMessages');
            if (chatContainer) {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            // Enter key to send
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    }
                });
            }
        }

        function showGroups() {
            const groupsHtml = userGroups.map(group => `
                <div class="feature-card" onclick="joinGroup(${group.id})">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                        <div style="font-size: 32px;">${group.avatar}</div>
                        <div style="flex: 1;">
                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">${group.name}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${group.members} members</div>
                        </div>
                    </div>
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 15px;">${group.description}</div>
                    <button class="btn-primary" style="width: 100%; padding: 8px; font-size: 12px;">Join Group</button>
                </div>
            `).join('');

            showModal(`
                <div class="feature-modal">
                    <div class="feature-header">
                        <div class="feature-icon">üèòÔ∏è</div>
                        <div>
                            <div class="feature-title">Groups</div>
                            <div class="feature-subtitle">Join communities that share your interests</div>
                        </div>
                    </div>
                    <div class="feature-content">
                        <div class="feature-grid">
                            ${groupsHtml}
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button onclick="closeModal()" class="btn-primary">Close</button>
                    </div>
                </div>
            `);
        }

        function showProfile() {
            const completedChallenges = userStats.completedChallenges.length;
            const totalTokens = userStats.tokens;
            const currentLevel = userStats.level;
            const currentStreak = userStats.streak;

            showModal(`
                <div class="feature-modal">
                    <div class="feature-header">
                        <div class="feature-icon">üë§</div>
                        <div>
                            <div class="feature-title">My Profile</div>
                            <div class="feature-subtitle">${currentUser?.displayName || 'JomBro User'}</div>
                        </div>
                    </div>
                    <div class="feature-content">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple)); display: flex; align-items: center; justify-content: center; font-size: 32px; margin: 0 auto 15px;">${userStats.badge || 'üéÆ'}</div>
                            <div style="font-size: 20px; font-weight: 700; margin-bottom: 5px;">${currentUser?.displayName || 'JomBro User'}</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">${userStats.accountType === 'standard' ? 'Standard Member' : userStats.accountType.charAt(0).toUpperCase() + userStats.accountType.slice(1)}</div>
                        </div>
                        
                        <div class="feature-grid">
                            <div style="background: rgba(255, 107, 157, 0.1); padding: 20px; border-radius: 12px; text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: var(--primary-pink);">${totalTokens.toLocaleString()}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Total Tokens</div>
                            </div>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 20px; border-radius: 12px; text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: var(--primary-purple);">${completedChallenges}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Challenges Completed</div>
                            </div>
                            <div style="background: rgba(0, 212, 255, 0.1); padding: 20px; border-radius: 12px; text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: var(--primary-blue);">${currentStreak}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Current Streak</div>
                            </div>
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 20px; border-radius: 12px; text-align: center;">
                                <div style="font-size: 24px; font-weight: 700; color: var(--success-green);">${currentLevel}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Current Level</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button onclick="editProfile()" class="btn-secondary" style="flex: 1;">Edit Profile</button>
                            <button onclick="shareProfile()" class="btn-primary" style="flex: 1;">Share Profile</button>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button onclick="closeModal()" class="btn-primary">Close</button>
                    </div>
                </div>
            `);
        }

        // Helper Functions
        function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            if (!chatInput || !chatInput.value.trim()) return;

            const message = chatInput.value.trim();
            const newMessage = {
                id: Date.now(),
                user: 'You',
                avatar: userStats.badge || 'üéÆ',
                message: message,
                time: 'now',
                own: true
            };

            chatMessages.unshift(newMessage);
            chatInput.value = '';
            
            // Update chat display
            const chatContainer = document.getElementById('chatMessages');
            if (chatContainer) {
                const messageEl = document.createElement('div');
                messageEl.className = 'chat-message own';
                messageEl.innerHTML = `
                    <div class="chat-avatar">${newMessage.avatar}</div>
                    <div class="chat-content">
                        <div class="chat-username">${newMessage.user}</div>
                        <div class="chat-text">${newMessage.message}</div>
                        <div class="chat-time">${newMessage.time}</div>
                    </div>
                `;
                chatContainer.appendChild(messageEl);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            showMessage('üí¨ Message sent!', 'success');
        }

        function joinGroup(groupId) {
            const group = userGroups.find(g => g.id === groupId);
            if (group) {
                showMessage(`üèòÔ∏è Joined ${group.name}! Welcome to the community!`, 'success');
                closeModal();
            }
        }

        function completeTask(taskId) {
            const task = myTasks.find(t => t.id === taskId);
            if (task && !task.completed) {
                task.completed = true;
                userStats.tokens += task.tokens;
                userStats.xp += Math.floor(task.tokens * 0.5);
                
                updateUserStatsDisplay();
                showMessage(`‚úÖ Task completed! +${task.tokens} tokens earned!`, 'success');
                
                // Update UI
                const taskEl = document.querySelector(`[data-task-id="${taskId}"]`);
                if (taskEl) {
                    const checkbox = taskEl.querySelector('.task-checkbox');
                    checkbox.classList.add('completed');
                    checkbox.innerHTML = '‚úì';
                }
            }
        }

        function createCustomChallenge() {
            const name = document.getElementById('challengeName')?.value;
            const description = document.getElementById('challengeDescription')?.value;
            const category = document.getElementById('challengeCategory')?.value;
            const difficulty = document.getElementById('challengeDifficulty')?.value;
            const tokens = parseInt(document.getElementById('challengeTokens')?.value) || 250;
            const time = document.getElementById('challengeTime')?.value || '30min';

            if (!name || !description) {
                showMessage('‚ùå Please fill in all required fields!', 'error');
                return;
            }

            showMessage('üéØ Custom challenge created successfully!', 'success');
            closeModal();
            
            // Add to available challenges
            setTimeout(() => {
                showMessage(`üöÄ "${name}" is now available in your challenges!`, 'info');
            }, 1500);
        }

        function exportData() {
            const data = {
                userStats: userStats,
                completedChallenges: userStats.completedChallenges,
                achievements: userStats.achievements,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `jombro-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showMessage('üìä Data exported successfully!', 'success');
        }

        function editProfile() {
            showMessage('‚úèÔ∏è Profile editing feature coming soon!', 'info');
        }

        function shareProfile() {
            if (navigator.share) {
                navigator.share({
                    title: 'Check out my JomBro profile!',
                    text: `I'm level ${userStats.level} with ${userStats.tokens} tokens on JomBro!`,
                    url: window.location.href
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                const shareText = `Check out my JomBro profile! Level ${userStats.level} with ${userStats.tokens} tokens!`;
                navigator.clipboard.writeText(shareText).then(() => {
                    showMessage('üìã Profile info copied to clipboard!', 'success');
                });
            }
        }

        function setLoadingState(button, isLoading) {
            if (!button) return;
            
            if (isLoading) {
                button.classList.add('loading');
                button.disabled = true;
            } else {
                button.classList.remove('loading');
                button.disabled = false;
            }
        }

        function updateConnectionStatus(status, message) {
            const connectionStatus = document.getElementById('connectionStatus');
            if (!connectionStatus) return;
            
            connectionStatus.className = `connection-status ${status}`;
            
            const icons = {
                connecting: 'üîÑ',
                connected: 'üî•',
                disconnected: '‚ùå'
            };
            
            connectionStatus.innerHTML = `
                <span>${icons[status] || 'üîÑ'}</span>
                <span>${message}</span>
            `;
        }

        function showMessage(message, type = 'info', duration = 5000) {
            try {
                const messageContainer = document.getElementById('messageContainer');
                if (!messageContainer) return;
                
                messageContainer.innerHTML = '';
                
                const messageEl = document.createElement('div');
                messageEl.className = `message ${type}`;
                messageEl.textContent = message;
                
                messageContainer.appendChild(messageEl);
                
                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.style.opacity = '0';
                        messageEl.style.transform = 'translateY(-10px)';
                        setTimeout(() => {
                            if (messageEl.parentNode) {
                                messageEl.remove();
                            }
                        }, 300);
                    }
                }, duration);
            } catch (error) {
                console.error('‚ùå Error showing message:', error);
            }
        }

        function clearMessages() {
            const messageContainer = document.getElementById('messageContainer');
            if (messageContainer) {
                messageContainer.innerHTML = '';
            }
        }

        function focusField(fieldId) {
            setTimeout(() => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.focus();
                    field.select();
                }
            }, 100);
        }

        function getDisplayNameFromEmail(email) {
            const username = email.split('@')[0];
            return username.charAt(0).toUpperCase() + username.slice(1);
        }

        // App Features Functions
        function initializeAppFeatures() {
            generateDailyChallenges();
            generateWeeklyChallenges();
            loadLeaderboard();
            loadAchievements();
            updateUserStatsDisplay();
            initializeDailyRewards();
            initializePowerUps();
            updateUserRank();
        }

        function loadUserData(user) {
            if (!firebaseDb || !user.uid) return;
            
            firebaseDb.ref(`users/${user.uid}/stats`).once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        userStats = { ...userStats, ...snapshot.val() };
                    } else {
                        firebaseDb.ref(`users/${user.uid}/stats`).set(userStats);
                    }
                    updateUserStatsDisplay();
                })
                .catch((error) => {
                    console.warn('‚ö†Ô∏è Failed to load user stats:', error);
                });
        }

        function updateUserStatsDisplay() {
            const userTokens = document.getElementById('userTokens');
            const userLevel = document.getElementById('userLevel');
            const userStreak = document.getElementById('userStreak');
            const userRank = document.getElementById('userRank');
            const userEnergy = document.getElementById('userEnergy');
            const userGems = document.getElementById('userGems');
            const xpProgress = document.getElementById('xpProgress');
            const xpFill = document.getElementById('xpFill');
            const premiumBanner = document.getElementById('premiumBanner');
            const premiumStatus = document.getElementById('premiumStatus');
            
            if (userTokens) userTokens.textContent = userStats.tokens.toLocaleString();
            if (userLevel) userLevel.textContent = userStats.level;
            if (userStreak) userStreak.textContent = userStats.streak;
            if (userRank) userRank.textContent = userStats.rank;
            if (userEnergy) userEnergy.textContent = userStats.energy;
            if (userGems) userGems.textContent = userStats.gems;
            
            // Update XP progress
            const xpNeeded = userStats.level * 1000;
            const xpPercent = Math.min((userStats.xp / xpNeeded) * 100, 100);
            if (xpProgress) xpProgress.textContent = `${userStats.xp} / ${xpNeeded}`;
            if (xpFill) xpFill.style.width = `${xpPercent}%`;
            
            // Show premium banner for premium accounts
            if (premiumBanner && userStats.accountType !== 'standard') {
                premiumBanner.style.display = 'block';
                
                if (premiumStatus) {
                    const statusText = userStats.accountType === 'founder' ? 
                        'Founder Benefits ‚Ä¢ Unlimited Challenges ‚Ä¢ Priority Support' :
                        userStats.accountType === 'master' ? 
                        'Master Access ‚Ä¢ Admin Tools ‚Ä¢ Challenge Creator ‚Ä¢ All Premium Features' :
                        'Premium Features Unlocked';
                    premiumStatus.textContent = statusText;
                }
            }
        }

        function updateUserRank() {
            const currentRank = gameFeatures.ranks.find(rank => 
                userStats.tokens >= rank.minTokens && 
                userStats.tokens < (gameFeatures.ranks[gameFeatures.ranks.indexOf(rank) + 1]?.minTokens || Infinity)
            );
            
            if (currentRank) {
                userStats.rank = currentRank.name;
                const userRankElement = document.getElementById('userRank');
                if (userRankElement) {
                    userRankElement.textContent = currentRank.name;
                    userRankElement.style.color = currentRank.color;
                }
            }
        }

        function initializeDailyRewards() {
            const dailyRewardsGrid = document.getElementById('dailyRewardsGrid');
            const dailyRewardBtn = document.getElementById('dailyRewardBtn');
            
            if (!dailyRewardsGrid) return;
            
            const currentDay = userStats.dailyRewards || 1;
            
            dailyRewardsGrid.innerHTML = gameFeatures.dailyRewards.map((reward, index) => {
                const day = index + 1;
                const isToday = day === currentDay;
                const isClaimed = day < currentDay;
                
                return `
                    <div style="background: ${isClaimed ? 'rgba(16, 185, 129, 0.2)' : isToday ? 'rgba(255, 107, 157, 0.2)' : 'rgba(255, 255, 255, 0.05)'}; 
                                border: 1px solid ${isClaimed ? '#10b981' : isToday ? '#ff6b9d' : 'rgba(255, 255, 255, 0.1)'}; 
                                border-radius: 8px; padding: 8px; text-align: center; font-size: 12px;">
                        <div style="font-weight: 700; margin-bottom: 5px;">Day ${day}</div>
                        <div style="font-size: 10px; opacity: 0.8;">
                            ${reward.reward.type === 'tokens' ? `${reward.reward.tokens} tokens` : 
                              reward.reward.type === 'gems' ? `${reward.reward.gems} gems` : 
                              reward.reward.type === 'powerup' ? 'Power-up' : 'Mega Reward'}
                        </div>
                        ${isClaimed ? '<div style="color: #10b981; font-size: 14px; margin-top: 5px;">‚úÖ</div>' : ''}
                        ${isToday ? '<div style="color: #ff6b9d; font-size: 14px; margin-top: 5px;">üéÅ</div>' : ''}
                    </div>
                `;
            }).join('');
            
            if (dailyRewardBtn) {
                dailyRewardBtn.style.display = currentDay <= 7 ? 'block' : 'none';
                dailyRewardBtn.disabled = currentDay > 7;
            }
        }

        function initializePowerUps() {
            const activePowerUps = document.getElementById('activePowerUps');
            if (!activePowerUps) return;
            
            const active = userStats.powerUps.filter(p => p.active);
            
            if (active.length === 0) {
                activePowerUps.innerHTML = '<div style="text-align: center; color: var(--text-secondary); font-size: 12px; grid-column: 1 / -1;">No active power-ups</div>';
                return;
            }
            
            activePowerUps.innerHTML = active.map(powerUp => `
                <div class="power-up-active" style="padding: 8px; border-radius: 8px; text-align: center; font-size: 12px; background: rgba(255, 255, 255, 0.1);">
                    <div style="font-size: 16px; margin-bottom: 5px;">${powerUp.icon}</div>
                    <div style="font-weight: 600; margin-bottom: 3px;">${powerUp.name}</div>
                    <div style="font-size: 10px; opacity: 0.8;">
                        ${powerUp.timeLeft ? `${Math.ceil(powerUp.timeLeft / 60)}m left` : `${powerUp.usesLeft} uses left`}
                    </div>
                </div>
            `).join('');
        }

        function generateDailyChallenges() {
            const dailyChallenges = document.getElementById('dailyChallenges');
            if (!dailyChallenges) return;
            
            const isPremium = userStats.accountType !== 'standard';
            const categories = Object.keys(challengeCategories);
            const selectedChallenges = [];
            
            const challengeCount = isPremium ? 5 : 3;
            
            for (let i = 0; i < challengeCount; i++) {
                const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                const categoryChallenge = challengeCategories[randomCategory];
                
                const availableChallenges = isPremium ? 
                    categoryChallenge : 
                    categoryChallenge.filter(c => !c.premium);
                
                const randomChallenge = availableChallenges[Math.floor(Math.random() * availableChallenges.length)];
                selectedChallenges.push({ ...randomChallenge, category: randomCategory });
            }
            
            dailyChallenges.innerHTML = selectedChallenges.map(challenge => {
                const isPremiumChallenge = challenge.premium;
                const premiumBadge = isPremiumChallenge ? 
                    '<div style="position: absolute; top: 10px; right: 10px; background: linear-gradient(45deg, #ffd700, #ff6b9d); color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 700;">PREMIUM</div>' : 
                    '';
                
                return `
                    <div class="challenge-card" onclick="takeChallenge('${challenge.name}', ${challenge.tokens}, '${challenge.category}')" style="position: relative;">
                        ${premiumBadge}
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px; color: var(--primary-pink);">
                            ${getCategoryIcon(challenge.category)} ${challenge.name}
                        </div>
                        <div style="font-size: 14px; line-height: 1.4; margin-bottom: 15px; opacity: 0.9; color: var(--text-secondary);">
                            ${challenge.description}
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;">
                            <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px;">
                                <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${challenge.tokens}</div>
                                <div style="font-size: 9px; color: var(--text-secondary);">TOKENS</div>
                            </div>
                            <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px;">
                                <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${challenge.difficulty}</div>
                                <div style="font-size: 9px; color: var(--text-secondary);">LEVEL</div>
                            </div>
                            <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px;">
                                <div style="font-size: 14px; font-weight: 700; color: var(--primary-pink);">${challenge.time}</div>
                                <div style="font-size: 9px; color: var(--text-secondary);">TIME</div>
                            </div>
                        </div>
                        <button class="btn-primary" style="width: 100%;">üöÄ TAKE CHALLENGE</button>
                    </div>
                `;
            }).join('');
        }

        function generateWeeklyChallenges() {
            const weeklyChallenges = document.getElementById('weeklyChallenges');
            if (!weeklyChallenges) return;
            
            const weeklyList = [
                { name: 'Fitness Master', description: 'Complete 5 fitness challenges this week', tokens: 1000, difficulty: 'Hard', time: '7 days' },
                { name: 'Mind Expansion', description: 'Complete 3 mental challenges this week', tokens: 750, difficulty: 'Medium', time: '7 days' },
                { name: 'Social Connector', description: 'Complete 3 social challenges this week', tokens: 800, difficulty: 'Medium', time: '7 days' }
            ];
            
            weeklyChallenges.innerHTML = weeklyList.map(challenge => `
                <div class="challenge-card" onclick="takeChallenge('${challenge.name}', ${challenge.tokens}, 'weekly')">
                    <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px; color: var(--primary-purple);">
                        üóìÔ∏è ${challenge.name}
                    </div>
                    <div style="font-size: 14px; line-height: 1.4; margin-bottom: 15px; opacity: 0.9; color: var(--text-secondary);">
                        ${challenge.description}
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;">
                        <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: 700; color: var(--primary-purple);">${challenge.tokens}</div>
                            <div style="font-size: 9px; color: var(--text-secondary);">TOKENS</div>
                        </div>
                        <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: 700; color: var(--primary-purple);">${challenge.difficulty}</div>
                            <div style="font-size: 9px; color: var(--text-secondary);">LEVEL</div>
                        </div>
                        <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: 700; color: var(--primary-purple);">${challenge.time}</div>
                            <div style="font-size: 9px; color: var(--text-secondary);">TIME</div>
                        </div>
                    </div>
                    <button class="btn-primary" style="width: 100%;">üöÄ TAKE CHALLENGE</button>
                </div>
            `).join('');
        }

        function loadLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            if (!leaderboard) return;
            
            // Updated leaderboard with new creator name
            const leaderboardData = [
                { name: 'Pepp', tokens: 1000000, level: 15, rank: 1, badge: 'üéØ', accountType: 'master' },
                { name: 'Stonne', tokens: 500000, level: 10, rank: 2, badge: 'üëë', accountType: 'founder' },
                { name: 'ChampionPlayer', tokens: 5420, level: 12, rank: 3, accountType: 'standard' },
                { name: 'FitnessGuru', tokens: 4890, level: 11, rank: 4, accountType: 'standard' },
                { name: 'MindMaster', tokens: 4320, level: 10, rank: 5, accountType: 'standard' },
                { name: 'SocialBee', tokens: 3950, level: 9, rank: 6, accountType: 'standard' },
                { name: 'CreativeGenius', tokens: 3680, level: 8, rank: 7, accountType: 'standard' }
            ];
            
            if (currentUser && userStats.tokens > 1000) {
                const userEntry = {
                    name: `${userStats.badge || ''} ${currentUser.displayName || 'You'}`,
                    tokens: userStats.tokens,
                    level: userStats.level,
                    rank: 'YOU',
                    accountType: userStats.accountType || 'standard',
                    isCurrentUser: true
                };
                leaderboardData.push(userEntry);
            }
            
            leaderboard.innerHTML = leaderboardData.map(player => {
                const isPremium = player.accountType !== 'standard';
                const premiumGlow = isPremium ? 'box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);' : '';
                const userHighlight = player.isCurrentUser ? 'background: rgba(255, 107, 157, 0.1); border: 1px solid rgba(255, 107, 157, 0.3);' : '';
                
                return `
                    <div class="leaderboard-entry" style="${premiumGlow} ${userHighlight}">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="leaderboard-rank ${player.rank === 1 ? 'gold' : player.rank === 2 ? 'silver' : player.rank === 3 ? 'bronze' : ''}">
                                ${player.rank === 1 ? 'ü•á' : player.rank === 2 ? 'ü•à' : player.rank === 3 ? 'ü•â' : player.rank}
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 5px;">
                                    ${player.name}
                                    ${isPremium ? `<span style="font-size: 10px; background: linear-gradient(45deg, #ffd700, #ff6b9d); color: white; padding: 1px 6px; border-radius: 8px;">${player.accountType.toUpperCase()}</span>` : ''}
                                </div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Level ${player.level}</div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 700; color: var(--primary-pink);">${player.tokens.toLocaleString()}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">tokens</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadAchievements() {
            const achievementsContainer = document.getElementById('achievements');
            if (!achievementsContainer) return;
            
            achievementsContainer.innerHTML = achievements.map(achievement => `
                <div class="achievement-badge ${userStats.achievements.includes(achievement.id) ? 'earned' : ''}" 
                     onclick="showAchievementDetails('${achievement.id}')" 
                     title="${achievement.description}">
                    <div style="font-size: 24px; margin-bottom: 5px;">${achievement.icon}</div>
                    <div style="font-size: 10px; color: var(--text-secondary);">${achievement.name}</div>
                </div>
            `).join('');
        }

        function showChallenges(category) {
            const challenges = challengeCategories[category];
            if (!challenges) return;
            
            showMessage(`üéØ ${category.charAt(0).toUpperCase() + category.slice(1)} challenges loaded!`, 'info');
        }

        function getCategoryIcon(category) {
            const icons = {
                fitness: 'üí™',
                mental: 'üß†',
                social: 'üë•',
                creative: 'üé®',
                weekly: 'üóìÔ∏è'
            };
            return icons[category] || 'üéØ';
        }

        function claimDailyReward() {
            const currentDay = userStats.dailyRewards || 1;
            
            if (currentDay > 7) {
                showMessage('üéÅ Daily rewards cycle completed! Come back tomorrow for a new cycle.', 'info');
                return;
            }
            
            const reward = gameFeatures.dailyRewards[currentDay - 1].reward;
            
            if (reward.type === 'tokens') {
                userStats.tokens += reward.tokens;
                showMessage(`üéÅ Daily reward claimed! +${reward.tokens} tokens!`, 'success');
            } else if (reward.type === 'gems') {
                userStats.gems += reward.gems;
                showMessage(`üéÅ Daily reward claimed! +${reward.gems} gems!`, 'success');
            } else if (reward.type === 'powerup') {
                userStats.powerUps.push({
                    ...gameFeatures.powerUps.find(p => p.id === reward.powerUp),
                    active: false
                });
                showMessage(`üéÅ Daily reward claimed! Power-up unlocked!`, 'success');
            } else if (reward.type === 'mega') {
                userStats.tokens += reward.tokens;
                userStats.gems += reward.gems;
                showMessage(`üéÅ MEGA REWARD! +${reward.tokens} tokens & +${reward.gems} gems!`, 'success');
            }
            
            userStats.dailyRewards = currentDay + 1;
            updateUserStatsDisplay();
            initializeDailyRewards();
            createCelebrationEffect();
        }

        // Settings Functions
        function toggleNotifications() {
            const toggle = document.getElementById('notificationToggle');
            if (toggle) {
                const isOn = toggle.textContent === 'ON';
                toggle.textContent = isOn ? 'OFF' : 'ON';
                toggle.style.background = isOn ? '#666' : 'var(--primary-pink)';
                showMessage(isOn ? 'üîï Notifications disabled' : 'üîî Notifications enabled', 'info');
            }
        }

        function toggleDarkMode() {
            const toggle = document.getElementById('darkModeToggle');
            if (toggle) {
                const isOn = toggle.textContent === 'ON';
                toggle.textContent = isOn ? 'OFF' : 'ON';
                toggle.style.background = isOn ? '#666' : 'var(--primary-purple)';
                showMessage(isOn ? '‚òÄÔ∏è Light mode enabled' : 'üåô Dark mode enabled', 'info');
            }
        }

        function togglePrivacy() {
            const toggle = document.getElementById('privacyToggle');
            if (toggle) {
                const isPrivate = toggle.textContent === 'PRIVATE';
                toggle.textContent = isPrivate ? 'PUBLIC' : 'PRIVATE';
                toggle.style.background = isPrivate ? '#666' : 'var(--primary-blue)';
                showMessage(isPrivate ? 'üåê Profile is now public' : 'üîê Profile is now private', 'info');
            }
        }

        // Challenge Functions
        function takeChallenge(challengeName, tokens, category = 'general') {
            try {
                if (confirm(`üéØ Ready to take on "${challengeName}"?\n\nReward: ${tokens} tokens\nCategory: ${category}\n\nClick OK to accept the challenge!`)) {
                    showMessage(`üéØ Challenge "${challengeName}" accepted!`, 'success');
                    
                    // Simulate challenge completion
                    setTimeout(() => {
                        // Update user stats
                        userStats.tokens += tokens;
                        userStats.xp += Math.floor(tokens * 0.5);
                        userStats.completedChallenges.push({
                            name: challengeName,
                            category: category,
                            tokens: tokens,
                            completedAt: Date.now()
                        });
                        
                        // Check for level up
                        const newLevel = Math.floor(userStats.xp / 1000) + 1;
                        if (newLevel > userStats.level) {
                            userStats.level = newLevel;
                            showMessage(`üéâ Level up! You're now level ${newLevel}!`, 'success');
                            checkAchievements();
                        }
                        
                        // Update streak
                        userStats.streak += 1;
                        
                        // Update display
                        updateUserStatsDisplay();
                        updateUserRank();
                        
                        // Save to Firebase
                        if (firebaseDb && currentUser && !currentUser.isFounder) {
                            const challengeData = {
                                challengeName: challengeName,
                                category: category,
                                tokensEarned: tokens,
                                completedAt: firebase.database.ServerValue.TIMESTAMP
                            };
                            
                            firebaseDb.ref(`users/${currentUser.uid}/challenges`).push(challengeData);
                            firebaseDb.ref(`users/${currentUser.uid}/stats`).set(userStats);
                        }
                        
                        showMessage(`üèÜ Challenge completed! You earned ${tokens} tokens!`, 'success');
                        createCelebrationEffect();
                        
                        // Check achievements
                        checkAchievements();
                    }, 2000);
                }
            } catch (error) {
                console.error('‚ùå Error in takeChallenge:', error);
                showMessage('‚ùå Challenge error occurred', 'error');
            }
        }

        function checkAchievements() {
            const newAchievements = [];
            
            // Check first challenge
            if (userStats.completedChallenges.length >= 1 && !userStats.achievements.includes('first_challenge')) {
                newAchievements.push('first_challenge');
            }
            
            // Check token collector
            if (userStats.tokens >= 1000 && !userStats.achievements.includes('token_collector')) {
                newAchievements.push('token_collector');
            }
            
            // Check streak master
            if (userStats.streak >= 7 && !userStats.achievements.includes('streak_master')) {
                newAchievements.push('streak_master');
            }
            
            // Check category-specific achievements
            const socialChallenges = userStats.completedChallenges.filter(c => c.category === 'social').length;
            if (socialChallenges >= 5 && !userStats.achievements.includes('social_butterfly')) {
                newAchievements.push('social_butterfly');
            }
            
            const fitnessChallenges = userStats.completedChallenges.filter(c => c.category === 'fitness').length;
            if (fitnessChallenges >= 10 && !userStats.achievements.includes('fitness_guru')) {
                newAchievements.push('fitness_guru');
            }
            
            const mentalChallenges = userStats.completedChallenges.filter(c => c.category === 'mental').length;
            if (mentalChallenges >= 10 && !userStats.achievements.includes('mind_master')) {
                newAchievements.push('mind_master');
            }
            
            const creativeChallenges = userStats.completedChallenges.filter(c => c.category === 'creative').length;
            if (creativeChallenges >= 5 && !userStats.achievements.includes('creative_genius')) {
                newAchievements.push('creative_genius');
            }
            
            // Check level achievement
            if (userStats.level >= 5 && !userStats.achievements.includes('level_up')) {
                newAchievements.push('level_up');
            }
            
            // Award new achievements
            if (newAchievements.length > 0) {
                userStats.achievements.push(...newAchievements);
                
                newAchievements.forEach(achievementId => {
                    const achievement = achievements.find(a => a.id === achievementId);
                    if (achievement) {
                        setTimeout(() => {
                            showMessage(`üéñÔ∏è Achievement Unlocked: ${achievement.icon} ${achievement.name}!`, 'success');
                            createCelebrationEffect();
                        }, 1000);
                    }
                });
                
                // Refresh achievements display
                loadAchievements();
                
                // Save to Firebase
                if (firebaseDb && currentUser && !currentUser.isFounder) {
                    firebaseDb.ref(`users/${currentUser.uid}/stats`).set(userStats);
                }
            }
        }

        function createCelebrationEffect() {
            try {
                const emojis = ['üéâ', 'üèÜ', '‚≠ê', 'üéä', 'üî•', 'üí´', '‚ú®', 'üåü'];
                
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const emoji = document.createElement('div');
                        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                        emoji.style.cssText = `
                            position: fixed;
                            font-size: ${20 + Math.random() * 15}px;
                            left: ${Math.random() * window.innerWidth}px;
                            top: ${window.innerHeight}px;
                            pointer-events: none;
                            z-index: 10000;
                            animation: celebrationFloat 3s ease-out forwards;
                        `;
                        
                        document.body.appendChild(emoji);
                        
                        setTimeout(() => {
                            if (emoji.parentNode) {
                                emoji.remove();
                            }
                        }, 3000);
                    }, i * 150);
                }
                
                // Add celebration CSS if not exists
                if (!document.querySelector('#celebration-style')) {
                    const style = document.createElement('style');
                    style.id = 'celebration-style';
                    style.textContent = `
                        @keyframes celebrationFloat {
                            0% {
                                transform: translateY(0) rotate(0deg) scale(0);
                                opacity: 1;
                            }
                            50% {
                                transform: translateY(-60vh) rotate(180deg) scale(1.3);
                                opacity: 1;
                            }
                            100% {
                                transform: translateY(-100vh) rotate(360deg) scale(0.5);
                                opacity: 0;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
            } catch (error) {
                console.error('‚ùå Error in celebration effect:', error);
            }
        }

        // Modal Functions
        function showModal(content) {
            const modalContainer = document.getElementById('modalContainer');
            if (!modalContainer) return;
            
            modalContainer.innerHTML = `
                <div class="modal-overlay" onclick="closeModal()">
                    <div class="modal-content" onclick="event.stopPropagation();">
                        ${content}
                    </div>
                </div>
            `;
        }

        function closeModal() {
            const modalContainer = document.getElementById('modalContainer');
            if (modalContainer) {
                modalContainer.innerHTML = '';
            }
        }

        function showShop() {
            const shopItems = gameFeatures.powerUps.map(item => `
                <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 32px;">${item.icon}</div>
                        <div style="flex: 1;">
                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">${item.name}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 10px;">${item.description}</div>
                            <div style="font-size: 14px; color: var(--success-green); font-weight: 600;">${item.cost} gems</div>
                        </div>
                        <button onclick="buyItem('${item.id}')" class="btn-primary" style="padding: 8px 16px; font-size: 12px;">Buy</button>
                    </div>
                </div>
            `).join('');
            
            showModal(`
                <div>
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 32px; margin-bottom: 10px;">üõí</div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--primary-pink);">Shop</div>
                        <div style="font-size: 14px; color: var(--text-secondary); margin-top: 5px;">
                            Your gems: ${userStats.gems} üíé
                        </div>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${shopItems}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="closeModal()" class="btn-secondary">Close</button>
                    </div>
                </div>
            `);
        }

        function buyItem(itemId) {
            const item = gameFeatures.powerUps.find(p => p.id === itemId);
            if (!item) return;
            
            if (userStats.gems < item.cost) {
                showMessage('üíé Not enough gems!', 'error');
                return;
            }
            
            userStats.gems -= item.cost;
            userStats.powerUps.push({
                ...item,
                active: false,
                purchasedAt: Date.now()
            });
            
            updateUserStatsDisplay();
            showMessage(`‚úÖ ${item.name} purchased!`, 'success');
            closeModal();
        }

        function showFriends() {
            showModal(`
                <div style="text-align: center;">
                    <div style="font-size: 32px; margin-bottom: 15px;">üë•</div>
                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 20px; color: var(--primary-pink);">Friends</div>
                    <div style="font-size: 16px; color: var(--text-secondary); margin-bottom: 20px;">
                        Connect with friends to compete and share achievements!
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <div style="font-size: 18px; margin-bottom: 10px;">üéØ Friend Challenges</div>
                        <div style="font-size: 14px; color: var(--text-secondary);">Challenge friends to beat your scores and earn bonus rewards!</div>
                    </div>
                    <button onclick="closeModal()" class="btn-primary">Close</button>
                </div>
            `);
        }

        function showStats() {
            showModal(`
                <div>
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 32px; margin-bottom: 10px;">üìä</div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--primary-pink);">Your Stats</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(255, 107, 157, 0.1); padding: 15px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary-pink);">${userStats.tokens.toLocaleString()}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Total Tokens</div>
                        </div>
                        <div style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary-purple);">${userStats.completedChallenges.length}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Completed Challenges</div>
                        </div>
                        <div style="background: rgba(0, 212, 255, 0.1); padding: 15px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary-blue);">${userStats.streak}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Current Streak</div>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--success-green);">${userStats.level}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Current Level</div>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button onclick="closeModal()" class="btn-primary">Close</button>
                    </div>
                </div>
            `);
        }

        function showInventory() {
            const inventoryItems = userStats.powerUps.filter(p => !p.active).map(item => `
                <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 15px; margin-bottom: 10px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 24px;">${item.icon}</div>
                        <div style="flex: 1;">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 5px;">${item.name}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${item.description}</div>
                        </div>
                        <button onclick="activatePowerUp('${item.id}')" class="btn-primary" style="padding: 6px 12px; font-size: 12px;">Use</button>
                    </div>
                </div>
            `).join('');
            
            showModal(`
                <div>
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 32px; margin-bottom: 10px;">üéí</div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--primary-pink);">Inventory</div>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${inventoryItems.length > 0 ? inventoryItems : '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">No items in inventory</div>'}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="closeModal()" class="btn-secondary">Close</button>
                    </div>
                </div>
            `);
        }

        function activatePowerUp(powerUpId) {
            const powerUp = userStats.powerUps.find(p => p.id === powerUpId && !p.active);
            if (!powerUp) return;
            
            powerUp.active = true;
            powerUp.activatedAt = Date.now();
            
            if (powerUp.duration) {
                powerUp.timeLeft = powerUp.duration;
            } else if (powerUp.uses) {
                powerUp.usesLeft = powerUp.uses;
            }
            
            showMessage(`‚ö° ${powerUp.name} activated!`, 'success');
            initializePowerUps();
            closeModal();
            
            // Set expiration timer
            if (powerUp.duration) {
                setTimeout(() => {
                    powerUp.active = false;
                    showMessage(`‚è∞ ${powerUp.name} expired!`, 'info');
                    initializePowerUps();
                }, powerUp.duration * 1000);
            }
        }

        function showAchievementDetails(achievementId) {
            const achievement = achievements.find(a => a.id === achievementId);
            if (!achievement) return;
            
            const isEarned = userStats.achievements.includes(achievementId);
            
            showModal(`
                <div style="text-align: center;">
                    <div style="font-size: 64px; margin-bottom: 15px; ${isEarned ? 'filter: none;' : 'filter: grayscale(100%);'}">${achievement.icon}</div>
                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 10px; color: var(--primary-pink);">${achievement.name}</div>
                    <div style="font-size: 16px; color: var(--text-secondary); margin-bottom: 20px;">${achievement.description}</div>
                    <div style="font-size: 18px; font-weight: 600; color: ${isEarned ? 'var(--success-green)' : 'var(--text-secondary)'};">
                        ${isEarned ? '‚úÖ EARNED' : 'üîí LOCKED'}
                    </div>
                    <div style="margin-top: 20px;">
                        <button onclick="closeModal()" class="btn-primary">Close</button>
                    </div>
                </div>
            `);
        }

        function quickAction() {
            const actions = [
                { name: 'Generate AI Challenge', action: () => generateAIChallenge() },
                { name: 'View Stats', action: () => showStats() },
                { name: 'Open Shop', action: () => showShop() },
                { name: 'Check Inventory', action: () => showInventory() },
                { name: 'View Friends', action: () => showFriends() }
            ];
            
            const randomAction = actions[Math.floor(Math.random() * actions.length)];
            showMessage(`‚ö° Quick Action: ${randomAction.name}`, 'info');
            
            setTimeout(() => {
                randomAction.action();
            }, 1000);
        }

        // Enhanced initialization with retry logic and stability improvements
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ JomBro Enhanced - Initializing...');
            
            // Set up form submission with enhanced error handling
            const authForm = document.getElementById('authForm');
            if (authForm) {
                authForm.addEventListener('submit', function(e) {
                    console.log('üìù Form submit event triggered');
                    handleAuthSubmit(e);
                });
                console.log('‚úÖ Form event listener added');
            } else {
                console.error('‚ùå Auth form not found');
            }
            
            // Initialize Firebase with enhanced retry logic
            setTimeout(async () => {
                console.log('üî• Starting Firebase initialization...');
                
                let success = false;
                let attempts = 0;
                const maxAttempts = 5; // Increased attempts
                
                while (!success && attempts < maxAttempts) {
                    attempts++;
                    console.log(`üîÑ Firebase initialization attempt ${attempts}/${maxAttempts}`);
                    updateConnectionStatus('connecting', `Connecting... (${attempts}/${maxAttempts})`);
                    
                    success = await initializeFirebase();
                    
                    if (!success && attempts < maxAttempts) {
                        console.log(`‚ö†Ô∏è Attempt ${attempts} failed, retrying in ${attempts * 2} seconds...`);
                        updateConnectionStatus('connecting', `Retrying in ${attempts * 2}s... (${attempts}/${maxAttempts})`);
                        await new Promise(resolve => setTimeout(resolve, attempts * 2000)); // Increasing delay
                    }
                }
                
                if (success) {
                    console.log('‚úÖ Firebase initialization successful');
                    showMessage('üî• Firebase authentication ready!', 'success', 3000);
                } else {
                    console.error('‚ùå Firebase initialization failed after all attempts');
                    updateConnectionStatus('disconnected', 'Connection Failed');
                    showMessage('‚ùå Unable to connect to Firebase. Please check your internet connection and refresh the page.', 'error', 10000);
                    
                    // Offer manual retry
                    setTimeout(() => {
                        showMessage('üîÑ You can try refreshing the page or check your internet connection.', 'info', 8000);
                    }, 5000);
                }
            }, 500); // Reduced initial delay
            
            // Enhanced keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + Enter to submit form
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    const submitBtn = document.getElementById('submitBtn');
                    if (submitBtn && !submitBtn.disabled) {
                        e.preventDefault();
                        console.log('‚å®Ô∏è Keyboard shortcut triggered');
                        submitBtn.click();
                    }
                }
                
                // Escape to clear messages
                if (e.key === 'Escape') {
                    clearMessages();
                }
            });
            
            // Hide online players when clicking outside
            document.addEventListener('click', function(e) {
                const onlineOverlay = document.getElementById('onlinePlayersOverlay');
                if (onlineOverlay && !onlineOverlay.contains(e.target) && !e.target.closest('.overlay-button')) {
                    if (isOnlinePlayersVisible) {
                        onlineOverlay.classList.add('hidden');
                        isOnlinePlayersVisible = false;
                    }
                }
            });
            
            // Enhanced form input handling
            const emailInput = document.getElementById('emailInput');
            const passwordInput = document.getElementById('passwordInput');
            
            if (emailInput) {
                emailInput.addEventListener('input', function() {
                    // Clear error state when user starts typing
                    if (this.classList.contains('error')) {
                        this.classList.remove('error');
                    }
                });
                
                emailInput.addEventListener('blur', function() {
                    const email = this.value.trim();
                    if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                        this.style.borderColor = 'var(--error-red)';
                    } else {
                        this.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                    }
                });
            }
            
            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    // Clear error state when user starts typing
                    if (this.classList.contains('error')) {
                        this.classList.remove('error');
                    }
                    
                    // Real-time password strength indicator
                    const password = this.value;
                    if (password.length >= 6) {
                        this.style.borderColor = password.length >= 8 ? 'var(--success-green)' : 'var(--warning-orange)';
                    } else if (password.length > 0) {
                        this.style.borderColor = 'var(--error-red)';
                    } else {
                        this.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                    }
                });
            }
            
            // Enhanced connection monitoring
            let connectionCheckInterval;
            
            function startConnectionMonitoring() {
                if (connectionCheckInterval) {
                    clearInterval(connectionCheckInterval);
                }
                
                connectionCheckInterval = setInterval(() => {
                    if (navigator.onLine) {
                        if (!isInitialized) {
                            console.log('üîÑ Network back online, attempting to reconnect...');
                            initializeFirebase();
                        }
                    } else {
                        console.log('üìµ Network offline detected');
                        updateConnectionStatus('disconnected', 'No Internet Connection');
                        showMessage('üìµ No internet connection. Please check your network.', 'warning');
                    }
                }, 10000); // Check every 10 seconds
            }
            
            // Network event listeners
            window.addEventListener('online', () => {
                console.log('üåê Network connection restored');
                if (!isInitialized) {
                    showMessage('üåê Network restored. Reconnecting...', 'info');
                    initializeFirebase();
                }
            });
            
            window.addEventListener('offline', () => {
                console.log('üìµ Network connection lost');
                updateConnectionStatus('disconnected', 'Offline');
                showMessage('üìµ Network connection lost. Please check your internet.', 'warning');
            });
            
            // Start connection monitoring
            startConnectionMonitoring();
            
            // Page visibility handling
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible' && !isInitialized) {
                    console.log('üëÅÔ∏è Page became visible, checking Firebase connection...');
                    initializeFirebase();
                }
            });
            
            console.log('‚úÖ JomBro Enhanced initialization complete');
            console.log('üéØ Features: Enhanced Stability, Live Players, AI Challenges, Better Error Handling');
        });
    </script>
</body>
</html>
