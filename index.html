<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="JomBro - Complete challenges, earn rewards, and have fun!">
    <title>JomBro - Challenge & Reward Platform</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ®</text></svg>">
    
    <!-- Performance Optimization: Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://firebasestorage.googleapis.com">
    
    <!-- PWA meta tags -->
    <link rel="manifest" href="data:application/json,{%22name%22:%22JomBro%22,%22short_name%22:%22JomBro%22,%22start_url%22:%22/%22,%22display%22:%22standalone%22,%22background_color%22:%22%23000000%22,%22theme_color%22:%22%23000000%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ®</text></svg>%22,%22sizes%22:%22any%22}]}">
    
    <!-- Social sharing meta tags -->
    <meta property="og:title" content="JomBro - Challenge & Reward Platform">
    <meta property="og:description" content="Complete fun challenges with friends, earn rewards, and level up!">
    <meta property="og:type" content="website">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>
    
    <style>
        /* CSS Variables for theming */
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #e91e63;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --primary-gradient: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            --secondary-gradient: linear-gradient(45deg, #9b59b6, #e91e63);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #fff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --text-tertiary: rgba(255, 255, 255, 0.6);
            --animation-speed: 0.3s;
            --animation-curve: cubic-bezier(0.4, 0, 0.2, 1);
            --safe-area-top: env(safe-area-inset-top);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }
        
        /* Dark theme (default) */
        [data-theme="dark"] {
            --bg-primary: #000;
            --bg-secondary: #111;
            --bg-tertiary: #1a1a1a;
        }
        
        /* Light theme */
        [data-theme="light"] {
            --bg-primary: #fff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #e0e0e0;
            --text-primary: #000;
            --text-secondary: rgba(0, 0, 0, 0.8);
            --text-tertiary: rgba(0, 0, 0, 0.6);
            --glass-bg: rgba(0, 0, 0, 0.05);
            --glass-border: rgba(0, 0, 0, 0.1);
        }
        
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-weight: 400;
            background: var(--bg-primary, #000);
            color: var(--text-primary);
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            overscroll-behavior: none;
            max-width: 480px;
            margin: 0 auto;
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background 0.3s ease;
        }
        
        @media (min-width: 481px) {
            body {
                border-left: 1px solid #333;
                border-right: 1px solid #333;
            }
        }
        
        /* Hide scrollbars */
        ::-webkit-scrollbar {
            display: none;
        }
        
        .file-input {
            display: none;
        }
        
        /* GPU Accelerated Animations */
        .gpu-accelerated {
            transform: translateZ(0);
            will-change: transform;
            backface-visibility: hidden;
            perspective: 1000px;
        }
        
        /* Utility Classes */
        .glass-effect {
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
        }
        
        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .no-select {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        /* Enhanced Login Screen */
        #loginScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .login-content {
            text-align: center;
            padding: 20px;
            animation: slideInUp 0.6s var(--animation-curve);
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .app-logo {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: logoFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3));
        }
        
        @keyframes logoFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .app-title {
            font-size: 3rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 100;
            margin-bottom: 10px;
            color: white;
            letter-spacing: 2px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 40px;
            font-weight: 300;
        }
        
        .login-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }
        
        .login-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid white;
            color: white;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all var(--animation-speed) var(--animation-curve);
            font-weight: 600;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .login-btn:hover {
            background: white;
            color: var(--primary-color);
            transform: scale(1.05);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .quick-start-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid white;
            color: white;
            padding: 20px 60px;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all var(--animation-speed) var(--animation-curve);
            font-weight: 600;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .quick-start-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .quick-start-btn:hover {
            color: var(--primary-color);
            transform: scale(1.05);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .quick-start-btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .quick-start-btn span {
            position: relative;
            z-index: 1;
        }
        
        /* Feed Container */
        .feed-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
            display: none;
            background: var(--bg-primary);
            scrollbar-width: none;
        }
        
        /* Feed Post */
        .feed-post {
            position: relative;
            width: 100%;
            height: 100vh;
            height: 100dvh;
            scroll-snap-align: start;
            background: var(--bg-primary);
            overflow: hidden;
        }
        
        /* Post Media */
        .post-media {
            width: 100%;
            height: 100%;
            position: relative;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }
        
        .post-media::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 40px;
            height: 40px;
            margin: -20px 0 0 -20px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: -1;
        }
        
        .post-video,
        .post-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .post-video.loaded,
        .post-image.loaded {
            opacity: 1;
        }
        
        /* Live Badge */
        .live-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #ff0000;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: 600;
            font-size: 0.9rem;
            z-index: 30;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Frame Styles */
        .frame-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        .frame-gradient-border {
            background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #06c, #ff006e);
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
            padding: 3px;
            opacity: 0.8;
        }
        
        .frame-gradient-border::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            right: 3px;
            bottom: 3px;
            background: var(--bg-primary);
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Gradient Overlays */
        .gradient-overlay-top {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: linear-gradient(to bottom, 
                rgba(0,0,0,0.8) 0%, 
                rgba(0,0,0,0.4) 50%, 
                transparent 100%);
            z-index: 15;
            pointer-events: none;
        }
        
        .gradient-overlay-bottom {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: linear-gradient(to top, 
                rgba(0,0,0,0.95) 0%, 
                rgba(0,0,0,0.6) 50%, 
                transparent 100%);
            z-index: 15;
            pointer-events: none;
        }
        
        /* Header */
        .feed-header {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            z-index: 300;
            padding: 15px 20px;
            padding-top: max(15px, var(--safe-area-top));
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: transparent;
            transition: background 0.3s ease;
        }
        
        .feed-header.scrolled {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
        }
        
        .header-left {
            font-size: 1.5rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 200;
            color: white;
            flex-shrink: 0;
            text-shadow: 0 2px 8px rgba(0,0,0,0.8);
            animation: fadeInDown 0.5s ease-out;
            letter-spacing: 1px;
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header-center {
            display: flex;
            gap: 20px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 10px 24px;
            border-radius: 35px;
            animation: fadeInDown 0.5s ease-out 0.1s backwards;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header-tab {
            font-size: 1.1rem;
            font-weight: 600;
            opacity: 0.7;
            cursor: pointer;
            transition: all var(--animation-speed) var(--animation-curve);
            position: relative;
            background: none;
            border: none;
            color: white;
            text-shadow: 0 1px 4px rgba(0,0,0,0.8);
            padding: 5px 10px;
        }
        
        .header-tab.active {
            opacity: 1;
        }
        
        .header-tab.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 2px;
            background: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .header-icon-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--animation-speed) var(--animation-curve);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 1.2rem;
            position: relative;
        }
        
        .header-icon-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: #ff0000;
            color: white;
            font-size: 0.7rem;
            padding: 2px 5px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        /* Post Actions */
        .post-actions {
            position: absolute;
            right: 15px;
            bottom: 120px;
            z-index: 25;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }
        
        .action-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all var(--animation-speed) var(--animation-curve);
        }
        
        .action-item:active {
            transform: scale(0.95);
        }
        
        .action-icon {
            width: 48px;
            height: 48px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all var(--animation-speed) var(--animation-curve);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .action-icon:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        
        .action-icon.liked {
            background: var(--accent-color);
            box-shadow: 0 2px 12px rgba(233, 30, 99, 0.5);
            animation: likeAnimation 0.6s var(--animation-curve);
        }
        
        @keyframes likeAnimation {
            0% { transform: scale(1); }
            25% { transform: scale(0.8); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .action-count {
            font-size: 0.75rem;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        }
        
        /* User Avatar */
        .user-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            border: 3px solid white;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .follow-btn {
            position: absolute;
            bottom: -3px;
            background: var(--accent-color);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            border: 2px solid var(--bg-primary);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
            transition: all var(--animation-speed) var(--animation-curve);
        }
        
        .follow-btn:hover {
            transform: scale(1.1);
        }
        
        /* Post Info */
        .post-info {
            position: absolute;
            bottom: 20px;
            bottom: calc(20px + var(--safe-area-bottom));
            left: 0;
            right: 80px;
            padding: 20px;
            z-index: 25;
        }
        
        .post-user {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 10px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        }
        
        .challenge-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(155, 89, 182, 0.3);
            backdrop-filter: blur(10px);
            padding: 6px 16px;
            border-radius: 20px;
            margin-bottom: 10px;
            font-size: 0.9rem;
            border: 1px solid rgba(155, 89, 182, 0.5);
            animation: fadeInUp 0.5s ease-out 0.3s backwards;
        }
        
        @keyframes fadeInUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .post-caption {
            font-size: 0.95rem;
            margin-bottom: 10px;
            line-height: 1.4;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        }
        
        .post-music {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .music-icon {
            animation: musicSpin 3s linear infinite;
        }
        
        @keyframes musicSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            z-index: 300;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            padding-bottom: calc(10px + var(--safe-area-bottom));
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all var(--animation-speed) var(--animation-curve);
            padding: 5px;
            background: none;
            border: none;
            color: white;
            position: relative;
        }
        
        .nav-item::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 40px;
            height: 2px;
            background: var(--primary-gradient);
            transition: transform 0.3s var(--animation-curve);
        }
        
        .nav-item.active::before {
            transform: translateX(-50%) scaleX(1);
        }
        
        .nav-icon {
            font-size: 1.5rem;
            transition: transform 0.3s var(--animation-curve);
        }
        
        .nav-item:active .nav-icon {
            transform: scale(0.9);
        }
        
        .nav-label {
            font-size: 0.7rem;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }
        
        .nav-item.active .nav-icon,
        .nav-item.active .nav-label {
            opacity: 1;
        }
        
        /* Create Button */
        .create-btn {
            position: relative;
            background: white;
            border-radius: 12px;
            padding: 8px 24px;
            overflow: hidden;
        }
        
        .create-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s ease;
        }
        
        .create-btn:hover::before {
            left: 100%;
        }
        
        .create-btn .nav-icon {
            color: black;
            position: relative;
            z-index: 1;
        }
        
        /* Modal Base */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 400;
            display: none;
            align-items: flex-end;
            justify-content: center;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: var(--bg-tertiary, #1a1a1a);
            border-radius: 20px 20px 0 0;
            padding: 20px;
            width: 100%;
            max-width: 480px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlideUp var(--animation-speed) var(--animation-curve);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @keyframes modalSlideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Form Styles */
        .form-input, .form-textarea, .form-select {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--text-primary);
            padding: 15px;
            border-radius: 10px;
            font-size: 1rem;
            width: 100%;
            resize: vertical;
            transition: all var(--animation-speed) var(--animation-curve);
            font-family: inherit;
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .form-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
            font-weight: 500;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        /* Buttons */
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: var(--secondary-gradient);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--animation-speed) var(--animation-curve);
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(155, 89, 182, 0.4);
        }
        
        .submit-btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .submit-btn:active {
            transform: translateY(0);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 25px;
            z-index: 600;
            animation: toastSlideUp 0.3s var(--animation-curve);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @keyframes toastSlideUp {
            from { 
                opacity: 0;
                transform: translate(-50%, 20px);
            }
            to { 
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }
        
        .toast-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0 5px;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            display: none;
            z-index: 10000;
        }
        
        .loading-spinner::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading-message {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            color: white;
            font-size: 0.9rem;
        }
        
        /* Profile Modal */
        #profileModal .modal-content {
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 0;
            max-height: 100vh;
            height: 100vh;
            border-radius: 0;
            position: relative;
            overflow: hidden;
        }
        
        .profile-modal-scroll {
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            background: var(--bg-primary);
            scroll-behavior: smooth;
        }
        
        /* Profile Header */
        .profile-header {
            padding: 0;
            position: relative;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 40vh;
            overflow: hidden;
        }
        
        .profile-cover {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .profile-cover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, 
                transparent 0%, 
                rgba(0,0,0,0.3) 50%, 
                rgba(0,0,0,0.8) 100%);
            z-index: 2;
            pointer-events: none;
        }
        
        .profile-cover-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-cover-default {
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
        }
        
        .profile-cover-upload {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .profile-cover-upload:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.1);
        }
        
        /* Profile Info Section */
        .profile-info-section {
            padding: 30px 20px;
            margin-top: -80px;
            position: relative;
            z-index: 10;
        }
        
        /* Avatar */
        .profile-avatar-section {
            position: relative;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .profile-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            border: 4px solid var(--bg-primary);
            box-shadow: 0 0 40px rgba(240, 147, 251, 0.5),
                        0 0 80px rgba(245, 87, 108, 0.3);
            position: relative;
            cursor: pointer;
            animation: avatarPulse 3s ease-in-out infinite;
            overflow: hidden;
        }
        
        @keyframes avatarPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .profile-avatar-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .profile-avatar-edit {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--primary-gradient);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            border: 2px solid var(--bg-primary);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        
        .profile-avatar-edit:hover {
            transform: scale(1.1);
        }
        
        /* Profile Name and Stats */
        .profile-name-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .profile-username {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .profile-bio {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 20px;
            padding: 0 20px;
        }
        
        /* Stats */
        .profile-stats {
            display: flex;
            justify-content: space-around;
            padding: 20px 10px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: scale(1.05);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Profile Tabs */
        .profile-tabs {
            display: flex;
            justify-content: space-around;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin: 0 -20px;
            padding: 0 20px;
            position: sticky;
            top: 0;
            background: var(--bg-primary);
            z-index: 20;
        }
        
        .profile-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: var(--text-tertiary);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .profile-tab.active {
            color: var(--text-primary);
        }
        
        .profile-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: var(--primary-gradient);
        }
        
        /* Posts Grid */
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            padding: 2px;
        }
        
        .grid-post {
            position: relative;
            aspect-ratio: 1;
            background: #111;
            overflow: hidden;
            cursor: pointer;
        }
        
        .grid-post img,
        .grid-post video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .grid-post:hover img,
        .grid-post:hover video {
            transform: scale(1.05);
        }
        
        .grid-post-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 10px;
            display: flex;
            gap: 15px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .grid-post:hover .grid-post-overlay {
            opacity: 1;
        }
        
        /* Profile Actions */
        .profile-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .profile-btn {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .profile-btn.primary {
            background: var(--primary-gradient);
            border: none;
        }
        
        .profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.1);
        }
        
        /* Camera Modal */
        #cameraModal .modal-content {
            background: #000;
            padding: 0;
            max-height: 100vh;
            height: 100vh;
            border-radius: 0;
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        
        #cameraVideo,
        #recordedVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .camera-controls {
            position: absolute;
            bottom: 40px;
            bottom: calc(40px + var(--safe-area-bottom));
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            z-index: 10;
        }
        
        .camera-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid white;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .camera-btn::before {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            background: red;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .camera-btn.recording::before {
            border-radius: 8px;
            width: 25px;
            height: 25px;
        }
        
        .camera-btn.recording {
            animation: recordPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes recordPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .camera-close {
            position: absolute;
            top: 40px;
            top: calc(40px + var(--safe-area-top));
            left: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .camera-flip {
            position: absolute;
            top: 40px;
            top: calc(40px + var(--safe-area-top));
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .camera-close:hover,
        .camera-flip:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }
        
        .gallery-btn {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .gallery-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .timer {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: 600;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        /* Camera Effects */
        .effects-panel {
            position: absolute;
            bottom: 150px;
            left: 0;
            right: 0;
            display: flex;
            gap: 15px;
            padding: 0 20px;
            overflow-x: auto;
            z-index: 10;
        }
        
        .effect-btn {
            flex-shrink: 0;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .effect-btn.active {
            background: var(--primary-gradient);
            transform: scale(1.1);
        }
        
        /* Challenge Cards */
        .challenge-section {
            padding: 20px 0;
        }
        
        .challenge-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all var(--animation-speed) ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .challenge-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .challenge-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        
        .challenge-card:hover::before {
            left: 100%;
        }
        
        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }
        
        .challenge-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .challenge-category {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(155, 89, 182, 0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            border: 1px solid rgba(155, 89, 182, 0.4);
        }
        
        .challenge-reward {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 1.2rem;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .challenge-description {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
            margin-bottom: 10px;
        }
        
        .challenge-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            opacity: 0.6;
        }
        
        /* Search Modal */
        #searchModal .modal-content {
            background: var(--bg-secondary);
            max-height: 100vh;
            height: 100vh;
            border-radius: 0;
        }
        
        .search-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            z-index: 10;
        }
        
        .search-input-container {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 25px;
            padding: 12px 20px;
            transition: all 0.3s ease;
        }
        
        .search-input-container:focus-within {
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-input {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1rem;
            outline: none;
        }
        
        .search-results {
            padding: 20px;
        }
        
        .search-result-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all var(--animation-speed) ease;
            position: relative;
        }
        
        .search-result-item::before {
            content: '';
            position: absolute;
            left: -20px;
            right: -20px;
            top: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.05);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .search-result-item:hover::before {
            opacity: 1;
        }
        
        .search-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            position: relative;
            z-index: 1;
        }
        
        .search-info {
            flex: 1;
            position: relative;
            z-index: 1;
        }
        
        .search-name {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .search-username {
            font-size: 0.9rem;
            opacity: 0.6;
        }
        
        /* Comments Modal */
        #commentsModal .modal-content {
            max-height: 70vh;
        }
        
        .comments-list {
            padding: 20px 0;
            max-height: 50vh;
            overflow-y: auto;
        }
        
        .comment-item {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            animation: fadeInUp 0.3s ease;
        }
        
        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .comment-content {
            flex: 1;
        }
        
        .comment-header {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .comment-author {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .comment-time {
            font-size: 0.8rem;
            opacity: 0.5;
        }
        
        .comment-text {
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .comment-input-container {
            display: flex;
            gap: 10px;
            padding: 15px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            bottom: 0;
            background: var(--bg-tertiary);
        }
        
        .comment-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.08);
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            color: var(--text-primary);
            font-size: 0.95rem;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .comment-input:focus {
            background: rgba(255, 255, 255, 0.12);
        }
        
        .comment-send-btn {
            background: var(--secondary-gradient);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .comment-send-btn:hover {
            transform: scale(1.05);
        }
        
        .comment-send-btn:active {
            transform: scale(0.95);
        }
        
        /* Discover Page */
        .discover-container {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 60px;
            bottom: calc(60px + var(--safe-area-bottom));
            overflow-y: auto;
            background: var(--bg-primary);
            display: none;
            padding: 20px;
            max-width: 480px;
            margin: 0 auto;
        }
        
        .trending-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .trending-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .trending-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all var(--animation-speed) ease;
            position: relative;
        }
        
        .trending-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .trending-card:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .trending-card:hover::before {
            opacity: 1;
        }
        
        .trending-media {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
        }
        
        .trending-info {
            padding: 12px;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1;
        }
        
        .trending-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .trending-stats {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            opacity: 0.7;
        }
        
        /* Edit Profile Modal */
        #editProfileModal .modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }
        
        /* Settings Modal */
        #settingsModal .modal-content {
            max-height: 80vh;
        }
        
        .settings-section {
            margin-bottom: 30px;
        }
        
        .settings-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-secondary);
        }
        
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .settings-label {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .toggle-switch.active {
            background: var(--primary-color);
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        
        .toggle-switch.active::after {
            transform: translateX(24px);
        }
        
        /* Notifications Modal */
        #notificationsModal .modal-content {
            max-height: 80vh;
        }
        
        .notification-item {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .notification-item:hover {
            background: rgba(255, 255, 255, 0.05);
            margin: 0 -20px;
            padding: 15px 20px;
        }
        
        .notification-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-text {
            margin-bottom: 5px;
        }
        
        .notification-time {
            font-size: 0.8rem;
            opacity: 0.6;
        }
        
        /* Inbox/Chat Modal */
        #inboxModal .modal-content {
            background: var(--bg-secondary);
            max-height: 100vh;
            height: 100vh;
            border-radius: 0;
            display: flex;
            flex-direction: column;
        }
        
        .inbox-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .chat-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all var(--animation-speed) ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .chat-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .chat-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            position: relative;
        }
        
        .online-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 14px;
            height: 14px;
            background: #4caf50;
            border-radius: 50%;
            border: 2px solid var(--bg-secondary);
        }
        
        .chat-info {
            flex: 1;
        }
        
        .chat-name {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .chat-preview {
            font-size: 0.9rem;
            opacity: 0.6;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .chat-meta {
            text-align: right;
        }
        
        .chat-time {
            font-size: 0.8rem;
            opacity: 0.5;
            margin-bottom: 5px;
        }
        
        .unread-badge {
            background: #e91e63;
            color: white;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        /* Chat Window */
        #chatWindow {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            z-index: 500;
            max-width: 480px;
            margin: 0 auto;
        }
        
        .chat-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
        }
        
        .chat-back {
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .chat-user-info {
            flex: 1;
        }
        
        .chat-user-name {
            font-weight: 600;
        }
        
        .chat-user-status {
            font-size: 0.8rem;
            opacity: 0.6;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 18px;
            position: relative;
        }
        
        .message.sent {
            align-self: flex-end;
            background: var(--primary-gradient);
            color: white;
        }
        
        .message.received {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .message-time {
            font-size: 0.7rem;
            opacity: 0.6;
            margin-top: 5px;
        }
        
        .chat-input-container {
            display: flex;
            gap: 10px;
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
        }
        
        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 10px 15px;
            border-radius: 25px;
            color: var(--text-primary);
            outline: none;
        }
        
        .chat-send {
            background: var(--primary-gradient);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 1.2rem;
        }
        
        /* Leaderboard Modal */
        #leaderboardModal .modal-content {
            max-height: 80vh;
        }
        
        .leaderboard-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .leaderboard-tab {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .leaderboard-tab.active {
            background: var(--primary-gradient);
        }
        
        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }
        
        .leaderboard-rank {
            font-size: 1.5rem;
            font-weight: 700;
            width: 40px;
            text-align: center;
        }
        
        .leaderboard-rank.gold {
            color: #ffd700;
        }
        
        .leaderboard-rank.silver {
            color: #c0c0c0;
        }
        
        .leaderboard-rank.bronze {
            color: #cd7f32;
        }
        
        .leaderboard-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .leaderboard-info {
            flex: 1;
        }
        
        .leaderboard-name {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .leaderboard-stats {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .leaderboard-score {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        /* Shop/Rewards Modal */
        #shopModal .modal-content {
            max-height: 80vh;
        }
        
        .shop-balance {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 255, 255, 0.05));
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .shop-balance-label {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .shop-balance-amount {
            font-size: 2rem;
            font-weight: 700;
            color: #ffd700;
        }
        
        .shop-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .shop-category {
            flex-shrink: 0;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .shop-category.active {
            background: var(--primary-gradient);
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .shop-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .shop-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-5px);
        }
        
        .shop-item-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .shop-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .shop-item-price {
            color: #ffd700;
            font-weight: 600;
        }
        
        /* Badges Section */
        .badges-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .badge-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .badge-item.unlocked {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
        }
        
        .badge-item.locked {
            opacity: 0.5;
        }
        
        .badge-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .badge-name {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .badge-description {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        /* Friend Tag Modal */
        #friendTagModal .modal-content {
            max-height: 60vh;
        }
        
        .friend-list {
            padding: 10px 0;
        }
        
        .friend-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .friend-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .friend-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .friend-item.selected {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .friend-item.selected .friend-checkbox {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }
        
        /* Live Stream Setup */
        #liveSetupModal .modal-content {
            max-height: 80vh;
        }
        
        .live-preview {
            position: relative;
            width: 100%;
            aspect-ratio: 9/16;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .live-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .live-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            background: red;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }
        
        /* Collaboration Modal */
        #collabModal .modal-content {
            max-height: 80vh;
        }
        
        .collab-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .collab-option {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .collab-option:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }
        
        .collab-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .collab-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .collab-description {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        /* Tutorial Overlay */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }
        
        .tutorial-content {
            background: var(--bg-tertiary);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            text-align: center;
            position: relative;
        }
        
        .tutorial-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .tutorial-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .tutorial-text {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 30px;
        }
        
        .tutorial-dots {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .tutorial-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }
        
        .tutorial-dot.active {
            background: white;
            transform: scale(1.2);
        }
        
        .tutorial-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 480px) {
            .header-center {
                gap: 15px;
                padding: 8px 20px;
            }
            
            .header-tab {
                font-size: 1rem;
            }
            
            .post-actions {
                right: 10px;
                gap: 15px;
            }
            
            .action-icon {
                width: 42px;
                height: 42px;
                font-size: 1.2rem;
            }
            
            .user-avatar {
                width: 48px;
                height: 48px;
            }
            
            .trending-grid {
                gap: 10px;
            }
        }
        
        /* Landscape Mode Fixes */
        @media (orientation: landscape) and (max-height: 500px) {
            .feed-header {
                padding: 10px 20px;
            }
            
            .bottom-nav {
                padding: 5px 0;
            }
            
            .nav-label {
                display: none;
            }
            
            .post-actions {
                bottom: 80px;
            }
        }
        
        /* Animation Performance */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            .glass-effect {
                background: rgba(0, 0, 0, 0.8);
                border: 2px solid white;
            }
            
            .form-input,
            .form-textarea {
                border: 2px solid white;
            }
        }
        
        /* Accessibility Improvements */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Focus Indicators */
        *:focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        
        /* Loading States */
        .skeleton {
            background: linear-gradient(90deg, #222 25%, #333 50%, #222 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Error States */
        .error-message {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #ff6b6b;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        /* Success States */
        .success-message {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: #4caf50;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        /* Verification Badge */
        .verified-badge {
            background: #1DA1F2;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: white;
        }
        
        /* Premium Badge */
        .premium-badge {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Language Selector */
        .language-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .language-option {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .language-option.active {
            background: var(--primary-gradient);
            border-color: transparent;
        }
        
        /* Two-Factor Auth */
        .two-factor-input {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .two-factor-digit {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: var(--text-primary);
        }
        
        /* Export Options */
        .export-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .export-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .export-option:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        /* Help/Support */
        .help-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .help-category {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .help-category:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-5px);
        }
        
        .help-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        /* FAQ Accordion */
        .faq-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        .faq-question {
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .faq-answer {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .faq-item.active .faq-answer {
            max-height: 200px;
            padding: 15px;
        }
        
        /* Report Modal */
        .report-reasons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .report-reason {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .report-reason:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .report-reason input[type="radio"] {
            width: 20px;
            height: 20px;
        }
        
        /* Privacy Controls */
        .privacy-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .privacy-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .privacy-label {
            flex: 1;
        }
        
        .privacy-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .privacy-description {
            font-size: 0.9rem;
            opacity: 0.7;
        }
    </style>
</head>
<body data-theme="dark">
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="login-content">
            <div class="app-logo">ðŸŽ®</div>
            <h1 class="app-title">JomBro</h1>
            <p class="app-subtitle">Let's Go! Let's Go!</p>
            
            <button class="quick-start-btn" onclick="App.quickStart()">
                <span>Start Playing â†’</span>
            </button>
            
            <div class="login-options">
                <button class="login-btn" onclick="App.loginWithGoogle()">
                    <span>ðŸ”·</span> Continue with Google
                </button>
                <button class="login-btn" onclick="App.loginWithFacebook()">
                    <span>ðŸ“˜</span> Continue with Facebook
                </button>
                <button class="login-btn" onclick="App.loginWithPhone()">
                    <span>ðŸ“±</span> Continue with Phone
                </button>
            </div>
        </div>
    </div>
    
    <!-- Feed Header -->
    <div class="feed-header" style="display: none;">
        <div class="header-left">JomBro</div>
        <div class="header-center">
            <button class="header-tab" onclick="App.switchFeed('following')">Following</button>
            <button class="header-tab active" onclick="App.switchFeed('foryou')">For You</button>
            <button class="header-tab" onclick="App.switchFeed('live')">ðŸ”´ Live</button>
        </div>
        <div class="header-right">
            <div class="header-icon-btn" onclick="App.showSearch()">ðŸ”</div>
            <div class="header-icon-btn" onclick="App.showNotifications()">
                ðŸ””
                <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
            </div>
        </div>
    </div>
    
    <!-- Main Feed -->
    <div class="feed-container" id="feedContainer" style="display: none;">
        <!-- Posts will be dynamically loaded here -->
    </div>
    
    <!-- Discover Container -->
    <div class="discover-container" id="discoverContainer">
        <!-- Discover content will be loaded here -->
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav" id="bottomNav" style="display: none;">
        <button class="nav-item active" onclick="App.switchNav('home', this)">
            <span class="nav-icon">ðŸ </span>
            <span class="nav-label">Home</span>
        </button>
        <button class="nav-item" onclick="App.switchNav('discover', this)">
            <span class="nav-icon">ðŸ”¥</span>
            <span class="nav-label">Discover</span>
        </button>
        <button class="nav-item create-btn" onclick="App.showCreateOptions()">
            <span class="nav-icon">âž•</span>
        </button>
        <button class="nav-item" onclick="App.switchNav('inbox', this)">
            <span class="nav-icon">ðŸ’¬</span>
            <span class="nav-label">Inbox</span>
        </button>
        <button class="nav-item" onclick="App.showProfile()">
            <span class="nav-icon">ðŸ‘¤</span>
            <span class="nav-label">Profile</span>
        </button>
    </div>
    
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner"></div>
    
    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="profile-modal-scroll" id="profileContent">
                <!-- Profile content will be dynamically loaded -->
            </div>
        </div>
    </div>
    
    <!-- Camera Modal -->
    <div class="modal" id="cameraModal">
        <div class="modal-content">
            <div class="camera-container">
                <video id="cameraVideo" autoplay playsinline muted></video>
                <video id="recordedVideo" style="display: none;" playsinline></video>
                
                <div class="camera-close" onclick="App.closeCamera()">âœ•</div>
                <div class="camera-flip" onclick="App.flipCamera()">ðŸ”„</div>
                
                <div class="timer" id="recordTimer">00:00</div>
                
                <!-- Effects Panel -->
                <div class="effects-panel" id="effectsPanel" style="display: none;">
                    <div class="effect-btn" onclick="App.applyEffect('none')">âŒ</div>
                    <div class="effect-btn" onclick="App.applyEffect('beauty')">âœ¨</div>
                    <div class="effect-btn" onclick="App.applyEffect('vintage')">ðŸ“·</div>
                    <div class="effect-btn" onclick="App.applyEffect('comic')">ðŸ’¥</div>
                    <div class="effect-btn" onclick="App.applyEffect('blur')">ðŸŒ«ï¸</div>
                </div>
                
                <div class="camera-controls">
                    <div class="gallery-btn" onclick="document.getElementById('galleryInput').click()">
                        ðŸ–¼ï¸
                    </div>
                    <div class="camera-btn" id="recordBtn" onclick="App.toggleRecording()"></div>
                    <div class="gallery-btn" onclick="App.toggleEffects()">
                        âœ¨
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Challenge Select Modal -->
    <div class="modal" id="challengeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Select Challenge</h2>
                <button class="close-btn" onclick="App.closeModal('challengeModal')">âœ•</button>
            </div>
            <div class="challenge-section" id="challengeList">
                <!-- Challenges will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Comments Modal -->
    <div class="modal" id="commentsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Comments</h2>
                <button class="close-btn" onclick="App.closeModal('commentsModal')">âœ•</button>
            </div>
            <div class="comments-list" id="commentsList">
                <!-- Comments will be loaded here -->
            </div>
            <div class="comment-input-container">
                <input type="text" class="comment-input" placeholder="Add a comment..." id="commentInput">
                <button class="comment-send-btn" onclick="App.postComment()">Send</button>
            </div>
        </div>
    </div>
    
    <!-- Search Modal -->
    <div class="modal" id="searchModal">
        <div class="modal-content">
            <div class="search-header">
                <div class="search-input-container">
                    <span>ðŸ”</span>
                    <input type="text" class="search-input" placeholder="Search users, challenges, sounds..." id="searchInput" oninput="App.performSearch()">
                    <button class="close-btn" onclick="App.closeModal('searchModal')" style="width: auto; height: auto; background: none;">âœ•</button>
                </div>
            </div>
            <div class="search-results" id="searchResults">
                <!-- Search results will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Notifications Modal -->
    <div class="modal" id="notificationsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Notifications</h2>
                <button class="close-btn" onclick="App.closeModal('notificationsModal')">âœ•</button>
            </div>
            <div id="notificationsList">
                <!-- Notifications will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Inbox Modal -->
    <div class="modal" id="inboxModal">
        <div class="modal-content">
            <div class="inbox-header">
                <h2 class="modal-title">Messages</h2>
                <button class="close-btn" onclick="App.closeModal('inboxModal')">âœ•</button>
            </div>
            <div class="chat-list" id="chatList">
                <!-- Chat items will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Chat Window -->
    <div id="chatWindow">
        <div class="chat-header">
            <div class="chat-back" onclick="App.closeChat()">â†</div>
            <div class="chat-user-info">
                <div class="chat-user-name" id="chatUserName">User</div>
                <div class="chat-user-status" id="chatUserStatus">Online</div>
            </div>
            <div class="header-icon-btn" onclick="App.showChatOptions()">â‹®</div>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be loaded here -->
        </div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" placeholder="Type a message..." id="chatInput">
            <button class="chat-send" onclick="App.sendMessage()">â†’</button>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button class="close-btn" onclick="App.closeModal('settingsModal')">âœ•</button>
            </div>
            <div id="settingsContent">
                <!-- Settings will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Leaderboard Modal -->
    <div class="modal" id="leaderboardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Leaderboard</h2>
                <button class="close-btn" onclick="App.closeModal('leaderboardModal')">âœ•</button>
            </div>
            <div class="leaderboard-tabs">
                <button class="leaderboard-tab active" onclick="App.switchLeaderboard('global', this)">Global</button>
                <button class="leaderboard-tab" onclick="App.switchLeaderboard('friends', this)">Friends</button>
                <button class="leaderboard-tab" onclick="App.switchLeaderboard('weekly', this)">This Week</button>
            </div>
            <div class="leaderboard-list" id="leaderboardList">
                <!-- Leaderboard will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Shop/Rewards Modal -->
    <div class="modal" id="shopModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Rewards Shop</h2>
                <button class="close-btn" onclick="App.closeModal('shopModal')">âœ•</button>
            </div>
            <div class="shop-balance">
                <div class="shop-balance-label">Your Balance</div>
                <div class="shop-balance-amount" id="shopBalance">ðŸª™ 0</div>
            </div>
            <div class="shop-categories">
                <button class="shop-category active" onclick="App.switchShopCategory('all', this)">All</button>
                <button class="shop-category" onclick="App.switchShopCategory('avatars', this)">Avatars</button>
                <button class="shop-category" onclick="App.switchShopCategory('frames', this)">Frames</button>
                <button class="shop-category" onclick="App.switchShopCategory('effects', this)">Effects</button>
                <button class="shop-category" onclick="App.switchShopCategory('vouchers', this)">Vouchers</button>
            </div>
            <div class="shop-items" id="shopItems">
                <!-- Shop items will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Friend Tag Modal -->
    <div class="modal" id="friendTagModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Tag Friends</h2>
                <button class="close-btn" onclick="App.closeModal('friendTagModal')">âœ•</button>
            </div>
            <div class="friend-list" id="friendList">
                <!-- Friend list will be loaded here -->
            </div>
            <button class="submit-btn" onclick="App.confirmFriendTags()">Tag Selected Friends</button>
        </div>
    </div>
    
    <!-- Post Upload Modal -->
    <div class="modal" id="postUploadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Share Your Challenge</h2>
                <button class="close-btn" onclick="App.closeModal('postUploadModal')">âœ•</button>
            </div>
            <div class="form-group">
                <label class="form-label">Caption</label>
                <textarea class="form-textarea" id="postCaption" rows="3" placeholder="Write a caption..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Tag Friends</label>
                <button class="form-input" style="cursor: pointer; text-align: left;" onclick="App.showFriendTag()">
                    <span id="taggedFriendsText">Select friends to tag...</span>
                </button>
            </div>
            <div class="form-group">
                <label class="form-label">Privacy</label>
                <select class="form-select" id="postPrivacy">
                    <option value="public">Public</option>
                    <option value="friends">Friends Only</option>
                    <option value="private">Only Me</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Challenge</label>
                <div class="challenge-card" id="selectedChallengeCard" style="cursor: default;">
                    <!-- Selected challenge will be shown here -->
                </div>
            </div>
            <button class="submit-btn" onclick="App.uploadPost()">Share Challenge ðŸš€</button>
        </div>
    </div>
    
    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Profile</h2>
                <button class="close-btn" onclick="App.closeModal('editProfileModal')">âœ•</button>
            </div>
            <div id="editProfileForm">
                <!-- Edit form will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Live Setup Modal -->
    <div class="modal" id="liveSetupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Go Live</h2>
                <button class="close-btn" onclick="App.closeModal('liveSetupModal')">âœ•</button>
            </div>
            <div class="live-preview">
                <video id="livePreview" autoplay playsinline muted></video>
                <div class="live-overlay">LIVE</div>
            </div>
            <div class="form-group">
                <label class="form-label">Title</label>
                <input type="text" class="form-input" id="liveTitle" placeholder="What are you doing?">
            </div>
            <div class="form-group">
                <label class="form-label">Category</label>
                <select class="form-select" id="liveCategory">
                    <option value="gaming">Gaming</option>
                    <option value="music">Music</option>
                    <option value="talk">Just Chatting</option>
                    <option value="fitness">Fitness</option>
                    <option value="food">Food & Drink</option>
                </select>
            </div>
            <button class="submit-btn" onclick="App.startLive()">Go Live ðŸ”´</button>
        </div>
    </div>
    
    <!-- Collaboration Modal -->
    <div class="modal" id="collabModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create Together</h2>
                <button class="close-btn" onclick="App.closeModal('collabModal')">âœ•</button>
            </div>
            <div class="collab-options">
                <div class="collab-option" onclick="App.startDuet()">
                    <div class="collab-icon">ðŸŽ­</div>
                    <div class="collab-title">Duet</div>
                    <div class="collab-description">Create side-by-side with another video</div>
                </div>
                <div class="collab-option" onclick="App.startReact()">
                    <div class="collab-icon">ðŸ˜®</div>
                    <div class="collab-title">React</div>
                    <div class="collab-description">Record your reaction to a video</div>
                </div>
                <div class="collab-option" onclick="App.startStitch()">
                    <div class="collab-icon">ðŸŽ¬</div>
                    <div class="collab-title">Stitch</div>
                    <div class="collab-description">Add to the end of another video</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create Options Modal -->
    <div class="modal" id="createOptionsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create</h2>
                <button class="close-btn" onclick="App.closeModal('createOptionsModal')">âœ•</button>
            </div>
            <div class="collab-options">
                <div class="collab-option" onclick="App.openCamera()">
                    <div class="collab-icon">ðŸ“¹</div>
                    <div class="collab-title">Challenge Video</div>
                    <div class="collab-description">Record yourself completing a challenge</div>
                </div>
                <div class="collab-option" onclick="App.goLive()">
                    <div class="collab-icon">ðŸ”´</div>
                    <div class="collab-title">Go Live</div>
                    <div class="collab-description">Stream live to your followers</div>
                </div>
                <div class="collab-option" onclick="App.showCollab()">
                    <div class="collab-icon">ðŸ‘¥</div>
                    <div class="collab-title">Collaborate</div>
                    <div class="collab-description">Create with other users</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Help/Support Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Help & Support</h2>
                <button class="close-btn" onclick="App.closeModal('helpModal')">âœ•</button>
            </div>
            <div class="help-categories">
                <div class="help-category" onclick="App.showFAQ()">
                    <div class="help-icon">â“</div>
                    <div>FAQ</div>
                </div>
                <div class="help-category" onclick="App.contactSupport()">
                    <div class="help-icon">ðŸ’¬</div>
                    <div>Contact Us</div>
                </div>
                <div class="help-category" onclick="App.showGuides()">
                    <div class="help-icon">ðŸ“–</div>
                    <div>Guides</div>
                </div>
                <div class="help-category" onclick="App.reportBug()">
                    <div class="help-icon">ðŸ›</div>
                    <div>Report Bug</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Report Modal -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Report</h2>
                <button class="close-btn" onclick="App.closeModal('reportModal')">âœ•</button>
            </div>
            <div class="report-reasons">
                <label class="report-reason">
                    <input type="radio" name="report" value="spam">
                    <span>Spam or misleading</span>
                </label>
                <label class="report-reason">
                    <input type="radio" name="report" value="inappropriate">
                    <span>Inappropriate content</span>
                </label>
                <label class="report-reason">
                    <input type="radio" name="report" value="harassment">
                    <span>Harassment or bullying</span>
                </label>
                <label class="report-reason">
                    <input type="radio" name="report" value="violence">
                    <span>Violence or dangerous acts</span>
                </label>
                <label class="report-reason">
                    <input type="radio" name="report" value="copyright">
                    <span>Copyright infringement</span>
                </label>
            </div>
            <textarea class="form-textarea" placeholder="Additional details (optional)" style="margin-top: 20px;"></textarea>
            <button class="submit-btn" style="margin-top: 20px;" onclick="App.submitReport()">Submit Report</button>
        </div>
    </div>
    
    <!-- Two-Factor Modal -->
    <div class="modal" id="twoFactorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Two-Factor Authentication</h2>
                <button class="close-btn" onclick="App.closeModal('twoFactorModal')">âœ•</button>
            </div>
            <p style="text-align: center; margin-bottom: 20px;">Enter the 6-digit code from your authenticator app</p>
            <div class="two-factor-input">
                <input type="text" class="two-factor-digit" maxlength="1" oninput="App.handleTwoFactorInput(this, 0)">
                <input type="text" class="two-factor-digit" maxlength="1" oninput="App.handleTwoFactorInput(this, 1)">
                <input type="text" class="two-factor-digit" maxlength="1" oninput="App.handleTwoFactorInput(this, 2)">
                <input type="text" class="two-factor-digit" maxlength="1" oninput="App.handleTwoFactorInput(this, 3)">
                <input type="text" class="two-factor-digit" maxlength="1" oninput="App.handleTwoFactorInput(this, 4)">
                <input type="text" class="two-factor-digit" maxlength="1" oninput="App.handleTwoFactorInput(this, 5)">
            </div>
            <button class="submit-btn" style="margin-top: 20px;" onclick="App.verifyTwoFactor()">Verify</button>
        </div>
    </div>
    
    <!-- Phone Login Modal -->
    <div class="modal" id="phoneLoginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Phone Login</h2>
                <button class="close-btn" onclick="App.closeModal('phoneLoginModal')">âœ•</button>
            </div>
            <div class="form-group">
                <label class="form-label">Phone Number</label>
                <input type="tel" class="form-input" id="phoneNumber" placeholder="+60 12-345 6789">
            </div>
            <button class="submit-btn" onclick="App.sendOTP()">Send OTP</button>
            
            <div id="otpSection" style="display: none; margin-top: 20px;">
                <div class="form-group">
                    <label class="form-label">Enter OTP</label>
                    <input type="text" class="form-input" id="otpCode" placeholder="6-digit code" maxlength="6">
                </div>
                <button class="submit-btn" onclick="App.verifyOTP()">Verify & Login</button>
            </div>
        </div>
    </div>
    
    <!-- Hidden file inputs -->
    <input type="file" id="galleryInput" class="file-input" accept="image/*,video/*" onchange="App.handleGalleryUpload(event)">
    <input type="file" id="avatarInput" class="file-input" accept="image/*" onchange="App.handleAvatarUpload(event)">
    <input type="file" id="coverInput" class="file-input" accept="image/*" onchange="App.handleCoverUpload(event)">
    
    <script>
        'use strict';
        
        // Complete App Implementation
        const App = {
            // Firebase config
            firebaseConfig: {
                apiKey: "AIzaSyC_orriRUuf1ynDiFaJAPrO6-Gu3GeURxQ",
                authDomain: "jombro-9d129.firebaseapp.com",
                projectId: "jombro-9d129",
                storageBucket: "jombro-9d129.firebasestorage.app",
                messagingSenderId: "390572076435",
                appId: "1:390572076435:web:781f9f62b84542eb834c66"
            },
            
            // App State
            state: {
                // User
                currentUser: null,
                userData: {
                    username: '',
                    bio: '',
                    avatar: 'ðŸ‘¤',
                    cover: null,
                    coins: 1000,
                    level: 1,
                    xp: 0,
                    followers: 0,
                    following: 0,
                    posts: 0,
                    badges: []
                },
                userPosts: [],
                userSettings: {
                    theme: 'dark',
                    language: 'en',
                    notifications: true,
                    autoplay: true,
                    dataUsage: 'auto',
                    privacy: {
                        profileVisibility: 'public',
                        messageRequests: 'everyone',
                        duetReact: 'friends',
                        download: 'everyone',
                        comments: 'everyone'
                    },
                    twoFactor: false
                },
                
                // Feed & Content
                feedPosts: [],
                currentPostIndex: 0,
                feedType: 'foryou',
                livePosts: [],
                
                // Challenges
                selectedChallenge: null,
                aiChallenges: [],
                userChallenges: [],
                completedChallenges: new Set(),
                dailyChallenge: null,
                
                // Social
                friends: [],
                followers: [],
                following: [],
                blockedUsers: [],
                selectedFriends: new Set(),
                
                // Messaging
                conversations: [],
                currentChat: null,
                typingUsers: new Set(),
                
                // Notifications
                notifications: [],
                unreadNotifications: 0,
                
                // Comments
                comments: {},
                
                // Search
                searchResults: {
                    users: [],
                    challenges: [],
                    sounds: [],
                    hashtags: []
                },
                recentSearches: [],
                
                // Discovery
                discoverContent: {
                    trending: [],
                    categories: [],
                    topCreators: [],
                    recommendedChallenges: []
                },
                
                // Shop
                shopItems: [],
                purchasedItems: [],
                
                // Leaderboard
                leaderboard: {
                    global: [],
                    friends: [],
                    weekly: []
                },
                
                // Camera & Recording
                currentStream: null,
                mediaRecorder: null,
                recordedChunks: [],
                isRecording: false,
                recordingStartTime: null,
                recordingTimer: null,
                currentCamera: 'user',
                currentEffect: 'none',
                currentUploadFile: null,
                
                // Live Streaming
                isLive: false,
                liveStream: null,
                liveViewers: 0,
                
                // UI State
                isModalOpen: false,
                activeModal: null,
                deferredPrompt: null,
                isFirstTime: true,
                onboardingStep: 0,
                
                // Performance
                imageCache: new Map(),
                videoCache: new Map(),
                lastScrollTime: 0,
                
                // Analytics
                sessionStartTime: Date.now(),
                viewedPosts: new Set(),
                engagementMetrics: {
                    likes: 0,
                    comments: 0,
                    shares: 0,
                    watchTime: 0
                }
            },
            
            // Initialize App
            async init() {
                try {
                    // Initialize Firebase
                    await this.initFirebase();
                    
                    // Load saved data
                    this.loadSavedData();
                    
                    // Setup event listeners
                    this.setupEventListeners();
                    
                    // Initialize features
                    await this.initializeFeatures();
                    
                    console.log('JomBro initialized! ðŸš€');
                    
                } catch (error) {
                    console.error('App initialization error:', error);
                    this.showToast('Starting in offline mode', 3000);
                    this.initializeFeatures();
                }
            },
            
            // Initialize Firebase
            async initFirebase() {
                try {
                    firebase.initializeApp(this.firebaseConfig);
                    this.auth = firebase.auth();
                    this.db = firebase.firestore();
                    this.storage = firebase.storage();
                    
                    // Enable offline persistence
                    await this.db.enablePersistence().catch(err => {
                        console.log('Persistence failed:', err.code);
                    });
                    
                    // Setup auth listener
                    this.auth.onAuthStateChanged((user) => {
                        if (user) {
                            this.handleAuthSuccess(user);
                        }
                    });
                    
                } catch (error) {
                    console.warn('Firebase initialization failed:', error);
                    this.auth = null;
                    this.db = null;
                    this.storage = null;
                }
            },
            
            // Initialize Features
            async initializeFeatures() {
                this.setupSwipeGestures();
                this.generateAIChallenges();
                this.generateDailyChallenge();
                this.loadSampleData();
                this.loadShopItems();
                this.preloadAssets();
            },
            
            // Quick Start
            quickStart() {
                const username = 'Player' + Math.floor(Math.random() * 10000);
                this.state.currentUser = {
                    uid: 'guest_' + Date.now(),
                    displayName: username,
                    email: null,
                    isGuest: true
                };
                
                this.state.userData.username = username;
                this.saveData();
                this.enterApp();
                
                if (this.state.isFirstTime) {
                    this.showTutorial();
                }
            },
            
            // Login Methods
            async loginWithGoogle() {
                if (!this.auth) {
                    this.showToast('Google login unavailable in offline mode', 3000);
                    return;
                }
                
                try {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    const result = await this.auth.signInWithPopup(provider);
                    this.handleAuthSuccess(result.user);
                } catch (error) {
                    console.error('Google login error:', error);
                    this.showToast('Login failed. Please try again.', 3000);
                }
            },
            
            async loginWithFacebook() {
                if (!this.auth) {
                    this.showToast('Facebook login unavailable in offline mode', 3000);
                    return;
                }
                
                try {
                    const provider = new firebase.auth.FacebookAuthProvider();
                    const result = await this.auth.signInWithPopup(provider);
                    this.handleAuthSuccess(result.user);
                } catch (error) {
                    console.error('Facebook login error:', error);
                    this.showToast('Login failed. Please try again.', 3000);
                }
            },
            
            loginWithPhone() {
                this.showModal('phoneLoginModal');
            },
            
            // Handle Auth Success
            handleAuthSuccess(user) {
                this.state.currentUser = user;
                this.state.userData.username = user.displayName || 'Player' + Math.floor(Math.random() * 10000);
                
                if (user.photoURL) {
                    this.state.userData.avatar = user.photoURL;
                }
                
                this.saveData();
                this.enterApp();
                
                if (this.state.isFirstTime) {
                    this.showTutorial();
                }
            },
            
            // Enter App
            enterApp() {
                document.getElementById('loginScreen').style.display = 'none';
                document.querySelector('.feed-header').style.display = 'flex';
                document.getElementById('feedContainer').style.display = 'block';
                document.getElementById('bottomNav').style.display = 'flex';
                
                this.loadFeed();
                this.updateUI();
            },
            
            // Setup Event Listeners
            setupEventListeners() {
                // Navigation
                window.addEventListener('popstate', this.handleBackButton.bind(this));
                
                // Network
                window.addEventListener('online', () => {
                    this.showToast('Back online! ðŸŒ');
                    this.syncOfflineData();
                });
                window.addEventListener('offline', () => this.showToast('Offline mode ðŸ“µ'));
                
                // Visibility
                document.addEventListener('visibilitychange', this.handleVisibilityChange.bind(this));
                
                // Keyboard
                document.addEventListener('keydown', this.handleKeyboard.bind(this));
                
                // Touch events
                this.setupTouchEvents();
                
                // Intersection Observer
                this.setupIntersectionObserver();
            },
            
            // Setup Touch Events
            setupTouchEvents() {
                let touchStartX = 0;
                let touchStartY = 0;
                
                document.addEventListener('touchstart', (e) => {
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                }, { passive: true });
                
                document.addEventListener('touchend', (e) => {
                    const touchEndX = e.changedTouches[0].clientX;
                    const touchEndY = e.changedTouches[0].clientY;
                    this.handleSwipe(touchStartX - touchEndX, touchStartY - touchEndY);
                }, { passive: true });
            },
            
            // Setup Swipe Gestures
            setupSwipeGestures() {
                const feedContainer = document.getElementById('feedContainer');
                if (!feedContainer) return;
                
                let touchStartY = 0;
                
                feedContainer.addEventListener('touchstart', (e) => {
                    touchStartY = e.touches[0].clientY;
                }, { passive: true });
                
                feedContainer.addEventListener('touchend', (e) => {
                    const touchEndY = e.changedTouches[0].clientY;
                    const swipeDistance = touchStartY - touchEndY;
                    
                    if (Math.abs(swipeDistance) > 50) {
                        if (swipeDistance > 0) {
                            this.nextPost();
                        } else {
                            this.previousPost();
                        }
                    }
                }, { passive: true });
            },
            
            // Handle Swipe
            handleSwipe(swipeX, swipeY) {
                const threshold = 50;
                const ratio = Math.abs(swipeX) / Math.abs(swipeY);
                const feedContainer = document.getElementById('feedContainer');
                
                if (feedContainer && feedContainer.style.display !== 'none' && ratio < 0.5) {
                    if (Math.abs(swipeY) > threshold) {
                        if (swipeY > 0) {
                            this.nextPost();
                        } else {
                            this.previousPost();
                        }
                    }
                }
            },
            
            // Setup Intersection Observer
            setupIntersectionObserver() {
                const options = {
                    root: null,
                    rootMargin: '0px',
                    threshold: [0.5, 0.75]
                };
                
                this.postObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && entry.intersectionRatio >= 0.75) {
                            const index = parseInt(entry.target.getAttribute('data-index'));
                            this.state.currentPostIndex = index;
                            
                            const video = entry.target.querySelector('.post-video');
                            if (video && video.paused) {
                                video.play().catch(err => console.log('Autoplay prevented:', err));
                            }
                            
                            this.updateViewCount(index);
                        } else {
                            const video = entry.target.querySelector('.post-video');
                            if (video && !video.paused) {
                                video.pause();
                            }
                        }
                    });
                }, options);
            },
            
            // Generate AI Challenges
            generateAIChallenges() {
                const categories = Object.keys(this.aiChallengeTemplates);
                this.state.aiChallenges = [];
                
                // Generate 20 random challenges
                for (let i = 0; i < 20; i++) {
                    const category = categories[Math.floor(Math.random() * categories.length)];
                    const challenges = this.aiChallengeTemplates[category];
                    const challenge = challenges[Math.floor(Math.random() * challenges.length)];
                    
                    this.state.aiChallenges.push({
                        id: 'ai_' + Date.now() + '_' + i,
                        ...challenge,
                        category: category,
                        participants: Math.floor(Math.random() * 5000) + 100,
                        completions: Math.floor(Math.random() * 1000) + 50
                    });
                }
            },
            
            // Generate Daily Challenge
            generateDailyChallenge() {
                const categories = Object.keys(this.aiChallengeTemplates);
                const category = categories[Math.floor(Math.random() * categories.length)];
                const challenges = this.aiChallengeTemplates[category];
                const challenge = challenges[Math.floor(Math.random() * challenges.length)];
                
                this.state.dailyChallenge = {
                    id: 'daily_' + new Date().toISOString().split('T')[0],
                    ...challenge,
                    category: category,
                    reward: challenge.reward * 2, // Double rewards for daily
                    participants: Math.floor(Math.random() * 10000) + 1000,
                    completions: Math.floor(Math.random() * 5000) + 500,
                    expiresIn: this.getTimeUntilMidnight()
                };
            },
            
            // Get Time Until Midnight
            getTimeUntilMidnight() {
                const now = new Date();
                const midnight = new Date(now);
                midnight.setHours(24, 0, 0, 0);
                return midnight - now;
            },
            
            // Load Sample Data
            loadSampleData() {
                // Sample posts
                const samplePosts = [
                    {
                        id: 'post_1',
                        user: {
                            id: 'user_1',
                            name: 'Sarah Chen',
                            username: '@sarahc',
                            avatar: 'ðŸ‘©',
                            verified: true
                        },
                        mediaUrl: 'https://picsum.photos/400/800?random=1',
                        mediaType: 'image',
                        caption: 'Just completed the plank challenge! ðŸ’ª',
                        challenge: this.state.aiChallenges[0] || { title: 'Plank Challenge', category: 'fitness' },
                        likes: 1234,
                        comments: 89,
                        shares: 45,
                        views: 5678,
                        timestamp: Date.now() - 3600000,
                        isLiked: false
                    },
                    {
                        id: 'post_2',
                        user: {
                            id: 'user_2',
                            name: 'Mike Johnson',
                            username: '@mikej',
                            avatar: 'ðŸ‘¨',
                            verified: false
                        },
                        mediaUrl: 'https://picsum.photos/400/800?random=2',
                        mediaType: 'image',
                        caption: 'Dance battle mode activated! ðŸ•º',
                        challenge: this.state.aiChallenges[1] || { title: 'Dance Battle', category: 'creative' },
                        likes: 2345,
                        comments: 156,
                        shares: 78,
                        views: 8901,
                        timestamp: Date.now() - 7200000,
                        isLiked: false
                    },
                    {
                        id: 'post_3',
                        user: {
                            id: 'user_3',
                            name: 'Emma Wilson',
                            username: '@emmaw',
                            avatar: 'ðŸ‘±â€â™€ï¸',
                            verified: true
                        },
                        mediaUrl: 'https://picsum.photos/400/800?random=3',
                        mediaType: 'image',
                        caption: 'Cooking challenge complete! Check out this amazing dish ðŸ³',
                        challenge: this.state.aiChallenges[2] || { title: 'Cooking Challenge', category: 'food' },
                        likes: 3456,
                        comments: 234,
                        shares: 123,
                        views: 12345,
                        timestamp: Date.now() - 10800000,
                        isLiked: true
                    }
                ];
                
                this.state.feedPosts = samplePosts;
                
                // Sample notifications
                this.state.notifications = [
                    {
                        id: 'notif_1',
                        type: 'like',
                        user: 'Sarah Chen',
                        content: 'liked your video',
                        timestamp: Date.now() - 1800000,
                        read: false
                    },
                    {
                        id: 'notif_2',
                        type: 'follow',
                        user: 'Mike Johnson',
                        content: 'started following you',
                        timestamp: Date.now() - 3600000,
                        read: false
                    },
                    {
                        id: 'notif_3',
                        type: 'comment',
                        user: 'Emma Wilson',
                        content: 'commented: "Great job!"',
                        timestamp: Date.now() - 7200000,
                        read: true
                    }
                ];
                
                this.updateNotificationBadge();
                
                // Sample conversations
                this.state.conversations = [
                    {
                        id: 'conv_1',
                        user: {
                            name: 'Sarah Chen',
                            avatar: 'ðŸ‘©',
                            isOnline: true
                        },
                        lastMessage: 'Hey! Want to collab?',
                        timestamp: Date.now() - 1800000,
                        unread: 2
                    },
                    {
                        id: 'conv_2',
                        user: {
                            name: 'Mike Johnson',
                            avatar: 'ðŸ‘¨',
                            isOnline: false
                        },
                        lastMessage: 'That challenge was awesome!',
                        timestamp: Date.now() - 3600000,
                        unread: 0
                    }
                ];
                
                // Sample leaderboard
                this.state.leaderboard.global = [
                    { rank: 1, user: 'ChallengeKing', avatar: 'ðŸ‘‘', score: 9876, completions: 234 },
                    { rank: 2, user: 'ProGamer123', avatar: 'ðŸŽ®', score: 8765, completions: 198 },
                    { rank: 3, user: 'FitnessFanatic', avatar: 'ðŸ’ª', score: 7654, completions: 176 },
                    { rank: 4, user: 'CreativeQueen', avatar: 'ðŸ‘¸', score: 6543, completions: 154 },
                    { rank: 5, user: 'You', avatar: 'ðŸ˜Ž', score: 5432, completions: 132 }
                ];
            },
            
            // Load Shop Items
            loadShopItems() {
                this.state.shopItems = [
                    ...this.shopItemsData.avatars,
                    ...this.shopItemsData.frames,
                    ...this.shopItemsData.effects,
                    ...this.shopItemsData.vouchers
                ];
            },
            
            // Preload Assets
            preloadAssets() {
                // Preload critical images
                const images = [
                    'https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700&display=swap'
                ];
                
                images.forEach(src => {
                    const img = new Image();
                    img.src = src;
                });
            },
            
            // Load Feed
            loadFeed() {
                const feedContainer = document.getElementById('feedContainer');
                feedContainer.innerHTML = '';
                
                this.state.feedPosts.forEach((post, index) => {
                    const postElement = this.createPostElement(post, index);
                    feedContainer.appendChild(postElement);
                    
                    if (this.postObserver) {
                        this.postObserver.observe(postElement);
                    }
                });
                
                // Auto-play first video
                setTimeout(() => {
                    const firstVideo = feedContainer.querySelector('.post-video');
                    if (firstVideo) {
                        firstVideo.play().catch(err => console.log('Autoplay prevented:', err));
                    }
                }, 100);
            },
            
            // Create Post Element
            createPostElement(post, index) {
                const postDiv = document.createElement('div');
                postDiv.className = 'feed-post';
                postDiv.setAttribute('data-index', index);
                
                postDiv.innerHTML = `
                    <div class="post-media">
                        ${post.mediaType === 'video' ? 
                            `<video class="post-video" src="${post.mediaUrl}" loop playsinline muted></video>` :
                            `<img class="post-image" src="${post.mediaUrl}" alt="${post.caption}" onload="this.classList.add('loaded')">`
                        }
                    </div>
                    
                    ${post.isLive ? '<div class="live-badge">LIVE</div>' : ''}
                    
                    <div class="gradient-overlay-top"></div>
                    <div class="gradient-overlay-bottom"></div>
                    
                    <div class="post-actions">
                        <div class="action-item" onclick="App.toggleLike(${index})">
                            <div class="user-avatar">
                                ${post.user.avatar}
                                <div class="follow-btn" onclick="event.stopPropagation(); App.toggleFollow('${post.user.id}')">+</div>
                            </div>
                        </div>
                        
                        <div class="action-item" onclick="App.toggleLike(${index})">
                            <div class="action-icon ${post.isLiked ? 'liked' : ''}">â¤ï¸</div>
                            <span class="action-count">${this.formatCount(post.likes)}</span>
                        </div>
                        
                        <div class="action-item" onclick="App.showComments(${index})">
                            <div class="action-icon">ðŸ’¬</div>
                            <span class="action-count">${this.formatCount(post.comments)}</span>
                        </div>
                        
                        <div class="action-item" onclick="App.sharePost(${index})">
                            <div class="action-icon">ðŸ“¤</div>
                            <span class="action-count">${this.formatCount(post.shares)}</span>
                        </div>
                    </div>
                    
                    <div class="post-info">
                        <div class="post-user">
                            ${post.user.name} ${post.user.verified ? '<span class="verified-badge">âœ“</span>' : ''}
                        </div>
                        ${post.challenge ? `
                            <div class="challenge-badge">
                                ðŸ† ${post.challenge.title}
                            </div>
                        ` : ''}
                        <div class="post-caption">${post.caption}</div>
                        <div class="post-music">
                            <span class="music-icon">ðŸŽµ</span>
                            <span>Original Sound - ${post.user.name}</span>
                        </div>
                    </div>
                `;
                
                return postDiv;
            },
            
            // Format Count
            formatCount(count) {
                if (count >= 1000000) {
                    return (count / 1000000).toFixed(1) + 'M';
                } else if (count >= 1000) {
                    return (count / 1000).toFixed(1) + 'K';
                }
                return count.toString();
            },
            
            // Navigation
            nextPost() {
                const feedContainer = document.getElementById('feedContainer');
                const posts = feedContainer.querySelectorAll('.feed-post');
                
                if (this.state.currentPostIndex < posts.length - 1) {
                    this.state.currentPostIndex++;
                    posts[this.state.currentPostIndex].scrollIntoView({ behavior: 'smooth' });
                }
            },
            
            previousPost() {
                const feedContainer = document.getElementById('feedContainer');
                const posts = feedContainer.querySelectorAll('.feed-post');
                
                if (this.state.currentPostIndex > 0) {
                    this.state.currentPostIndex--;
                    posts[this.state.currentPostIndex].scrollIntoView({ behavior: 'smooth' });
                }
            },
            
            // Like/Unlike Post
            toggleLike(index) {
                const post = this.state.feedPosts[index];
                post.isLiked = !post.isLiked;
                post.likes += post.isLiked ? 1 : -1;
                
                const likeIcon = document.querySelectorAll('.feed-post')[index].querySelector('.action-icon');
                if (post.isLiked) {
                    likeIcon.classList.add('liked');
                } else {
                    likeIcon.classList.remove('liked');
                }
                
                const likeCount = document.querySelectorAll('.feed-post')[index].querySelectorAll('.action-count')[0];
                likeCount.textContent = this.formatCount(post.likes);
                
                this.showToast(post.isLiked ? 'Liked! â¤ï¸' : 'Unliked ðŸ’”', 1000);
            },
            
            // Show Comments
            showComments(index) {
                const post = this.state.feedPosts[index];
                this.loadComments(post.id);
                this.showModal('commentsModal');
            },
            
            // Load Comments
            loadComments(postId) {
                // Simulate loading comments
                const comments = [
                    {
                        id: 'comment_1',
                        user: 'User1',
                        avatar: 'ðŸ˜€',
                        text: 'Amazing challenge! ðŸ”¥',
                        timestamp: Date.now() - 3600000
                    },
                    {
                        id: 'comment_2',
                        user: 'User2',
                        avatar: 'ðŸ˜Ž',
                        text: 'I need to try this!',
                        timestamp: Date.now() - 7200000
                    },
                    {
                        id: 'comment_3',
                        user: 'User3',
                        avatar: 'ðŸ¤©',
                        text: 'You killed it! ðŸ’ª',
                        timestamp: Date.now() - 10800000
                    }
                ];
                
                const commentsList = document.getElementById('commentsList');
                commentsList.innerHTML = comments.map(comment => `
                    <div class="comment-item">
                        <div class="comment-avatar">${comment.avatar}</div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <span class="comment-author">${comment.user}</span>
                                <span class="comment-time">${this.getTimeAgo(comment.timestamp)}</span>
                            </div>
                            <div class="comment-text">${comment.text}</div>
                        </div>
                    </div>
                `).join('');
            },
            
            // Post Comment
            postComment() {
                const input = document.getElementById('commentInput');
                const text = input.value.trim();
                
                if (!text) return;
                
                // Add comment to UI
                const comment = {
                    id: 'comment_' + Date.now(),
                    user: this.state.userData.username,
                    avatar: this.state.userData.avatar,
                    text: text,
                    timestamp: Date.now()
                };
                
                const commentHTML = `
                    <div class="comment-item">
                        <div class="comment-avatar">${comment.avatar}</div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <span class="comment-author">${comment.user}</span>
                                <span class="comment-time">now</span>
                            </div>
                            <div class="comment-text">${comment.text}</div>
                        </div>
                    </div>
                `;
                
                document.getElementById('commentsList').insertAdjacentHTML('afterbegin', commentHTML);
                input.value = '';
                
                this.showToast('Comment posted! ðŸ’¬', 1500);
            },
            
            // Share Post
            sharePost(index) {
                const post = this.state.feedPosts[index];
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Check out this JomBro challenge!',
                        text: post.caption,
                        url: window.location.href
                    }).then(() => {
                        post.shares++;
                        this.updatePostStats(index);
                        this.showToast('Shared! ðŸ“¤', 1500);
                    }).catch(err => console.log('Share cancelled'));
                } else {
                    // Fallback
                    navigator.clipboard.writeText(window.location.href);
                    this.showToast('Link copied! ðŸ“‹', 1500);
                }
            },
            
            // Update Post Stats
            updatePostStats(index) {
                const post = this.state.feedPosts[index];
                const postElement = document.querySelectorAll('.feed-post')[index];
                
                const counts = postElement.querySelectorAll('.action-count');
                counts[0].textContent = this.formatCount(post.likes);
                counts[1].textContent = this.formatCount(post.comments);
                counts[2].textContent = this.formatCount(post.shares);
            },
            
            // Follow/Unfollow User
            toggleFollow(userId) {
                const isFollowing = this.state.following.includes(userId);
                
                if (isFollowing) {
                    this.state.following = this.state.following.filter(id => id !== userId);
                    this.showToast('Unfollowed', 1500);
                } else {
                    this.state.following.push(userId);
                    this.showToast('Following! ðŸ‘¥', 1500);
                }
            },
            
            // Switch Feed
            switchFeed(type) {
                this.state.feedType = type;
                
                // Update header tabs
                document.querySelectorAll('.header-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                event.target.classList.add('active');
                
                // Load appropriate feed
                if (type === 'live') {
                    this.loadLiveFeed();
                } else {
                    this.loadFeed();
                }
                
                this.showToast(`Switched to ${type} ðŸ“º`, 1000);
            },
            
            // Load Live Feed
            loadLiveFeed() {
                // Simulate live streams
                const liveStreams = [
                    {
                        id: 'live_1',
                        user: {
                            id: 'user_live_1',
                            name: 'Gaming Pro',
                            username: '@gamingpro',
                            avatar: 'ðŸŽ®',
                            verified: true
                        },
                        title: 'Epic Gaming Session!',
                        viewers: 2345,
                        thumbnail: 'https://picsum.photos/400/800?random=10',
                        isLive: true
                    }
                ];
                
                const feedContainer = document.getElementById('feedContainer');
                feedContainer.innerHTML = liveStreams.map(stream => `
                    <div class="feed-post">
                        <div class="post-media">
                            <img class="post-image loaded" src="${stream.thumbnail}" alt="${stream.title}">
                        </div>
                        <div class="live-badge">LIVE</div>
                        <div class="gradient-overlay-top"></div>
                        <div class="gradient-overlay-bottom"></div>
                        <div class="post-info">
                            <div class="post-user">${stream.user.name} ${stream.user.verified ? '<span class="verified-badge">âœ“</span>' : ''}</div>
                            <div class="post-caption">${stream.title}</div>
                            <div class="post-music">ðŸ‘ï¸ ${this.formatCount(stream.viewers)} watching</div>
                        </div>
                    </div>
                `).join('');
            },
            
            // Switch Navigation
            switchNav(page, element) {
                // Update active state
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                element.classList.add('active');
                
                // Hide all containers
                document.getElementById('feedContainer').style.display = 'none';
                document.getElementById('discoverContainer').style.display = 'none';
                
                // Show appropriate content
                switch(page) {
                    case 'home':
                        document.getElementById('feedContainer').style.display = 'block';
                        break;
                    case 'discover':
                        document.getElementById('discoverContainer').style.display = 'block';
                        this.loadDiscoverPage();
                        break;
                    case 'inbox':
                        this.showInbox();
                        break;
                }
            },
            
            // Load Discover Page
            loadDiscoverPage() {
                const discoverContainer = document.getElementById('discoverContainer');
                
                discoverContainer.innerHTML = `
                    <div class="trending-section">
                        <h2 class="section-title">ðŸ”¥ Trending Challenges</h2>
                        <div class="trending-grid">
                            ${this.state.aiChallenges.slice(0, 6).map((challenge, index) => `
                                <div class="trending-card" onclick="App.selectChallenge(${index})">
                                    <img class="trending-media" src="https://picsum.photos/200/200?random=${index + 20}" alt="${challenge.title}">
                                    <div class="trending-info">
                                        <div class="trending-title">${challenge.title}</div>
                                        <div class="trending-stats">
                                            <span>ðŸ‘¥ ${this.formatCount(challenge.participants)}</span>
                                            <span>ðŸ† ${challenge.reward} coins</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="trending-section">
                        <h2 class="section-title">â­ Daily Challenge</h2>
                        ${this.state.dailyChallenge ? `
                            <div class="challenge-card" onclick="App.selectDailyChallenge()">
                                <div class="challenge-header">
                                    <div>
                                        <div class="challenge-title">${this.state.dailyChallenge.title}</div>
                                        <div class="challenge-category">ðŸŽ¯ ${this.state.dailyChallenge.category}</div>
                                    </div>
                                    <div class="challenge-reward">ðŸª™ ${this.state.dailyChallenge.reward}</div>
                                </div>
                                <div class="challenge-description">${this.state.dailyChallenge.description}</div>
                                <div class="challenge-meta">
                                    <span>â±ï¸ ${Math.floor(this.state.dailyChallenge.expiresIn / 3600000)}h left</span>
                                    <span>ðŸ‘¥ ${this.formatCount(this.state.dailyChallenge.participants)} joined</span>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="trending-section">
                        <h2 class="section-title">ðŸ† Leaderboard</h2>
                        <button class="submit-btn" onclick="App.showLeaderboard()">View Full Leaderboard</button>
                    </div>
                    
                    <div class="trending-section">
                        <h2 class="section-title">ðŸŽ Rewards Shop</h2>
                        <button class="submit-btn" onclick="App.showShop()">Open Shop</button>
                    </div>
                `;
            },
            
            // Show Profile
            showProfile() {
                const profileContent = document.getElementById('profileContent');
                
                profileContent.innerHTML = `
                    <div class="profile-header">
                        <div class="profile-cover">
                            ${this.state.userData.cover ? 
                                `<img class="profile-cover-img" src="${this.state.userData.cover}" alt="Cover">` :
                                `<div class="profile-cover-default">ðŸŒ†</div>`
                            }
                            <button class="profile-cover-upload" onclick="document.getElementById('coverInput').click()">
                                ðŸ“· Edit Cover
                            </button>
                        </div>
                    </div>
                    
                    <div class="profile-info-section">
                        <div class="profile-avatar-section">
                            <div class="profile-avatar-large" onclick="document.getElementById('avatarInput').click()">
                                ${this.state.userData.avatar}
                                <div class="profile-avatar-edit">âœï¸</div>
                            </div>
                        </div>
                        
                        <div class="profile-name-section">
                            <h2 class="profile-username">${this.state.userData.username}</h2>
                            <p class="profile-bio">${this.state.userData.bio || 'No bio yet. Add one!'}</p>
                        </div>
                        
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-value">${this.formatCount(this.state.userData.followers)}</div>
                                <div class="stat-label">Followers</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${this.formatCount(this.state.userData.following)}</div>
                                <div class="stat-label">Following</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${this.formatCount(this.state.userData.posts)}</div>
                                <div class="stat-label">Posts</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${this.formatCount(this.state.userData.coins)}</div>
                                <div class="stat-label">Coins</div>
                            </div>
                        </div>
                        
                        <div class="profile-actions">
                            <button class="profile-btn primary" onclick="App.editProfile()">Edit Profile</button>
                            <button class="profile-btn" onclick="App.showSettings()">Settings</button>
                        </div>
                        
                        <div class="profile-tabs">
                            <button class="profile-tab active" onclick="App.switchProfileTab('posts', this)">Posts</button>
                            <button class="profile-tab" onclick="App.switchProfileTab('badges', this)">Badges</button>
                            <button class="profile-tab" onclick="App.switchProfileTab('liked', this)">Liked</button>
                        </div>
                        
                        <div id="profileTabContent">
                            <div class="posts-grid">
                                ${this.state.userPosts.length > 0 ? 
                                    this.state.userPosts.map(post => `
                                        <div class="grid-post">
                                            <img src="${post.thumbnail}" alt="${post.caption}">
                                            <div class="grid-post-overlay">
                                                <span>â¤ï¸ ${this.formatCount(post.likes)}</span>
                                                <span>ðŸ’¬ ${this.formatCount(post.comments)}</span>
                                            </div>
                                        </div>
                                    `).join('') :
                                    '<p style="text-align: center; padding: 40px; opacity: 0.6;">No posts yet. Start creating!</p>'
                                }
                            </div>
                        </div>
                    </div>
                `;
                
                this.showModal('profileModal');
            },
            
            // Edit Profile
            editProfile() {
                const editForm = document.getElementById('editProfileForm');
                
                editForm.innerHTML = `
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-input" id="editUsername" value="${this.state.userData.username}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Bio</label>
                        <textarea class="form-textarea" id="editBio" rows="3" placeholder="Tell us about yourself...">${this.state.userData.bio || ''}</textarea>
                    </div>
                    <button class="submit-btn" onclick="App.saveProfile()">Save Changes</button>
                `;
                
                this.showModal('editProfileModal');
            },
            
            // Save Profile
            saveProfile() {
                const username = document.getElementById('editUsername').value.trim();
                const bio = document.getElementById('editBio').value.trim();
                
                if (!username) {
                    this.showToast('Username is required!', 2000);
                    return;
                }
                
                this.state.userData.username = username;
                this.state.userData.bio = bio;
                
                this.saveData();
                this.closeModal('editProfileModal');
                this.showProfile();
                this.showToast('Profile updated! âœ¨', 2000);
            },
            
            // Switch Profile Tab
            switchProfileTab(tab, element) {
                // Update active state
                document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
                element.classList.add('active');
                
                const content = document.getElementById('profileTabContent');
                
                switch(tab) {
                    case 'posts':
                        content.innerHTML = `
                            <div class="posts-grid">
                                ${this.state.userPosts.length > 0 ? 
                                    this.state.userPosts.map(post => `
                                        <div class="grid-post">
                                            <img src="${post.thumbnail}" alt="${post.caption}">
                                            <div class="grid-post-overlay">
                                                <span>â¤ï¸ ${this.formatCount(post.likes)}</span>
                                                <span>ðŸ’¬ ${this.formatCount(post.comments)}</span>
                                            </div>
                                        </div>
                                    `).join('') :
                                    '<p style="text-align: center; padding: 40px; opacity: 0.6;">No posts yet. Start creating!</p>'
                                }
                            </div>
                        `;
                        break;
                        
                    case 'badges':
                        content.innerHTML = `
                            <div class="badges-grid">
                                <div class="badge-item unlocked">
                                    <div class="badge-icon">ðŸŒŸ</div>
                                    <div class="badge-name">Starter</div>
                                    <div class="badge-description">Welcome to JomBro!</div>
                                </div>
                                <div class="badge-item unlocked">
                                    <div class="badge-icon">ðŸ”¥</div>
                                    <div class="badge-name">First Challenge</div>
                                    <div class="badge-description">Complete your first challenge</div>
                                </div>
                                <div class="badge-item locked">
                                    <div class="badge-icon">ðŸ†</div>
                                    <div class="badge-name">Champion</div>
                                    <div class="badge-description">Win 10 challenges</div>
                                </div>
                                <div class="badge-item locked">
                                    <div class="badge-icon">ðŸ’Ž</div>
                                    <div class="badge-name">Elite</div>
                                    <div class="badge-description">Reach level 50</div>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'liked':
                        content.innerHTML = `
                            <div class="posts-grid">
                                <p style="text-align: center; padding: 40px; opacity: 0.6;">Your liked videos will appear here</p>
                            </div>
                        `;
                        break;
                }
            },
            
            // Show Settings
            showSettings() {
                const settingsContent = document.getElementById('settingsContent');
                
                settingsContent.innerHTML = `
                    <div class="settings-section">
                        <h3 class="settings-title">Account</h3>
                        <div class="settings-item">
                            <div class="settings-label">
                                <span>ðŸ””</span>
                                <span>Push Notifications</span>
                            </div>
                            <div class="toggle-switch ${this.state.userSettings.notifications ? 'active' : ''}" onclick="App.toggleSetting('notifications', this)"></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">
                                <span>ðŸŽ¥</span>
                                <span>Autoplay Videos</span>
                            </div>
                            <div class="toggle-switch ${this.state.userSettings.autoplay ? 'active' : ''}" onclick="App.toggleSetting('autoplay', this)"></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">
                                <span>ðŸŒ™</span>
                                <span>Dark Mode</span>
                            </div>
                            <div class="toggle-switch ${this.state.userSettings.theme === 'dark' ? 'active' : ''}" onclick="App.toggleTheme(this)"></div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3 class="settings-title">Privacy</h3>
                        <div class="settings-item" onclick="App.showPrivacySettings()">
                            <div class="settings-label">
                                <span>ðŸ”’</span>
                                <span>Privacy Settings</span>
                            </div>
                            <span>â†’</span>
                        </div>
                        <div class="settings-item" onclick="App.showBlockedUsers()">
                            <div class="settings-label">
                                <span>ðŸš«</span>
                                <span>Blocked Users</span>
                            </div>
                            <span>â†’</span>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3 class="settings-title">Support</h3>
                        <div class="settings-item" onclick="App.showHelp()">
                            <div class="settings-label">
                                <span>â“</span>
                                <span>Help & Support</span>
                            </div>
                            <span>â†’</span>
                        </div>
                        <div class="settings-item" onclick="App.showAbout()">
                            <div class="settings-label">
                                <span>â„¹ï¸</span>
                                <span>About JomBro</span>
                            </div>
                            <span>â†’</span>
                        </div>
                    </div>
                    
                    <button class="submit-btn" style="background: #ff4444; margin-top: 20px;" onclick="App.logout()">Logout</button>
                `;
                
                this.showModal('settingsModal');
            },
            
            // Toggle Setting
            toggleSetting(setting, element) {
                this.state.userSettings[setting] = !this.state.userSettings[setting];
                element.classList.toggle('active');
                this.saveUserSettings();
                this.showToast(`${setting} ${this.state.userSettings[setting] ? 'enabled' : 'disabled'}`, 1500);
            },
            
            // Toggle Theme
            toggleTheme(element) {
                const newTheme = this.state.userSettings.theme === 'dark' ? 'light' : 'dark';
                this.state.userSettings.theme = newTheme;
                this.applyTheme(newTheme);
                element.classList.toggle('active');
                this.saveUserSettings();
                this.showToast(`${newTheme === 'dark' ? 'ðŸŒ™ Dark' : 'â˜€ï¸ Light'} mode enabled`, 1500);
            },
            
            // Apply Theme
            applyTheme(theme) {
                document.body.setAttribute('data-theme', theme);
            },
            
            // Camera Functions
            async openCamera() {
                // First show challenge selection
                this.loadChallenges();
                this.showModal('challengeModal');
            },
            
            // Load Challenges
            loadChallenges() {
                const challengeList = document.getElementById('challengeList');
                
                const allChallenges = [
                    this.state.dailyChallenge,
                    ...this.state.aiChallenges
                ].filter(Boolean);
                
                challengeList.innerHTML = allChallenges.map((challenge, index) => `
                    <div class="challenge-card" onclick="App.selectChallengeAndRecord(${index})">
                        <div class="challenge-header">
                            <div>
                                <div class="challenge-title">${challenge.title}</div>
                                <div class="challenge-category">${this.getCategoryIcon(challenge.category)} ${challenge.category}</div>
                            </div>
                            <div class="challenge-reward">ðŸª™ ${challenge.reward}</div>
                        </div>
                        <div class="challenge-description">${challenge.description}</div>
                        <div class="challenge-meta">
                            <span>â±ï¸ ${challenge.timeLimit}s</span>
                            <span>ðŸ‘¥ ${this.formatCount(challenge.participants)} joined</span>
                            <span>ðŸ… ${challenge.difficulty}</span>
                        </div>
                    </div>
                `).join('');
            },
            
            // Get Category Icon
            getCategoryIcon(category) {
                const icons = {
                    fitness: 'ðŸ’ª',
                    creative: 'ðŸŽ¨',
                    social: 'ðŸ‘¥',
                    food: 'ðŸ”',
                    gaming: 'ðŸŽ®'
                };
                return icons[category] || 'ðŸ†';
            },
            
            // Select Challenge and Record
            selectChallengeAndRecord(index) {
                const allChallenges = [
                    this.state.dailyChallenge,
                    ...this.state.aiChallenges
                ].filter(Boolean);
                
                this.state.selectedChallenge = allChallenges[index];
                this.closeModal('challengeModal');
                this.startCamera();
            },
            
            // Start Camera
            async startCamera() {
                this.showModal('cameraModal');
                
                try {
                    const constraints = {
                        video: {
                            facingMode: this.state.currentCamera,
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        },
                        audio: true
                    };
                    
                    this.state.currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                    const video = document.getElementById('cameraVideo');
                    video.srcObject = this.state.currentStream;
                    
                } catch (error) {
                    console.error('Camera access error:', error);
                    this.showToast('Camera access denied', 3000);
                    this.closeModal('cameraModal');
                }
            },
            
            // Close Camera
            closeCamera() {
                if (this.state.currentStream) {
                    this.state.currentStream.getTracks().forEach(track => track.stop());
                    this.state.currentStream = null;
                }
                
                if (this.state.isRecording) {
                    this.stopRecording();
                }
                
                this.closeModal('cameraModal');
            },
            
            // Flip Camera
            async flipCamera() {
                this.state.currentCamera = this.state.currentCamera === 'user' ? 'environment' : 'user';
                
                if (this.state.currentStream) {
                    this.state.currentStream.getTracks().forEach(track => track.stop());
                }
                
                await this.startCamera();
            },
            
            // Toggle Recording
            toggleRecording() {
                if (this.state.isRecording) {
                    this.stopRecording();
                } else {
                    this.startRecording();
                }
            },
            
            // Start Recording
            startRecording() {
                const video = document.getElementById('cameraVideo');
                const recordBtn = document.getElementById('recordBtn');
                
                this.state.recordedChunks = [];
                
                const options = {
                    mimeType: 'video/webm;codecs=vp9',
                    videoBitsPerSecond: 2500000
                };
                
                try {
                    this.state.mediaRecorder = new MediaRecorder(this.state.currentStream, options);
                    
                    this.state.mediaRecorder.ondataavailable = (event) => {
                        if (event.data && event.data.size > 0) {
                            this.state.recordedChunks.push(event.data);
                        }
                    };
                    
                    this.state.mediaRecorder.onstop = () => {
                        this.handleRecordingComplete();
                    };
                    
                    this.state.mediaRecorder.start();
                    this.state.isRecording = true;
                    this.state.recordingStartTime = Date.now();
                    
                    recordBtn.classList.add('recording');
                    document.getElementById('recordTimer').style.display = 'block';
                    
                    this.updateRecordingTimer();
                    
                } catch (error) {
                    console.error('Recording error:', error);
                    this.showToast('Recording failed', 3000);
                }
            },
            
            // Stop Recording
            stopRecording() {
                if (this.state.mediaRecorder && this.state.isRecording) {
                    this.state.mediaRecorder.stop();
                    this.state.isRecording = false;
                    
                    const recordBtn = document.getElementById('recordBtn');
                    recordBtn.classList.remove('recording');
                    document.getElementById('recordTimer').style.display = 'none';
                    
                    if (this.state.recordingTimer) {
                        clearInterval(this.state.recordingTimer);
                    }
                }
            },
            
            // Update Recording Timer
            updateRecordingTimer() {
                this.state.recordingTimer = setInterval(() => {
                    if (!this.state.isRecording) {
                        clearInterval(this.state.recordingTimer);
                        return;
                    }
                    
                    const elapsed = Date.now() - this.state.recordingStartTime;
                    const seconds = Math.floor(elapsed / 1000);
                    const minutes = Math.floor(seconds / 60);
                    const displaySeconds = seconds % 60;
                    
                    document.getElementById('recordTimer').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${displaySeconds.toString().padStart(2, '0')}`;
                    
                    // Auto-stop at 60 seconds
                    if (seconds >= 60) {
                        this.stopRecording();
                    }
                }, 100);
            },
            
            // Handle Recording Complete
            handleRecordingComplete() {
                const blob = new Blob(this.state.recordedChunks, { type: 'video/webm' });
                const url = URL.createObjectURL(blob);
                
                // Show recorded video
                const cameraVideo = document.getElementById('cameraVideo');
                const recordedVideo = document.getElementById('recordedVideo');
                
                cameraVideo.style.display = 'none';
                recordedVideo.style.display = 'block';
                recordedVideo.src = url;
                recordedVideo.play();
                
                // Stop camera stream
                if (this.state.currentStream) {
                    this.state.currentStream.getTracks().forEach(track => track.stop());
                }
                
                // Show upload modal
                setTimeout(() => {
                    this.closeModal('cameraModal');
                    this.showPostUpload(blob);
                }, 1000);
            },
            
            // Show Post Upload
            showPostUpload(videoBlob) {
                this.state.currentUploadFile = videoBlob;
                
                // Show selected challenge
                if (this.state.selectedChallenge) {
                    const challengeCard = document.getElementById('selectedChallengeCard');
                    challengeCard.innerHTML = `
                        <div class="challenge-header">
                            <div>
                                <div class="challenge-title">${this.state.selectedChallenge.title}</div>
                                <div class="challenge-category">${this.getCategoryIcon(this.state.selectedChallenge.category)} ${this.state.selectedChallenge.category}</div>
                            </div>
                            <div class="challenge-reward">ðŸª™ ${this.state.selectedChallenge.reward}</div>
                        </div>
                        <div class="challenge-description">${this.state.selectedChallenge.description}</div>
                    `;
                }
                
                this.showModal('postUploadModal');
            },
            
            // Upload Post
            async uploadPost() {
                const caption = document.getElementById('postCaption').value.trim();
                const privacy = document.getElementById('postPrivacy').value;
                
                if (!caption) {
                    this.showToast('Please add a caption!', 2000);
                    return;
                }
                
                this.showLoading('Uploading your challenge...');
                
                // Simulate upload
                setTimeout(() => {
                    // Add to user posts
                    const newPost = {
                        id: 'post_' + Date.now(),
                        caption: caption,
                        challenge: this.state.selectedChallenge,
                        privacy: privacy,
                        thumbnail: 'https://picsum.photos/400/800?random=' + Date.now(),
                        likes: 0,
                        comments: 0,
                        shares: 0,
                        timestamp: Date.now()
                    };
                    
                    this.state.userPosts.unshift(newPost);
                    this.state.userData.posts++;
                    
                    // Award coins for completing challenge
                    if (this.state.selectedChallenge) {
                        this.state.userData.coins += this.state.selectedChallenge.reward;
                        this.state.completedChallenges.add(this.state.selectedChallenge.id);
                    }
                    
                    this.saveData();
                    this.hideLoading();
                    this.closeModal('postUploadModal');
                    
                    this.showToast('Challenge completed! ðŸŽ‰ +' + this.state.selectedChallenge.reward + ' coins', 3000);
                    
                    // Reset
                    this.state.selectedChallenge = null;
                    this.state.currentUploadFile = null;
                    
                }, 2000);
            },
            
            // Gallery Upload
            handleGalleryUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (file.type.startsWith('video/') || file.type.startsWith('image/')) {
                    this.showPostUpload(file);
                } else {
                    this.showToast('Please select a video or image', 2000);
                }
            },
            
            // Avatar Upload
            handleAvatarUpload(event) {
                const file = event.target.files[0];
                if (!file || !file.type.startsWith('image/')) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.state.userData.avatar = `<img src="${e.target.result}" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">`;
                    this.saveData();
                    this.showProfile();
                    this.showToast('Avatar updated! ðŸ“¸', 2000);
                };
                reader.readAsDataURL(file);
            },
            
            // Cover Upload
            handleCoverUpload(event) {
                const file = event.target.files[0];
                if (!file || !file.type.startsWith('image/')) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.state.userData.cover = e.target.result;
                    this.saveData();
                    this.showProfile();
                    this.showToast('Cover updated! ðŸ–¼ï¸', 2000);
                };
                reader.readAsDataURL(file);
            },
            
            // Show Search
            showSearch() {
                this.showModal('searchModal');
                document.getElementById('searchInput').focus();
            },
            
            // Perform Search
            performSearch() {
                const query = document.getElementById('searchInput').value.toLowerCase().trim();
                
                if (!query) {
                    document.getElementById('searchResults').innerHTML = `
                        <div class="search-section">
                            <h3>Recent Searches</h3>
                            ${this.state.recentSearches.map(search => `
                                <div class="search-result-item" onclick="App.searchFor('${search}')">
                                    <div class="search-avatar">ðŸ”</div>
                                    <div class="search-info">
                                        <div class="search-name">${search}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    return;
                }
                
                // Save recent search
                this.saveRecentSearch(query);
                
                // Simulate search results
                const results = {
                    users: [
                        { name: 'John Doe', username: '@johndoe', avatar: 'ðŸ‘¨' },
                        { name: 'Jane Smith', username: '@janesmith', avatar: 'ðŸ‘©' }
                    ],
                    challenges: this.state.aiChallenges.filter(c => 
                        c.title.toLowerCase().includes(query) || 
                        c.category.toLowerCase().includes(query)
                    )
                };
                
                document.getElementById('searchResults').innerHTML = `
                    ${results.users.length > 0 ? `
                        <div class="search-section">
                            <h3>Users</h3>
                            ${results.users.map(user => `
                                <div class="search-result-item">
                                    <div class="search-avatar">${user.avatar}</div>
                                    <div class="search-info">
                                        <div class="search-name">${user.name}</div>
                                        <div class="search-username">${user.username}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${results.challenges.length > 0 ? `
                        <div class="search-section">
                            <h3>Challenges</h3>
                            ${results.challenges.map(challenge => `
                                <div class="search-result-item" onclick="App.selectChallenge(${this.state.aiChallenges.indexOf(challenge)})">
                                    <div class="search-avatar">ðŸ†</div>
                                    <div class="search-info">
                                        <div class="search-name">${challenge.title}</div>
                                        <div class="search-username">${challenge.category} â€¢ ${challenge.reward} coins</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${results.users.length === 0 && results.challenges.length === 0 ? `
                        <p style="text-align: center; padding: 40px; opacity: 0.6;">No results found for "${query}"</p>
                    ` : ''}
                `;
            },
            
            // Search For
            searchFor(query) {
                document.getElementById('searchInput').value = query;
                this.performSearch();
            },
            
            // Show Notifications
            showNotifications() {
                const notificationsList = document.getElementById('notificationsList');
                
                notificationsList.innerHTML = this.state.notifications.length > 0 ?
                    this.state.notifications.map(notif => `
                        <div class="notification-item ${notif.read ? '' : 'unread'}">
                            <div class="notification-icon">
                                ${this.getNotificationIcon(notif.type)}
                            </div>
                            <div class="notification-content">
                                <div class="notification-text">
                                    <strong>${notif.user}</strong> ${notif.content}
                                </div>
                                <div class="notification-time">${this.getTimeAgo(notif.timestamp)}</div>
                            </div>
                        </div>
                    `).join('') :
                    '<p style="text-align: center; padding: 40px; opacity: 0.6;">No notifications yet</p>';
                
                // Mark all as read
                this.state.notifications.forEach(notif => notif.read = true);
                this.state.unreadNotifications = 0;
                this.updateNotificationBadge();
                
                this.showModal('notificationsModal');
            },
            
            // Get Notification Icon
            getNotificationIcon(type) {
                const icons = {
                    like: 'â¤ï¸',
                    comment: 'ðŸ’¬',
                    follow: 'ðŸ‘¥',
                    mention: '@',
                    challenge: 'ðŸ†'
                };
                return icons[type] || 'ðŸ””';
            },
            
            // Update Notification Badge
            updateNotificationBadge() {
                const badge = document.getElementById('notificationBadge');
                const unread = this.state.notifications.filter(n => !n.read).length;
                
                if (unread > 0) {
                    badge.textContent = unread > 99 ? '99+' : unread;
                    badge.style.display = 'block';
                } else {
                    badge.style.display = 'none';
                }
            },
            
            // Show Inbox
            showInbox() {
                const chatList = document.getElementById('chatList');
                
                chatList.innerHTML = this.state.conversations.length > 0 ?
                    this.state.conversations.map(conv => `
                        <div class="chat-item" onclick="App.openChat('${conv.id}')">
                            <div class="chat-avatar">
                                ${conv.user.avatar}
                                ${conv.user.isOnline ? '<div class="online-indicator"></div>' : ''}
                            </div>
                            <div class="chat-info">
                                <div class="chat-name">${conv.user.name}</div>
                                <div class="chat-preview">${conv.lastMessage}</div>
                            </div>
                            <div class="chat-meta">
                                <div class="chat-time">${this.getTimeAgo(conv.timestamp)}</div>
                                ${conv.unread > 0 ? `<div class="unread-badge">${conv.unread}</div>` : ''}
                            </div>
                        </div>
                    `).join('') :
                    '<p style="text-align: center; padding: 40px; opacity: 0.6;">No conversations yet</p>';
                
                this.showModal('inboxModal');
            },
            
            // Open Chat
            openChat(conversationId) {
                const conversation = this.state.conversations.find(c => c.id === conversationId);
                if (!conversation) return;
                
                this.state.currentChat = conversation;
                
                document.getElementById('chatUserName').textContent = conversation.user.name;
                document.getElementById('chatUserStatus').textContent = conversation.user.isOnline ? 'Online' : 'Offline';
                
                // Load messages
                this.loadChatMessages();
                
                // Mark as read
                conversation.unread = 0;
                
                document.getElementById('chatWindow').style.display = 'flex';
                this.closeModal('inboxModal');
            },
            
            // Load Chat Messages
            loadChatMessages() {
                const messagesContainer = document.getElementById('chatMessages');
                
                // Simulate messages
                const messages = [
                    {
                        id: 'msg_1',
                        text: 'Hey! Want to collab?',
                        sent: false,
                        timestamp: Date.now() - 3600000
                    },
                    {
                        id: 'msg_2',
                        text: 'Sure! What challenge?',
                        sent: true,
                        timestamp: Date.now() - 3000000
                    },
                    {
                        id: 'msg_3',
                        text: 'How about the dance battle?',
                        sent: false,
                        timestamp: Date.now() - 2400000
                    }
                ];
                
                messagesContainer.innerHTML = messages.map(msg => `
                    <div class="message ${msg.sent ? 'sent' : 'received'}">
                        ${msg.text}
                        <div class="message-time">${this.getTimeAgo(msg.timestamp)}</div>
                    </div>
                `).join('');
                
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            },
            
            // Send Message
            sendMessage() {
                const input = document.getElementById('chatInput');
                const text = input.value.trim();
                
                if (!text) return;
                
                const message = {
                    id: 'msg_' + Date.now(),
                    text: text,
                    sent: true,
                    timestamp: Date.now()
                };
                
                const messageHTML = `
                    <div class="message sent">
                        ${text}
                        <div class="message-time">now</div>
                    </div>
                `;
                
                document.getElementById('chatMessages').insertAdjacentHTML('beforeend', messageHTML);
                input.value = '';
                
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Simulate reply
                setTimeout(() => {
                    const replyHTML = `
                        <div class="message received">
                            Sounds great! Let's do it!
                            <div class="message-time">now</div>
                        </div>
                    `;
                    document.getElementById('chatMessages').insertAdjacentHTML('beforeend', replyHTML);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }, 2000);
            },
            
            // Close Chat
            closeChat() {
                document.getElementById('chatWindow').style.display = 'none';
                this.state.currentChat = null;
            },
            
            // Show Leaderboard
            showLeaderboard() {
                this.loadLeaderboard('global');
                this.showModal('leaderboardModal');
            },
            
            // Switch Leaderboard
            switchLeaderboard(type, element) {
                // Update active state
                document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                element.classList.add('active');
                
                this.loadLeaderboard(type);
            },
            
            // Load Leaderboard
            loadLeaderboard(type) {
                const leaderboardList = document.getElementById('leaderboardList');
                const data = this.state.leaderboard[type] || this.state.leaderboard.global;
                
                leaderboardList.innerHTML = data.map((user, index) => `
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank ${index < 3 ? ['gold', 'silver', 'bronze'][index] : ''}">
                            ${user.rank}
                        </div>
                        <div class="leaderboard-avatar">${user.avatar}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${user.user}</div>
                            <div class="leaderboard-stats">${user.completions} challenges completed</div>
                        </div>
                        <div class="leaderboard-score">
                            ${this.formatCount(user.score)}
                        </div>
                    </div>
                `).join('');
            },
            
            // Show Shop
            showShop() {
                this.updateShopBalance();
                this.loadShopItems('all');
                this.showModal('shopModal');
            },
            
            // Update Shop Balance
            updateShopBalance() {
                document.getElementById('shopBalance').textContent = `ðŸª™ ${this.formatCount(this.state.userData.coins)}`;
            },
            
            // Switch Shop Category
            switchShopCategory(category, element) {
                // Update active state
                document.querySelectorAll('.shop-category').forEach(cat => {
                    cat.classList.remove('active');
                });
                element.classList.add('active');
                
                this.loadShopItems(category);
            },
            
            // Load Shop Items
            loadShopItems(category) {
                const shopItemsContainer = document.getElementById('shopItems');
                
                let items = this.state.shopItems;
                if (category !== 'all') {
                    items = items.filter(item => item.type === category);
                }
                
                shopItemsContainer.innerHTML = items.map(item => `
                    <div class="shop-item" onclick="App.purchaseItem('${item.id}')">
                        <div class="shop-item-icon">${item.icon}</div>
                        <div class="shop-item-name">${item.name}</div>
                        <div class="shop-item-price">ðŸª™ ${item.price}</div>
                    </div>
                `).join('');
            },
            
            // Purchase Item
            purchaseItem(itemId) {
                const item = this.state.shopItems.find(i => i.id === itemId);
                if (!item) return;
                
                if (this.state.userData.coins < item.price) {
                    this.showToast('Not enough coins! Complete more challenges ðŸ’ª', 2000);
                    return;
                }
                
                // Deduct coins
                this.state.userData.coins -= item.price;
                this.state.purchasedItems.push(itemId);
                
                this.saveData();
                this.updateShopBalance();
                
                this.showToast(`Purchased ${item.name}! ðŸŽ‰`, 2000);
                
                // Apply item if it's an avatar
                if (item.type === 'avatar') {
                    this.state.userData.avatar = item.icon;
                    this.saveData();
                }
            },
            
            // Show Create Options
            showCreateOptions() {
                this.showModal('createOptionsModal');
            },
            
            // Go Live
            async goLive() {
                this.closeModal('createOptionsModal');
                this.showModal('liveSetupModal');
                
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                    document.getElementById('livePreview').srcObject = stream;
                    this.state.liveStream = stream;
                } catch (error) {
                    console.error('Camera access error:', error);
                    this.showToast('Camera access denied', 3000);
                    this.closeModal('liveSetupModal');
                }
            },
            
            // Start Live
            startLive() {
                const title = document.getElementById('liveTitle').value.trim();
                const category = document.getElementById('liveCategory').value;
                
                if (!title) {
                    this.showToast('Please add a title!', 2000);
                    return;
                }
                
                this.state.isLive = true;
                this.closeModal('liveSetupModal');
                
                this.showToast('You are now LIVE! ðŸ”´', 3000);
                
                // Simulate viewers joining
                setInterval(() => {
                    if (this.state.isLive) {
                        this.state.liveViewers += Math.floor(Math.random() * 10);
                    }
                }, 5000);
            },
            
            // Show Collab
            showCollab() {
                this.closeModal('createOptionsModal');
                this.showModal('collabModal');
            },
            
            // Start Duet
            startDuet() {
                this.closeModal('collabModal');
                this.showToast('Select a video to duet with', 2000);
                // Would implement video selection
            },
            
            // Start React
            startReact() {
                this.closeModal('collabModal');
                this.showToast('Select a video to react to', 2000);
                // Would implement video selection
            },
            
            // Start Stitch
            startStitch() {
                this.closeModal('collabModal');
                this.showToast('Select a video to stitch', 2000);
                // Would implement video selection
            },
            
            // Show Friend Tag
            showFriendTag() {
                const friendList = document.getElementById('friendList');
                
                // Simulate friends list
                const friends = [
                    { id: 'friend_1', name: 'Sarah Chen', avatar: 'ðŸ‘©' },
                    { id: 'friend_2', name: 'Mike Johnson', avatar: 'ðŸ‘¨' },
                    { id: 'friend_3', name: 'Emma Wilson', avatar: 'ðŸ‘±â€â™€ï¸' }
                ];
                
                friendList.innerHTML = friends.map(friend => `
                    <div class="friend-item ${this.state.selectedFriends.has(friend.id) ? 'selected' : ''}" 
                         onclick="App.toggleFriendSelection('${friend.id}')">
                        <div class="friend-checkbox">
                            ${this.state.selectedFriends.has(friend.id) ? 'âœ“' : ''}
                        </div>
                        <div class="search-avatar">${friend.avatar}</div>
                        <div class="search-info">
                            <div class="search-name">${friend.name}</div>
                        </div>
                    </div>
                `).join('');
                
                this.showModal('friendTagModal');
            },
            
            // Toggle Friend Selection
            toggleFriendSelection(friendId) {
                if (this.state.selectedFriends.has(friendId)) {
                    this.state.selectedFriends.delete(friendId);
                } else {
                    this.state.selectedFriends.add(friendId);
                }
                
                // Update UI
                const friendItem = event.currentTarget;
                friendItem.classList.toggle('selected');
                
                const checkbox = friendItem.querySelector('.friend-checkbox');
                checkbox.textContent = this.state.selectedFriends.has(friendId) ? 'âœ“' : '';
            },
            
            // Confirm Friend Tags
            confirmFriendTags() {
                const count = this.state.selectedFriends.size;
                document.getElementById('taggedFriendsText').textContent = 
                    count > 0 ? `${count} friends tagged` : 'Select friends to tag...';
                
                this.closeModal('friendTagModal');
                this.showToast(`Tagged ${count} friends! ðŸ‘¥`, 1500);
            },
            
            // Select Challenge
            selectChallenge(index) {
                this.state.selectedChallenge = this.state.aiChallenges[index];
                this.closeModal('searchModal');
                this.openCamera();
            },
            
            // Select Daily Challenge
            selectDailyChallenge() {
                this.state.selectedChallenge = this.state.dailyChallenge;
                this.openCamera();
            },
            
            // Show Help
            showHelp() {
                this.showModal('helpModal');
            },
            
            // Show About
            showAbout() {
                this.showToast('JomBro v1.0 - Made with â¤ï¸ in Malaysia', 3000);
            },
            
            // Logout
            logout() {
                if (confirm('Are you sure you want to logout?')) {
                    // Clear user data
                    this.state.currentUser = null;
                    localStorage.removeItem('currentUser');
                    
                    // Reload app
                    location.reload();
                }
            },
            
            // Show Tutorial
            showTutorial() {
                const tutorials = [
                    {
                        icon: 'ðŸŽ®',
                        title: 'Welcome to JomBro!',
                        text: 'Complete fun challenges, earn rewards, and have a great time!'
                    },
                    {
                        icon: 'ðŸ“¹',
                        title: 'Record Challenges',
                        text: 'Press the + button to record yourself completing challenges'
                    },
                    {
                        icon: 'ðŸ†',
                        title: 'Earn Rewards',
                        text: 'Complete challenges to earn coins and unlock cool items!'
                    },
                    {
                        icon: 'ðŸ‘¥',
                        title: 'Connect with Friends',
                        text: 'Follow friends, collaborate, and compete on the leaderboard!'
                    }
                ];
                
                let currentStep = 0;
                
                const showStep = () => {
                    if (currentStep >= tutorials.length) {
                        document.body.removeChild(document.querySelector('.tutorial-overlay'));
                        this.state.isFirstTime = false;
                        localStorage.setItem('hasVisitedJomBro', 'true');
                        return;
                    }
                    
                    const tutorial = tutorials[currentStep];
                    const overlay = document.querySelector('.tutorial-overlay') || document.createElement('div');
                    overlay.className = 'tutorial-overlay';
                    
                    overlay.innerHTML = `
                        <div class="tutorial-content">
                            <div class="tutorial-icon">${tutorial.icon}</div>
                            <h2 class="tutorial-title">${tutorial.title}</h2>
                            <p class="tutorial-text">${tutorial.text}</p>
                            <div class="tutorial-dots">
                                ${tutorials.map((_, i) => `
                                    <div class="tutorial-dot ${i === currentStep ? 'active' : ''}"></div>
                                `).join('')}
                            </div>
                            <button class="tutorial-btn" onclick="App.nextTutorial()">
                                ${currentStep === tutorials.length - 1 ? "Let's Go!" : 'Next'}
                            </button>
                        </div>
                    `;
                    
                    if (!document.querySelector('.tutorial-overlay')) {
                        document.body.appendChild(overlay);
                    }
                };
                
                window.App.nextTutorial = () => {
                    currentStep++;
                    showStep();
                };
                
                showStep();
            },
            
            // Modal Functions
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                modal.classList.add('show');
                this.state.isModalOpen = true;
                this.state.activeModal = modalId;
            },
            
            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                modal.classList.remove('show');
                this.state.isModalOpen = false;
                this.state.activeModal = null;
            },
            
            // Show/Hide Loading
            showLoading(message = 'Loading...') {
                const spinner = document.getElementById('loadingSpinner');
                spinner.style.display = 'block';
                
                if (message) {
                    const msgElement = spinner.querySelector('.loading-message') || document.createElement('div');
                    msgElement.className = 'loading-message';
                    msgElement.textContent = message;
                    if (!spinner.contains(msgElement)) {
                        spinner.appendChild(msgElement);
                    }
                }
            },
            
            hideLoading() {
                document.getElementById('loadingSpinner').style.display = 'none';
            },
            
            // Show Toast
            showToast(message, duration = 2000, type = 'info') {
                const existingToast = document.querySelector('.toast');
                if (existingToast) {
                    existingToast.remove();
                }
                
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.innerHTML = `
                    ${message}
                    <button class="toast-close" onclick="this.parentElement.remove()">Ã—</button>
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        toast.remove();
                    }
                }, duration);
            },
            
            // Time Formatting
            getTimeAgo(timestamp) {
                const seconds = Math.floor((Date.now() - timestamp) / 1000);
                
                if (seconds < 60) return 'now';
                if (seconds < 3600) return Math.floor(seconds / 60) + 'm';
                if (seconds < 86400) return Math.floor(seconds / 3600) + 'h';
                if (seconds < 604800) return Math.floor(seconds / 86400) + 'd';
                
                return new Date(timestamp).toLocaleDateString();
            },
            
            // Update View Count
            updateViewCount(index) {
                if (!this.state.viewedPosts.has(index)) {
                    this.state.viewedPosts.add(index);
                    if (this.state.feedPosts[index]) {
                        this.state.feedPosts[index].views++;
                    }
                }
            },
            
            // Handle Back Button
            handleBackButton(event) {
                if (this.state.isModalOpen && this.state.activeModal) {
                    event.preventDefault();
                    this.closeModal(this.state.activeModal);
                } else if (document.getElementById('chatWindow').style.display !== 'none') {
                    event.preventDefault();
                    this.closeChat();
                }
            },
            
            // Handle Visibility Change
            handleVisibilityChange() {
                if (document.hidden) {
                    // Pause all videos
                    document.querySelectorAll('video').forEach(video => {
                        if (!video.paused) {
                            video.pause();
                        }
                    });
                }
            },
            
            // Handle Keyboard
            handleKeyboard(event) {
                // Space to pause/play
                if (event.code === 'Space' && !this.state.isModalOpen) {
                    event.preventDefault();
                    const currentPost = document.querySelectorAll('.feed-post')[this.state.currentPostIndex];
                    const video = currentPost?.querySelector('.post-video');
                    if (video) {
                        if (video.paused) {
                            video.play();
                        } else {
                            video.pause();
                        }
                    }
                }
                
                // Arrow keys for navigation
                if (!this.state.isModalOpen) {
                    if (event.code === 'ArrowDown') {
                        event.preventDefault();
                        this.nextPost();
                    } else if (event.code === 'ArrowUp') {
                        event.preventDefault();
                        this.previousPost();
                    }
                }
            },
            
            // Handle Resize
            handleResize() {
                // Update UI based on new dimensions
                if (window.innerWidth > 480) {
                    document.body.style.maxWidth = '480px';
                }
            },
            
            // Handle Orientation Change
            handleOrientationChange() {
                // Adjust UI for orientation
                this.showToast(`Rotated to ${window.orientation === 0 ? 'portrait' : 'landscape'}`, 1000);
            },
            
            // Save Data
            saveData() {
                try {
                    if (this.state.currentUser) {
                        localStorage.setItem('currentUser', JSON.stringify(this.state.currentUser));
                    }
                    if (this.state.userData) {
                        localStorage.setItem('userProfile', JSON.stringify(this.state.userData));
                    }
                    localStorage.setItem('completedChallenges', JSON.stringify(Array.from(this.state.completedChallenges)));
                    this.saveUserPosts();
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            },
            
            // Load Saved Data
            loadSavedData() {
                try {
                    const savedUser = localStorage.getItem('currentUser');
                    if (savedUser) {
                        this.state.currentUser = JSON.parse(savedUser);
                    }
                    
                    const savedProfile = localStorage.getItem('userProfile');
                    if (savedProfile) {
                        this.state.userData = { ...this.state.userData, ...JSON.parse(savedProfile) };
                    }
                    
                    const completedChallenges = localStorage.getItem('completedChallenges');
                    if (completedChallenges) {
                        this.state.completedChallenges = new Set(JSON.parse(completedChallenges));
                    }
                    
                    this.loadUserPosts();
                    this.loadUserSettings();
                    this.loadRecentSearches();
                } catch (error) {
                    console.error('Error loading saved data:', error);
                }
            },
            
            // Save User Posts
            saveUserPosts() {
                try {
                    localStorage.setItem('userPosts', JSON.stringify(this.state.userPosts));
                } catch (error) {
                    console.error('Error saving user posts:', error);
                }
            },
            
            // Load User Posts
            loadUserPosts() {
                try {
                    const savedPosts = localStorage.getItem('userPosts');
                    if (savedPosts) {
                        this.state.userPosts = JSON.parse(savedPosts);
                    }
                } catch (error) {
                    console.error('Error loading user posts:', error);
                    this.state.userPosts = [];
                }
            },
            
            // Save User Settings
            saveUserSettings() {
                try {
                    localStorage.setItem('userSettings', JSON.stringify(this.state.userSettings));
                } catch (error) {
                    console.error('Error saving settings:', error);
                }
            },
            
            // Load User Settings
            loadUserSettings() {
                try {
                    const savedSettings = localStorage.getItem('userSettings');
                    if (savedSettings) {
                        this.state.userSettings = { ...this.state.userSettings, ...JSON.parse(savedSettings) };
                        this.applyTheme(this.state.userSettings.theme);
                    }
                } catch (error) {
                    console.error('Error loading settings:', error);
                }
            },
            
            // Save Recent Search
            saveRecentSearch(query) {
                if (!query) return;
                
                this.state.recentSearches = this.state.recentSearches.filter(s => s !== query);
                this.state.recentSearches.unshift(query);
                this.state.recentSearches = this.state.recentSearches.slice(0, 10);
                
                localStorage.setItem('recentSearches', JSON.stringify(this.state.recentSearches));
            },
            
            // Load Recent Searches
            loadRecentSearches() {
                try {
                    const searches = localStorage.getItem('recentSearches');
                    if (searches) {
                        this.state.recentSearches = JSON.parse(searches);
                    }
                } catch (error) {
                    console.error('Error loading recent searches:', error);
                }
            },
            
            // Sync Offline Data
            syncOfflineData() {
                if (!navigator.onLine || !this.db) return;
                
                // Sync user data, posts, etc.
                console.log('Syncing offline data...');
            },
            
            // Update UI
            updateUI() {
                // Update various UI elements based on current state
                this.updateNotificationBadge();
                this.updateShopBalance();
            },
            
            // AI Challenge Templates
            aiChallengeTemplates: {
                fitness: [
                    { title: "20 Push-ups Challenge", description: "Complete 20 push-ups with proper form", reward: 100, difficulty: "Easy", timeLimit: 60 },
                    { title: "1 Minute Plank", description: "Hold a plank position for 60 seconds", reward: 150, difficulty: "Medium", timeLimit: 70 },
                    { title: "50 Jumping Jacks", description: "Do 50 jumping jacks non-stop", reward: 80, difficulty: "Easy", timeLimit: 90 },
                    { title: "Wall Sit Challenge", description: "Hold wall sit for 45 seconds", reward: 120, difficulty: "Medium", timeLimit: 60 },
                    { title: "Burpee Challenge", description: "Complete 15 burpees", reward: 200, difficulty: "Hard", timeLimit: 120 }
                ],
                creative: [
                    { title: "Dance Battle", description: "Show your best 30-second dance moves", reward: 150, difficulty: "Medium", timeLimit: 40 },
                    { title: "Beatbox Challenge", description: "Create a 20-second beatbox rhythm", reward: 120, difficulty: "Medium", timeLimit: 30 },
                    { title: "Drawing Speed Run", description: "Draw JomBro logo in 30 seconds", reward: 100, difficulty: "Easy", timeLimit: 40 },
                    { title: "Origami Challenge", description: "Make a paper crane in under 2 minutes", reward: 180, difficulty: "Hard", timeLimit: 120 },
                    { title: "Freestyle Rap", description: "Rap about JomBro for 30 seconds", reward: 200, difficulty: "Hard", timeLimit: 40 }
                ],
                social: [
                    { title: "Compliment Spree", description: "Give 5 genuine compliments to strangers", reward: 150, difficulty: "Medium", timeLimit: 180 },
                    { title: "Random Act of Kindness", description: "Do something nice for someone", reward: 200, difficulty: "Hard", timeLimit: 300 },
                    { title: "Teach Something", description: "Teach a skill in 60 seconds", reward: 180, difficulty: "Hard", timeLimit: 70 },
                    { title: "Make Someone Laugh", description: "Tell jokes until someone laughs", reward: 100, difficulty: "Easy", timeLimit: 120 }
                ],
                food: [
                    { title: "Spicy Challenge", description: "Eat something super spicy without water", reward: 150, difficulty: "Hard", timeLimit: 120 },
                    { title: "Blindfold Taste Test", description: "Guess 5 foods while blindfolded", reward: 130, difficulty: "Medium", timeLimit: 180 },
                    { title: "Speed Eating", description: "Finish a meal in under 5 minutes", reward: 100, difficulty: "Easy", timeLimit: 300 },
                    { title: "Cook Without Recipe", description: "Create a dish without any instructions", reward: 200, difficulty: "Hard", timeLimit: 600 }
                ],
                gaming: [
                    { title: "No Death Run", description: "Complete a game level without dying", reward: 180, difficulty: "Hard", timeLimit: 600 },
                    { title: "Speedrun Challenge", description: "Beat your best time in any game", reward: 150, difficulty: "Medium", timeLimit: 600 },
                    { title: "Blindfold Gaming", description: "Play a game blindfolded for 2 minutes", reward: 200, difficulty: "Hard", timeLimit: 120 },
                    { title: "One Hand Gaming", description: "Win a match using only one hand", reward: 160, difficulty: "Hard", timeLimit: 600 }
                ]
            },
            
            // Shop Items Data
            shopItemsData: {
                avatars: [
                    { id: 'avatar_1', name: 'Golden Crown', icon: 'ðŸ‘‘', price: 5000, type: 'avatar' },
                    { id: 'avatar_2', name: 'Rainbow Unicorn', icon: 'ðŸ¦„', price: 3000, type: 'avatar' },
                    { id: 'avatar_3', name: 'Fire Dragon', icon: 'ðŸ‰', price: 4000, type: 'avatar' },
                    { id: 'avatar_4', name: 'Space Astronaut', icon: 'ðŸ‘¨â€ðŸš€', price: 3500, type: 'avatar' },
                    { id: 'avatar_5', name: 'Ninja Master', icon: 'ðŸ¥·', price: 2500, type: 'avatar' }
                ],
                frames: [
                    { id: 'frame_1', name: 'Gold Frame', icon: 'ðŸ–¼ï¸', price: 2000, type: 'frame', color: '#FFD700' },
                    { id: 'frame_2', name: 'Neon Frame', icon: 'ðŸ–¼ï¸', price: 1500, type: 'frame', color: '#FF00FF' },
                    { id: 'frame_3', name: 'Ice Frame', icon: 'ðŸ–¼ï¸', price: 1800, type: 'frame', color: '#00FFFF' }
                ],
                effects: [
                    { id: 'effect_1', name: 'Sparkle Effect', icon: 'âœ¨', price: 1000, type: 'effect' },
                    { id: 'effect_2', name: 'Rainbow Trail', icon: 'ðŸŒˆ', price: 1500, type: 'effect' },
                    { id: 'effect_3', name: 'Smoke Effect', icon: 'ðŸ’¨', price: 800, type: 'effect' }
                ],
                vouchers: [
                    { id: 'voucher_1', name: 'Starbucks RM10', icon: 'â˜•', price: 1000, type: 'voucher' },
                    { id: 'voucher_2', name: 'Grab RM15', icon: 'ðŸš—', price: 1500, type: 'voucher' },
                    { id: 'voucher_3', name: 'Shopee RM20', icon: 'ðŸ›ï¸', price: 2000, type: 'voucher' }
                ]
            }
        };
        
        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });
        
        // Prevent pull-to-refresh
        document.addEventListener('touchmove', (e) => {
            if (e.touches[0].clientY > 0) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
