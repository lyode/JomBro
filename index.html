<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content, minimal-ui">
    
    <!-- Enhanced Mobile Viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JomBro">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#000000">
    
    <!-- Maximize Screen Real Estate -->
    <meta name="screen-orientation" content="portrait">
    <meta name="full-screen" content="yes">
    <meta name="browsermode" content="application">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json,{%22name%22:%22JomBro%20-%20Social%20Challenge%20App%22,%22short_name%22:%22JomBro%22,%22description%22:%22Advanced%20social%20challenge%20platform%20with%20AI-powered%20challenges%22,%22start_url%22:%22/%22,%22display%22:%22standalone%22,%22background_color%22:%22%23000000%22,%22theme_color%22:%22%23000000%22,%22orientation%22:%22portrait%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%3E%3Crect%20width='512'%20height='512'%20fill='%23000'/%3E%3Ctext%20x='50%25'%20y='50%25'%20dominant-baseline='middle'%20text-anchor='middle'%20font-size='280'%20fill='%2300FF96'%3EðŸš€%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='100' fill='%2300FF96'%3EðŸš€%3C/text%3E%3C/svg%3E">
    
    <title>JomBro - Advanced Social Challenge System</title>

    <style>
        /* iPhone 15 Pro Max Full Screen Optimized Styles */
        :root {
            --iphone15-width: 430px;
            --iphone15-height: 932px;
            --iphone15-full-height: 2796px;
            --iphone15-full-width: 1290px;
            --device-pixel-ratio: 3;
            --dynamic-island-height: 37px;
            --safe-area-top: env(safe-area-inset-top, 59px);
            --safe-area-bottom: env(safe-area-inset-bottom, 34px);
            --safe-area-left: env(safe-area-inset-left, 0px);
            --safe-area-right: env(safe-area-inset-right, 0px);
            --extended-browser-bar: 83px;
        }

        /* iPhone 15 Pro Max Full Screen Detection */
        @media screen and (width: 430px) and (height: 932px) {
            :root {
                --safe-area-top: env(safe-area-inset-top, 59px);
                --safe-area-bottom: env(safe-area-inset-bottom, 83px);
            }
            
            body {
                width: 430px !important;
                height: 932px !important;
                overflow-x: hidden;
            }

            /* Optimize for full screen with extended browser bar */
            .dark-nav {
                padding-bottom: calc(env(safe-area-inset-bottom, 83px) + 10px) !important;
                min-height: calc(80px + env(safe-area-inset-bottom, 83px)) !important;
            }

            .dark-feed {
                bottom: calc(80px + env(safe-area-inset-bottom, 83px)) !important;
            }
        }

        /* Extended browser bar support for iPhone 15 Pro Max */
        @media screen and (width: 430px) and (height: 932px) and (display-mode: standalone) {
            :root {
                --safe-area-bottom: env(safe-area-inset-bottom, 34px);
            }
            
            .dark-nav {
                padding-bottom: calc(env(safe-area-inset-bottom, 34px) + 20px) !important;
            }

            .dark-feed {
                bottom: calc(80px + env(safe-area-inset-bottom, 34px)) !important;
            }
        }

        /* Standalone PWA Mode Detection */
        @media all and (display-mode: standalone) {
            :root {
                --safe-area-top: env(safe-area-inset-top, 59px);
                --safe-area-bottom: env(safe-area-inset-bottom, 34px);
            }
        }

        /* iPhone Safe Area Support */
        @supports (padding: max(0px)) {
            :root {
                --safe-area-top: max(env(safe-area-inset-top, 0px), 59px);
                --safe-area-bottom: max(env(safe-area-inset-bottom, 0px), 34px);
                --safe-area-left: env(safe-area-inset-left, 0px);
                --safe-area-right: env(safe-area-inset-right, 0px);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
        }

        html {
            height: 100vh;
            height: 100svh;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: radial-gradient(ellipse at center, #0f0f23 0%, #000000 70%);
            width: 100vw;
            height: 100vh;
            height: 100svh;
            color: #FFFFFF;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            font-weight: 300;
            transition: all 1s ease;
            font-size: 16px;
            line-height: 1.5;
        }

        /* Background Themes - More Dramatic & Visible */
        body.underwater {
            background: radial-gradient(ellipse at center, #001a2e 0%, #003d5c 40%, #000814 100%);
        }

        body.sky {
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8E8 50%, #B6E5F0 100%);
        }

        body.beach {
            background: linear-gradient(to bottom, #FFD700 0%, #F0E68C 30%, #87CEEB 70%, #4682B4 100%);
        }

        body.rainy {
            background: linear-gradient(to bottom, #2C3E50 0%, #34495E 50%, #1C2833 100%);
        }

        body.city {
            background: linear-gradient(to bottom, #2C3E50 0%, #34495E 30%, #1C1C1C 70%, #000000 100%);
        }

        body.jungle {
            background: linear-gradient(to bottom, #228B22 0%, #006400 30%, #004225 70%, #001a0d 100%);
        }

        body.forest {
            background: linear-gradient(to bottom, #2F4F2F 0%, #1C3A1C 50%, #0D1F0D 100%);
        }

        body.mountain {
            background: linear-gradient(to bottom, #4682B4 0%, #5F8A8B 30%, #2F4F4F 70%, #1C2833 100%);
        }

        body.desert {
            background: linear-gradient(to bottom, #F4A460 0%, #D2691E 50%, #8B4513 100%);
        }

        body.aurora {
            background: radial-gradient(ellipse at center, #001122 0%, #003366 40%, #000000 100%);
        }

        body.sunset {
            background: linear-gradient(to bottom, #FF6B47 0%, #FF8C42 30%, #F39C12 60%, #E67E22 100%);
        }

        body.snowy {
            background: linear-gradient(to bottom, #E8E8E8 0%, #D3D3D3 50%, #A9A9A9 100%);
        }

        body.cyberpunk {
            background: radial-gradient(ellipse at center, #1a0033 0%, #330066 40%, #000000 100%);
        }

        body.volcano {
            background: radial-gradient(ellipse at center, #660000 0%, #330000 50%, #000000 100%);
        }

        body.thunderstorm {
            background: linear-gradient(to bottom, #1C1C1C 0%, #2C2C54 30%, #40407A 60%, #000000 100%);
        }

        body.wedding {
            background: linear-gradient(to bottom, #FFE4E1 0%, #FFC0CB 30%, #F8F8FF 60%, #E6E6FA 100%);
        }

        body.tropical {
            background: linear-gradient(to bottom, #00CED1 0%, #48D1CC 30%, #20B2AA 60%, #008B8B 100%);
        }

        body.galaxy {
            background: radial-gradient(ellipse at center, #4B0082 0%, #8A2BE2 30%, #9932CC 60%, #000000 100%);
        }

        body.neon {
            background: radial-gradient(ellipse at center, #FF1493 0%, #00FFFF 30%, #FF69B4 60%, #000000 100%);
        }

        body.meadow {
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 30%, #90EE90 60%, #228B22 100%);
        }

        body.twilight {
            background: linear-gradient(to bottom, #191970 0%, #4B0082 30%, #8B008B 60%, #000000 100%);
        }

        body.carnival {
            background: linear-gradient(to bottom, #FF6347 0%, #FFD700 25%, #FF69B4 50%, #9370DB 75%, #FF4500 100%);
        }

        body.ice {
            background: linear-gradient(to bottom, #E0FFFF 0%, #B0E0E6 30%, #87CEEB 60%, #4682B4 100%);
        }

        body.steampunk {
            background: linear-gradient(to bottom, #8B4513 0%, #A0522D 30%, #D2691E 60%, #654321 100%);
        }

        body.retro {
            background: linear-gradient(to bottom, #FF6B9D 0%, #C44569 30%, #F8B500 60%, #6D214F 100%);
        }

        body.noir {
            background: linear-gradient(to bottom, #2C2C2C 0%, #1C1C1C 50%, #000000 100%);
        }

        body.paradise {
            background: linear-gradient(to bottom, #FFE066 0%, #FF6B6B 30%, #4ECDC4 60%, #45B7D1 100%);
        }

        body.mystic {
            background: radial-gradient(ellipse at center, #2E0249 0%, #570A57 30%, #A91079 60%, #000000 100%);
        }

        body.future {
            background: linear-gradient(to bottom, #00FFFF 0%, #0080FF 30%, #8000FF 60%, #FF0080 100%);
        }

        /* Theme-specific text color adjustments */
        body.snowy .challenge-text,
        body.snowy .dark-logo,
        body.snowy .challenge-username {
            color: #2C3E50 !important;
            text-shadow: 0 0 18px rgba(44, 62, 80, 0.8), 2px 2px 8px rgba(255, 255, 255, 0.9) !important;
        }

        body.desert .challenge-text,
        body.desert .dark-logo,
        body.desert .challenge-username {
            color: #8B4513 !important;
            text-shadow: 0 0 18px rgba(139, 69, 19, 0.8), 2px 2px 8px rgba(244, 164, 96, 0.9) !important;
        }

        body.sunset .challenge-text,
        body.sunset .dark-logo,
        body.sunset .challenge-username {
            color: #8B0000 !important;
            text-shadow: 0 0 18px rgba(255, 107, 71, 0.8), 2px 2px 8px rgba(255, 140, 66, 0.9) !important;
        }

        body.beach .challenge-text,
        body.beach .dark-logo,
        body.beach .challenge-username {
            color: #4682B4 !important;
            text-shadow: 0 0 18px rgba(70, 130, 180, 0.8), 2px 2px 8px rgba(255, 215, 0, 0.9) !important;
        }

        body.wedding .challenge-text,
        body.wedding .dark-logo,
        body.wedding .challenge-username {
            color: #8B008B !important;
            text-shadow: 0 0 18px rgba(139, 0, 139, 0.8), 2px 2px 8px rgba(255, 192, 203, 0.9) !important;
        }

        body.cyberpunk .challenge-text,
        body.cyberpunk .dark-logo,
        body.cyberpunk .challenge-username {
            color: #FF1493 !important;
            text-shadow: 0 0 18px rgba(255, 20, 147, 0.8), 2px 2px 8px rgba(0, 255, 255, 0.9) !important;
        }

        body.galaxy .challenge-text,
        body.galaxy .dark-logo,
        body.galaxy .challenge-username {
            color: #8A2BE2 !important;
            text-shadow: 0 0 18px rgba(138, 43, 226, 0.8), 2px 2px 8px rgba(75, 0, 130, 0.9) !important;
        }

        body.jungle .challenge-text,
        body.jungle .dark-logo,
        body.jungle .challenge-username {
            color: #228B22 !important;
            text-shadow: 0 0 18px rgba(34, 139, 34, 0.8), 2px 2px 8px rgba(0, 100, 0, 0.9) !important;
        }

        /* Theme-specific border colors for better visibility */
        body.underwater .round-btn,
        body.underwater .action-btn {
            border-color: rgba(0, 206, 209, 0.9) !important;
        }

        body.sky .round-btn,
        body.sky .action-btn {
            border-color: rgba(135, 206, 235, 0.9) !important;
        }

        body.sunset .round-btn,
        body.sunset .action-btn {
            border-color: rgba(255, 107, 71, 0.9) !important;
        }

        body.cyberpunk .round-btn,
        body.cyberpunk .action-btn {
            border-color: rgba(255, 20, 147, 0.9) !important;
        }

        body.galaxy .round-btn,
        body.galaxy .action-btn {
            border-color: rgba(138, 43, 226, 0.9) !important;
        }

        body.jungle .round-btn,
        body.jungle .action-btn {
            border-color: rgba(34, 139, 34, 0.9) !important;
        }

        /* Background preview colors for each theme */
        .bg-option[data-bg="underwater"] {
            background: linear-gradient(45deg, #001a2e, #003d5c) !important;
        }

        .bg-option[data-bg="sky"] {
            background: linear-gradient(45deg, #87CEEB, #98D8E8) !important;
        }

        .bg-option[data-bg="beach"] {
            background: linear-gradient(45deg, #FFD700, #87CEEB) !important;
        }

        .bg-option[data-bg="rainy"] {
            background: linear-gradient(45deg, #2C3E50, #34495E) !important;
        }

        .bg-option[data-bg="city"] {
            background: linear-gradient(45deg, #2C3E50, #1C1C1C) !important;
        }

        .bg-option[data-bg="jungle"] {
            background: linear-gradient(45deg, #228B22, #006400) !important;
        }

        .bg-option[data-bg="sunset"] {
            background: linear-gradient(45deg, #FF6B47, #FF8C42) !important;
        }

        .bg-option[data-bg="snowy"] {
            background: linear-gradient(45deg, #E8E8E8, #D3D3D3) !important;
        }

        .bg-option[data-bg="cyberpunk"] {
            background: linear-gradient(45deg, #1a0033, #330066) !important;
        }

        .bg-option[data-bg="galaxy"] {
            background: linear-gradient(45deg, #4B0082, #8A2BE2) !important;
        }

        .bg-option[data-bg="aurora"] {
            background: linear-gradient(45deg, #001122, #003366) !important;
        }

        .bg-option[data-bg="wedding"] {
            background: linear-gradient(45deg, #FFE4E1, #FFC0CB) !important;
        }

        .bg-option[data-bg="tropical"] {
            background: linear-gradient(45deg, #00CED1, #48D1CC) !important;
        }

        .bg-option[data-bg="neon"] {
            background: linear-gradient(45deg, #FF1493, #00FFFF) !important;
        }

        .bg-option[data-bg="space"] {
            background: linear-gradient(45deg, #0f0f23, #000000) !important;
        }

        .bg-option[data-bg="desert"] {
            background: linear-gradient(45deg, #F4A460, #D2691E) !important;
        }

        .bg-option[data-bg="volcano"] {
            background: linear-gradient(45deg, #660000, #330000) !important;
        }

        .bg-option[data-bg="thunderstorm"] {
            background: linear-gradient(45deg, #1C1C1C, #40407A) !important;
        }

        .bg-option[data-bg="meadow"] {
            background: linear-gradient(45deg, #87CEEB, #98FB98) !important;
        }

        .bg-option[data-bg="twilight"] {
            background: linear-gradient(45deg, #191970, #4B0082) !important;
        }

        .bg-option[data-bg="carnival"] {
            background: linear-gradient(45deg, #FF6347, #FFD700, #FF69B4) !important;
        }

        .bg-option[data-bg="ice"] {
            background: linear-gradient(45deg, #E0FFFF, #B0E0E6) !important;
        }

        .bg-option[data-bg="steampunk"] {
            background: linear-gradient(45deg, #8B4513, #A0522D) !important;
        }

        .bg-option[data-bg="retro"] {
            background: linear-gradient(45deg, #FF6B9D, #C44569) !important;
        }

        .bg-option[data-bg="noir"] {
            background: linear-gradient(45deg, #2C2C2C, #1C1C1C) !important;
        }

        .bg-option[data-bg="paradise"] {
            background: linear-gradient(45deg, #FFE066, #FF6B6B) !important;
        }

        .bg-option[data-bg="mystic"] {
            background: linear-gradient(45deg, #2E0249, #570A57) !important;
        }

        .bg-option[data-bg="future"] {
            background: linear-gradient(45deg, #00FFFF, #8000FF) !important;
        }

        .bg-option[data-bg="forest"] {
            background: linear-gradient(45deg, #2F4F2F, #1C3A1C) !important;
        }

        .bg-option[data-bg="mountain"] {
            background: linear-gradient(45deg, #4682B4, #5F8A8B) !important;
        }

        /* Adjust text color for light themes */
        .bg-option[data-bg="snowy"] .bg-name,
        .bg-option[data-bg="beach"] .bg-name,
        .bg-option[data-bg="sunset"] .bg-name,
        .bg-option[data-bg="wedding"] .bg-name,
        .bg-option[data-bg="ice"] .bg-name,
        .bg-option[data-bg="paradise"] .bg-name {
            color: #2C3E50 !important;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8) !important;
        }

        /* Starfield Background */
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #ddd, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            z-index: 0;
        }

        /* Dark Overlay */
        .dark-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(0.1px);
            -webkit-backdrop-filter: blur(0.1px);
            z-index: 2;
        }

        /* Main Container */
        .main-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10;
            display: flex;
            flex-direction: column;
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
        }

        /* iPhone 15 Pro Max Header */
        .dark-header {
            position: fixed;
            top: calc(var(--safe-area-top) + 16px);
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.002);
            border-radius: 28px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            height: 68px;
            width: calc(100vw - 40px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.002);
        }

        .dark-logo {
            font-size: 28px;
            font-weight: 300;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.4),
                2px 2px 6px rgba(0, 0, 0, 0.9);
            animation: logoFloat 8s ease-in-out infinite;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .dark-slogan {
            font-size: 12px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            margin-top: 2px;
            font-style: italic;
            letter-spacing: 0.5px;
        }

        .dark-header-icons {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        /* iPhone 15 Pro Max Buttons */
        .round-btn {
            width: 44px;
            height: 44px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 2px solid rgba(64, 93, 230, 0.9);
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.8),
                2px 2px 6px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                0 0 25px rgba(255, 255, 255, 0.3);
            position: relative;
            touch-action: manipulation;
        }

        .round-btn:hover {
            transform: translateY(-4px) scale(1.05);
            background: rgba(0, 0, 0, 0.002);
            border-color: rgba(64, 93, 230, 1);
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.1),
                0 0 40px rgba(64, 93, 230, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #FF3366, #FF6B35);
            border-radius: 10px;
            font-size: 11px;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 15px rgba(255, 51, 102, 0.6);
            animation: badgeFloat 4s ease infinite;
        }

        /* Player Info Display */
        .player-info {
            position: fixed;
            top: calc(var(--safe-area-top) + 84px);
            right: 24px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(0, 255, 150, 0.4);
            border-radius: 20px;
            padding: 12px 16px;
            z-index: 950;
            text-align: center;
        }

        .player-rank {
            font-size: 12px;
            color: #FFD700;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            margin-bottom: 4px;
        }

        .player-tokens {
            font-size: 14px;
            color: #00FF96;
            font-weight: 700;
            text-shadow: 0 0 12px rgba(0, 255, 150, 0.8);
        }

        /* Stories Section */
        .dark-stories {
            position: fixed;
            top: calc(var(--safe-area-top) + 100px);
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.002);
            border-radius: 24px;
            padding: 20px;
            z-index: 900;
            height: 120px;
            width: calc(100vw - 40px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.002);
        }

        .stories-scroll {
            display: flex;
            gap: 18px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 6px 0;
        }

        .stories-scroll::-webkit-scrollbar { 
            display: none; 
        }

        .story-item {
            min-width: 80px;
            text-align: center;
            cursor: pointer;
            touch-action: manipulation;
        }

        .story-circle {
            width: 80px;
            height: 80px;
            border-radius: 40px;
            background: linear-gradient(45deg, 
                rgba(0, 255, 150, 0.5), 
                rgba(64, 93, 230, 0.5), 
                rgba(138, 43, 226, 0.5), 
                rgba(255, 255, 255, 0.3));
            padding: 3px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 255, 150, 0.2);
            position: relative;
        }

        .story-circle:hover {
            transform: translateY(-4px) scale(1.05);
        }

        .story-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid rgba(0, 0, 0, 0.02);
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.002);
        }

        .story-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            filter: brightness(1.1) contrast(1.1);
        }

        .story-name {
            font-size: 13px;
            font-weight: 400;
            color: #FFFFFF;
            text-shadow: 
                0 0 8px rgba(255, 255, 255, 0.3),
                1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* Feed Section */
        .dark-feed {
            position: fixed;
            top: calc(var(--safe-area-top) + 240px);
            left: 0;
            right: 0;
            bottom: calc(80px + env(safe-area-inset-bottom, 34px));
            overflow: hidden;
            z-index: 100;
            padding: 0 20px;
            perspective: 1000px;
        }

        .feed-pages {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        .challenge-card {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            width: calc(100% - 40px);
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.002);
            border-radius: 28px;
            overflow: hidden;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.002);
            transform-style: preserve-3d;
            transform-origin: bottom center;
        }

        .challenge-card.current {
            transform: translateZ(0px) rotateX(0deg);
            z-index: 10;
        }

        .challenge-card.next {
            transform: translateZ(-100px) rotateX(-90deg);
            z-index: 5;
        }

        .challenge-card.prev {
            transform: translateZ(-100px) rotateX(90deg);
            z-index: 5;
        }

        /* Side Actions */
        .side-actions {
            position: absolute;
            right: 24px;
            bottom: 180px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            z-index: 200;
        }

        .action-btn {
            width: 56px;
            height: 56px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 2px solid rgba(0, 191, 255, 0.9);
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.6),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                0 0 30px rgba(255, 255, 255, 0.3);
            position: relative;
            touch-action: manipulation;
        }

        .points-btn {
            flex-direction: column;
            background: rgba(0, 0, 0, 0.002);
            border-color: rgba(0, 255, 150, 0.6);
            height: 72px;
            padding: 10px;
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.002),
                0 0 35px rgba(0, 255, 150, 0.3);
        }

        .points-number {
            font-size: 16px;
            font-weight: 700;
            line-height: 1;
            color: #FFFFFF;
            text-shadow: 
                0 0 15px rgba(0, 255, 150, 0.6),
                1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .points-label {
            font-size: 10px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* Challenge Content */
        .challenge-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 36px;
            z-index: 150;
        }

        .challenge-user {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 18px;
        }

        .challenge-avatar {
            width: 48px;
            height: 48px;
            border-radius: 24px;
            background: linear-gradient(45deg, 
                rgba(0, 255, 150, 0.6), 
                rgba(64, 93, 230, 0.6), 
                rgba(138, 43, 226, 0.6), 
                rgba(255, 255, 255, 0.4));
            padding: 3px;
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 255, 150, 0.2);
        }

        .challenge-avatar-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid rgba(0, 0, 0, 0.02);
        }

        .challenge-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            filter: brightness(1.2) contrast(1.1);
        }

        .challenge-username {
            color: #FFFFFF;
            font-weight: 400;
            font-size: 18px;
            text-shadow: 
                0 0 15px rgba(255, 255, 255, 0.5),
                2px 2px 6px rgba(0, 0, 0, 0.9);
        }

        .challenge-type {
            display: inline-block;
            padding: 4px 8px;
            background: rgba(255, 215, 0, 0.8);
            color: #000;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .challenge-type.daily {
            background: rgba(0, 255, 150, 0.8);
        }

        .challenge-type.treasure {
            background: rgba(255, 215, 0, 0.8);
        }

        .challenge-type.vip {
            background: rgba(138, 43, 226, 0.8);
            color: #fff;
        }

        .challenge-type.business {
            background: rgba(255, 107, 53, 0.8);
        }

        .challenge-text {
            font-size: 20px;
            font-weight: 300;
            color: #FFFFFF;
            text-shadow: 
                0 0 18px rgba(255, 255, 255, 0.5),
                2px 2px 8px rgba(0, 0, 0, 0.9);
            margin-bottom: 18px;
            line-height: 1.4;
        }

        .challenge-hashtags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 24px;
        }

        .challenge-hashtag {
            color: #4FC3F7;
            font-size: 15px;
            font-weight: 400;
            text-shadow: 
                0 0 8px rgba(79, 195, 247, 0.5),
                1px 1px 2px rgba(0, 0, 0, 0.8);
            padding: 8px 14px;
            background: rgba(200, 200, 200, 0.002);
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 18px;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .challenge-hashtag:hover {
            background: rgba(200, 200, 200, 0.002);
            color: #4FC3F7;
            border-color: rgba(79, 195, 247, 0.5);
        }

        .challenge-reward {
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(0, 255, 150, 0.6);
            color: #FFFFFF;
            padding: 12px 20px;
            border-radius: 22px;
            font-size: 16px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 28px;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.002),
                0 0 30px rgba(0, 255, 150, 0.3);
        }

        .challenge-difficulty {
            display: inline-block;
            margin-left: 12px;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            text-shadow: none;
        }

        .difficulty-easy {
            background: rgba(0, 255, 150, 0.8);
            color: #000;
        }

        .difficulty-medium {
            background: rgba(255, 193, 7, 0.8);
            color: #000;
        }

        .difficulty-hard {
            background: rgba(255, 87, 34, 0.8);
            color: #fff;
        }

        .difficulty-epic {
            background: rgba(156, 39, 176, 0.8);
            color: #fff;
        }

        .difficulty-legendary {
            background: linear-gradient(45deg, #FFD700, #FF6B47);
            color: #000;
            animation: legendaryGlow 2s ease infinite;
        }

        /* Challenge Buttons */
        .challenge-actions {
            display: flex;
            gap: 16px;
        }

        .challenge-btn {
            flex: 1;
            padding: 18px 24px;
            border: none;
            border-radius: 24px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
            touch-action: manipulation;
            min-height: 44px;
        }

        .btn-accept {
            background: rgba(0, 0, 0, 0.002);
            border: 1px solid rgba(0, 255, 150, 0.6);
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.002),
                0 0 30px rgba(0, 255, 150, 0.25);
        }

        .btn-decline {
            background: rgba(0, 0, 0, 0.002);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.002),
                0 0 20px rgba(255, 255, 255, 0.03);
        }

        /* Bottom Navigation */
        .dark-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.002);
            border-bottom: none;
            border-radius: 0;
            display: flex;
            justify-content: space-around;
            padding: 20px 20px calc(env(safe-area-inset-bottom, 34px) + 20px) 20px;
            z-index: 1000;
            width: 100vw;
            min-height: calc(80px + env(safe-area-inset-bottom, 34px));
            box-shadow: 
                0 -8px 32px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.002);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            padding: 12px 16px;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.002);
            backdrop-filter: blur(15px);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
            touch-action: manipulation;
            min-height: 44px;
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 6px;
            transition: all 0.3s ease;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }

        .nav-item.active {
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            background: rgba(0, 0, 0, 0.002);
            border: 1px solid rgba(0, 255, 150, 0.5);
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.002),
                0 0 30px rgba(0, 255, 150, 0.3);
            transform: translateZ(8px);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.15) translateZ(5px);
            text-shadow: 
                0 0 12px rgba(0, 255, 150, 0.8),
                0 0 8px rgba(255, 255, 255, 0.3);
        }

        /* Modal System */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 24px;
        }

        .modal.show {
            display: flex;
            animation: modalFadeIn 0.3s ease;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 28px;
            padding: 36px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 28px;
            text-align: center;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.6),
                2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px;
            color: #FFFFFF;
            font-size: 16px;
            font-weight: 400;
            outline: none;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
        }

        .form-control:focus {
            border-color: rgba(0, 255, 150, 0.7);
            background: rgba(0, 0, 0, 0.002);
            box-shadow: 0 0 35px rgba(0, 255, 150, 0.3);
        }

        .btn-primary {
            width: 100%;
            padding: 18px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(0, 255, 150, 0.6);
            border-radius: 18px;
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 14px;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.002),
                0 0 30px rgba(0, 255, 150, 0.25);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 255, 150, 0.4);
        }

        .btn-secondary {
            width: 100%;
            padding: 18px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 18px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(255, 255, 255, 0.2);
        }

        /* Toast */
        .toast {
            position: fixed;
            top: calc(var(--safe-area-top) + 160px);
            left: 24px;
            right: 24px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(35px);
            border: 1px solid rgba(0, 255, 150, 0.5);
            color: #FFFFFF;
            padding: 16px 20px;
            border-radius: 18px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            z-index: 3000;
            transform: translateY(-100px);
            opacity: 0;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.002),
                0 0 30px rgba(0, 255, 150, 0.3);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Background Settings */
        .background-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 18px;
            margin-bottom: 28px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .bg-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 18px;
            background: rgba(0, 0, 0, 0.002);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px;
            cursor: pointer;
            text-align: center;
            touch-action: manipulation;
        }

        .bg-option.active {
            border-color: rgba(0, 255, 150, 1);
            background: rgba(0, 255, 150, 0.002);
            box-shadow: 0 0 30px rgba(0, 255, 150, 0.4);
        }

        .bg-preview {
            font-size: 36px;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
        }

        .bg-name {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* Leaderboard Styles */
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 16px;
            margin-bottom: 12px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            transform: translateY(-2px);
            background: rgba(0, 255, 150, 0.05);
        }

        .rank-number {
            font-size: 24px;
            font-weight: 700;
            margin-right: 16px;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            min-width: 40px;
        }

        .player-avatar {
            width: 48px;
            height: 48px;
            border-radius: 24px;
            margin-right: 16px;
            border: 2px solid rgba(0, 255, 150, 0.5);
        }

        .player-details {
            flex: 1;
        }

        .player-name {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
        }

        .player-rank-title {
            font-size: 12px;
            color: #FFD700;
            font-weight: 500;
        }

        .player-score {
            font-size: 18px;
            font-weight: 700;
            color: #00FF96;
            text-shadow: 0 0 10px rgba(0, 255, 150, 0.6);
        }

        /* Animation Keyframes */
        @keyframes logoFloat {
            0%, 100% { transform: scale(1) translateY(0px); }
            50% { transform: scale(1.02) translateY(-1px); }
        }

        @keyframes badgeFloat {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes legendaryGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 107, 71, 0.8); }
        }

        /* Background Effect Animations */
        @keyframes bubbleFloat {
            0% { 
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% { 
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        @keyframes cloudDrift {
            0% { transform: translateX(-150px); }
            100% { transform: translateX(calc(100vw + 150px)); }
        }

        @keyframes rainFall {
            0% { transform: translateY(-100px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100vh); opacity: 0; }
        }

        @keyframes snowFall {
            0% { 
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { 
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes leafFall {
            0% { 
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { 
                transform: translateY(100vh) rotate(180deg);
                opacity: 0;
            }
        }

        @keyframes petalFall {
            0% { 
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { 
                transform: translateY(100vh) rotate(90deg);
                opacity: 0;
            }
        }

        @keyframes fishSwim {
            0% { transform: translateX(-150px); }
            100% { transform: translateX(calc(100vw + 150px)); }
        }

        @keyframes firefly {
            0%, 100% { 
                transform: translateX(0px) translateY(0px);
                opacity: 0.3;
            }
            25% { 
                transform: translateX(20px) translateY(-20px);
                opacity: 1;
            }
            50% { 
                transform: translateX(-15px) translateY(-40px);
                opacity: 0.5;
            }
            75% { 
                transform: translateX(25px) translateY(-10px);
                opacity: 1;
            }
        }

        @keyframes lightningFlash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        @keyframes waveMotion {
            0%, 100% { transform: translateX(0px); }
            50% { transform: translateX(-50px); }
        }

        @keyframes cityTwinkle {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        @keyframes auroraWave {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                opacity: 0.3;
            }
            50% { 
                transform: scale(1.1) rotate(5deg);
                opacity: 0.7;
            }
        }

        @keyframes gridPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        @keyframes galaxyRotate {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes neonPulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }

        /* Focus Visible Support */
        .round-btn:focus-visible,
        .action-btn:focus-visible,
        .challenge-btn:focus-visible,
        .nav-item:focus-visible {
            outline: 2px solid rgba(0, 255, 150, 0.8);
            outline-offset: 2px;
        }

        /* Install Button Styling */
        .install-btn {
            background: rgba(0, 255, 150, 0.1) !important;
            border-color: rgba(0, 255, 150, 0.8) !important;
        }

        /* Instant heart display */
        .instant-heart {
            position: fixed;
            right: 50px;
            bottom: 200px;
            font-size: 24px;
            z-index: 3000;
            pointer-events: none;
            opacity: 1;
            color: #FF1493;
        }

        /* Rating Stars */
        .rating-stars {
            display: flex;
            gap: 8px;
            margin: 10px 0;
        }

        .star {
            font-size: 24px;
            cursor: pointer;
            opacity: 0.3;
            transition: opacity 0.2s ease;
        }

        .star:hover {
            opacity: 1;
        }

        /* Unread notification styling */
        .leaderboard-item.unread {
            border-left: 4px solid #00FF96;
        }

        /* Login modal improvements */
        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-control::-webkit-input-placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-control::-moz-placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-control:-ms-input-placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* VIP badge styling */
        .vip-badge {
            background: linear-gradient(45deg, #FFD700, #FF6B47);
            color: #000;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
            animation: vipGlow 2s ease-in-out infinite;
        }

        @keyframes vipGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 107, 71, 0.8); }
        }

        /* Challenge completion modal */
        .challenge-completion-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 12px;
            margin-top: 10px;
        }

        /* Loading animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* Enhanced iPhone 15 Pro Max Responsive Design */
        @media screen and (max-width: 432px) {
            .dark-header {
                height: 64px;
                padding: 14px 20px;
            }
            
            .dark-logo {
                font-size: 26px;
            }
            
            .round-btn {
                width: 42px;
                height: 42px;
                font-size: 17px;
            }
        }

        /* iPhone 15 Pro Max landscape optimization */
        @media screen and (max-width: 932px) and (orientation: landscape) {
            .dark-header {
                padding: 8px 15px;
                height: 50px;
            }
            
            .dark-stories {
                height: 80px;
                top: calc(var(--safe-area-top) + 60px);
            }
            
            .dark-feed {
                top: calc(var(--safe-area-top) + 150px);
            }
            
            .side-actions {
                bottom: 120px;
                right: 15px;
            }
        }

        /* Extended browser bar detection and handling */
        @supports (-webkit-touch-callout: none) {
            /* iOS Safari specific */
            @media screen and (max-height: 932px) {
                .dark-nav {
                    padding-bottom: calc(env(safe-area-inset-bottom, 34px) + 25px) !important;
                    background: linear-gradient(180deg, 
                        rgba(0, 0, 0, 0.95) 0%, 
                        rgba(0, 0, 0, 0.98) 70%, 
                        rgba(0, 0, 0, 1) 100%) !important;
                    backdrop-filter: blur(40px) !important;
                }

                .dark-feed {
                    bottom: calc(90px + env(safe-area-inset-bottom, 34px)) !important;
                }
            }
        }

        /* Improved touch targets for better mobile UX */
        .challenge-btn, .nav-item, .round-btn, .action-btn {
            min-height: 44px;
            min-width: 44px;
        }

        /* Better modal sizing for iPhone 15 Pro Max */
        @media screen and (max-width: 430px) {
            .modal-content {
                max-width: 95%;
                max-height: 85%;
                margin: 20px auto;
                border-radius: 24px;
            }
            
            .background-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 12px;
            }
            
            .bg-option {
                padding: 12px;
            }
            
            .bg-preview {
                font-size: 28px;
            }
        }

        /* Optimized animations for better performance on mobile */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High DPI display optimization */
        @media (-webkit-min-device-pixel-ratio: 3), (min-resolution: 3dppx) {
            .challenge-text, .dark-logo, .nav-item {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                text-rendering: optimizeLegibility;
            }
        }

        /* Battery saving dark mode optimizations */
        @media (prefers-color-scheme: dark) {
            body {
                background: #000000;
            }
            
            .dark-overlay {
                background: rgba(0, 0, 0, 0.05);
            }
        }

        /* Full screen app mode (when added to home screen) */
        @media all and (display-mode: fullscreen) {
            .main-container {
                height: 100vh;
                height: 100svh;
            }
            
            .dark-header {
                top: calc(env(safe-area-inset-top, 20px) + 10px);
            }
        }
    </style>
</head>
<body>
    <!-- Outer Space Starfield Background -->
    <div class="starfield"></div>

    <!-- Dark Overlay -->
    <div class="dark-overlay"></div>

    <!-- Background Effects Container -->
    <div id="backgroundEffects">
        <div id="underwaterBubbles" class="underwater-bubbles" style="display: none;"></div>
        <div id="skyClouds" class="sky-clouds" style="display: none;"></div>
        <div id="beachWaves" class="beach-waves" style="display: none;"></div>
        <div id="rainDrops" class="rain-drops" style="display: none;"></div>
        <div id="cityLights" class="city-lights" style="display: none;"></div>
        <div id="jungleLeaves" class="jungle-leaves" style="display: none;"></div>
        <div id="snowFlakes" class="snow-flakes" style="display: none;"></div>
        <div id="auroraLights" class="aurora-lights" style="display: none;"></div>
        <div id="cyberpunkGrid" class="cyberpunk-grid" style="display: none;"></div>
        <div id="thunderstormEffects" class="thunderstorm-effects" style="display: none;"></div>
        <div id="weddingPetals" class="wedding-petals" style="display: none;"></div>
        <div id="tropicalFish" class="tropical-fish" style="display: none;"></div>
        <div id="galaxySpiral" class="galaxy-spiral" style="display: none;"></div>
        <div id="neonLines" class="neon-lines" style="display: none;"></div>
        <div id="fireflies" class="fireflies" style="display: none;"></div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        
        <!-- Dark Header -->
        <div class="dark-header">
            <div class="dark-logo">
                <div>JomBro</div>
                <div class="dark-slogan">lai lai lai, kang dao lai liau bro!</div>
            </div>
            <div class="dark-header-icons">
                <div class="round-btn" onclick="showHowToPlay()">â“</div>
                <div class="round-btn" onclick="showLiveActivity()">âš¡</div>
                <div class="round-btn" onclick="navigateAction(this, 'create')">âž•</div>
                <div class="round-btn" onclick="showGroups()">ðŸ‘¥</div>
                <div class="round-btn" onclick="showNotifications()">
                    ðŸ””
                    <div class="notification-badge" id="notificationCount">0</div>
                </div>
                <div class="round-btn" onclick="showSettings()">âš™ï¸</div>
            </div>
        </div>

        <!-- Player Info Display -->
        <div class="player-info">
            <div class="player-rank" id="playerRank">Elite Gladiator</div>
            <div class="player-tokens" id="playerTokens">ðŸª™ 15,247</div>
        </div>

        <!-- Dark Stories -->
        <div class="dark-stories">
            <div class="stories-scroll" id="storiesScroll">
                <!-- Stories will be dynamically populated -->
            </div>
        </div>

        <!-- Dark Feed with Page Flip -->
        <div class="dark-feed">
            <div class="feed-pages" id="feedPages">
                <!-- Challenge cards will be dynamically populated -->
            </div>

            <!-- Side Actions -->
            <div class="side-actions">
                <div class="action-btn points-btn" onclick="likeChallenge()">
                    <div class="points-number" id="currentChallengePoints">2.5K</div>
                    <div class="points-label">â¤ï¸</div>
                </div>
                <div class="action-btn" onclick="shareChallenge()">ðŸ’¬</div>
                <div class="action-btn" onclick="bookmarkChallenge()">ðŸ”–</div>
                <div class="action-btn" onclick="shareChallenge()">ðŸ“¤</div>
            </div>
        </div>

        <!-- Dark Bottom Navigation -->
        <div class="dark-nav">
            <div class="nav-item active" onclick="navAction(this, 'home')">
                <div class="nav-icon">ðŸ </div>
                <div>Home</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'leaderboard')">
                <div class="nav-icon">ðŸ†</div>
                <div>Leaderboard</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'create')">
                <div class="nav-icon">âž•</div>
                <div>Create</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'shop')">
                <div class="nav-icon">ðŸ›ï¸</div>
                <div>Shop</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'profile')">
                <div class="nav-icon">ðŸ‘¤</div>
                <div>Profile</div>
            </div>
        </div>
    </div>

    <!-- Background Settings Modal -->
    <div id="backgroundModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ðŸŽ¨ Choose Your Atmosphere</div>
            
            <div class="background-grid">
                <div class="bg-option active" onclick="changeBackground('space')" data-bg="space">
                    <div class="bg-preview">ðŸŒŒ</div>
                    <div class="bg-name">Outer Space</div>
                </div>
                <div class="bg-option" onclick="changeBackground('underwater')" data-bg="underwater">
                    <div class="bg-preview">ðŸŒŠ</div>
                    <div class="bg-name">Underwater</div>
                </div>
                <div class="bg-option" onclick="changeBackground('sky')" data-bg="sky">
                    <div class="bg-preview">â˜ï¸</div>
                    <div class="bg-name">Sky Clouds</div>
                </div>
                <div class="bg-option" onclick="changeBackground('beach')" data-bg="beach">
                    <div class="bg-preview">ðŸ–ï¸</div>
                    <div class="bg-name">Beach</div>
                </div>
                <div class="bg-option" onclick="changeBackground('rainy')" data-bg="rainy">
                    <div class="bg-preview">ðŸŒ§ï¸</div>
                    <div class="bg-name">Rainy</div>
                </div>
                <div class="bg-option" onclick="changeBackground('city')" data-bg="city">
                    <div class="bg-preview">ðŸ™ï¸</div>
                    <div class="bg-name">City</div>
                </div>
                <div class="bg-option" onclick="changeBackground('jungle')" data-bg="jungle">
                    <div class="bg-preview">ðŸŒ´</div>
                    <div class="bg-name">Jungle</div>
                </div>
                <div class="bg-option" onclick="changeBackground('sunset')" data-bg="sunset">
                    <div class="bg-preview">ðŸŒ…</div>
                    <div class="bg-name">Sunset</div>
                </div>
                <div class="bg-option" onclick="changeBackground('snowy')" data-bg="snowy">
                    <div class="bg-preview">â„ï¸</div>
                    <div class="bg-name">Snowy</div>
                </div>
                <div class="bg-option" onclick="changeBackground('cyberpunk')" data-bg="cyberpunk">
                    <div class="bg-preview">ðŸ”®</div>
                    <div class="bg-name">Cyberpunk</div>
                </div>
                <div class="bg-option" onclick="changeBackground('galaxy')" data-bg="galaxy">
                    <div class="bg-preview">ðŸŒŒ</div>
                    <div class="bg-name">Galaxy</div>
                </div>
                <div class="bg-option" onclick="changeBackground('aurora')" data-bg="aurora">
                    <div class="bg-preview">ðŸŒŒ</div>
                    <div class="bg-name">Aurora</div>
                </div>
                <div class="bg-option" onclick="changeBackground('wedding')" data-bg="wedding">
                    <div class="bg-preview">ðŸ’’</div>
                    <div class="bg-name">Wedding</div>
                </div>
                <div class="bg-option" onclick="changeBackground('tropical')" data-bg="tropical">
                    <div class="bg-preview">ðŸ </div>
                    <div class="bg-name">Tropical</div>
                </div>
                <div class="bg-option" onclick="changeBackground('neon')" data-bg="neon">
                    <div class="bg-preview">ðŸ’«</div>
                    <div class="bg-name">Neon</div>
                </div>
                <div class="bg-option" onclick="changeBackground('meadow')" data-bg="meadow">
                    <div class="bg-preview">ðŸŒ¾</div>
                    <div class="bg-name">Meadow</div>
                </div>
                <div class="bg-option" onclick="changeBackground('desert')" data-bg="desert">
                    <div class="bg-preview">ðŸœï¸</div>
                    <div class="bg-name">Desert</div>
                </div>
                <div class="bg-option" onclick="changeBackground('volcano')" data-bg="volcano">
                    <div class="bg-preview">ðŸŒ‹</div>
                    <div class="bg-name">Volcano</div>
                </div>
                <div class="bg-option" onclick="changeBackground('thunderstorm')" data-bg="thunderstorm">
                    <div class="bg-preview">â›ˆï¸</div>
                    <div class="bg-name">Storm</div>
                </div>
                <div class="bg-option" onclick="changeBackground('twilight')" data-bg="twilight">
                    <div class="bg-preview">ðŸŒ†</div>
                    <div class="bg-name">Twilight</div>
                </div>
                <div class="bg-option" onclick="changeBackground('carnival')" data-bg="carnival">
                    <div class="bg-preview">ðŸŽ­</div>
                    <div class="bg-name">Carnival</div>
                </div>
                <div class="bg-option" onclick="changeBackground('ice')" data-bg="ice">
                    <div class="bg-preview">ðŸ§Š</div>
                    <div class="bg-name">Ice</div>
                </div>
                <div class="bg-option" onclick="changeBackground('steampunk')" data-bg="steampunk">
                    <div class="bg-preview">âš™ï¸</div>
                    <div class="bg-name">Steampunk</div>
                </div>
                <div class="bg-option" onclick="changeBackground('retro')" data-bg="retro">
                    <div class="bg-preview">ðŸŒˆ</div>
                    <div class="bg-name">Retro</div>
                </div>
                <div class="bg-option" onclick="changeBackground('noir')" data-bg="noir">
                    <div class="bg-preview">ðŸ•µï¸</div>
                    <div class="bg-name">Noir</div>
                </div>
                <div class="bg-option" onclick="changeBackground('paradise')" data-bg="paradise">
                    <div class="bg-preview">ðŸï¸</div>
                    <div class="bg-name">Paradise</div>
                </div>
                <div class="bg-option" onclick="changeBackground('mystic')" data-bg="mystic">
                    <div class="bg-preview">ðŸ”®</div>
                    <div class="bg-name">Mystic</div>
                </div>
                <div class="bg-option" onclick="changeBackground('future')" data-bg="future">
                    <div class="bg-preview">ðŸš€</div>
                    <div class="bg-name">Future</div>
                </div>
                <div class="bg-option" onclick="changeBackground('forest')" data-bg="forest">
                    <div class="bg-preview">ðŸŒ²</div>
                    <div class="bg-name">Forest</div>
                </div>
                <div class="bg-option" onclick="changeBackground('mountain')" data-bg="mountain">
                    <div class="bg-preview">ðŸ”ï¸</div>
                    <div class="bg-name">Mountain</div>
                </div>
            </div>
            
            <button class="btn-secondary" onclick="hideModal('background')">Close</button>
        </div>
    </div>

    <!-- Create Challenge Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">âœ¨ Create New Challenge</div>
            
            <div class="form-group">
                <label class="form-label">Challenge Type</label>
                <select class="form-control" id="challengeType">
                    <option value="personal">Personal Challenge</option>
                    <option value="vip" disabled>VIP Challenge (Requires VIP)</option>
                    <option value="treasure" disabled>Treasure Challenge (Requires VVIP)</option>
                    <option value="business">Business Partnership</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Target Friend</label>
                <select class="form-control" id="challengeTarget">
                    <option value="">Choose friend...</option>
                    <option value="Alexandra Stone">alexandra_stone</option>
                    <option value="Marcus Chen">marcus_chen</option>
                    <option value="Sofia Rodriguez">sofia_rodriguez</option>
                    <option value="Ryan Kumar">ryan_kumar</option>
                    <option value="Emma Thompson">emma_thompson</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Challenge Description</label>
                <textarea class="form-control" id="challengeDesc" rows="3" placeholder="Describe your epic challenge..." style="resize: vertical;"></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Difficulty & Reward</label>
                <select class="form-control" id="challengePoints">
                    <option value="500">500 Tokens (Easy)</option>
                    <option value="1200">1,200 Tokens (Medium)</option>
                    <option value="2500">2,500 Tokens (Hard)</option>
                    <option value="5000">5,000 Tokens (Epic)</option>
                    <option value="10000">10,000 Tokens (Legendary)</option>
                </select>
            </div>
            
            <button class="btn-primary" onclick="createChallenge()">ðŸš€ Share Challenge</button>
            <button class="btn-secondary" onclick="hideModal('create')">Cancel</button>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboardModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ðŸ† Global Leaderboard</div>
            
            <div id="leaderboardList">
                <!-- Leaderboard will be dynamically populated -->
            </div>
            
            <button class="btn-secondary" onclick="hideModal('leaderboard')">Close</button>
        </div>
    </div>

    <!-- Shop Modal -->
    <div id="shopModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ðŸ›ï¸ Token Shop</div>
            
            <div class="form-group">
                <label class="form-label">Purchase Tokens</label>
                <select class="form-control" id="tokenPackage">
                    <option value="1000">ðŸª™ 1,000 Tokens - RM 9.90</option>
                    <option value="5000">ðŸª™ 5,000 Tokens - RM 39.90</option>
                    <option value="12000">ðŸª™ 12,000 Tokens - RM 79.90</option>
                    <option value="25000">ðŸª™ 25,000 Tokens - RM 149.90</option>
                    <option value="50000">ðŸª™ 50,000 Tokens - RM 249.90</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">VIP Membership</label>
                <select class="form-control" id="vipPackage">
                    <option value="">No VIP Upgrade</option>
                    <option value="vip">VIP (1 Month) - RM 29.90</option>
                    <option value="vip3">VIP (3 Months) - RM 79.90</option>
                    <option value="vvip">VVIP (1 Month) - RM 59.90</option>
                    <option value="vvip3">VVIP (3 Months) - RM 149.90</option>
                </select>
            </div>
            
            <button class="btn-primary" onclick="purchaseTokens()">ðŸ’³ Purchase</button>
            <button class="btn-secondary" onclick="hideModal('shop')">Close</button>
        </div>
    </div>

    <!-- Enhanced Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ðŸ‘¤ Player Profile</div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn-primary" onclick="showProfileTab('view')" id="viewProfileTab">View</button>
                <button class="btn-secondary" onclick="showProfileTab('edit')" id="editProfileTab">Edit</button>
                <button class="btn-secondary" onclick="showProfileTab('card')" id="cardProfileTab">Business Card</button>
            </div>
            
            <div id="viewProfileContent">
                <!-- Profile view content will be dynamically populated -->
            </div>
            
            <div id="editProfileContent" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Display Name</label>
                    <input type="text" class="form-control" id="editDisplayName" placeholder="Your display name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Bio</label>
                    <textarea class="form-control" id="editBio" rows="3" placeholder="Tell everyone about yourself..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-control" id="editLocation" placeholder="City, Country">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Website/Portfolio</label>
                    <input type="url" class="form-control" id="editWebsite" placeholder="https://yourwebsite.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Social Links</label>
                    <input type="text" class="form-control" id="editInstagram" placeholder="Instagram username" style="margin-bottom: 10px;">
                    <input type="text" class="form-control" id="editLinkedIn" placeholder="LinkedIn profile URL">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Interests/Skills</label>
                    <input type="text" class="form-control" id="editSkills" placeholder="Adventure, Business, Photography, etc. (comma separated)">
                </div>
                
                <button class="btn-primary" onclick="saveProfile()">ðŸ’¾ Save Profile</button>
            </div>
            
            <div id="cardProfileContent" style="display: none;">
                <div style="background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 255, 150, 0.1)); border: 2px solid rgba(0, 255, 150, 0.3); border-radius: 20px; padding: 25px; margin: 20px 0; backdrop-filter: blur(20px); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                        <img id="cardAvatar" src="" alt="Avatar" style="width: 80px; height: 80px; border-radius: 40px; border: 3px solid #00FF96;">
                        <div>
                            <h3 id="cardName" style="color: #fff; margin: 0;"></h3>
                            <p id="cardTitle" style="color: #FFD700; margin: 0; font-size: 14px;"></p>
                            <p id="cardLocation" style="color: rgba(255,255,255,0.7); margin: 0; font-size: 12px;"></p>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-around; margin: 20px 0; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="text-align: center;">
                            <div id="cardTokens" style="font-size: 20px; font-weight: 700; color: #00FF96; margin-bottom: 5px;">0</div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Tokens</div>
                        </div>
                        <div style="text-align: center;">
                            <div id="cardLevel" style="font-size: 20px; font-weight: 700; color: #00FF96; margin-bottom: 5px;">0</div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Level</div>
                        </div>
                        <div style="text-align: center;">
                            <div id="cardChallenges" style="font-size: 20px; font-weight: 700; color: #00FF96; margin-bottom: 5px;">0</div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Challenges</div>
                        </div>
                    </div>
                    
                    <div id="cardBio" style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 12px; margin: 15px 0; font-size: 14px; line-height: 1.4;">
                        <!-- Bio will be populated here -->
                    </div>
                    
                    <div id="cardLinks" style="display: flex; gap: 15px; margin: 15px 0; flex-wrap: wrap;">
                        <!-- Social links will be populated here -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto;">ðŸ“±</div>
                        <p style="font-size: 12px; color: rgba(255,255,255,0.7); margin: 5px 0 0 0;">Scan to connect</p>
                    </div>
                </div>
                
                <button class="btn-primary" onclick="shareBusinessCard()" style="margin-top: 20px;">ðŸ“¤ Share Business Card</button>
            </div>
            
            <button class="btn-secondary" onclick="hideModal('profile')">Close</button>
        </div>
    </div>

    <!-- Groups Modal -->
    <div id="groupsModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ðŸ‘¥ Groups</div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn-primary" onclick="showGroupTab('my')" id="myGroupsTab">My Groups</button>
                <button class="btn-secondary" onclick="showGroupTab('discover')" id="discoverGroupsTab">Discover</button>
                <button class="btn-secondary" onclick="showGroupTab('create')" id="createGroupTab">Create</button>
            </div>
            
            <div id="myGroupsContent">
                <div id="userGroupsList">
                    <!-- User's groups will be populated here -->
                </div>
            </div>
            
            <div id="discoverGroupsContent" style="display: none;">
                <div class="form-group">
                    <input type="text" class="form-control" id="groupSearchInput" placeholder="Search groups..." onkeyup="searchGroups()">
                </div>
                <div id="publicGroupsList">
                    <!-- Public groups will be populated here -->
                </div>
            </div>
            
            <div id="createGroupContent" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Group Name</label>
                    <input type="text" class="form-control" id="newGroupName" placeholder="Enter group name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" id="newGroupDescription" rows="3" placeholder="Describe your group..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Privacy</label>
                    <select class="form-control" id="newGroupPrivacy">
                        <option value="public">Public - Anyone can join</option>
                        <option value="private">Private - Invite only</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-control" id="newGroupCategory">
                        <option value="general">General</option>
                        <option value="fitness">Fitness & Health</option>
                        <option value="adventure">Adventure</option>
                        <option value="social">Social</option>
                        <option value="business">Business</option>
                        <option value="education">Education</option>
                        <option value="gaming">Gaming</option>
                    </select>
                </div>
                
                <button class="btn-primary" onclick="createGroup()">ðŸŽ¯ Create Group</button>
            </div>
            
            <button class="btn-secondary" onclick="hideModal('groups')">Close</button>
        </div>
    </div>

    <!-- Group Details Modal -->
    <div id="groupDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="groupDetailsTitle">Group Details</div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn-primary" onclick="showGroupDetailsTab('info')" id="groupInfoTab">Info</button>
                <button class="btn-secondary" onclick="showGroupDetailsTab('members')" id="groupMembersTab">Members</button>
                <button class="btn-secondary" onclick="showGroupDetailsTab('challenges')" id="groupChallengesTab">Challenges</button>
                <button class="btn-secondary" onclick="showGroupDetailsTab('rewards')" id="groupRewardsTab">Rewards</button>
            </div>
            
            <div id="groupInfoContent">
                <!-- Group info will be populated here -->
            </div>
            
            <div id="groupMembersContent" style="display: none;">
                <!-- Group members will be populated here -->
            </div>
            
            <div id="groupChallengesContent" style="display: none;">
                <!-- Group challenges will be populated here -->
            </div>
            
            <div id="groupRewardsContent" style="display: none;">
                <!-- Group rewards will be populated here -->
            </div>
            
            <button class="btn-secondary" onclick="hideModal('groupDetails')">Close</button>
        </div>
    </div>

    <!-- Challenge Completion Modal -->
    <div id="challengeCompletionModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ðŸ“¸ Complete Challenge</div>
            
            <div id="challengeCompletionContent">
                <div class="form-group">
                    <label class="form-label">Upload Photo/Video</label>
                    <input type="file" class="form-control" id="challengeMedia" accept="image/*,video/*">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" id="challengeCompletionDesc" rows="3" placeholder="Tell us about your experience..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Rating (1-5 stars)</label>
                    <div class="rating-stars">
                        <span class="star" onclick="setRating(1)">â­</span>
                        <span class="star" onclick="setRating(2)">â­</span>
                        <span class="star" onclick="setRating(3)">â­</span>
                        <span class="star" onclick="setRating(4)">â­</span>
                        <span class="star" onclick="setRating(5)">â­</span>
                    </div>
                </div>
                
                <button class="btn-primary" onclick="submitChallengeCompletion()">ðŸ† Submit & Claim Reward</button>
                <button class="btn-secondary" onclick="hideModal('challengeCompletion')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ðŸ”” Notifications</div>
            
            <div id="notificationsList">
                <!-- Notifications will be populated here -->
            </div>
            
            <button class="btn-secondary" onclick="hideModal('notifications')">Close</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">âš™ï¸ Settings</div>
            
            <div class="form-group">
                <label class="form-label">Notifications</label>
                <select class="form-control" id="notificationSettings">
                    <option value="all">All Notifications</option>
                    <option value="important">Important Only</option>
                    <option value="none">None</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Privacy</label>
                <select class="form-control" id="privacySettings">
                    <option value="public">Public Profile</option>
                    <option value="friends">Friends Only</option>
                    <option value="private">Private</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Language</label>
                <select class="form-control" id="languageSettings">
                    <option value="en">English</option>
                    <option value="ms">Bahasa Malaysia</option>
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="ta">à®¤à®®à®¿à®´à¯</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Background Theme</label>
                <button class="btn-primary" onclick="showBackgroundSettings()" style="margin-top: 10px;">ðŸŽ¨ Choose Atmosphere</button>
            </div>
            
            <button class="btn-primary" onclick="saveSettings()">ðŸ’¾ Save Settings</button>
            <button class="btn-secondary" onclick="logout()" style="background: rgba(255, 0, 0, 0.2); border-color: rgba(255, 0, 0, 0.5);">ðŸšª Logout</button>
            <button class="btn-secondary" onclick="hideModal('settings')">Cancel</button>
        </div>
    </div>

    <!-- Live Activity Feed Modal -->
    <div id="activityFeedModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">âš¡ Live Activity Feed</div>
            
            <div id="liveActivityFeed">
                <!-- Live activity will be populated here -->
            </div>
            
            <button class="btn-secondary" onclick="hideModal('activityFeed')">Close</button>
        </div>
    </div>

    <!-- How to Play Modal -->
    <div id="howToPlayModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ðŸŽ® How to Play JomBro</div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn-primary" onclick="showHowToPlayTab('basics')" id="basicsTab">Basics</button>
                <button class="btn-secondary" onclick="showHowToPlayTab('challenges')" id="challengesTab">Challenges</button>
                <button class="btn-secondary" onclick="showHowToPlayTab('tokens')" id="tokensTab">Tokens</button>
                <button class="btn-secondary" onclick="showHowToPlayTab('social')" id="socialTab">Social</button>
            </div>
            
            <div id="basicsContent">
                <h3 style="color: #00FF96; margin-bottom: 15px;">ðŸš€ Welcome to JomBro!</h3>
                <p style="margin-bottom: 15px; line-height: 1.6;">JomBro is a social challenge platform where you complete real-world challenges, earn tokens, and compete with friends!</p>
                
                <div style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 16px; margin-bottom: 20px;">
                    <h4 style="color: #FFD700; margin-bottom: 10px;">ðŸŽ¯ Main Objectives:</h4>
                    <ul style="color: rgba(255,255,255,0.9); line-height: 1.8; padding-left: 20px;">
                        <li><strong>Complete Challenges:</strong> Accept and finish real-world tasks</li>
                        <li><strong>Earn Tokens:</strong> Get rewarded for every completed challenge</li>
                        <li><strong>Level Up:</strong> Progress through ranks from Novice to Legendary Gladiator</li>
                        <li><strong>Build Community:</strong> Make friends, join groups, share stories</li>
                        <li><strong>Win Prizes:</strong> Earn real rewards from business partnerships</li>
                    </ul>
                </div>
                
                <div style="background: rgba(0, 255, 150, 0.05); border: 1px solid rgba(0, 255, 150, 0.3); padding: 15px; border-radius: 12px;">
                    <h4 style="color: #00FF96; margin-bottom: 8px;">ðŸ’¡ Quick Start Guide:</h4>
                    <p style="color: rgba(255,255,255,0.9); font-size: 14px;">1. Swipe up/down to browse challenges<br>2. Tap "Accept Challenge" to start<br>3. Complete the task in real life<br>4. Upload proof & rate your experience<br>5. Earn tokens and climb leaderboards!</p>
                </div>
            </div>
            
            <div id="challengesContent" style="display: none;">
                <h3 style="color: #FF6B47; margin-bottom: 15px;">ðŸŽ¯ Challenge Types</h3>
                
                <div style="margin-bottom: 20px;">
                    <div style="background: rgba(0, 255, 150, 0.1); border: 1px solid rgba(0, 255, 150, 0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <h4 style="color: #00FF96; margin-bottom: 8px;">ðŸŒŸ Daily Challenges</h4>
                        <p style="color: rgba(255,255,255,0.9); font-size: 14px;">Easy tasks you can do anywhere: "Take a selfie with a stranger," "Try a new coffee flavor," "Do 20 pushups in public"</p>
                        <span style="background: rgba(0, 255, 150, 0.2); color: #00FF96; padding: 4px 8px; border-radius: 8px; font-size: 12px;">500-1,200 Tokens</span>
                    </div>
                    
                    <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <h4 style="color: #FFD700; margin-bottom: 8px;">ðŸ† Treasure Challenges</h4>
                        <p style="color: rgba(255,255,255,0.9); font-size: 14px;">Epic monthly events: "Complete city-wide scavenger hunt," "Visit 10 hidden locations"</p>
                        <span style="background: rgba(255, 215, 0, 0.2); color: #FFD700; padding: 4px 8px; border-radius: 8px; font-size: 12px;">25,000+ Tokens + Real Prizes</span>
                    </div>
                    
                    <div style="background: rgba(255, 107, 71, 0.1); border: 1px solid rgba(255, 107, 71, 0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <h4 style="color: #FF6B47; margin-bottom: 8px;">ðŸ’¼ Business Challenges</h4>
                        <p style="color: rgba(255,255,255,0.9); font-size: 14px;">Partner brand tasks: "Try McDonald's mystery meal," "Review new Starbucks drink"</p>
                        <span style="background: rgba(255, 107, 71, 0.2); color: #FF6B47; padding: 4px 8px; border-radius: 8px; font-size: 12px;">Real Vouchers + Tokens</span>
                    </div>
                    
                    <div style="background: rgba(138, 43, 226, 0.1); border: 1px solid rgba(138, 43, 226, 0.3); padding: 15px; border-radius: 12px;">
                        <h4 style="color: #8A2BE2; margin-bottom: 8px;">ðŸ‘‘ VIP Challenges</h4>
                        <p style="color: rgba(255,255,255,0.9); font-size: 14px;">Exclusive premium tasks: "5-star hotel experience," "Private dining challenge"</p>
                        <span style="background: rgba(138, 43, 226, 0.2); color: #8A2BE2; padding: 4px 8px; border-radius: 8px; font-size: 12px;">VIP/VVIP Members Only</span>
                    </div>
                </div>
            </div>
            
            <div id="tokensContent" style="display: none;">
                <h3 style="color: #FFD700; margin-bottom: 15px;">ðŸª™ Token Economy</h3>
                
                <div style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 16px; margin-bottom: 20px;">
                    <h4 style="color: #00FF96; margin-bottom: 15px;">ðŸ’° How to Earn Tokens:</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(0, 255, 150, 0.1); padding: 12px; border-radius: 8px;">
                            <div style="color: #00FF96; font-weight: 600;">Complete Challenges</div>
                            <div style="color: rgba(255,255,255,0.7); font-size: 12px;">500-25,000 tokens</div>
                        </div>
                        <div style="background: rgba(255, 215, 0, 0.1); padding: 12px; border-radius: 8px;">
                            <div style="color: #FFD700; font-weight: 600;">Daily Login</div>
                            <div style="color: rgba(255,255,255,0.7); font-size: 12px;">100 tokens/day</div>
                        </div>
                        <div style="background: rgba(255, 107, 71, 0.1); padding: 12px; border-radius: 8px;">
                            <div style="color: #FF6B47; font-weight: 600;">Invite Friends</div>
                            <div style="color: rgba(255,255,255,0.7); font-size: 12px;">1,000 tokens each</div>
                        </div>
                        <div style="background: rgba(138, 43, 226, 0.1); padding: 12px; border-radius: 8px;">
                            <div style="color: #8A2BE2; font-weight: 600;">Win Competitions</div>
                            <div style="color: rgba(255,255,255,0.7); font-size: 12px;">5,000+ tokens</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(255, 215, 0, 0.05); border: 1px solid rgba(255, 215, 0, 0.3); padding: 15px; border-radius: 12px;">
                    <h4 style="color: #FFD700; margin-bottom: 10px;">ðŸ›ï¸ What Can You Buy?</h4>
                    <ul style="color: rgba(255,255,255,0.9); line-height: 1.6; padding-left: 20px; font-size: 14px;">
                        <li><strong>VIP Membership:</strong> Exclusive challenges & rewards</li>
                        <li><strong>Profile Boosters:</strong> Premium themes & badges</li>
                        <li><strong>Challenge Multipliers:</strong> 2x token earning</li>
                        <li><strong>Real Rewards:</strong> Convert to vouchers & prizes</li>
                    </ul>
                </div>
            </div>
            
            <div id="socialContent" style="display: none;">
                <h3 style="color: #4FC3F7; margin-bottom: 15px;">ðŸ‘¥ Social Features</h3>
                
                <div style="margin-bottom: 20px;">
                    <div style="background: rgba(79, 195, 247, 0.1); border: 1px solid rgba(79, 195, 247, 0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <h4 style="color: #4FC3F7; margin-bottom: 8px;">ðŸ‘¤ Friends System</h4>
                        <p style="color: rgba(255,255,255,0.9); font-size: 14px;">Add friends, challenge them directly, see their progress, and compete on leaderboards together!</p>
                    </div>
                    
                    <div style="background: rgba(0, 255, 150, 0.1); border: 1px solid rgba(0, 255, 150, 0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <h4 style="color: #00FF96; margin-bottom: 8px;">ðŸ‘¥ Groups & Communities</h4>
                        <p style="color: rgba(255,255,255,0.9); font-size: 14px;">Join groups based on interests: Adventure Seekers, Business Network, Fitness Warriors. Get exclusive group challenges!</p>
                    </div>
                    
                    <div style="background: rgba(255, 107, 71, 0.1); border: 1px solid rgba(255, 107, 71, 0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <h4 style="color: #FF6B47; margin-bottom: 8px;">ðŸ“– Stories & Posts</h4>
                        <p style="color: rgba(255,255,255,0.9); font-size: 14px;">Share your challenge experiences, upload photos/videos, and inspire others with your adventures!</p>
                    </div>
                    
                    <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); padding: 15px; border-radius: 12px;">
                        <h4 style="color: #FFD700; margin-bottom: 8px;">ðŸ† Leaderboards & Achievements</h4>
                        <p style="color: rgba(255,255,255,0.9); font-size: 14px;">Compete globally, unlock achievements, and climb ranks from Novice to Legendary Gladiator!</p>
                    </div>
                </div>
            </div>
            
            <button class="btn-secondary" onclick="hideModal('howToPlay')">Close</button>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ðŸš€ Welcome to JomBro</div>
            
            <div id="loginContent">
                <div class="form-group">
                    <label class="form-label">Email or Username</label>
                    <input type="text" class="form-control" id="loginEmail" placeholder="Enter your email or username">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password">
                </div>
                
                <button class="btn-primary" onclick="loginUser()">ðŸ” Login</button>
                <button class="btn-secondary" onclick="showRegister()">ðŸ“ Create Account</button>
                
                <div style="text-align: center; margin: 20px 0; color: rgba(255,255,255,0.5);">
                    OR
                </div>
                
                <button class="btn-primary" onclick="socialLogin('google')" style="background: rgba(219, 68, 55, 0.8);">
                    ðŸ” Login with Google
                </button>
                <button class="btn-primary" onclick="socialLogin('facebook')" style="background: rgba(66, 103, 178, 0.8);">
                    ðŸ“˜ Login with Facebook
                </button>
                <button class="btn-primary" onclick="guestLogin()">
                    ðŸ‘¤ Continue as Guest
                </button>
            </div>
            
            <div id="registerContent" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="registerName" placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="registerEmail" placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" id="registerUsername" placeholder="Choose a username">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="registerPassword" placeholder="Create a password">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Country</label>
                    <select class="form-control" id="registerCountry">
                        <option value="MY">Malaysia</option>
                        <option value="SG">Singapore</option>
                        <option value="TH">Thailand</option>
                        <option value="ID">Indonesia</option>
                        <option value="PH">Philippines</option>
                        <option value="VN">Vietnam</option>
                        <option value="OTHER">Other</option>
                    </select>
                </div>
                
                <button class="btn-primary" onclick="registerUser()">ðŸŽ® Join JomBro</button>
                <button class="btn-secondary" onclick="showLogin()">ðŸ”™ Back to Login</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast">
        <span id="toastText">Success!</span>
    </div>

    <script>
        // Advanced Challenge System Data
        let playerData = {
            id: 'player_001',
            username: 'alexandra_stone',
            displayName: 'Alexandra Stone',
            email: 'alexandra.stone@jombro.com',
            avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=80&h=80&fit=crop&crop=face',
            tokens: 15247,
            totalEarned: 47832,
            rankPoints: 8450,
            level: 27,
            vipStatus: 'none',
            vipExpiry: null,
            completedChallenges: 143,
            createdChallenges: 67,
            winRate: 87.3,
            streakCurrent: 12,
            streakBest: 28,
            joinDate: '2024-01-15',
            location: 'Kuala Lumpur, Malaysia',
            bio: 'Elite challenge master specializing in extreme adventures and business partnerships.',
            website: 'https://alexandra-stone.com',
            instagram: 'alexandra_adventures',
            linkedin: 'https://linkedin.com/in/alexandra-stone',
            skills: 'Adventure, Business, Photography, Leadership',
            achievements: [
                'First Elite Gladiator',
                'Business Champion',
                'Streak Master',
                'Token Millionaire'
            ],
            followers: 2847,
            following: 432,
            friends: [
                'marcus_chen',
                'sofia_rodriguez', 
                'ryan_kumar',
                'emma_thompson'
            ],
            groups: ['adventure_seekers', 'business_network'],
            isLoggedIn: false,
            settings: {
                notifications: 'all',
                privacy: 'public',
                language: 'en'
            }
        };

        let challengeData = [];
        let leaderboardData = [];
        let groupsData = [];
        let friendsData = [];
        let notificationsData = [];
        let achievementsData = [];
        let messagesData = [];
        let storiesData = [];
        let challengeLikesData = [];
        let liveActivityData = [];
        let automatedPlayers = [];
        let currentPage = 0;
        let totalPages = 0;
        let isFlipping = false;
        let currentBackground = 'space';
        let deferredPrompt;
        let currentChallenge = null;
        let selectedRating = 0;
        let currentGroup = null;
        let activityInterval = null;

        // Initialize the advanced system
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            checkUserLogin();
            
            if (playerData.isLoggedIn) {
                initializeAllSystems();
            } else {
                showLoginModal();
            }
        });

        // Update the repeated initialization sections
        function initializeAllSystems() {
            initializeAdvancedSystem();
            updatePlayerDisplay();
            generateInitialChallenges();
            populateLeaderboard();
            createStories();
            setupSwipeGestures();
            initializePWA();
            loadGroups();
            loadFriends();
            loadNotifications();
            loadAchievements();
            loadMessages();
            loadStories();
            loadChallengeLikes();
            loadAutomatedPlayers();
            startLiveActivity();
            
            hideAllBackgroundEffects();
            createBackgroundEffects(currentBackground);
            
            // Show tutorial for new users
            if (playerData.level <= 5 || !localStorage.getItem('jombro_tutorial_completed')) {
                setTimeout(() => showHowToPlay(), 3000);
            }
        }

        // Authentication System
        function checkUserLogin() {
            const savedUser = localStorage.getItem('jombro_user');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                playerData = { ...playerData, ...userData, isLoggedIn: true };
            }
        }

        function showLoginModal() {
            showModal('login');
        }

        function showLogin() {
            document.getElementById('loginContent').style.display = 'block';
            document.getElementById('registerContent').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('loginContent').style.display = 'none';
            document.getElementById('registerContent').style.display = 'block';
        }

        function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showToast('âŒ Please enter both email and password!');
                return;
            }

            // Simulate login API call
            setTimeout(() => {
                // For demo, accept any email/password
                playerData.isLoggedIn = true;
                playerData.email = email;
                
                // Save to localStorage
                localStorage.setItem('jombro_user', JSON.stringify(playerData));
                
                hideModal('login');
                showToast('ðŸŽ‰ Welcome back to JomBro!');
                
                // Initialize app after login
                initializeAllSystems();
            }, 1000);
        }

        function registerUser() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const country = document.getElementById('registerCountry').value;

            if (!name || !email || !username || !password) {
                showToast('âŒ Please fill in all required fields!');
                return;
            }

            // Simulate registration API call
            setTimeout(() => {
                playerData.displayName = name;
                playerData.email = email;
                playerData.username = username;
                playerData.location = getCountryName(country);
                playerData.isLoggedIn = true;
                playerData.tokens = 1000; // Welcome bonus
                playerData.level = 1;
                playerData.rank = 'Novice';
                
                // Save to localStorage
                localStorage.setItem('jombro_user', JSON.stringify(playerData));
                
                hideModal('login');
                showToast('ðŸŽ‰ Welcome to JomBro! You received 1000 welcome tokens!');
                
                // Initialize app after registration
                initializeAllSystems();
            }, 1000);
        }

        function socialLogin(provider) {
            showToast(`ðŸ” Connecting to ${provider}...`);
            
            // Simulate social login
            setTimeout(() => {
                playerData.isLoggedIn = true;
                playerData.displayName = `${provider} User`;
                playerData.email = `user@${provider}.com`;
                
                localStorage.setItem('jombro_user', JSON.stringify(playerData));
                
                hideModal('login');
                showToast(`ðŸŽ‰ Successfully logged in with ${provider}!`);
                
                initializeAllSystems();
            }, 1500);
        }

        function guestLogin() {
            playerData.isLoggedIn = true;
            playerData.displayName = 'Guest Player';
            playerData.username = 'guest_' + Date.now();
            
            hideModal('login');
            showToast('ðŸ‘¤ Playing as guest! Register to save progress.');
            
            initializeAllSystems();
        }

        function logout() {
            // Stop live activity
            if (activityInterval) {
                clearInterval(activityInterval);
                activityInterval = null;
            }
            
            localStorage.removeItem('jombro_user');
            playerData.isLoggedIn = false;
            showToast('ðŸ‘‹ Logged out successfully!');
            location.reload();
        }

        function getCountryName(code) {
            const countries = {
                'MY': 'Malaysia',
                'SG': 'Singapore',
                'TH': 'Thailand',
                'ID': 'Indonesia',
                'PH': 'Philippines',
                'VN': 'Vietnam'
            };
            return countries[code] || 'Other';
        }

        // Enhanced Automated Players System with Real Personalities
        function loadAutomatedPlayers() {
            automatedPlayers = [
                {
                    id: 'ai_player_1',
                    name: 'Adventure Mike',
                    username: 'adventure_mike',
                    avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face',
                    level: 34,
                    tokens: 18430,
                    rank: 'Elite',
                    specialties: ['adventure', 'fitness', 'extreme_sports'],
                    personality: 'energetic',
                    location: 'Kuala Lumpur, Malaysia',
                    completedToday: 3,
                    currentStreak: 15,
                    bio: 'Professional rock climber and adventure photographer. Always seeking the next adrenaline rush!',
                    recentChallenges: [
                        'Completed Mount Kinabalu sunrise hike',
                        'Skydiving over Langkawi',
                        'White water rafting in Gopeng'
                    ]
                },
                {
                    id: 'ai_player_2',
                    name: 'Business Sarah',
                    username: 'business_sarah',
                    avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=80&h=80&fit=crop&crop=face',
                    level: 28,
                    tokens: 22150,
                    rank: 'Champion',
                    specialties: ['business', 'networking', 'startups'],
                    personality: 'professional',
                    location: 'Singapore',
                    completedToday: 2,
                    currentStreak: 22,
                    bio: 'Serial entrepreneur and networking queen. Building connections across Southeast Asia!',
                    recentChallenges: [
                        'Pitched at Startup Weekend Singapore',
                        'Coffee meeting with 5 new contacts',
                        'Attended fintech networking event'
                    ]
                },
                {
                    id: 'ai_player_3',
                    name: 'Fitness Ryan',
                    username: 'fitness_ryan',
                    avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face',
                    level: 31,
                    tokens: 16890,
                    rank: 'Elite',
                    specialties: ['fitness', 'health', 'marathon'],
                    personality: 'motivational',
                    location: 'Bangkok, Thailand',
                    completedToday: 4,
                    currentStreak: 30,
                    bio: 'Marathon runner and fitness coach. Inspiring others to push their limits daily!',
                    recentChallenges: [
                        '100 push-ups at Chatuchak Market',
                        '10km run along Chao Phraya River',
                        'Taught free fitness class in Lumpini Park'
                    ]
                },
                {
                    id: 'ai_player_4',
                    name: 'Social Emma',
                    username: 'social_emma',
                    avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=80&h=80&fit=crop&crop=face',
                    level: 25,
                    tokens: 14270,
                    rank: 'Duelist',
                    specialties: ['social', 'creativity', 'photography'],
                    personality: 'friendly',
                    location: 'Manila, Philippines',
                    completedToday: 2,
                    currentStreak: 8,
                    bio: 'Content creator and social butterfly. Making friends everywhere and documenting the journey!',
                    recentChallenges: [
                        'Photo scavenger hunt in Intramuros',
                        'Made friends with 3 street artists',
                        'Organized impromptu karaoke session'
                    ]
                },
                {
                    id: 'ai_player_5',
                    name: 'Tech Alex',
                    username: 'tech_alex',
                    avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=80&h=80&fit=crop&crop=face',
                    level: 29,
                    tokens: 19560,
                    rank: 'Elite',
                    specialties: ['technology', 'innovation', 'smart_city'],
                    personality: 'analytical',
                    location: 'Jakarta, Indonesia',
                    completedToday: 1,
                    currentStreak: 18,
                    bio: 'Software engineer and tech enthusiast. Exploring how technology shapes our cities and lives!',
                    recentChallenges: [
                        'Mapped 15 smart city sensors in Jakarta',
                        'Tested new food delivery robots',
                        'Documented IoT traffic management systems'
                    ]
                },
                {
                    id: 'ai_player_6',
                    name: 'Foodie Lisa',
                    username: 'foodie_lisa',
                    avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=80&h=80&fit=crop&crop=face',
                    level: 22,
                    tokens: 13890,
                    rank: 'Duelist',
                    specialties: ['food', 'culture', 'travel'],
                    personality: 'curious',
                    location: 'Ho Chi Minh City, Vietnam',
                    completedToday: 3,
                    currentStreak: 12,
                    bio: 'Food blogger and cultural explorer. Tasting my way through Southeast Asia one challenge at a time!',
                    recentChallenges: [
                        'Tried 7 different pho styles in one day',
                        'Learned to make banh mi from street vendor',
                        'Food crawl through Ben Thanh Market'
                    ]
                },
                {
                    id: 'ai_player_7',
                    name: 'Artist Miguel',
                    username: 'artist_miguel',
                    avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face',
                    level: 18,
                    tokens: 11540,
                    rank: 'Rival',
                    specialties: ['art', 'creativity', 'street_art'],
                    personality: 'creative',
                    location: 'Cebu, Philippines',
                    completedToday: 2,
                    currentStreak: 5,
                    bio: 'Street artist and creative soul. Bringing color to the world one wall at a time!',
                    recentChallenges: [
                        'Created mural in local community center',
                        'Taught kids art in public park',
                        'Photography challenge: 50 doors in Cebu'
                    ]
                },
                {
                    id: 'ai_player_8',
                    name: 'Gamer Kevin',
                    username: 'gamer_kevin',
                    avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face',
                    level: 26,
                    tokens: 15620,
                    rank: 'Duelist',
                    specialties: ['gaming', 'esports', 'streaming'],
                    personality: 'competitive',
                    location: 'Taipei, Taiwan',
                    completedToday: 1,
                    currentStreak: 20,
                    bio: 'Pro gamer taking gaming skills to real life. Speedrunning through JomBro challenges!',
                    recentChallenges: [
                        'Gaming cafe social challenge',
                        'Taught elderly people mobile games',
                        'Real-life treasure hunt using game strategies'
                    ]
                }
            ];
        }

        // Enhanced Groups System with Active Participation
        function loadGroups() {
            // Enhanced groups data with rewards and activity systems
            groupsData = [
                {
                    id: 'adventure_seekers',
                    name: 'Adventure Seekers',
                    description: 'For those who love extreme challenges and adventures! Join us for mountain climbing, skydiving, and more!',
                    category: 'adventure',
                    privacy: 'public',
                    members: 347,
                    avatar: 'ðŸ”ï¸',
                    owner: 'adventure_mike',
                    challenges: 67,
                    activeMembers: 289,
                    isMember: true,
                    weeklyActivity: 94,
                    recentActivity: [
                        'Adventure Mike completed Mount Kinabalu challenge',
                        '12 members joined this week\'s group rappelling event',
                        'New challenge: "Island Hopping in Philippines" posted',
                        'Adventure Mike shared epic drone footage compilation'
                    ],
                    activeChallenge: 'Weekly Extreme Sports Challenge - 25 participants',
                    rewards: [
                        {
                            id: 'adv_reward_1',
                            title: 'Mountain Master',
                            description: 'Complete 5 mountain climbing challenges',
                            icon: 'ðŸ”ï¸',
                            requirement: 'Complete 5 mountain challenges',
                            reward: '5,000 tokens + Mountain Badge + Climbing Gear Discount',
                            claimed: 34,
                            progress: '23 members close to completion'
                        },
                        {
                            id: 'adv_reward_2',
                            title: 'Extreme Adventurer',
                            description: 'Participate in 10 group challenges',
                            icon: 'ðŸª‚',
                            requirement: '10 group challenges',
                            reward: 'Premium Membership + Adventure Gear + Group Trip',
                            claimed: 18,
                            progress: '45 members actively participating'
                        }
                    ],
                    members_list: [
                        { id: 'adventure_mike', name: 'Adventure Mike', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=40&h=40&fit=crop&crop=face', role: 'Owner', status: 'online', lastActive: '2 min ago', streak: 15 },
                        { id: 'alexandra_stone', name: 'Alexandra Stone', avatar: playerData.avatar, role: 'Admin', status: 'online', lastActive: 'now', streak: 12 }
                    ]
                },
                {
                    id: 'business_network',
                    name: 'Business Network',
                    description: 'Professional networking and business challenges. Connect with entrepreneurs, learn new skills, and grow your business!',
                    category: 'business',
                    privacy: 'private',
                    members: 234,
                    avatar: 'ðŸ’¼',
                    owner: 'business_sarah',
                    challenges: 45,
                    activeMembers: 198,
                    isMember: true,
                    weeklyActivity: 89,
                    recentActivity: [
                        'Business Sarah closed $50K deal from network connection',
                        'Weekly startup pitch night - 8 presentations',
                        'New partnership with Singapore Fintech Association',
                        'Members collaborated on 3 successful ventures this month'
                    ],
                    activeChallenge: 'Networking Coffee Marathon - 156 participants',
                    rewards: [
                        {
                            id: 'biz_reward_1',
                            title: 'Networking Champion',
                            description: 'Connect with 20 business professionals',
                            icon: 'ðŸ¤',
                            requirement: 'Connect with 20 professionals',
                            reward: 'Business Card Premium + LinkedIn Credits + Mentor Access',
                            claimed: 23,
                            progress: '67 members actively networking'
                        }
                    ],
                    members_list: [
                        { id: 'business_sarah', name: 'Business Sarah', avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=40&h=40&fit=crop&crop=face', role: 'Owner', status: 'online', lastActive: '5 min ago', streak: 22 }
                    ]
                }
            ];
        }

        function initializeAdvancedSystem() {
            console.log('ðŸš€ JomBro Advanced Challenge System Initialized!');
            console.log('ðŸ† AI-Powered Daily Challenges Active');
            console.log('ðŸ’Ž Treasure Challenge System Ready');
            console.log('ðŸŽ–ï¸ Military & Gladiator Ranking Active');
            console.log('ðŸ’° Token Economy & VIP System Online');
        }

        // PWA Initialization
        function initializePWA() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:application/javascript,const CACHE_NAME="jombro-v1";const urlsToCache=["/"];self.addEventListener("install",event=>{event.waitUntil(caches.open(CACHE_NAME).then(cache=>cache.addAll(urlsToCache)))});self.addEventListener("fetch",event=>{event.respondWith(caches.match(event.request).then(response=>{if(response){return response;}return fetch(event.request)}))});')
                .then(registration => {
                    console.log('PWA: Service Worker registered successfully');
                    showToast('ðŸ“± App ready for offline use!');
                })
                .catch(error => {
                    console.log('PWA: Service Worker registration failed:', error);
                });
            }

            // Handle PWA install prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                showInstallButton();
            });

            // Check if app is already installed
            if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
                console.log('PWA: App is running in standalone mode');
                document.body.classList.add('pwa-mode');
                showToast('ðŸš€ Welcome to JomBro PWA!');
            }

            // Handle app installed
            window.addEventListener('appinstalled', (evt) => {
                console.log('PWA: App was installed');
                showToast('âœ… JomBro installed successfully!');
                hideInstallButton();
            });
        }

        function showInstallButton() {
            const headerIcons = document.querySelector('.dark-header-icons');
            if (!document.querySelector('.install-btn')) {
                const installBtn = document.createElement('div');
                installBtn.className = 'round-btn install-btn';
                installBtn.innerHTML = 'ðŸ“±';
                installBtn.title = 'Install App';
                installBtn.onclick = installPWA;
                headerIcons.insertBefore(installBtn, headerIcons.firstChild);
            }
        }

        function hideInstallButton() {
            const installBtn = document.querySelector('.install-btn');
            if (installBtn) {
                installBtn.remove();
            }
        }

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA: User accepted the install prompt');
                    } else {
                        console.log('PWA: User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        function generateInitialChallenges() {
            challengeData = [];
            
            challengeData.push({
                id: 'daily_001',
                title: "Coffee Shop Poetry Challenge",
                description: "Visit any coffee shop and ask the barista to write a short poem on your cup or napkin! â˜•ï¸ðŸ“",
                hashtags: ["#CoffeePoetry", "#BaristArt", "#JomBro"],
                difficulty: "easy",
                tokens: 500,
                type: "daily",
                creator: "JomBro AI System",
                createdAt: new Date().toISOString(),
                avatar: 'https://images.unsplash.com/photo-1551218808-94e220e084d2?w=80&h=80&fit=crop&crop=center'
            });

            challengeData.push({
                id: 'business_001',
                title: "McDonald's Random Order Challenge",
                description: "ðŸ’° BUSINESS PARTNERSHIP: Close your eyes and point at the menu to order! Rate your surprise meal and post your reaction!",
                hashtags: ["#McDonaldsPartner", "#SurpriseMenu", "#BusinessChallenge"],
                difficulty: "medium",
                tokens: 1800,
                realRewards: "RM 50 McDonald's Voucher + Free Delivery",
                type: "business",
                partner: "McDonald's Malaysia",
                creator: "McDonald's Malaysia",
                createdAt: new Date().toISOString(),
                avatar: 'https://images.unsplash.com/photo-1551218808-94e220e084d2?w=80&h=80&fit=crop&crop=center'
            });

            challengeData.push({
                id: 'vip_001',
                title: "Luxury Hotel Lobby Experience",
                description: "ðŸŒŸ VIP CHALLENGE: Spend 30 minutes in a 5-star hotel lobby, order room service to the lobby, and network with 3 guests!",
                hashtags: ["#VIPExperience", "#LuxuryLife", "#Networking"],
                difficulty: "epic",
                tokens: 5000,
                type: "vip",
                creator: "emma_thompson",
                vipOnly: true,
                createdAt: new Date().toISOString(),
                avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=80&h=80&fit=crop&crop=face'
            });

            challengeData.push({
                id: 'treasure_001',
                title: "TREASURE: City Scavenger Hunt",
                description: "ðŸ† MONTHLY TREASURE: Complete a massive city-wide scavenger hunt with 10 hidden locations! First 50 players to complete get massive rewards!",
                hashtags: ["#TreasureHunt", "#CityWide", "#MonthlyChallenge"],
                difficulty: "legendary",
                tokens: 25000,
                realRewards: "iPhone 15 Pro Max + RM 5,000 Cash",
                type: "treasure",
                creator: "JomBro Treasure System",
                createdAt: new Date().toISOString(),
                expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                participants: 0,
                maxParticipants: 1000,
                avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face'
            });

            challengeData.push({
                id: 'adventure_001',
                title: "Urban Explorer: Hidden Gems Hunt",
                description: "ðŸ—ºï¸ Discover 5 hidden gems in your city that aren't on tourist maps! Document each location and share the story behind it.",
                hashtags: ["#UrbanExplorer", "#HiddenGems", "#LocalDiscovery"],
                difficulty: "medium",
                tokens: 1500,
                type: "daily",
                creator: "adventure_mike",
                createdAt: new Date().toISOString(),
                avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face'
            });

            challengeData.push({
                id: 'fitness_001',
                title: "Public Workout Inspiration",
                description: "ðŸ’ª Do 50 push-ups in a public place and inspire at least 2 people to join you! Spread the fitness motivation!",
                hashtags: ["#PublicWorkout", "#FitnessMotivation", "#CommunityHealth"],
                difficulty: "medium",
                tokens: 1200,
                type: "daily",
                creator: "fitness_ryan",
                createdAt: new Date().toISOString(),
                avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face'
            });

            totalPages = challengeData.length;
            updateChallengeDisplay();
        }

        function updatePlayerDisplay() {
            document.getElementById('playerRank').textContent = playerData.rank;
            document.getElementById('playerTokens').textContent = `ðŸª™ ${playerData.tokens.toLocaleString()}`;
        }

        function updateChallengeDisplay() {
            const feedPages = document.getElementById('feedPages');
            feedPages.innerHTML = '';

            challengeData.forEach((challenge, index) => {
                const card = createChallengeCard(challenge, index);
                feedPages.appendChild(card);
            });

            if (challengeData.length > 0) {
                updateCurrentChallenge();
            }
        }

        function createChallengeCard(challenge, index) {
            const card = document.createElement('div');
            card.className = `challenge-card ${index === currentPage ? 'current' : (index === currentPage + 1 ? 'next' : 'prev')}`;
            card.setAttribute('data-index', index);

            const getDifficultyClass = (difficulty) => {
                switch(difficulty) {
                    case 'easy': return 'difficulty-easy';
                    case 'medium': return 'difficulty-medium';
                    case 'hard': return 'difficulty-hard';
                    case 'epic': return 'difficulty-epic';
                    case 'legendary': return 'difficulty-legendary';
                    default: return 'difficulty-easy';
                }
            };

            const getTypeClass = (type) => {
                switch(type) {
                    case 'daily': return 'daily';
                    case 'treasure': return 'treasure';
                    case 'vip': return 'vip';
                    case 'business': return 'business';
                    default: return 'daily';
                }
            };

            card.innerHTML = `
                <div class="challenge-content">
                    <div class="challenge-user">
                        <div class="challenge-avatar">
                            <div class="challenge-avatar-inner">
                                <img src="${challenge.avatar}" alt="${challenge.creator}">
                            </div>
                        </div>
                        <div>
                            <div class="challenge-username">
                                ${challenge.creator}
                                <span class="challenge-type ${getTypeClass(challenge.type)}">${challenge.type.toUpperCase()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="challenge-text">${challenge.description}</div>
                    
                    <div class="challenge-hashtags">
                        ${challenge.hashtags.map(tag => `<span class="challenge-hashtag">${tag}</span>`).join('')}
                    </div>
                    
                    <div class="challenge-reward">
                        ðŸª™ ${challenge.tokens.toLocaleString()} Tokens
                        <span class="challenge-difficulty ${getDifficultyClass(challenge.difficulty)}">${challenge.difficulty.toUpperCase()}</span>
                        ${challenge.realRewards ? `<br><small>ðŸŽ Real Reward: ${challenge.realRewards}</small>` : ''}
                    </div>
                    
                    <div class="challenge-actions">
                        <button class="challenge-btn btn-accept" onclick="acceptChallenge('${challenge.id}')">
                            ðŸš€ Accept Challenge
                        </button>
                        <button class="challenge-btn btn-decline" onclick="nextChallenge()">
                            Skip
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        function updateCurrentChallenge() {
            const cards = document.querySelectorAll('.challenge-card');
            cards.forEach((card, index) => {
                card.className = 'challenge-card';
                if (index === currentPage) {
                    card.classList.add('current');
                } else if (index === currentPage + 1) {
                    card.classList.add('next');
                } else {
                    card.classList.add('prev');
                }
            });

            // Update points display
            if (challengeData[currentPage]) {
                const pointsDisplay = document.getElementById('currentChallengePoints');
                if (pointsDisplay) {
                    pointsDisplay.textContent = formatPoints(challengeData[currentPage].tokens);
                }
            }
        }

        function formatPoints(points) {
            if (points >= 1000) {
                return (points / 1000).toFixed(1) + 'K';
            }
            return points.toString();
        }

        function nextChallenge() {
            if (isFlipping) return;
            isFlipping = true;
            
            currentPage = (currentPage + 1) % challengeData.length;
            updateCurrentChallenge();
            
            setTimeout(() => {
                isFlipping = false;
            }, 300);
        }

        function previousChallenge() {
            if (isFlipping) return;
            isFlipping = true;
            
            currentPage = currentPage === 0 ? challengeData.length - 1 : currentPage - 1;
            updateCurrentChallenge();
            
            setTimeout(() => {
                isFlipping = false;
            }, 300);
        }

        function setupSwipeGestures() {
            const feedElement = document.querySelector('.dark-feed');
            let startY = 0;
            let startX = 0;
            let deltaY = 0;
            let deltaX = 0;

            feedElement.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                startX = e.touches[0].clientX;
            });

            feedElement.addEventListener('touchmove', (e) => {
                e.preventDefault();
                deltaY = e.touches[0].clientY - startY;
                deltaX = e.touches[0].clientX - startX;
            });

            feedElement.addEventListener('touchend', () => {
                if (Math.abs(deltaY) > 50 && Math.abs(deltaY) > Math.abs(deltaX)) {
                    if (deltaY > 0) {
                        previousChallenge();
                    } else {
                        nextChallenge();
                    }
                }
                deltaY = 0;
                deltaX = 0;
            });
        }

        function createStories() {
            const storiesScroll = document.getElementById('storiesScroll');
            
            const stories = [
                { name: 'Your Story', avatar: playerData.avatar, isOwn: true },
                { name: 'Adventure Mike', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face' },
                { name: 'Business Sarah', avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=80&h=80&fit=crop&crop=face' },
                { name: 'Fitness Ryan', avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face' },
                { name: 'Social Emma', avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=80&h=80&fit=crop&crop=face' },
                { name: 'Tech Alex', avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=80&h=80&fit=crop&crop=face' },
                { name: 'Foodie Lisa', avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=80&h=80&fit=crop&crop=face' },
                { name: 'Artist Miguel', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face' }
            ];

            stories.forEach(story => {
                const storyItem = document.createElement('div');
                storyItem.className = 'story-item';
                storyItem.innerHTML = `
                    <div class="story-circle" onclick="viewStory('${story.name}')">
                        <div class="story-inner">
                            <img src="${story.avatar}" alt="${story.name}" class="story-image">
                        </div>
                    </div>
                    <div class="story-name">${story.name}</div>
                `;
                storiesScroll.appendChild(storyItem);
            });
        }

        function populateLeaderboard() {
            leaderboardData = [
                { rank: 1, name: 'Adventure Mike', tokens: 28394, avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face', title: 'Champion' },
                { rank: 2, name: 'Business Sarah', tokens: 22150, avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=80&h=80&fit=crop&crop=face', title: 'Elite' },
                { rank: 3, name: 'Fitness Ryan', tokens: 16890, avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face', title: 'Elite' },
                { rank: 4, name: 'Alexandra Stone', tokens: 15247, avatar: playerData.avatar, title: 'Elite Gladiator' },
                { rank: 5, name: 'Tech Alex', tokens: 19560, avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=80&h=80&fit=crop&crop=face', title: 'Elite' },
                { rank: 6, name: 'Social Emma', tokens: 14270, avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=80&h=80&fit=crop&crop=face', title: 'Duelist' },
                { rank: 7, name: 'Foodie Lisa', tokens: 13890, avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=80&h=80&fit=crop&crop=face', title: 'Duelist' },
                { rank: 8, name: 'Gamer Kevin', tokens: 15620, avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face', title: 'Duelist' }
            ];
        }

        // Enhanced Stories System with Real Examples
        function loadStories() {
            storiesData = [
                {
                    id: 'story_1',
                    userId: 'adventure_mike',
                    userName: 'Adventure Mike',
                    userAvatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=40&h=40&fit=crop&crop=face',
                    type: 'challenge',
                    caption: 'ðŸ”ï¸ EPIC WIN! Just completed the "Mount Kinabalu Sunrise Challenge" and OH MY GOD the view was INSANE! Started hiking at 2AM, reached the summit just as the sun painted the sky gold. Met this amazing group of Malaysian hikers who adopted me for the day ðŸ˜‚ Already planning next week\'s challenge: caving in Mulu!',
                    media: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=300&h=200&fit=crop',
                    timestamp: new Date(Date.now() - 45 * 60 * 1000),
                    views: 1847,
                    likes: 324,
                    comments: 67
                }
            ];
        }

        function viewStory(storyName) {
            showToast(`ðŸ‘€ Viewing ${storyName}'s story...`);
        }

        // Enhanced Live Activity System with immediate startup
        function startLiveActivity() {
            generateInitialActivity();
            
            // Generate immediate burst of activity to show community is active
            setTimeout(() => generateRandomActivity(), 1000);
            setTimeout(() => generateRandomActivity(), 3000);
            setTimeout(() => generateRandomActivity(), 6000);
            setTimeout(() => generateRandomActivity(), 10000);
            setTimeout(() => addGroupMemberActivity(), 8000);
            setTimeout(() => triggerGroupChallenge(), 12000);
            
            // Generate new activity every 5-15 seconds for better engagement
            activityInterval = setInterval(() => {
                generateRandomActivity();
            }, Math.random() * 10000 + 5000);
            
            // Generate group activity updates every 20-40 seconds
            setInterval(() => {
                if (Math.random() < 0.7) {
                    addGroupMemberActivity();
                }
            }, Math.random() * 20000 + 20000);
            
            // Generate group challenges every 45-90 seconds
            setInterval(() => {
                if (Math.random() < 0.6) {
                    triggerGroupChallenge();
                }
            }, Math.random() * 45000 + 45000);
            
            // Update player stats every 2 minutes
            setInterval(() => {
                updateAllPlayerStats();
            }, 120000);
            
            // Add real-time engagement notifications
            setInterval(() => {
                if (Math.random() < 0.4) {
                    addEngagementNotification();
                }
            }, Math.random() * 30000 + 30000);
        }

        // Generate initial activity
        function generateInitialActivity() {
            liveActivityData = [
                {
                    id: 'activity_initial_1',
                    type: 'challenge_completed',
                    player: automatedPlayers[0], // Adventure Mike
                    action: 'completed "Mount Kinabalu Sunrise Challenge" - epic 6-hour climb!',
                    reward: '3,500 tokens + Mountain Master badge',
                    timestamp: new Date(Date.now() - 1 * 60 * 1000),
                    icon: 'ðŸ”ï¸'
                },
                {
                    id: 'activity_initial_2',
                    type: 'business_deal',
                    player: automatedPlayers[1], // Business Sarah
                    action: 'closed $50K deal from Coffee Networking Challenge connection',
                    reward: 'Real business impact!',
                    timestamp: new Date(Date.now() - 3 * 60 * 1000),
                    icon: 'ðŸ’°'
                }
            ];
        }

        function generateRandomActivity() {
            const currentTime = new Date();
            const hour = currentTime.getHours();
            
            // Time-based realistic activities
            const timeBasedActivities = [
                // Morning activities (6-11 AM)
                ...(hour >= 6 && hour <= 11 ? [
                    {
                        player: automatedPlayers[2], // Fitness Ryan
                        type: 'challenge_completed',
                        action: 'completed "Morning 5km Run Challenge" along Marina Bay at sunrise ðŸŒ…',
                        reward: '1,200 tokens + Early Bird bonus',
                        icon: 'ðŸƒâ€â™‚ï¸'
                    },
                    {
                        player: automatedPlayers[5], // Foodie Lisa
                        type: 'challenge_completed',
                        action: 'found the best breakfast pho in District 1 - hidden gem discovered! ðŸœ',
                        reward: '800 tokens + Local Expert badge',
                        icon: 'ðŸœ'
                    }
                ] : []),
                
                // Regular activities (any time)
                {
                    player: automatedPlayers[0], // Adventure Mike
                    type: 'group_challenge_creation',
                    action: 'created "Extreme Waterfall Jumping Challenge" - 47 brave souls signed up!',
                    reward: 'Challenge Creator bonus + Safety Equipment sponsor',
                    icon: 'ðŸŒŠ'
                },
                {
                    player: automatedPlayers[1], // Business Sarah
                    type: 'mentorship_session',
                    action: 'mentored 5 young entrepreneurs at co-working space ðŸ“š',
                    reward: '1,800 tokens + Mentor Recognition badge',
                    icon: 'ðŸ‘©â€ðŸ«'
                }
            ];

            // Select random activity from time-appropriate activities
            const availableActivities = timeBasedActivities.length > 0 ? timeBasedActivities : [
                {
                    player: automatedPlayers[Math.floor(Math.random() * automatedPlayers.length)],
                    type: 'challenge_completed',
                    action: 'completed daily challenge and earned tokens!',
                    reward: '500-1500 tokens',
                    icon: 'ðŸŽ¯'
                }
            ];
            
            const activity = availableActivities[Math.floor(Math.random() * availableActivities.length)];

            const newActivity = {
                id: 'activity_' + Date.now(),
                type: activity.type,
                player: activity.player,
                action: activity.action,
                reward: activity.reward,
                timestamp: new Date(),
                icon: activity.icon
            };

            // Add to beginning of array and limit to 100 items for better performance
            liveActivityData.unshift(newActivity);
            if (liveActivityData.length > 100) {
                liveActivityData = liveActivityData.slice(0, 100);
            }

            // Update group activity and player stats
            updatePlayerProgress(activity.player);

            // Sometimes add group notifications (more frequent for better engagement)
            if (Math.random() < 0.4) {
                addGroupActivity(activity.player);
            }

            // Update notification count occasionally
            if (Math.random() < 0.3) {
                const currentCount = parseInt(document.getElementById('notificationCount').textContent);
                document.getElementById('notificationCount').textContent = currentCount + 1;
                updateNotificationCount();
            }

            // Sometimes trigger group challenges
            if (Math.random() < 0.2) {
                triggerGroupChallenge();
            }

            // Add real-time group member activities
            if (Math.random() < 0.3) {
                addGroupMemberActivity();
            }
        }

        // Helper function to update player progress
        function updatePlayerProgress(player) {
            if (player) {
                player.completedToday = Math.min(player.completedToday + 1, 10);
                player.tokens += Math.floor(Math.random() * 2000) + 500;
                
                // Sometimes level up
                if (Math.random() < 0.1) {
                    player.level += 1;
                    addLevelUpActivity(player);
                }
            }
        }

        // Helper function to add group activities
        function addGroupActivity(player) {
            const groupActivities = [
                `${player.name} shared expert tips in Adventure Seekers group`,
                `${player.name} organized group meetup in ${player.location}`,
                `${player.name} mentored 3 new members in their specialty area`,
                `${player.name} created team challenge for group members`,
                `${player.name} hosted live Q&A session about their recent challenges`
            ];

            const groupActivity = {
                id: 'group_activity_' + Date.now(),
                type: 'group_contribution',
                player: player,
                action: groupActivities[Math.floor(Math.random() * groupActivities.length)],
                reward: null,
                timestamp: new Date(),
                icon: 'ðŸ‘¥'
            };

            liveActivityData.unshift(groupActivity);
        }

        // Helper function for level up activities
        function addLevelUpActivity(player) {
            const levelUpActivity = {
                id: 'levelup_' + Date.now(),
                type: 'level_up',
                player: player,
                action: `leveled up to ${player.level}! ðŸŽ‰`,
                reward: `Level bonus: ${player.level * 100} tokens`,
                timestamp: new Date(),
                icon: 'â­'
            };

            liveActivityData.unshift(levelUpActivity);
        }

        // Trigger group challenges
        function triggerGroupChallenge() {
            const groupChallenges = [
                {
                    group: 'Adventure Seekers',
                    challenge: 'Weekend Mountain Expedition to Gunung Ledang - 15 spots available!',
                    participants: Math.floor(Math.random() * 20) + 10,
                    icon: 'ðŸ”ï¸',
                    player: automatedPlayers[0] // Adventure Mike
                },
                {
                    group: 'Business Network',
                    challenge: 'Startup Pitch Night at KLCC - Present your ideas to investors!',
                    participants: Math.floor(Math.random() * 15) + 8,
                    icon: 'ðŸ’¼',
                    player: automatedPlayers[1] // Business Sarah
                }
            ];

            const challenge = groupChallenges[Math.floor(Math.random() * groupChallenges.length)];
            
            const groupChallengeActivity = {
                id: 'group_challenge_' + Date.now(),
                type: 'group_challenge_launched',
                player: challenge.player,
                action: `${challenge.group}: ${challenge.challenge}`,
                reward: `${challenge.participants} members already joined!`,
                timestamp: new Date(),
                icon: challenge.icon
            };

            liveActivityData.unshift(groupChallengeActivity);
        }

        // Add group member activities
        function addGroupMemberActivity() {
            const memberActivities = [
                {
                    group: 'Adventure Seekers',
                    activities: [
                        'Mike shared breathtaking photos from last weekend\'s cliff jumping!',
                        'Sarah completed her first rock climbing challenge - huge milestone!',
                        'New member Emma just joined and already signed up for caving expedition!',
                        'Group reached 350 members milestone - celebration challenge incoming!'
                    ],
                    icon: 'ðŸ”ï¸'
                },
                {
                    group: 'Business Network',
                    activities: [
                        'Sarah just announced her startup\'s Series A funding success! ðŸŽ‰',
                        'Weekly networking breakfast tomorrow at Pavilion - 12 confirmed!',
                        'New partnership opportunity shared: Fintech collaboration project',
                        'Member spotlight: How John built his e-commerce empire in 6 months'
                    ],
                    icon: 'ðŸ’¼'
                }
            ];

            const randomGroup = memberActivities[Math.floor(Math.random() * memberActivities.length)];
            const randomActivity = randomGroup.activities[Math.floor(Math.random() * randomGroup.activities.length)];
            
            const memberActivity = {
                id: 'member_activity_' + Date.now(),
                type: 'group_member_update',
                player: { name: randomGroup.group, avatar: randomGroup.icon },
                action: randomActivity,
                reward: null,
                timestamp: new Date(),
                icon: 'ðŸ‘¥'
            };

            liveActivityData.unshift(memberActivity);
        }

        // Update all player stats periodically
        function updateAllPlayerStats() {
            automatedPlayers.forEach(player => {
                // Reset daily completions
                if (Math.random() < 0.1) {
                    player.completedToday = 0;
                }
                
                // Update streaks
                if (Math.random() < 0.8) {
                    player.currentStreak += 1;
                } else if (Math.random() < 0.2) {
                    player.currentStreak = Math.max(0, player.currentStreak - 1);
                }
                
                // Add tokens from passive activities
                player.tokens += Math.floor(Math.random() * 500) + 100;
            });
        }

        // Add engagement notifications
        function addEngagementNotification() {
            const engagementTypes = [
                {
                    action: 'ðŸ”¥ JomBro is trending! 500+ challenges completed in the last hour!',
                    icon: 'ðŸ“ˆ',
                    player: { name: 'JomBro Analytics', avatar: 'ðŸ“Š' }
                },
                {
                    action: 'ðŸŒŸ New personal record: Adventure Mike completed 8 challenges today!',
                    icon: 'ðŸ†',
                    player: { name: 'Achievement System', avatar: 'ðŸ…' }
                },
                {
                    action: 'â¤ï¸ Most liked challenge today: "Coffee Shop Poetry" with 2,500 likes!',
                    icon: 'ðŸ’•',
                    player: { name: 'Community Highlights', avatar: 'â­' }
                }
            ];

            const engagement = engagementTypes[Math.floor(Math.random() * engagementTypes.length)];
            
            const engagementActivity = {
                id: 'engagement_' + Date.now(),
                type: 'community_engagement',
                player: engagement.player,
                action: engagement.action,
                reward: null,
                timestamp: new Date(),
                icon: engagement.icon
            };

            liveActivityData.unshift(engagementActivity);
            
            // Update notification count
            if (Math.random() < 0.5) {
                const currentCount = parseInt(document.getElementById('notificationCount').textContent);
                document.getElementById('notificationCount').textContent = currentCount + 1;
                updateNotificationCount();
            }
        }

        // Action Functions
        function acceptChallenge(challengeId) {
            const challenge = challengeData.find(c => c.id === challengeId);
            if (challenge) {
                showToast(`ðŸš€ Challenge "${challenge.title}" accepted! Good luck!`);
                
                // Show completion modal after a delay (simulate doing the challenge)
                setTimeout(() => {
                    showChallengeCompletion(challengeId);
                }, 3000);
                
                nextChallenge();
            }
        }

        function likeChallenge() {
            showToast('â¤ï¸ Challenge liked!');
            createFloatingHeart();
        }

        function shareChallenge() {
            const currentChallengeData = challengeData[currentPage];
            if (currentChallengeData) {
                showToast(`ðŸ“¤ "${currentChallengeData.title}" shared with friends!`);
            }
        }

        function bookmarkChallenge() {
            showToast('ðŸ”– Challenge bookmarked!');
        }

        function createChallenge() {
            const type = document.getElementById('challengeType').value;
            const target = document.getElementById('challengeTarget').value;
            const description = document.getElementById('challengeDesc').value;
            const points = document.getElementById('challengePoints').value;

            if (!description.trim()) {
                showToast('âŒ Please enter a challenge description!');
                return;
            }

            const newChallenge = {
                id: 'user_' + Date.now(),
                title: "User Created Challenge",
                description: description,
                hashtags: ["#UserChallenge", "#JomBro", "#Community"],
                difficulty: points >= 5000 ? "epic" : points >= 2500 ? "hard" : "medium",
                tokens: parseInt(points),
                type: type,
                creator: playerData.displayName,
                createdAt: new Date().toISOString(),
                avatar: playerData.avatar
            };

            challengeData.unshift(newChallenge);
            totalPages = challengeData.length;
            playerData.createdChallenges++;
            updateChallengeDisplay();

            hideModal('create');
            showToast('âœ¨ Challenge created successfully!');
            
            // Update localStorage
            localStorage.setItem('jombro_user', JSON.stringify(playerData));
        }

        function purchaseTokens() {
            const tokenPackage = document.getElementById('tokenPackage').value;
            const vipPackage = document.getElementById('vipPackage').value;

            hideModal('shop');
            showToast(`ðŸ’³ Purchase successful! ${tokenPackage} tokens added to your account!`);
            
            // Update player tokens
            playerData.tokens += parseInt(tokenPackage);
            playerData.totalEarned += parseInt(tokenPackage);
            
            // Handle VIP upgrade
            if (vipPackage) {
                playerData.vipStatus = vipPackage.includes('vvip') ? 'vvip' : 'vip';
                const months = vipPackage.includes('3') ? 3 : 1;
                const expiryDate = new Date();
                expiryDate.setMonth(expiryDate.getMonth() + months);
                playerData.vipExpiry = expiryDate.toISOString();
                showToast(`ðŸ‘‘ ${playerData.vipStatus.toUpperCase()} membership activated!`);
            }
            
            updatePlayerDisplay();
            localStorage.setItem('jombro_user', JSON.stringify(playerData));
        }

        function createFloatingHeart() {
            const heart = document.createElement('div');
            heart.textContent = 'â¤ï¸';
            heart.className = 'instant-heart';

            document.body.appendChild(heart);

            setTimeout(() => {
                heart.remove();
            }, 1000);
        }

        // Navigation Functions
        function navigateAction(element, action) {
            switch(action) {
                case 'create':
                    showModal('create');
                    break;
                case 'notifications':
                    showNotifications();
                    break;
                case 'messages':
                    showMessages();
                    break;
            }
        }

        function navAction(element, section) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            element.classList.add('active');

            switch(section) {
                case 'home':
                    break;
                case 'leaderboard':
                    showLeaderboard();
                    break;
                case 'create':
                    showModal('create');
                    break;
                case 'shop':
                    showModal('shop');
                    break;
                case 'profile':
                    showProfile();
                    break;
            }
        }

        function showLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '';

            leaderboardData.forEach(player => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                item.innerHTML = `
                    <div class="rank-number">${player.rank}</div>
                    <img src="${player.avatar}" alt="${player.name}" class="player-avatar">
                    <div class="player-details">
                        <div class="player-name">${player.name}</div>
                        <div class="player-rank-title">${player.title}</div>
                    </div>
                    <div class="player-score">${player.tokens.toLocaleString()}</div>
                `;
                leaderboardList.appendChild(item);
            });

            showModal('leaderboard');
        }

        function showLiveActivity() {
            populateLiveActivityFeed();
            showModal('activityFeed');
        }

        function populateLiveActivityFeed() {
            const container = document.getElementById('liveActivityFeed');
            container.innerHTML = '';

            if (liveActivityData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7);">No activity yet. Be the first to complete a challenge!</p>';
                return;
            }

            liveActivityData.forEach(activity => {
                const timeAgo = getTimeAgo(activity.timestamp);
                
                const activityElement = document.createElement('div');
                activityElement.className = 'leaderboard-item';
                activityElement.style.marginBottom = '10px';
                activityElement.innerHTML = `
                    <div style="font-size: 24px; margin-right: 16px;">${activity.icon}</div>
                    <div class="player-details">
                        <div class="player-name">${activity.player.name}</div>
                        <div class="player-rank-title">${activity.action}</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.5);">${timeAgo}${activity.reward ? ` â€¢ ${activity.reward}` : ''}</div>
                    </div>
                    <img src="${activity.player.avatar}" alt="${activity.player.name}" style="width: 40px; height: 40px; border-radius: 20px; border: 2px solid rgba(0, 255, 150, 0.3);">
                `;
                container.appendChild(activityElement);
            });
        }

        // Challenge completion functions
        function showChallengeCompletion(challengeId) {
            currentChallenge = challengeData.find(c => c.id === challengeId);
            showModal('challengeCompletion');
        }

        function setRating(rating) {
            selectedRating = rating;
            document.querySelectorAll('.star').forEach((star, index) => {
                star.style.opacity = index < rating ? '1' : '0.3';
            });
        }

        function submitChallengeCompletion() {
            const description = document.getElementById('challengeCompletionDesc').value;
            const mediaFile = document.getElementById('challengeMedia').files[0];

            if (!description.trim()) {
                showToast('âŒ Please add a description of your experience!');
                return;
            }

            if (selectedRating === 0) {
                showToast('âŒ Please rate your experience!');
                return;
            }

            // Award tokens
            if (currentChallenge) {
                playerData.tokens += currentChallenge.tokens;
                playerData.completedChallenges++;
                playerData.streakCurrent++;
                
                if (playerData.streakCurrent > playerData.streakBest) {
                    playerData.streakBest = playerData.streakCurrent;
                }
                
                // Check for level up
                checkLevelUp();
                
                updatePlayerDisplay();
                localStorage.setItem('jombro_user', JSON.stringify(playerData));
            }

            hideModal('challengeCompletion');
            showToast(`ðŸŽ‰ Challenge completed! +${currentChallenge.tokens} tokens earned!`);

            // Reset for next challenge
            selectedRating = 0;
            document.querySelectorAll('.star').forEach(star => {
                star.style.opacity = '0.3';
            });
            document.getElementById('challengeCompletionDesc').value = '';
            document.getElementById('challengeMedia').value = '';
        }

        function checkLevelUp() {
            const newLevel = Math.floor(playerData.completedChallenges / 10) + 1;
            if (newLevel > playerData.level) {
                const oldLevel = playerData.level;
                playerData.level = newLevel;
                
                // Update rank based on level
                if (newLevel >= 50) playerData.rank = 'Legendary Gladiator';
                else if (newLevel >= 40) playerData.rank = 'Champion';
                else if (newLevel >= 30) playerData.rank = 'Elite Gladiator';
                else if (newLevel >= 20) playerData.rank = 'Elite';
                else if (newLevel >= 15) playerData.rank = 'Duelist';
                else if (newLevel >= 10) playerData.rank = 'Rival';
                else if (newLevel >= 5) playerData.rank = 'Warrior';
                else playerData.rank = 'Novice';
                
                showToast(`ðŸŽ‰ Level up! You are now Level ${newLevel} - ${playerData.rank}!`);
                
                // Award level up bonus
                const bonus = newLevel * 500;
                playerData.tokens += bonus;
                showToast(`ðŸ’° Level up bonus: +${bonus} tokens!`);
            }
        }

        // Profile functions
        function showProfile() {
            populateProfileView();
            populateProfileEdit();
            populateBusinessCard();
            showModal('profile');
        }

        function showProfileTab(tab) {
            // Reset tab buttons
            document.getElementById('viewProfileTab').className = 'btn-secondary';
            document.getElementById('editProfileTab').className = 'btn-secondary';
            document.getElementById('cardProfileTab').className = 'btn-secondary';
            
            // Hide all content
            document.getElementById('viewProfileContent').style.display = 'none';
            document.getElementById('editProfileContent').style.display = 'none';
            document.getElementById('cardProfileContent').style.display = 'none';
            
            // Show selected tab
            if (tab === 'view') {
                document.getElementById('viewProfileTab').className = 'btn-primary';
                document.getElementById('viewProfileContent').style.display = 'block';
            } else if (tab === 'edit') {
                document.getElementById('editProfileTab').className = 'btn-primary';
                document.getElementById('editProfileContent').style.display = 'block';
            } else if (tab === 'card') {
                document.getElementById('cardProfileTab').className = 'btn-primary';
                document.getElementById('cardProfileContent').style.display = 'block';
            }
        }

        function populateProfileView() {
            const container = document.getElementById('viewProfileContent');
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <img src="${playerData.avatar}" alt="Avatar" style="width: 100px; height: 100px; border-radius: 50px; border: 4px solid #00FF96; margin-bottom: 15px;">
                    <h2 style="color: #fff; margin-bottom: 5px;">${playerData.displayName}</h2>
                    <p style="color: #FFD700; margin-bottom: 5px;">${playerData.rank}</p>
                    <p style="color: rgba(255, 255, 255, 0.7);">${playerData.location}</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px;">
                    <div style="text-align: center; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 12px;">
                        <div style="font-size: 24px; color: #00FF96; font-weight: 700;">${playerData.tokens.toLocaleString()}</div>
                        <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">Tokens</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 12px;">
                        <div style="font-size: 24px; color: #FFD700; font-weight: 700;">${playerData.level}</div>
                        <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">Level</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 12px;">
                        <div style="font-size: 24px; color: #4FC3F7; font-weight: 700;">${playerData.completedChallenges}</div>
                        <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">Completed</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 12px;">
                        <div style="font-size: 24px; color: #FF6B47; font-weight: 700;">${playerData.streakCurrent}</div>
                        <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">Streak</div>
                    </div>
                </div>
                
                <div style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 16px; margin-bottom: 20px;">
                    <h3 style="color: #fff; margin-bottom: 15px;">ðŸ“Š Statistics</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>Win Rate: <span style="color: #00FF96;">${playerData.winRate}%</span></div>
                        <div>Total Earned: <span style="color: #FFD700;">${playerData.totalEarned.toLocaleString()}</span></div>
                        <div>Created: <span style="color: #4FC3F7;">${playerData.createdChallenges}</span></div>
                        <div>Best Streak: <span style="color: #FF6B47;">${playerData.streakBest}</span></div>
                    </div>
                </div>
                
                <div style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 16px;">
                    <h3 style="color: #fff; margin-bottom: 15px;">ðŸ† Recent Achievements</h3>
                    ${playerData.achievements.map(achievement => `
                        <div style="background: rgba(255, 215, 0, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 8px;">
                            <span style="color: #FFD700;">ðŸ† ${achievement}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function populateProfileEdit() {
            document.getElementById('editDisplayName').value = playerData.displayName;
            document.getElementById('editBio').value = playerData.bio || '';
            document.getElementById('editLocation').value = playerData.location || '';
            document.getElementById('editWebsite').value = playerData.website || '';
            document.getElementById('editInstagram').value = playerData.instagram || '';
            document.getElementById('editLinkedIn').value = playerData.linkedin || '';
            document.getElementById('editSkills').value = playerData.skills || '';
        }

        function populateBusinessCard() {
            document.getElementById('cardAvatar').src = playerData.avatar;
            document.getElementById('cardName').textContent = playerData.displayName;
            document.getElementById('cardTitle').textContent = playerData.rank;
            document.getElementById('cardLocation').textContent = playerData.location;
            document.getElementById('cardTokens').textContent = playerData.tokens.toLocaleString();
            document.getElementById('cardLevel').textContent = playerData.level;
            document.getElementById('cardChallenges').textContent = playerData.completedChallenges;
            document.getElementById('cardBio').textContent = playerData.bio || 'No bio available';
            
            const linksContainer = document.getElementById('cardLinks');
            linksContainer.innerHTML = '';
            
            if (playerData.website) {
                const websiteLink = document.createElement('a');
                websiteLink.href = playerData.website;
                websiteLink.target = '_blank';
                websiteLink.style.cssText = 'background: rgba(0, 255, 150, 0.1); border: 1px solid rgba(0, 255, 150, 0.3); padding: 8px 15px; border-radius: 20px; font-size: 12px; text-decoration: none; color: #00FF96; display: flex; align-items: center; gap: 5px;';
                websiteLink.innerHTML = 'ðŸŒ Website';
                linksContainer.appendChild(websiteLink);
            }
            
            if (playerData.instagram) {
                const instagramLink = document.createElement('a');
                instagramLink.href = `https://instagram.com/${playerData.instagram}`;
                instagramLink.target = '_blank';
                instagramLink.style.cssText = 'background: rgba(0, 255, 150, 0.1); border: 1px solid rgba(0, 255, 150, 0.3); padding: 8px 15px; border-radius: 20px; font-size: 12px; text-decoration: none; color: #00FF96; display: flex; align-items: center; gap: 5px;';
                instagramLink.innerHTML = 'ðŸ“· Instagram';
                linksContainer.appendChild(instagramLink);
            }
            
            if (playerData.linkedin) {
                const linkedinLink = document.createElement('a');
                linkedinLink.href = playerData.linkedin;
                linkedinLink.target = '_blank';
                linkedinLink.style.cssText = 'background: rgba(0, 255, 150, 0.1); border: 1px solid rgba(0, 255, 150, 0.3); padding: 8px 15px; border-radius: 20px; font-size: 12px; text-decoration: none; color: #00FF96; display: flex; align-items: center; gap: 5px;';
                linkedinLink.innerHTML = 'ðŸ’¼ LinkedIn';
                linksContainer.appendChild(linkedinLink);
            }
        }

        function saveProfile() {
            playerData.displayName = document.getElementById('editDisplayName').value;
            playerData.bio = document.getElementById('editBio').value;
            playerData.location = document.getElementById('editLocation').value;
            playerData.website = document.getElementById('editWebsite').value;
            playerData.instagram = document.getElementById('editInstagram').value;
            playerData.linkedin = document.getElementById('editLinkedIn').value;
            playerData.skills = document.getElementById('editSkills').value;
            
            localStorage.setItem('jombro_user', JSON.stringify(playerData));
            showToast('ðŸ’¾ Profile updated successfully!');
            
            populateProfileView();
            populateBusinessCard();
            showProfileTab('view');
        }

        function shareBusinessCard() {
            if (navigator.share) {
                navigator.share({
                    title: `${playerData.displayName} - JomBro`,
                    text: `Check out my JomBro profile! Level ${playerData.level} ${playerData.rank}`,
                    url: window.location.href
                });
            } else {
                showToast('ðŸ“‹ Business card link copied to clipboard!');
            }
        }

        // Groups Functions
        function showGroups() {
            populateMyGroups();
            populateDiscoverGroups();
            showModal('groups');
        }

        function showGroupTab(tab) {
            // Reset tab buttons
            document.getElementById('myGroupsTab').className = 'btn-secondary';
            document.getElementById('discoverGroupsTab').className = 'btn-secondary';
            document.getElementById('createGroupTab').className = 'btn-secondary';
            
            // Hide all content
            document.getElementById('myGroupsContent').style.display = 'none';
            document.getElementById('discoverGroupsContent').style.display = 'none';
            document.getElementById('createGroupContent').style.display = 'none';
            
            // Show selected tab
            if (tab === 'my') {
                document.getElementById('myGroupsTab').className = 'btn-primary';
                document.getElementById('myGroupsContent').style.display = 'block';
            } else if (tab === 'discover') {
                document.getElementById('discoverGroupsTab').className = 'btn-primary';
                document.getElementById('discoverGroupsContent').style.display = 'block';
            } else if (tab === 'create') {
                document.getElementById('createGroupTab').className = 'btn-primary';
                document.getElementById('createGroupContent').style.display = 'block';
            }
        }

        function populateMyGroups() {
            const container = document.getElementById('userGroupsList');
            const userGroups = groupsData.filter(group => group.isMember);
            
            container.innerHTML = '';
            
            if (userGroups.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7);">You haven\'t joined any groups yet!</p>';
                return;
            }
            
            userGroups.forEach(group => {
                const groupElement = document.createElement('div');
                groupElement.className = 'leaderboard-item';
                groupElement.innerHTML = `
                    <div style="font-size: 40px; margin-right: 16px;">${group.avatar}</div>
                    <div class="player-details">
                        <div class="player-name">${group.name}</div>
                        <div class="player-rank-title">${group.members} members â€¢ ${group.challenges} challenges â€¢ ${group.weeklyActivity}% activity</div>
                        <div style="font-size: 12px; color: #4FC3F7;">${group.activeChallenge}</div>
                    </div>
                    <button class="btn-primary" onclick="viewGroup('${group.id}')" style="padding: 8px 16px; font-size: 14px;">View</button>
                `;
                container.appendChild(groupElement);
            });
        }

        function populateDiscoverGroups() {
            const container = document.getElementById('publicGroupsList');
            const publicGroups = groupsData.filter(group => group.privacy === 'public' && !group.isMember);
            
            container.innerHTML = '';
            
            publicGroups.forEach(group => {
                const groupElement = document.createElement('div');
                groupElement.className = 'leaderboard-item';
                groupElement.innerHTML = `
                    <div style="font-size: 40px; margin-right: 16px;">${group.avatar}</div>
                    <div class="player-details">
                        <div class="player-name">${group.name}</div>
                        <div class="player-rank-title">${group.members} members â€¢ ${group.challenges} challenges â€¢ ${group.weeklyActivity}% activity</div>
                        <div style="font-size: 12px; color: #4FC3F7;">${group.activeChallenge}</div>
                    </div>
                    <button class="btn-primary" onclick="joinGroup('${group.id}')" style="padding: 8px 16px; font-size: 14px;">Join</button>
                `;
                container.appendChild(groupElement);
            });
        }

        function viewGroup(groupId) {
            showToast('ðŸ‘¥ Viewing group details...');
        }

        function joinGroup(groupId) {
            const group = groupsData.find(g => g.id === groupId);
            if (group) {
                group.isMember = true;
                group.members++;
                showToast(`ðŸŽ‰ Joined ${group.name}!`);
                populateMyGroups();
                populateDiscoverGroups();
            }
        }

        function createGroup() {
            const name = document.getElementById('newGroupName').value;
            const description = document.getElementById('newGroupDescription').value;
            const privacy = document.getElementById('newGroupPrivacy').value;
            const category = document.getElementById('newGroupCategory').value;

            if (!name || !description) {
                showToast('âŒ Please fill in group name and description!');
                return;
            }

            showToast('ðŸŽ‰ Group created successfully!');
            
            // Clear form
            document.getElementById('newGroupName').value = '';
            document.getElementById('newGroupDescription').value = '';
            
            populateMyGroups();
            showGroupTab('my');
        }

        function searchGroups() {
            // Simple search functionality
            populateDiscoverGroups();
        }

        // Notifications and other load functions
        function loadNotifications() {
            notificationsData = [
                {
                    id: 'notif_1',
                    type: 'challenge_completed',
                    title: 'Challenge Completed!',
                    message: 'Adventure Mike completed your "Urban Explorer" challenge and earned 1,500 tokens!',
                    time: new Date(Date.now() - 5 * 60 * 1000),
                    read: false,
                    avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=40&h=40&fit=crop&crop=face'
                }
            ];
            
            updateNotificationCount();
        }

        function updateNotificationCount() {
            const unreadCount = notificationsData.filter(n => !n.read).length;
            document.getElementById('notificationCount').textContent = unreadCount;
        }

        function showNotifications() {
            populateNotificationsList();
            showModal('notifications');
        }

        function populateNotificationsList() {
            const container = document.getElementById('notificationsList');
            container.innerHTML = '';
            
            if (notificationsData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.7);">No notifications</p>';
                return;
            }
            
            notificationsData.forEach(notification => {
                const timeAgo = getTimeAgo(notification.time);
                
                const notificationElement = document.createElement('div');
                notificationElement.className = 'leaderboard-item';
                if (!notification.read) notificationElement.classList.add('unread');
                
                notificationElement.innerHTML = `
                    ${typeof notification.avatar === 'string' && notification.avatar.startsWith('http') ? 
                        `<img src="${notification.avatar}" alt="Avatar" style="width: 40px; height: 40px; border-radius: 20px; margin-right: 16px;">` :
                        `<div style="font-size: 24px; margin-right: 16px;">${notification.avatar}</div>`
                    }
                    <div class="player-details">
                        <div class="player-name">${notification.title}</div>
                        <div class="player-rank-title">${notification.message}</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.5);">${timeAgo}</div>
                    </div>
                `;
                
                notificationElement.onclick = () => markNotificationRead(notification.id);
                container.appendChild(notificationElement);
            });
        }

        function markNotificationRead(notificationId) {
            const notification = notificationsData.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                updateNotificationCount();
                populateNotificationsList();
            }
        }

        function loadAchievements() {
            achievementsData = [];
        }

        function loadMessages() {
            messagesData = [];
        }

        function loadChallengeLikes() {
            challengeLikesData = [];
        }

        function loadFriends() {
            friendsData = [];
        }

        // Settings functions
        function showSettings() {
            loadCurrentSettings();
            showModal('settings');
        }

        function loadCurrentSettings() {
            document.getElementById('notificationSettings').value = playerData.settings.notifications;
            document.getElementById('privacySettings').value = playerData.settings.privacy;
            document.getElementById('languageSettings').value = playerData.settings.language;
        }

        function saveSettings() {
            playerData.settings.notifications = document.getElementById('notificationSettings').value;
            playerData.settings.privacy = document.getElementById('privacySettings').value;
            playerData.settings.language = document.getElementById('languageSettings').value;
            
            localStorage.setItem('jombro_user', JSON.stringify(playerData));
            showToast('âš™ï¸ Settings saved successfully!');
            hideModal('settings');
        }

        function showBackgroundSettings() {
            hideModal('settings');
            showModal('background');
        }

        // Background system
        function changeBackground(backgroundType) {
            // Update active state
            document.querySelectorAll('.bg-option').forEach(option => {
                option.classList.remove('active');
            });
            document.querySelector(`[data-bg="${backgroundType}"]`).classList.add('active');
            
            // Hide all current effects
            hideAllBackgroundEffects();
            
            // Remove all background classes
            document.body.classList.remove(
                'underwater', 'sky', 'beach', 'rainy', 'city', 'jungle', 'forest', 'mountain',
                'sunset', 'snowy', 'cyberpunk', 'aurora', 'volcano', 'thunderstorm', 'wedding',
                'tropical', 'galaxy', 'neon', 'meadow', 'twilight', 'carnival', 'ice',
                'steampunk', 'retro', 'noir', 'paradise', 'mystic', 'future', 'desert'
            );
            
            // Apply new background
            if (backgroundType !== 'space') {
                document.body.classList.add(backgroundType);
            }
            
            // Create background effects
            createBackgroundEffects(backgroundType);
            
            currentBackground = backgroundType;
            showToast(`ðŸŽ¨ Background changed to ${backgroundType}!`);
        }

        function hideAllBackgroundEffects() {
            const effectContainers = [
                'underwaterBubbles', 'skyClouds', 'beachWaves', 'rainDrops', 'cityLights',
                'jungleLeaves', 'snowFlakes', 'auroraLights', 'cyberpunkGrid', 'thunderstormEffects',
                'weddingPetals', 'tropicalFish', 'galaxySpiral', 'neonLines', 'fireflies'
            ];
            
            effectContainers.forEach(container => {
                const element = document.getElementById(container);
                if (element) {
                    element.style.display = 'none';
                    element.innerHTML = '';
                }
            });
        }

        function createBackgroundEffects(type) {
            switch(type) {
                case 'underwater':
                    createUnderwaterEffect();
                    break;
                case 'sky':
                    createSkyEffect();
                    break;
                case 'rainy':
                    createRainEffect();
                    break;
                case 'snowy':
                case 'ice':
                    createSnowEffect();
                    break;
                case 'cyberpunk':
                    createCyberpunkEffect();
                    break;
                case 'neon':
                    createNeonEffect();
                    break;
                default:
                    break;
            }
        }

        function createUnderwaterEffect() {
            const container = document.getElementById('underwaterBubbles');
            container.style.display = 'block';
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.style.position = 'fixed';
                    bubble.style.width = Math.random() * 20 + 10 + 'px';
                    bubble.style.height = bubble.style.width;
                    bubble.style.backgroundColor = 'rgba(135, 206, 235, 0.3)';
                    bubble.style.borderRadius = '50%';
                    bubble.style.left = Math.random() * 100 + 'vw';
                    bubble.style.bottom = '-50px';
                    bubble.style.animation = `bubbleFloat ${Math.random() * 3 + 4}s linear infinite`;
                    bubble.style.zIndex = '1';
                    
                    container.appendChild(bubble);
                    
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.remove();
                        }
                    }, 7000);
                }, i * 500);
            }
            
            // Continue creating bubbles
            setInterval(() => {
                if (container.style.display === 'block') {
                    const bubble = document.createElement('div');
                    bubble.style.position = 'fixed';
                    bubble.style.width = Math.random() * 15 + 8 + 'px';
                    bubble.style.height = bubble.style.width;
                    bubble.style.backgroundColor = 'rgba(135, 206, 235, 0.4)';
                    bubble.style.borderRadius = '50%';
                    bubble.style.left = Math.random() * 100 + 'vw';
                    bubble.style.bottom = '-30px';
                    bubble.style.animation = `bubbleFloat ${Math.random() * 2 + 3}s linear infinite`;
                    bubble.style.zIndex = '1';
                    
                    container.appendChild(bubble);
                    
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.remove();
                        }
                    }, 5000);
                }
            }, 800);
        }

        function createSkyEffect() {
            const container = document.getElementById('skyClouds');
            container.style.display = 'block';
            
            for (let i = 0; i < 5; i++) {
                const cloud = document.createElement('div');
                cloud.textContent = 'â˜ï¸';
                cloud.style.position = 'fixed';
                cloud.style.fontSize = Math.random() * 40 + 30 + 'px';
                cloud.style.top = Math.random() * 50 + 10 + '%';
                cloud.style.left = '-100px';
                cloud.style.animation = `cloudDrift ${Math.random() * 20 + 30}s linear infinite`;
                cloud.style.zIndex = '1';
                cloud.style.opacity = '0.6';
                
                container.appendChild(cloud);
            }
        }

        function createRainEffect() {
            const container = document.getElementById('rainDrops');
            container.style.display = 'block';
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const drop = document.createElement('div');
                    drop.style.position = 'fixed';
                    drop.style.width = '2px';
                    drop.style.height = '20px';
                    drop.style.background = 'rgba(135, 206, 235, 0.8)';
                    drop.style.left = Math.random() * 100 + 'vw';
                    drop.style.top = '-30px';
                    drop.style.animation = `rainFall ${Math.random() * 1 + 1}s linear infinite`;
                    drop.style.zIndex = '1';
                    
                    container.appendChild(drop);
                    
                    setTimeout(() => {
                        if (drop.parentNode) {
                            drop.remove();
                        }
                    }, 2000);
                }, i * 50);
            }
        }

        function createSnowEffect() {
            const container = document.getElementById('snowFlakes');
            container.style.display = 'block';
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const flake = document.createElement('div');
                    flake.textContent = 'â„ï¸';
                    flake.style.position = 'fixed';
                    flake.style.fontSize = Math.random() * 15 + 10 + 'px';
                    flake.style.left = Math.random() * 100 + 'vw';
                    flake.style.top = '-30px';
                    flake.style.animation = `snowFall ${Math.random() * 3 + 4}s linear infinite`;
                    flake.style.zIndex = '1';
                    flake.style.opacity = '0.8';
                    
                    container.appendChild(flake);
                    
                    setTimeout(() => {
                        if (flake.parentNode) {
                            flake.remove();
                        }
                    }, 7000);
                }, i * 300);
            }
        }

        function createCyberpunkEffect() {
            const container = document.getElementById('cyberpunkGrid');
            container.style.display = 'block';
            
            // Create grid lines
            for (let i = 0; i < 10; i++) {
                const line = document.createElement('div');
                line.style.position = 'fixed';
                line.style.width = '100vw';
                line.style.height = '1px';
                line.style.background = 'rgba(255, 20, 147, 0.3)';
                line.style.top = i * 10 + '%';
                line.style.left = '0';
                line.style.animation = `gridPulse ${Math.random() * 2 + 2}s ease-in-out infinite`;
                line.style.zIndex = '1';
                
                container.appendChild(line);
            }
        }

        function createNeonEffect() {
            const container = document.getElementById('neonLines');
            container.style.display = 'block';
            
            for (let i = 0; i < 8; i++) {
                const line = document.createElement('div');
                line.style.position = 'fixed';
                line.style.width = Math.random() * 200 + 100 + 'px';
                line.style.height = '2px';
                line.style.background = `linear-gradient(90deg, transparent, ${['#FF1493', '#00FFFF', '#FF69B4', '#9370DB'][Math.floor(Math.random() * 4)]}, transparent)`;
                line.style.top = Math.random() * 100 + '%';
                line.style.left = Math.random() * 100 + '%';
                line.style.animation = `neonPulse ${Math.random() * 2 + 1}s ease-in-out infinite`;
                line.style.zIndex = '1';
                line.style.boxShadow = `0 0 10px ${['#FF1493', '#00FFFF', '#FF69B4', '#9370DB'][Math.floor(Math.random() * 4)]}`;
                
                container.appendChild(line);
            }
        }

        // How to play tutorial functions
        function showHowToPlay() {
            showModal('howToPlay');
            localStorage.setItem('jombro_tutorial_completed', 'true');
        }

        function showHowToPlayTab(tab) {
            // Reset tab buttons
            document.getElementById('basicsTab').className = 'btn-secondary';
            document.getElementById('challengesTab').className = 'btn-secondary';
            document.getElementById('tokensTab').className = 'btn-secondary';
            document.getElementById('socialTab').className = 'btn-secondary';
            
            // Hide all content
            document.getElementById('basicsContent').style.display = 'none';
            document.getElementById('challengesContent').style.display = 'none';
            document.getElementById('tokensContent').style.display = 'none';
            document.getElementById('socialContent').style.display = 'none';
            
            // Show selected tab
            if (tab === 'basics') {
                document.getElementById('basicsTab').className = 'btn-primary';
                document.getElementById('basicsContent').style.display = 'block';
            } else if (tab === 'challenges') {
                document.getElementById('challengesTab').className = 'btn-primary';
                document.getElementById('challengesContent').style.display = 'block';
            } else if (tab === 'tokens') {
                document.getElementById('tokensTab').className = 'btn-primary';
                document.getElementById('tokensContent').style.display = 'block';
            } else if (tab === 'social') {
                document.getElementById('socialTab').className = 'btn-primary';
                document.getElementById('socialContent').style.display = 'block';
            }
        }

        // Modal functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId + 'Modal');
            if (modal) {
                modal.classList.add('show');
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId + 'Modal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // Toast function
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastText = document.getElementById('toastText');
            
            toastText.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Utility functions
        function getTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'just now';
            if (diffMins < 60) return `${diffMins} min ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
        }

        // Initialize app when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                if (!playerData.isLoggedIn) {
                    showLoginModal();
                } else {
                    initializeAllSystems();
                }
            });
        } else {
            if (!playerData.isLoggedIn) {
                showLoginModal();
            } else {
                initializeAllSystems();
            }
        }
    </script>
</body>
</html>: 'Elite Gladiator',
            rank
