// Show challenge detail
        window.showChallengeDetail = function(challenge) {
            const modal = document.createElement('div');
            modal.className = 'challenge-detail-modal';
            
            // Get participant details
            let participantsHtml = '';
            if (challenge.participants && challenge.participants.length > 0) {
                for (const participantId of challenge.participants) {
                    if (participantId !== currentUser.uid) {
                        const friend = friends.find(f => f.id === participantId);
                        if (friend) {
                            let avatarHtml;
                            if (friend.avatar && friend.avatar.startsWith('data:')) {
                                avatarHtml = `<img src="${friend.avatar}" alt="${friend.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                            } else {
                                avatarHtml = friend.avatar || 'üë§';
                            }
                            
                            const response = challenge.responses && challenge.responses[participantId];
                            let status = 'pending';
                            let statusClass = '';
                            
                            if (response) {
                                status = response.response;
                                statusClass = response.response;
                            }
                            
                            participantsHtml += `
                                <div class="participant-item">
                                    <div class="participant-info">
                                        <div class="participant-avatar">${avatarHtml}</div>
                                        <div class="participant-name">${friend.name}</div>
                                    </div>
                                    <div class="participant-status ${statusClass}">${status}</div>
                                </div>
                            `;
                        }
                    }
                }
            }
            
            const isCreator = challenge.creatorId === currentUser.uid;
            const isSender = challenge.senderId === currentUser.uid;
            const userResponse = challenge.responses && challenge.responses[currentUser.uid];
            const responseStatus = userResponse ? userResponse.response : 'pending';
            
            let actionButtons = '';
            if (!isCreator && !isSender && responseStatus === 'pending') {
                actionButtons = `
                    <button class="btn btn-primary" onclick="respondToChallenge('${challenge.id}', 'accepted')">‚úÖ Accept Challenge</button>
                    <button class="btn btn-secondary" onclick="respondToChallenge('${challenge.id}', 'declined')">‚ùå Decline</button>
                `;
            } else if (!isCreator && !isSender && responseStatus === 'accepted' && (!userResponse || !userResponse.proofUrl)) {
                actionButtons = `
                    <button class="btn btn-primary" onclick="showSubmitChallengeModal('${challenge.id}')" style="width: 100%;">
                        üì∏ Submit Proof
                    </button>
                `;
            } else if (userResponse && userResponse.proofUrl) {
                actionButtons = `
                    <div style="text-align: center; padding: 20px; background: rgba(76, 175, 80, 0.1); border-radius: 12px;">
                        <p style="color: #4CAF50; font-weight: 600; margin-bottom: 10px;">‚úÖ Challenge Completed!</p>
                        <p style="opacity: 0.8;">You earned ${challenge.reward} tokens</p>
                    </div>
                `;
            }
            
            modal.innerHTML = `
                <div class="challenge-detail-content">
                    <div class="challenge-detail-header">
                        <div>
                            <h2 class="challenge-detail-title">${challenge.title}</h2>
                            <div class="challenge-detail-meta">
                                <div class="challenge-detail-meta-item">
                                    ${getCategoryIcon(challenge.category)} ${challenge.category}
                                </div>
                                <div class="challenge-detail-meta-item">
                                    ü™ô ${challenge.reward} tokens
                                </div>
                                <div class="challenge-detail-meta-item">
                                    ${challenge.isAI ? 'ü§ñ AI Challenge' : `üë§ ${challenge.creatorName}`}
                                </div>
                            </div>
                        </div>
                        <button class="close-modal" onclick="closeModal(this)">√ó</button>
                    </div>
                    
                    <div class="challenge-detail-description">
                        ${challenge.description}
                    </div>
                    
                    ${participantsHtml ? `
                        <div class="challenge-participants">
                            <h3>Participants</h3>
                            <div class="participant-list">
                                ${participantsHtml}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 20px;">
                        ${actionButtons}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        };

        // Show How to Play
        window.showHowToPlay = function() {
            const modal = document.createElement('div');
            modal.className = 'how-to-play-modal';
            modal.innerHTML = `
                <div class="how-to-play-content">
                    <button class="close-modal" onclick="closeModal(this)" style="position: absolute; top: 20px; right: 20px;">√ó</button>
                    
                    <div class="how-to-play-header">
                        <h1 class="how-to-play-title">How to Play JomBro</h1>
                        <p class="how-to-play-subtitle">Challenge your friends, earn tokens, level up!</p>
                    </div>
                    
                    <div class="how-to-play-steps">
                        <div class="step-item">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h3>Add Friends</h3>
                                <p>Connect with friends using their username or friend code. The more friends you have, the more fun challenges you can share!</p>
                            </div>
                        </div>
                        
                        <div class="step-item">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h3>Create or Accept Challenges</h3>
                                <p>Use Quick Challenge to create custom dares, or choose from AI-generated challenges. Accept challenges from friends to earn tokens!</p>
                            </div>
                        </div>
                        
                        <div class="step-item">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h3>Complete & Submit Proof</h3>
                                <p>Do the challenge and upload a photo or video as proof. Once verified, you'll earn the reward tokens!</p>
                            </div>
                        </div>
                        
                        <div class="step-item">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h3>Earn Tokens & Level Up</h3>
                                <p>Complete challenges to earn tokens and increase your level. Higher levels unlock more features and bigger rewards!</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="how-to-play-tips">
                        <h3>Pro Tips</h3>
                        <ul class="tips-list">
                            <li>AI challenges refresh every 2 minutes with new ideas</li>
                            <li>Creating challenges costs 50 tokens, sending AI challenges costs 25 per friend</li>
                            <li>Upload a custom avatar to stand out from the crowd</li>
                            <li>Challenge multiple friends at once for epic group dares</li>
                            <li>Be creative with your challenges - the funnier, the better!</li>
                        </ul>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="closeModal(this)" style="padding: 15px 40px; font-size: 1.1rem;">
                            üéÆ Let's Play!
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        };
