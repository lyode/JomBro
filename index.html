<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    
    <!-- iPhone 15 Pro Max Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JomBro">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#000000">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json,{%22name%22:%22JomBro%20-%20Social%20Challenge%20App%22,%22short_name%22:%22JomBro%22,%22description%22:%22Advanced%20social%20challenge%20platform%20with%20AI-powered%20challenges%22,%22start_url%22:%22/%22,%22display%22:%22standalone%22,%22background_color%22:%22%23000000%22,%22theme_color%22:%22%23000000%22,%22orientation%22:%22portrait%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%3E%3Crect%20width='512'%20height='512'%20fill='%23000'/%3E%3Ctext%20x='50%25'%20y='50%25'%20dominant-baseline='middle'%20text-anchor='middle'%20font-size='280'%20fill='%2300FF96'%3E🚀%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='100' fill='%2300FF96'%3E🚀%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" sizes="152x152" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 152 152'%3E%3Crect width='152' height='152' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='85' fill='%2300FF96'%3E🚀%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" sizes="167x167" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 167 167'%3E%3Crect width='167' height='167' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='95' fill='%2300FF96'%3E🚀%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='100' fill='%2300FF96'%3E🚀%3C/text%3E%3C/svg%3E">
    
    <!-- iPhone 15 Pro Max Display Settings -->
    <meta name="screen-orientation" content="portrait">
    <meta name="full-screen" content="yes">
    <meta name="browsermode" content="application">
    
    <!-- PWA iOS Splash Screens -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-startup-image" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 430 932'%3E%3Crect width='430' height='932' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='200' fill='%2300FF96'%3E🚀%3C/text%3E%3C/svg%3E" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)">
    
    <title>JomBro - Advanced Social Challenge System</title>

    <style>
        /* iPhone 15 Pro Max Optimized Styles */
        :root {
            --iphone15-width: 430px;
            --iphone15-height: 932px;
            --dynamic-island-height: 37px;
            --safe-area-top: env(safe-area-inset-top, 47px);
            --safe-area-bottom: env(safe-area-inset-bottom, 34px);
            --safe-area-left: env(safe-area-inset-left, 0px);
            --safe-area-right: env(safe-area-inset-right, 0px);
        }

        /* Standalone PWA Mode Detection */
        @media all and (display-mode: standalone) {
            :root {
                --safe-area-top: env(safe-area-inset-top, 44px);
                --safe-area-bottom: env(safe-area-inset-bottom, 34px);
            }
        }

        /* iPhone Safe Area Support */
        @supports (padding: max(0px)) {
            :root {
                --safe-area-top: max(env(safe-area-inset-top, 0px), 20px);
                --safe-area-bottom: max(env(safe-area-inset-bottom, 0px), 20px);
                --safe-area-left: env(safe-area-inset-left, 0px);
                --safe-area-right: env(safe-area-inset-right, 0px);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
        }

        html {
            height: 100vh;
            height: 100svh;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: radial-gradient(ellipse at center, #0f0f23 0%, #000000 70%);
            width: 100vw;
            height: 100vh;
            height: 100svh;
            color: #FFFFFF;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            font-weight: 300;
            transition: all 1s ease;
            font-size: 16px;
            line-height: 1.5;
        }

        /* Background Themes - Optimized for iPhone 15 Pro Max */
        body.underwater {
            background: radial-gradient(ellipse at center, #001a2e 0%, #003d5c 40%, #000814 100%);
        }

        body.sky {
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8E8 50%, #B6E5F0 100%);
        }

        body.beach {
            background: linear-gradient(to bottom, #FFD700 0%, #F0E68C 30%, #87CEEB 70%, #4682B4 100%);
        }

        body.rainy {
            background: linear-gradient(to bottom, #2C3E50 0%, #34495E 50%, #1C2833 100%);
        }

        body.city {
            background: linear-gradient(to bottom, #2C3E50 0%, #34495E 30%, #1C1C1C 70%, #000000 100%);
        }

        body.jungle {
            background: linear-gradient(to bottom, #228B22 0%, #006400 30%, #004225 70%, #001a0d 100%);
        }

        /* Starfield Background - No Animation */
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #ddd, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            z-index: 0;
        }

        /* Dark Overlay */
        .dark-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(0.1px);
            -webkit-backdrop-filter: blur(0.1px);
            z-index: 2;
        }

        /* Main Container - Full Coverage */
        .main-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10;
            display: flex;
            flex-direction: column;
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
        }

        /* iPhone 15 Pro Max Header - 99.8% Transparent */
        .dark-header {
            position: fixed;
            top: calc(var(--safe-area-top) + 16px);
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.002);
            border-radius: 28px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            height: 68px;
            width: calc(100vw - 40px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.002);
        }

        /* PWA Mode Header */
        @media all and (display-mode: standalone) {
            .dark-header {
                top: calc(env(safe-area-inset-top, 0px) + 16px);
            }
        }

        .dark-logo {
            font-size: 28px;
            font-weight: 300;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.4),
                2px 2px 6px rgba(0, 0, 0, 0.9);
            animation: logoFloat 8s ease-in-out infinite;
        }

        .dark-header-icons {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        /* iPhone 15 Pro Max 99.8% Transparent Buttons */
        .round-btn {
            width: 44px;
            height: 44px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 2px solid rgba(64, 93, 230, 0.9);
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.8),
                2px 2px 6px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                0 0 25px rgba(255, 255, 255, 0.3);
            position: relative;
            touch-action: manipulation;
        }

        .round-btn:hover {
            transform: translateY(-4px) scale(1.05);
            background: rgba(0, 0, 0, 0.002);
            border-color: rgba(64, 93, 230, 1);
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.1),
                0 0 40px rgba(64, 93, 230, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #FF3366, #FF6B35);
            border-radius: 10px;
            font-size: 11px;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 15px rgba(255, 51, 102, 0.6);
            animation: badgeFloat 4s ease infinite;
        }

        /* Player Info Display */
        .player-info {
            position: fixed;
            top: calc(var(--safe-area-top) + 84px);
            right: 24px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(0, 255, 150, 0.4);
            border-radius: 20px;
            padding: 12px 16px;
            z-index: 950;
            text-align: center;
        }

        /* PWA Mode Player Info */
        @media all and (display-mode: standalone) {
            .player-info {
                top: calc(env(safe-area-inset-top, 0px) + 84px);
            }
        }

        .player-rank {
            font-size: 12px;
            color: #FFD700;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            margin-bottom: 4px;
        }

        .player-tokens {
            font-size: 14px;
            color: #00FF96;
            font-weight: 700;
            text-shadow: 0 0 12px rgba(0, 255, 150, 0.8);
        }

        /* iPhone 15 Pro Max Stories Section - 99.8% Transparent */
        .dark-stories {
            position: fixed;
            top: calc(var(--safe-area-top) + 100px);
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.002);
            border-radius: 24px;
            padding: 20px;
            z-index: 900;
            height: 120px;
            width: calc(100vw - 40px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.002);
        }

        /* PWA Mode Stories */
        @media all and (display-mode: standalone) {
            .dark-stories {
                top: calc(env(safe-area-inset-top, 0px) + 100px);
            }
        }

        .stories-scroll {
            display: flex;
            gap: 18px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 6px 0;
        }

        .stories-scroll::-webkit-scrollbar { 
            display: none; 
        }

        .story-item {
            min-width: 80px;
            text-align: center;
            cursor: pointer;
            touch-action: manipulation;
        }

        .story-circle {
            width: 80px;
            height: 80px;
            border-radius: 40px;
            background: linear-gradient(45deg, 
                rgba(0, 255, 150, 0.5), 
                rgba(64, 93, 230, 0.5), 
                rgba(138, 43, 226, 0.5), 
                rgba(255, 255, 255, 0.3));
            padding: 3px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 255, 150, 0.2);
            position: relative;
        }

        .story-circle:hover {
            transform: translateY(-4px) scale(1.05);
        }

        .story-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid rgba(0, 0, 0, 0.02);
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.002);
        }

        .story-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            filter: brightness(1.1) contrast(1.1);
        }

        .story-name {
            font-size: 13px;
            font-weight: 400;
            color: #FFFFFF;
            text-shadow: 
                0 0 8px rgba(255, 255, 255, 0.3),
                1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* iPhone 15 Pro Max Feed Section - Adjusted for new bottom nav */
        .dark-feed {
            position: fixed;
            top: calc(var(--safe-area-top) + 240px);
            left: 0;
            right: 0;
            bottom: calc(80px + env(safe-area-inset-bottom, 34px));
            overflow: hidden;
            z-index: 100;
            padding: 0 20px;
            perspective: 1000px;
        }

        /* iPhone 15 Pro Max Specific Feed */
        @media screen and (min-width: 428px) and (max-width: 432px) and (min-height: 926px) {
            .dark-feed {
                bottom: calc(80px + 34px);
            }
        }

        /* PWA Mode Feed */
        @media all and (display-mode: standalone) {
            .dark-feed {
                top: calc(env(safe-area-inset-top, 0px) + 240px);
                bottom: calc(80px + env(safe-area-inset-bottom, 34px));
            }
        }

        .feed-pages {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        .challenge-card {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            width: calc(100% - 40px);
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.002);
            border-radius: 28px;
            overflow: hidden;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.002);
            transform-style: preserve-3d;
            transform-origin: bottom center;
        }

        .challenge-card.current {
            transform: translateZ(0px) rotateX(0deg);
            z-index: 10;
        }

        .challenge-card.next {
            transform: translateZ(-100px) rotateX(-90deg);
            z-index: 5;
        }

        .challenge-card.prev {
            transform: translateZ(-100px) rotateX(90deg);
            z-index: 5;
        }

        /* Side Actions */
        .side-actions {
            position: absolute;
            right: 24px;
            bottom: 180px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            z-index: 200;
        }

        .action-btn {
            width: 56px;
            height: 56px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 2px solid rgba(0, 191, 255, 0.9);
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.6),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                0 0 30px rgba(255, 255, 255, 0.3);
            position: relative;
            touch-action: manipulation;
        }

        .points-btn {
            flex-direction: column;
            background: rgba(0, 0, 0, 0.002);
            border-color: rgba(0, 255, 150, 0.6);
            height: 72px;
            padding: 10px;
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.002),
                0 0 35px rgba(0, 255, 150, 0.3);
        }

        .points-number {
            font-size: 16px;
            font-weight: 700;
            line-height: 1;
            color: #FFFFFF;
            text-shadow: 
                0 0 15px rgba(0, 255, 150, 0.6),
                1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .points-label {
            font-size: 10px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* Challenge Content */
        .challenge-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 36px;
            z-index: 150;
        }

        .challenge-user {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 18px;
        }

        .challenge-avatar {
            width: 48px;
            height: 48px;
            border-radius: 24px;
            background: linear-gradient(45deg, 
                rgba(0, 255, 150, 0.6), 
                rgba(64, 93, 230, 0.6), 
                rgba(138, 43, 226, 0.6), 
                rgba(255, 255, 255, 0.4));
            padding: 3px;
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 255, 150, 0.2);
        }

        .challenge-avatar-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid rgba(0, 0, 0, 0.02);
        }

        .challenge-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            filter: brightness(1.2) contrast(1.1);
        }

        .challenge-username {
            color: #FFFFFF;
            font-weight: 400;
            font-size: 18px;
            text-shadow: 
                0 0 15px rgba(255, 255, 255, 0.5),
                2px 2px 6px rgba(0, 0, 0, 0.9);
        }

        .challenge-type {
            display: inline-block;
            padding: 4px 8px;
            background: rgba(255, 215, 0, 0.8);
            color: #000;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .challenge-type.daily {
            background: rgba(0, 255, 150, 0.8);
        }

        .challenge-type.treasure {
            background: rgba(255, 215, 0, 0.8);
        }

        .challenge-type.vip {
            background: rgba(138, 43, 226, 0.8);
            color: #fff;
        }

        .challenge-type.business {
            background: rgba(255, 107, 53, 0.8);
        }

        .challenge-text {
            font-size: 20px;
            font-weight: 300;
            color: #FFFFFF;
            text-shadow: 
                0 0 18px rgba(255, 255, 255, 0.5),
                2px 2px 8px rgba(0, 0, 0, 0.9);
            margin-bottom: 18px;
            line-height: 1.4;
        }

        .challenge-hashtags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 24px;
        }

        .challenge-hashtag {
            color: #4FC3F7;
            font-size: 15px;
            font-weight: 400;
            text-shadow: 
                0 0 8px rgba(79, 195, 247, 0.5),
                1px 1px 2px rgba(0, 0, 0, 0.8);
            padding: 8px 14px;
            background: rgba(200, 200, 200, 0.002);
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 18px;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .challenge-hashtag:hover {
            background: rgba(200, 200, 200, 0.002);
            color: #4FC3F7;
            border-color: rgba(79, 195, 247, 0.5);
        }

        .challenge-reward {
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(0, 255, 150, 0.6);
            color: #FFFFFF;
            padding: 12px 20px;
            border-radius: 22px;
            font-size: 16px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 28px;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.002),
                0 0 30px rgba(0, 255, 150, 0.3);
        }

        .challenge-difficulty {
            display: inline-block;
            margin-left: 12px;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            text-shadow: none;
        }

        .difficulty-easy {
            background: rgba(0, 255, 150, 0.8);
            color: #000;
        }

        .difficulty-medium {
            background: rgba(255, 193, 7, 0.8);
            color: #000;
        }

        .difficulty-hard {
            background: rgba(255, 87, 34, 0.8);
            color: #fff;
        }

        .difficulty-epic {
            background: rgba(156, 39, 176, 0.8);
            color: #fff;
        }

        .difficulty-legendary {
            background: linear-gradient(45deg, #FFD700, #FF6B47);
            color: #000;
            animation: legendaryGlow 2s ease infinite;
        }

        /* Challenge Buttons */
        .challenge-actions {
            display: flex;
            gap: 16px;
        }

        .challenge-btn {
            flex: 1;
            padding: 18px 24px;
            border: none;
            border-radius: 24px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
            touch-action: manipulation;
        }

        .btn-accept {
            background: rgba(0, 0, 0, 0.002);
            border: 1px solid rgba(0, 255, 150, 0.6);
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.002),
                0 0 30px rgba(0, 255, 150, 0.25);
        }

        .btn-decline {
            background: rgba(0, 0, 0, 0.002);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.002),
                0 0 20px rgba(255, 255, 255, 0.03);
        }

        /* Bottom Navigation - Full Coverage for iPhone 15 Pro Max */
        .dark-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.002);
            border-bottom: none;
            border-radius: 0;
            display: flex;
            justify-content: space-around;
            padding: 20px 20px calc(env(safe-area-inset-bottom, 34px) + 20px) 20px;
            z-index: 1000;
            width: 100vw;
            min-height: calc(80px + env(safe-area-inset-bottom, 34px));
            box-shadow: 
                0 -8px 32px rgba(0, 0, 0, 0.002),
                inset 0 1px 0 rgba(255, 255, 255, 0.002);
        }

        /* Add pseudo-element to ensure full bottom coverage */
        .dark-nav::after {
            content: '';
            position: absolute;
            bottom: calc(-1 * env(safe-area-inset-bottom, 34px));
            left: 0;
            right: 0;
            height: env(safe-area-inset-bottom, 34px);
            background: rgba(0, 0, 0, 0.002);
            z-index: -1;
        }

        /* Add another layer for complete bottom coverage */
        .dark-nav::before {
            content: '';
            position: absolute;
            bottom: calc(-1 * env(safe-area-inset-bottom, 34px) - 10px);
            left: 0;
            right: 0;
            height: calc(env(safe-area-inset-bottom, 34px) + 20px);
            background: radial-gradient(ellipse at center, #0f0f23 0%, #000000 70%);
            z-index: -2;
        }

        /* iPhone 15 Pro Max Specific Bottom Nav */
        @media screen and (min-width: 428px) and (max-width: 432px) and (min-height: 926px) {
            .dark-nav {
                padding: 20px 20px calc(34px + 20px) 20px;
                min-height: calc(80px + 34px);
            }
            
            .dark-nav::after {
                height: 34px;
                bottom: -34px;
            }

            .dark-nav::before {
                height: 54px;
                bottom: -44px;
            }
        }

        /* PWA Mode Bottom Navigation - Full Coverage */
        @media all and (display-mode: standalone) {
            .dark-nav {
                padding: 20px 20px calc(env(safe-area-inset-bottom, 34px) + 20px) 20px;
                bottom: 0;
                border-radius: 0;
                margin: 0;
                min-height: calc(80px + env(safe-area-inset-bottom, 34px));
                background: rgba(0, 0, 0, 0.002);
            }
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            padding: 12px 16px;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.002);
            backdrop-filter: blur(15px);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
            touch-action: manipulation;
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 6px;
            transition: all 0.3s ease;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }

        .nav-item.active {
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            background: rgba(0, 0, 0, 0.002);
            border: 1px solid rgba(0, 255, 150, 0.5);
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.002),
                0 0 30px rgba(0, 255, 150, 0.3);
            transform: translateZ(8px);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.15) translateZ(5px);
            text-shadow: 
                0 0 12px rgba(0, 255, 150, 0.8),
                0 0 8px rgba(255, 255, 255, 0.3);
        }

        /* Modal System */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 24px;
        }

        .modal.show {
            display: flex;
            animation: modalFadeIn 0.3s ease;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 28px;
            padding: 36px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 28px;
            text-align: center;
            color: #FFFFFF;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.6),
                2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px;
            color: #FFFFFF;
            font-size: 16px;
            font-weight: 400;
            outline: none;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
        }

        .form-control:focus {
            border-color: rgba(0, 255, 150, 0.7);
            background: rgba(0, 0, 0, 0.002);
            box-shadow: 0 0 35px rgba(0, 255, 150, 0.3);
        }

        .btn-primary {
            width: 100%;
            padding: 18px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(0, 255, 150, 0.6);
            border-radius: 18px;
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 14px;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.002),
                0 0 30px rgba(0, 255, 150, 0.25);
        }

        .btn-secondary {
            width: 100%;
            padding: 18px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 18px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 1);
        }

        /* Toast - Instant Response */
        .toast {
            position: fixed;
            top: calc(var(--safe-area-top) + 160px);
            left: 24px;
            right: 24px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(35px);
            border: 1px solid rgba(0, 255, 150, 0.5);
            color: #FFFFFF;
            padding: 16px 20px;
            border-radius: 18px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            z-index: 3000;
            transform: translateY(-100px);
            opacity: 0;
            text-shadow: 
                0 0 20px rgba(0, 255, 150, 0.8),
                1px 1px 2px rgba(0, 0, 0, 1);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.002),
                0 0 30px rgba(0, 255, 150, 0.3);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* PWA Mode Toast */
        @media all and (display-mode: standalone) {
            .toast {
                top: calc(env(safe-area-inset-top, 0px) + 160px);
            }
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Background Settings */
        .background-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 18px;
            margin-bottom: 28px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .bg-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 18px;
            background: rgba(0, 0, 0, 0.002);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px;
            cursor: pointer;
            text-align: center;
        }

        .bg-option.active {
            border-color: rgba(0, 255, 150, 1);
            background: rgba(0, 255, 150, 0.002);
            box-shadow: 0 0 30px rgba(0, 255, 150, 0.4);
        }

        .bg-preview {
            font-size: 36px;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
        }

        .bg-name {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* Leaderboard Styles - 99.8% Transparent */
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 16px;
            margin-bottom: 12px;
            background: rgba(0, 0, 0, 0.002);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }

        .rank-number {
            font-size: 24px;
            font-weight: 700;
            margin-right: 16px;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            min-width: 40px;
        }

        .player-avatar {
            width: 48px;
            height: 48px;
            border-radius: 24px;
            margin-right: 16px;
            border: 2px solid rgba(0, 255, 150, 0.5);
        }

        .player-details {
            flex: 1;
        }

        .player-name {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
        }

        .player-rank-title {
            font-size: 12px;
            color: #FFD700;
            font-weight: 500;
        }

        .player-score {
            font-size: 18px;
            font-weight: 700;
            color: #00FF96;
            text-shadow: 0 0 10px rgba(0, 255, 150, 0.6);
        }

        /* Animation Keyframes */
        @keyframes starTwinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @keyframes starDrift {
            0% { transform: translateX(0px); }
            100% { transform: translateX(-200px); }
        }

        @keyframes headerFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-2px); }
        }

        @keyframes storiesFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-2px); }
        }

        @keyframes logoFloat {
            0%, 100% { transform: scale(1) translateY(0px); }
            50% { transform: scale(1.02) translateY(-1px); }
        }

        @keyframes cardFloatUp {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-4px); }
        }

        @keyframes badgeFloat {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes playerInfoFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-1px) scale(1.01); }
        }

        @keyframes legendaryGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 107, 71, 0.8); }
        }

        /* Responsive adjustments */
        @media screen and (max-width: 432px) {
            .dark-header {
                height: 64px;
                padding: 14px 20px;
            }
            
            .dark-logo {
                font-size: 26px;
            }
            
            .round-btn {
                width: 42px;
                height: 42px;
                font-size: 17px;
            }
        }

        /* PWA Mode Specific Styles */
        .pwa-mode {
            --safe-area-top: env(safe-area-inset-top, 0px);
            --safe-area-bottom: env(safe-area-inset-bottom, 0px);
        }

        .pwa-mode .dark-nav {
            border-radius: 0;
            margin: 0;
            width: 100vw;
        }

        /* Install Button Styling - No Animation */
        .install-btn {
            background: rgba(0, 255, 150, 0.1) !important;
            border-color: rgba(0, 255, 150, 0.8) !important;
        }

        /* Landscape Mode Handling */
        @media screen and (orientation: landscape) and (max-height: 500px) {
            .dark-stories {
                height: 100px;
                padding: 14px 18px;
            }
            
            .story-circle {
                width: 70px;
                height: 70px;
            }
            
            .dark-feed {
                top: calc(var(--safe-area-top) + 180px);
            }
        }

        /* Very Small Screens */
        @media screen and (max-width: 375px) {
            .dark-header,
            .dark-stories,
            .dark-nav {
                margin-left: 10px;
                margin-right: 10px;
                width: calc(100vw - 20px);
            }
            
            .dark-feed {
                padding: 0 10px;
            }
        }

        /* High DPI Displays */
        @media screen and (-webkit-min-device-pixel-ratio: 2) {
            .round-btn,
            .action-btn,
            .challenge-btn {
                border-width: 0.5px;
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body {
                background: radial-gradient(ellipse at center, #0a0a0f 0%, #000000 70%);
            }
        }

        /* Reduced Data Mode */
        @media (prefers-reduced-data: reduce) {
            .starfield,
            .starfield::before {
                display: none;
            }
        }

        /* Focus Visible Support */
        .round-btn:focus-visible,
        .action-btn:focus-visible,
        .challenge-btn:focus-visible,
        .nav-item:focus-visible {
            outline: 2px solid rgba(0, 255, 150, 0.8);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Outer Space Starfield Background -->
    <div class="starfield"></div>

    <!-- Dark Overlay -->
    <div class="dark-overlay"></div>

    <!-- Main Container -->
    <div class="main-container">
        
        <!-- Dark Header - iPhone 15 Pro Max Optimized -->
        <div class="dark-header">
            <div class="dark-logo">JomBro</div>
            <div class="dark-header-icons">
                <div class="round-btn" onclick="navigateAction(this, 'create')">➕</div>
                <div class="round-btn" onclick="showBackgroundSettings()">🎨</div>
                <div class="round-btn" onclick="navigateAction(this, 'notifications')">
                    🔔
                    <div class="notification-badge" id="notificationCount">7</div>
                </div>
                <div class="round-btn" onclick="navigateAction(this, 'messages')">💬</div>
            </div>
        </div>

        <!-- Player Info Display -->
        <div class="player-info">
            <div class="player-rank" id="playerRank">Elite Gladiator</div>
            <div class="player-tokens" id="playerTokens">🪙 15,247</div>
        </div>

        <!-- Dark Stories - iPhone 15 Pro Max Optimized -->
        <div class="dark-stories">
            <div class="stories-scroll" id="storiesScroll">
                <!-- Stories will be dynamically populated -->
            </div>
        </div>

        <!-- Dark Feed with Page Flip - iPhone 15 Pro Max Optimized -->
        <div class="dark-feed">
            <div class="feed-pages" id="feedPages">
                <!-- Challenge cards will be dynamically populated -->
            </div>

            <!-- Side Actions -->
            <div class="side-actions">
                <div class="action-btn points-btn" onclick="likeChallenge()">
                    <div class="points-number" id="currentChallengePoints">2.5K</div>
                    <div class="points-label">❤️</div>
                </div>
                <div class="action-btn" onclick="shareChallenge()">💬</div>
                <div class="action-btn" onclick="bookmarkChallenge()">🔖</div>
                <div class="action-btn" onclick="shareChallenge()">📤</div>
            </div>
        </div>

        <!-- Dark Bottom Navigation - iPhone 15 Pro Max Optimized -->
        <div class="dark-nav">
            <div class="nav-item active" onclick="navAction(this, 'home')">
                <div class="nav-icon">🏠</div>
                <div>Home</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'leaderboard')">
                <div class="nav-icon">🏆</div>
                <div>Leaderboard</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'create')">
                <div class="nav-icon">➕</div>
                <div>Create</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'shop')">
                <div class="nav-icon">🛍️</div>
                <div>Shop</div>
            </div>
            <div class="nav-item" onclick="navAction(this, 'profile')">
                <div class="nav-icon">👤</div>
                <div>Profile</div>
            </div>
        </div>
    </div>

    <!-- Background Settings Modal -->
    <div id="backgroundModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">🎨 Choose Your Atmosphere</div>
            
            <div class="background-grid">
                <div class="bg-option active" onclick="changeBackground('space')" data-bg="space">
                    <div class="bg-preview">🌌</div>
                    <div class="bg-name">Outer Space</div>
                </div>
                <div class="bg-option" onclick="changeBackground('underwater')" data-bg="underwater">
                    <div class="bg-preview">🌊</div>
                    <div class="bg-name">Underwater Island</div>
                </div>
                <div class="bg-option" onclick="changeBackground('sky')" data-bg="sky">
                    <div class="bg-preview">☁️</div>
                    <div class="bg-name">Sky Clouds</div>
                </div>
                <div class="bg-option" onclick="changeBackground('beach')" data-bg="beach">
                    <div class="bg-preview">🏖️</div>
                    <div class="bg-name">Beach Waves</div>
                </div>
                <div class="bg-option" onclick="changeBackground('rainy')" data-bg="rainy">
                    <div class="bg-preview">🌧️</div>
                    <div class="bg-name">Rainy Day</div>
                </div>
                <div class="bg-option" onclick="changeBackground('city')" data-bg="city">
                    <div class="bg-preview">🏙️</div>
                    <div class="bg-name">City Drizzle</div>
                </div>
                <div class="bg-option" onclick="changeBackground('jungle')" data-bg="jungle">
                    <div class="bg-preview">🌴</div>
                    <div class="bg-name">Jungle Seaside</div>
                </div>
            </div>
            
            <button class="btn-secondary" onclick="hideModal('background')">Close</button>
        </div>
    </div>

    <!-- Create Challenge Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">✨ Create New Challenge</div>
            
            <div class="form-group">
                <label class="form-label">Challenge Type</label>
                <select class="form-control" id="challengeType">
                    <option value="personal">Personal Challenge</option>
                    <option value="vip" disabled>VIP Challenge (Requires VIP)</option>
                    <option value="treasure" disabled>Treasure Challenge (Requires VVIP)</option>
                    <option value="business">Business Partnership</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Target Friend</label>
                <select class="form-control" id="challengeTarget">
                    <option value="">Choose friend...</option>
                    <option value="Alexandra Stone">alexandra_stone</option>
                    <option value="Marcus Chen">marcus_chen</option>
                    <option value="Sofia Rodriguez">sofia_rodriguez</option>
                    <option value="Ryan Kumar">ryan_kumar</option>
                    <option value="Emma Thompson">emma_thompson</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Challenge Description</label>
                <textarea class="form-control" id="challengeDesc" rows="3" placeholder="Describe your epic challenge..." style="resize: vertical;"></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Difficulty & Reward</label>
                <select class="form-control" id="challengePoints">
                    <option value="500">500 Tokens (Easy)</option>
                    <option value="1200">1,200 Tokens (Medium)</option>
                    <option value="2500">2,500 Tokens (Hard)</option>
                    <option value="5000">5,000 Tokens (Epic)</option>
                    <option value="10000">10,000 Tokens (Legendary)</option>
                </select>
            </div>
            
            <button class="btn-primary" onclick="createChallenge()">🚀 Share Challenge</button>
            <button class="btn-secondary" onclick="hideModal('create')">Cancel</button>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboardModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">🏆 Global Leaderboard</div>
            
            <div id="leaderboardList">
                <!-- Leaderboard will be dynamically populated -->
            </div>
            
            <button class="btn-secondary" onclick="hideModal('leaderboard')">Close</button>
        </div>
    </div>

    <!-- Shop Modal -->
    <div id="shopModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">🛍️ Token Shop</div>
            
            <div class="form-group">
                <label class="form-label">Purchase Tokens</label>
                <select class="form-control" id="tokenPackage">
                    <option value="1000">🪙 1,000 Tokens - RM 9.90</option>
                    <option value="5000">🪙 5,000 Tokens - RM 39.90</option>
                    <option value="12000">🪙 12,000 Tokens - RM 79.90</option>
                    <option value="25000">🪙 25,000 Tokens - RM 149.90</option>
                    <option value="50000">🪙 50,000 Tokens - RM 249.90</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">VIP Membership</label>
                <select class="form-control" id="vipPackage">
                    <option value="">No VIP Upgrade</option>
                    <option value="vip">VIP (1 Month) - RM 29.90</option>
                    <option value="vip3">VIP (3 Months) - RM 79.90</option>
                    <option value="vvip">VVIP (1 Month) - RM 59.90</option>
                    <option value="vvip3">VVIP (3 Months) - RM 149.90</option>
                </select>
            </div>
            
            <button class="btn-primary" onclick="purchaseTokens()">💳 Purchase</button>
            <button class="btn-secondary" onclick="hideModal('shop')">Close</button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">👤 Player Profile</div>
            
            <div id="profileContent">
                <!-- Profile content will be dynamically populated -->
            </div>
            
            <button class="btn-secondary" onclick="hideModal('profile')">Close</button>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast">
        <span id="toastText">Success!</span>
    </div>

    <script>
        // Advanced Challenge System Data
        let playerData = {
            id: 'player_001',
            username: 'alexandra_stone',
            displayName: 'Alexandra Stone',
            email: 'alexandra.stone@jombro.com',
            avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=80&h=80&fit=crop&crop=face',
            tokens: 15247,
            totalEarned: 47832,
            rank: 'Elite Gladiator',
            rankPoints: 8450,
            level: 27,
            vipStatus: 'none', // none, vip, vvip
            vipExpiry: null,
            completedChallenges: 143,
            createdChallenges: 67,
            winRate: 87.3,
            streakCurrent: 12,
            streakBest: 28,
            joinDate: '2024-01-15',
            location: 'Kuala Lumpur, Malaysia',
            bio: 'Elite challenge master specializing in extreme adventures and business partnerships.',
            achievements: [
                'First Elite Gladiator',
                'Business Champion',
                'Streak Master',
                'Token Millionaire'
            ],
            followers: 2847,
            following: 432,
            friends: [
                'marcus_chen',
                'sofia_rodriguez', 
                'ryan_kumar',
                'emma_thompson'
            ]
        };

        let challengeData = [];
        let leaderboardData = [];
        let currentPage = 0;
        let totalPages = 0;
        let isFlipping = false;
        let currentBackground = 'space';
        let deferredPrompt;

        // Challenge Templates
        const challengeTemplates = {
            daily: [
                {
                    title: "Coffee Shop Poetry Challenge",
                    description: "Visit any coffee shop and ask the barista to write a short poem on your cup or napkin! ☕️📝",
                    hashtags: ["#CoffeePoetry", "#BaristArt", "#JomBro"],
                    difficulty: "easy",
                    tokens: 500,
                    type: "daily"
                },
                {
                    title: "Random Act of Kindness",
                    description: "Pay for a stranger's meal or drink and capture their reaction (with permission)! 🤝❤️",
                    hashtags: ["#RandomKindness", "#PayItForward", "#GoodVibes"],
                    difficulty: "medium", 
                    tokens: 800,
                    type: "daily"
                },
                {
                    title: "Street Art Discovery",
                    description: "Find and photograph 3 different pieces of street art in your city, then share the stories behind them! 🎨🏙️",
                    hashtags: ["#StreetArt", "#UrbanExplorer", "#ArtHunt"],
                    difficulty: "medium",
                    tokens: 1200,
                    type: "daily"
                }
            ],
            treasure: [
                {
                    title: "TREASURE: City Scavenger Hunt",
                    description: "🏆 MONTHLY TREASURE: Complete a massive city-wide scavenger hunt with 10 hidden locations! First 50 players to complete get massive rewards!",
                    hashtags: ["#TreasureHunt", "#CityWide", "#MonthlyChallenge"],
                    difficulty: "legendary",
                    tokens: 25000,
                    realRewards: "iPhone 15 Pro Max + RM 5,000 Cash",
                    type: "treasure"
                }
            ],
            business: [
                {
                    title: "Starbucks Mystery Drink Challenge",
                    description: "💰 BUSINESS PARTNERSHIP: Let the barista create a mystery drink for you and rate it! Complete 5 visits this week for REAL rewards!",
                    hashtags: ["#StarbucksPartner", "#MysteryDrink", "#BusinessChallenge"],
                    difficulty: "medium",
                    tokens: 2000,
                    realRewards: "RM 100 Starbucks Card + Free Premium Membership",
                    type: "business",
                    partner: "Starbucks Malaysia"
                }
            ]
        };

        // Sample Player Database
        const playerDatabase = [
            {
                username: 'alexandra_stone',
                displayName: 'Alexandra Stone',
                avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=80&h=80&fit=crop&crop=face',
                rank: 'Elite Gladiator',
                tokens: 15247,
                level: 27,
                vipStatus: 'none'
            },
            {
                username: 'marcus_chen',
                displayName: 'Marcus Chen',
                avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face',
                rank: 'Champion',
                tokens: 28394,
                level: 42,
                vipStatus: 'vvip'
            },
            {
                username: 'sofia_rodriguez',
                displayName: 'Sofia Rodriguez', 
                avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=80&h=80&fit=crop&crop=face',
                rank: 'Duelist',
                tokens: 9876,
                level: 19,
                vipStatus: 'vip'
            },
            {
                username: 'ryan_kumar',
                displayName: 'Ryan Kumar',
                avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face',
                rank: 'Rival',
                tokens: 7234,
                level: 16,
                vipStatus: 'none'
            },
            {
                username: 'emma_thompson',
                displayName: 'Emma Thompson',
                avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=80&h=80&fit=crop&crop=face',
                rank: 'Elite',
                tokens: 12567,
                level: 23,
                vipStatus: 'vip'
            }
        ];

        // Initialize the advanced system
        document.addEventListener('DOMContentLoaded', function() {
            initializeAdvancedSystem();
            updatePlayerDisplay();
            generateInitialChallenges();
            populateLeaderboard();
            createStories();
            setupSwipeGestures();
            initializePWA();
        });

        function initializeAdvancedSystem() {
            console.log('🚀 JomBro Advanced Challenge System Initialized!');
            console.log('🏆 AI-Powered Daily Challenges Active');
            console.log('💎 Treasure Challenge System Ready');
            console.log('🎖️ Military & Gladiator Ranking Active');
            console.log('💰 Token Economy & VIP System Online');
        }

        // PWA Initialization
        function initializePWA() {
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:application/javascript,const CACHE_NAME="jombro-v1";const urlsToCache=["/"];self.addEventListener("install",event=>{event.waitUntil(caches.open(CACHE_NAME).then(cache=>cache.addAll(urlsToCache)))});self.addEventListener("fetch",event=>{event.respondWith(caches.match(event.request).then(response=>{if(response){return response;}return fetch(event.request)}))});')
                .then(registration => {
                    console.log('PWA: Service Worker registered successfully');
                    showToast('📱 App ready for offline use!');
                })
                .catch(error => {
                    console.log('PWA: Service Worker registration failed:', error);
                });
            }

            // Handle PWA install prompt
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                showInstallButton();
            });

            // Check if app is already installed
            if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
                console.log('PWA: App is running in standalone mode');
                document.body.classList.add('pwa-mode');
                showToast('🚀 Welcome to JomBro PWA!');
            }

            // Handle app installed
            window.addEventListener('appinstalled', (evt) => {
                console.log('PWA: App was installed');
                showToast('✅ JomBro installed successfully!');
                hideInstallButton();
            });
        }

        function showInstallButton() {
            // Add install button to header if not already present
            const headerIcons = document.querySelector('.dark-header-icons');
            if (!document.querySelector('.install-btn')) {
                const installBtn = document.createElement('div');
                installBtn.className = 'round-btn install-btn';
                installBtn.innerHTML = '📱';
                installBtn.title = 'Install App';
                installBtn.onclick = installPWA;
                headerIcons.insertBefore(installBtn, headerIcons.firstChild);
            }
        }

        function hideInstallButton() {
            const installBtn = document.querySelector('.install-btn');
            if (installBtn) {
                installBtn.remove();
            }
        }

        function installPWA() {
            const installBtn = document.querySelector('.install-btn');
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA: User accepted the install prompt');
                    } else {
                        console.log('PWA: User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Prevent zoom on double tap - instant response
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        function generateInitialChallenges() {
            challengeData = [];
            
            // Add sample challenges
            challengeData.push({
                id: 'daily_001',
                title: "Coffee Shop Poetry Challenge",
                description: "Visit any coffee shop and ask the barista to write a short poem on your cup or napkin! ☕️📝",
                hashtags: ["#CoffeePoetry", "#BaristArt", "#JomBro"],
                difficulty: "easy",
                tokens: 500,
                type: "daily",
                creator: "JomBro AI System",
                createdAt: new Date().toISOString(),
                avatar: 'https://images.unsplash.com/photo-1551218808-94e220e084d2?w=80&h=80&fit=crop&crop=center'
            });

            challengeData.push({
                id: 'business_001',
                title: "McDonald's Random Order Challenge",
                description: "💰 BUSINESS PARTNERSHIP: Close your eyes and point at the menu to order! Rate your surprise meal and post your reaction!",
                hashtags: ["#McDonaldsPartner", "#SurpriseMenu", "#BusinessChallenge"],
                difficulty: "medium",
                tokens: 1800,
                realRewards: "RM 50 McDonald's Voucher + Free Delivery",
                type: "business",
                partner: "McDonald's Malaysia",
                creator: "McDonald's Malaysia",
                createdAt: new Date().toISOString(),
                avatar: 'https://images.unsplash.com/photo-1551218808-94e220e084d2?w=80&h=80&fit=crop&crop=center'
            });

            challengeData.push({
                id: 'vip_001',
                title: "Luxury Hotel Lobby Experience",
                description: "🌟 VIP CHALLENGE: Spend 30 minutes in a 5-star hotel lobby, order room service to the lobby, and network with 3 guests!",
                hashtags: ["#VIPExperience", "#LuxuryLife", "#Networking"],
                difficulty: "epic",
                tokens: 5000,
                type: "vip",
                creator: "emma_thompson",
                vipOnly: true,
                createdAt: new Date().toISOString(),
                avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=80&h=80&fit=crop&crop=face'
            });

            challengeData.push({
                id: 'treasure_001',
                title: "TREASURE: City Scavenger Hunt",
                description: "🏆 MONTHLY TREASURE: Complete a massive city-wide scavenger hunt with 10 hidden locations! First 50 players to complete get massive rewards!",
                hashtags: ["#TreasureHunt", "#CityWide", "#MonthlyChallenge"],
                difficulty: "legendary",
                tokens: 25000,
                realRewards: "iPhone 15 Pro Max + RM 5,000 Cash",
                type: "treasure",
                creator: "JomBro Treasure System",
                createdAt: new Date().toISOString(),
                expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                participants: 0,
                maxParticipants: 1000,
                avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face'
            });

            totalPages = challengeData.length;
            updateChallengeDisplay();
        }

        function updatePlayerDisplay() {
            document.getElementById('playerRank').textContent = playerData.rank;
            document.getElementById('playerTokens').textContent = `🪙 ${playerData.tokens.toLocaleString()}`;
        }

        function updateChallengeDisplay() {
            const feedPages = document.getElementById('feedPages');
            feedPages.innerHTML = '';

            challengeData.forEach((challenge, index) => {
                const card = createChallengeCard(challenge, index);
                feedPages.appendChild(card);
            });

            if (challengeData.length > 0) {
                updateCurrentChallenge();
            }
        }

        function createChallengeCard(challenge, index) {
            const card = document.createElement('div');
            card.className = `challenge-card ${index === currentPage ? 'current' : (index === currentPage + 1 ? 'next' : 'prev')}`;
            card.setAttribute('data-index', index);

            const getDifficultyClass = (difficulty) => {
                switch(difficulty) {
                    case 'easy': return 'difficulty-easy';
                    case 'medium': return 'difficulty-medium';
                    case 'hard': return 'difficulty-hard';
                    case 'epic': return 'difficulty-epic';
                    case 'legendary': return 'difficulty-legendary';
                    default: return 'difficulty-easy';
                }
            };

            const getTypeClass = (type) => {
                switch(type) {
                    case 'daily': return 'daily';
                    case 'treasure': return 'treasure';
                    case 'vip': return 'vip';
                    case 'business': return 'business';
                    default: return 'daily';
                }
            };

            card.innerHTML = `
                <div class="challenge-content">
                    <div class="challenge-user">
                        <div class="challenge-avatar">
                            <div class="challenge-avatar-inner">
                                <img src="${challenge.avatar}" alt="${challenge.creator}">
                            </div>
                        </div>
                        <div>
                            <div class="challenge-username">
                                ${challenge.creator}
                                <span class="challenge-type ${getTypeClass(challenge.type)}">${challenge.type.toUpperCase()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="challenge-text">${challenge.description}</div>
                    
                    <div class="challenge-hashtags">
                        ${challenge.hashtags.map(tag => `<span class="challenge-hashtag">${tag}</span>`).join('')}
                    </div>
                    
                    <div class="challenge-reward">
                        🪙 ${challenge.tokens.toLocaleString()} Tokens
                        <span class="challenge-difficulty ${getDifficultyClass(challenge.difficulty)}">${challenge.difficulty.toUpperCase()}</span>
                        ${challenge.realRewards ? `<br><small>🎁 Real Reward: ${challenge.realRewards}</small>` : ''}
                    </div>
                    
                    <div class="challenge-actions">
                        <button class="challenge-btn btn-accept" onclick="acceptChallenge('${challenge.id}')">
                            🚀 Accept Challenge
                        </button>
                        <button class="challenge-btn btn-decline" onclick="nextChallenge()">
                            Skip
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        function updateCurrentChallenge() {
            const cards = document.querySelectorAll('.challenge-card');
            cards.forEach((card, index) => {
                card.className = 'challenge-card';
                if (index === currentPage) {
                    card.classList.add('current');
                } else if (index === currentPage + 1) {
                    card.classList.add('next');
                } else {
                    card.classList.add('prev');
                }
            });

            // Update points display
            if (challengeData[currentPage]) {
                const pointsDisplay = document.getElementById('currentChallengePoints');
                if (pointsDisplay) {
                    pointsDisplay.textContent = formatPoints(challengeData[currentPage].tokens);
                }
            }
        }

        function formatPoints(points) {
            if (points >= 1000) {
                return (points / 1000).toFixed(1) + 'K';
            }
            return points.toString();
        }

        function nextChallenge() {
            if (isFlipping) return;
            isFlipping = true;
            
            currentPage = (currentPage + 1) % challengeData.length;
            updateCurrentChallenge();
            
            // Instant response - no delay
            isFlipping = false;
        }

        function previousChallenge() {
            if (isFlipping) return;
            isFlipping = true;
            
            currentPage = currentPage === 0 ? challengeData.length - 1 : currentPage - 1;
            updateCurrentChallenge();
            
            // Instant response - no delay
            isFlipping = false;
        }

        function setupSwipeGestures() {
            const feedElement = document.querySelector('.dark-feed');
            let startY = 0;
            let startX = 0;
            let deltaY = 0;
            let deltaX = 0;

            feedElement.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                startX = e.touches[0].clientX;
            });

            feedElement.addEventListener('touchmove', (e) => {
                e.preventDefault();
                deltaY = e.touches[0].clientY - startY;
                deltaX = e.touches[0].clientX - startX;
            });

            feedElement.addEventListener('touchend', () => {
                if (Math.abs(deltaY) > 50 && Math.abs(deltaY) > Math.abs(deltaX)) {
                    if (deltaY > 0) {
                        previousChallenge();
                    } else {
                        nextChallenge();
                    }
                }
                deltaY = 0;
                deltaX = 0;
            });
        }

        function createStories() {
            const storiesScroll = document.getElementById('storiesScroll');
            
            const stories = [
                { name: 'Your Story', avatar: playerData.avatar, isOwn: true },
                { name: 'Marcus', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face' },
                { name: 'Sofia', avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=80&h=80&fit=crop&crop=face' },
                { name: 'Ryan', avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face' },
                { name: 'Emma', avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=80&h=80&fit=crop&crop=face' }
            ];

            stories.forEach(story => {
                const storyItem = document.createElement('div');
                storyItem.className = 'story-item';
                storyItem.innerHTML = `
                    <div class="story-circle" onclick="viewStory('${story.name}')">
                        <div class="story-inner">
                            <img src="${story.avatar}" alt="${story.name}" class="story-image">
                        </div>
                    </div>
                    <div class="story-name">${story.name}</div>
                `;
                storiesScroll.appendChild(storyItem);
            });
        }

        function populateLeaderboard() {
            leaderboardData = [
                { rank: 1, name: 'Marcus Chen', tokens: 28394, avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face', title: 'Champion' },
                { rank: 2, name: 'Alexandra Stone', tokens: 15247, avatar: playerData.avatar, title: 'Elite Gladiator' },
                { rank: 3, name: 'Emma Thompson', tokens: 12567, avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=80&h=80&fit=crop&crop=face', title: 'Elite' },
                { rank: 4, name: 'Sofia Rodriguez', tokens: 9876, avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=80&h=80&fit=crop&crop=face', title: 'Duelist' },
                { rank: 5, name: 'Ryan Kumar', tokens: 7234, avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face', title: 'Rival' }
            ];
        }

        // Action Functions
        function acceptChallenge(challengeId) {
            const challenge = challengeData.find(c => c.id === challengeId);
            if (challenge) {
                showToast(`🚀 Challenge "${challenge.title}" accepted! Get ready to earn ${challenge.tokens.toLocaleString()} tokens!`);
                nextChallenge();
            }
        }

        function likeChallenge() {
            showToast('❤️ Challenge liked!');
            // Add floating heart animation
            createFloatingHeart();
        }

        function shareChallenge() {
            showToast('📤 Challenge shared with friends!');
        }

        function bookmarkChallenge() {
            showToast('🔖 Challenge bookmarked!');
        }

        function createChallenge() {
            const type = document.getElementById('challengeType').value;
            const target = document.getElementById('challengeTarget').value;
            const description = document.getElementById('challengeDesc').value;
            const points = document.getElementById('challengePoints').value;

            if (!description.trim()) {
                showToast('❌ Please enter a challenge description!');
                return;
            }

            const newChallenge = {
                id: 'user_' + Date.now(),
                title: "User Created Challenge",
                description: description,
                hashtags: ["#UserChallenge", "#JomBro", "#Community"],
                difficulty: points >= 5000 ? "epic" : points >= 2500 ? "hard" : "medium",
                tokens: parseInt(points),
                type: type,
                creator: playerData.displayName,
                createdAt: new Date().toISOString(),
                avatar: playerData.avatar
            };

            challengeData.unshift(newChallenge);
            totalPages = challengeData.length;
            updateChallengeDisplay();

            hideModal('create');
            showToast('✨ Challenge created successfully!');
        }

        function purchaseTokens() {
            const tokenPackage = document.getElementById('tokenPackage').value;
            const vipPackage = document.getElementById('vipPackage').value;

            hideModal('shop');
            showToast(`💳 Purchase successful! ${tokenPackage} tokens added to your account!`);
            
            // Update player tokens
            playerData.tokens += parseInt(tokenPackage);
            updatePlayerDisplay();
        }

        function createFloatingHeart() {
            const heart = document.createElement('div');
            heart.textContent = '❤️';
            heart.className = 'instant-heart';

            document.body.appendChild(heart);

            // Quick cleanup
            setTimeout(() => {
                heart.remove();
            }, 1000);
        }

        // Navigation Functions - Instant Response
        function navigateAction(element, action) {
            // Immediate action - no visual delays
            switch(action) {
                case 'create':
                    showModal('create');
                    break;
                case 'notifications':
                    showToast('🔔 7 new notifications! Challenge completions, friend requests, and rewards awaiting!');
                    break;
                case 'messages':
                    showToast('💬 3 new messages from friends about ongoing challenges!');
                    break;
            }
        }

        function navAction(element, section) {
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked item
            element.classList.add('active');

            // Immediate navigation - no delays
            switch(section) {
                case 'home':
                    // Already on home
                    break;
                case 'leaderboard':
                    showLeaderboard();
                    break;
                case 'create':
                    showModal('create');
                    break;
                case 'shop':
                    showModal('shop');
                    break;
                case 'profile':
                    showProfile();
                    break;
            }
        }

        function showLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '';

            leaderboardData.forEach(player => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                item.innerHTML = `
                    <div class="rank-number">${player.rank}</div>
                    <img src="${player.avatar}" alt="${player.name}" class="player-avatar">
                    <div class="player-details">
                        <div class="player-name">${player.name}</div>
                        <div class="player-rank-title">${player.title}</div>
                    </div>
                    <div class="player-score">${player.tokens.toLocaleString()}</div>
                `;
                leaderboardList.appendChild(item);
            });

            showModal('leaderboard');
        }

        function showProfile() {
            const profileContent = document.getElementById('profileContent');
            profileContent.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <img src="${playerData.avatar}" alt="${playerData.displayName}" 
                         style="width: 120px; height: 120px; border-radius: 60px; border: 4px solid rgba(0, 255, 150, 0.5); margin-bottom: 20px;">
                    <h2 style="color: #fff; margin-bottom: 5px;">${playerData.displayName}</h2>
                    <p style="color: #FFD700; font-weight: 600;">${playerData.rank}</p>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">${playerData.bio}</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div style="text-align: center; padding: 20px; background: rgba(0, 0, 0, 0.001); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px;">
                        <div style="font-size: 24px; color: #00FF96; font-weight: 700;">${playerData.tokens.toLocaleString()}</div>
                        <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">Tokens</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(0, 0, 0, 0.001); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px;">
                        <div style="font-size: 24px; color: #FFD700; font-weight: 700;">${playerData.level}</div>
                        <div style="color: rgba(255, 255, 255, 0.7); font-size: 14px;">Level</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #fff; margin-bottom: 15px;">📊 Stats</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>Completed: <span style="color: #00FF96;">${playerData.completedChallenges}</span></div>
                        <div>Created: <span style="color: #4FC3F7;">${playerData.createdChallenges}</span></div>
                        <div>Win Rate: <span style="color: #FFD700;">${playerData.winRate}%</span></div>
                        <div>Streak: <span style="color: #FF6B47;">${playerData.streakCurrent}</span></div>
                    </div>
                </div>
            `;

            showModal('profile');
        }

        function viewStory(storyName) {
            showToast(`👀 Viewing ${storyName}'s story...`);
        }

        // Modal Functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId + 'Modal');
            if (modal) {
                modal.classList.add('show');
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId + 'Modal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        function showBackgroundSettings() {
            showModal('background');
        }

        function changeBackground(bgType) {
            // Remove active class from all options
            document.querySelectorAll('.bg-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // Add active class to selected option
            document.querySelector(`[data-bg="${bgType}"]`).classList.add('active');
            
            // Change body class
            document.body.className = bgType;
            currentBackground = bgType;
            
            showToast(`🎨 Background changed to ${bgType}!`);
            hideModal('background');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastText = document.getElementById('toastText');
            
            toastText.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Close modals when clicking outside - instant
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // Add CSS for instant heart display - no animation
        const style = document.createElement('style');
        style.textContent = `
            .instant-heart {
                position: fixed;
                right: 50px;
                bottom: 200px;
                font-size: 24px;
                z-index: 3000;
                pointer-events: none;
                opacity: 1;
                color: #FF1493;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
