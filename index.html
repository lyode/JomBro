<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    
    <title>JomBro - Challenge App</title>

    <style>
        /* ===== LIGHTWEIGHT OPTIMIZED STYLES ===== */
        :root {
            --safe-area-top: env(safe-area-inset-top, 20px);
            --safe-area-bottom: env(safe-area-inset-bottom, 20px);
            --animation-speed: 0.3s;
            --primary-color: #00FF96;
            --accent-color: #FFD700;
            --error-color: #FF6B6B;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
        }

        html, body {
            height: 100vh;
            overflow: hidden;
            position: fixed;
            width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* ===== SIMPLIFIED BACKGROUND ===== */
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #FFFFFF;
            font-size: 16px;
            line-height: 1.5;
            font-weight: 300;
        }

        /* ===== LIGHTWEIGHT BACKGROUND EFFECT ===== */
        .bg-effect {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 20%, rgba(0, 255, 150, 0.03) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(64, 93, 230, 0.03) 0%, transparent 50%);
            z-index: 0;
            pointer-events: none;
        }

        /* ===== MAIN CONTAINER ===== */
        .main-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10;
            display: flex;
            flex-direction: column;
        }

        /* ===== SIMPLIFIED HEADER ===== */
        .header {
            position: fixed;
            top: calc(var(--safe-area-top) + 10px);
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            height: 60px;
        }

        .logo {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(0, 255, 150, 0.5);
        }

        .header-icons {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            cursor: pointer;
            color: #fff;
            transition: all var(--animation-speed) ease;
        }

        .icon-btn:hover, .icon-btn:active {
            background: rgba(0, 255, 150, 0.2);
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        /* ===== PLAYER INFO ===== */
        .player-info {
            position: fixed;
            top: calc(var(--safe-area-top) + 80px);
            right: 24px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--primary-color);
            border-radius: 16px;
            padding: 8px 12px;
            z-index: 950;
            font-size: 12px;
            text-align: center;
        }

        .rank {
            color: var(--accent-color);
            font-weight: 600;
            margin-bottom: 2px;
        }

        .tokens {
            color: var(--primary-color);
            font-weight: 700;
        }

        /* ===== CHALLENGE FEED ===== */
        .feed {
            position: fixed;
            top: calc(var(--safe-area-top) + 150px);
            left: 0;
            right: 0;
            bottom: calc(80px + var(--safe-area-bottom));
            padding: 0 20px;
            z-index: 100;
        }

        .challenge-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .challenge-card {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--animation-speed) ease;
            overflow: hidden;
        }

        .challenge-card.active {
            opacity: 1;
            transform: translateY(0);
            z-index: 10;
        }

        .challenge-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: linear-gradient(45deg, var(--primary-color), #405DE6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .challenge-type {
            font-size: 10px;
            background: var(--accent-color);
            color: #000;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 600;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .description {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 16px;
            color: rgba(255, 255, 255, 0.9);
        }

        .hashtags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .hashtag {
            font-size: 14px;
            color: #4FC3F7;
            background: rgba(79, 195, 247, 0.1);
            padding: 4px 8px;
            border-radius: 12px;
        }

        .reward {
            background: rgba(0, 255, 150, 0.1);
            border: 1px solid var(--primary-color);
            padding: 12px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all var(--animation-speed) ease;
        }

        .btn-primary {
            background: var(--primary-color);
            color: #000;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn:hover, .btn:active {
            transform: translateY(-2px);
        }

        /* ===== SIDE ACTIONS ===== */
        .side-actions {
            position: fixed;
            right: 24px;
            bottom: calc(120px + var(--safe-area-bottom));
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 200;
        }

        .action-btn {
            width: 48px;
            height: 48px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            color: #fff;
            transition: all var(--animation-speed) ease;
        }

        .action-btn:hover, .action-btn:active {
            background: rgba(0, 255, 150, 0.2);
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .points-btn {
            height: 60px;
            flex-direction: column;
            padding: 8px;
            background: rgba(0, 255, 150, 0.1);
            border-color: var(--primary-color);
        }

        .points-number {
            font-size: 12px;
            font-weight: 700;
        }

        /* ===== BOTTOM NAVIGATION ===== */
        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-around;
            padding: 12px 20px calc(var(--safe-area-bottom) + 12px) 20px;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            transition: all var(--animation-speed) ease;
            border-radius: 12px;
        }

        .nav-item.active {
            color: var(--primary-color);
            background: rgba(0, 255, 150, 0.1);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        /* ===== MODALS ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 24px;
        }

        .modal.show {
            display: flex;
            animation: fadeIn var(--animation-speed) ease;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 24px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            width: 100%;
            max-width: 400px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            outline: none;
            transition: all var(--animation-speed) ease;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            top: calc(var(--safe-area-top) + 160px);
            left: 24px;
            right: 24px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--primary-color);
            color: #fff;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            text-align: center;
            z-index: 4000;
            transform: translateY(-100px);
            opacity: 0;
            transition: all var(--animation-speed) ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            border-color: var(--error-color);
        }

        /* ===== RATING STARS ===== */
        .rating-stars {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 16px 0;
        }

        .star {
            font-size: 24px;
            cursor: pointer;
            opacity: 0.3;
            transition: all 0.2s ease;
        }

        .star:hover, .star.active {
            opacity: 1;
            transform: scale(1.1);
        }

        /* ===== CHALLENGE PAGE ===== */
        .challenge-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            padding: var(--safe-area-top) 20px calc(var(--safe-area-bottom) + 20px) 20px;
            overflow-y: auto;
        }

        .challenge-page.show {
            display: block;
            animation: slideIn var(--animation-speed) ease;
        }

        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding-top: 20px;
        }

        .back-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #fff;
            font-size: 18px;
            transition: all var(--animation-speed) ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .page-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .detail-card {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .detail-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            line-height: 1.3;
        }

        .detail-description {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.9);
        }

        .requirements {
            background: rgba(0, 255, 150, 0.05);
            border: 1px solid rgba(0, 255, 150, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .requirements h3 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 16px;
        }

        .requirements ul {
            list-style: none;
            padding: 0;
        }

        .requirements li {
            padding: 4px 0;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            padding-left: 20px;
        }

        .requirements li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        /* ===== PROFILE PAGE ===== */
        .profile-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            padding: var(--safe-area-top) 0 calc(var(--safe-area-bottom) + 20px) 0;
            overflow-y: auto;
            display: none;
        }

        .profile-page.show {
            display: block;
            animation: slideIn var(--animation-speed) ease;
        }

        .profile-content {
            padding: 20px;
            text-align: center;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 40px;
            background: linear-gradient(45deg, var(--primary-color), #405DE6);
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .profile-username {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 24px 0;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== RESPONSIVE ===== */
        @media screen and (max-width: 400px) {
            .header {
                height: 56px;
                padding: 12px 20px;
            }
            
            .logo {
                font-size: 22px;
            }
            
            .icon-btn {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .challenge-card {
                padding: 20px;
            }
            
            .title {
                font-size: 18px;
            }
            
            .description {
                font-size: 15px;
            }
        }

        /* ===== PERFORMANCE OPTIMIZATIONS ===== */
        .challenge-card {
            will-change: transform, opacity;
            contain: layout style paint;
        }

        .feed {
            contain: layout style;
        }

        /* Remove heavy effects on low-end devices */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Lightweight Background -->
    <div class="bg-effect"></div>

    <!-- Main Container -->
    <div class="main-container">
        
        <!-- Header -->
        <div class="header">
            <div class="logo">JomBro</div>
            <div style="display: flex; align-items: center; gap: 12px;">
                <div id="challengeCounter" style="background: rgba(0, 255, 150, 0.2); color: var(--primary-color); padding: 4px 8px; border-radius: 8px; font-size: 11px; font-weight: 600;">
                    1/5
                </div>
                <div class="header-icons">
                    <div class="icon-btn" onclick="showHelp()" title="Help">❓</div>
                    <div class="icon-btn" onclick="showModal('create')" title="Create">➕</div>
                    <div class="icon-btn" onclick="showModal('settings')" title="Settings">⚙️</div>
                </div>
            </div>
        </div>

        <!-- Player Info -->
        <div class="player-info">
            <div class="rank" id="playerRank">Elite</div>
            <div class="tokens" id="playerTokens">🪙 15,247</div>
        </div>

        <!-- Challenge Feed -->
        <div class="feed">
            <div class="challenge-container" id="challengeContainer">
                <!-- Challenge cards populated by JS -->
            </div>

            <!-- Side Actions -->
            <div class="side-actions">
                <div class="action-btn points-btn" onclick="likeChallenge()" title="Like">
                    <div class="points-number" id="currentPoints">2.5K</div>
                    <div>❤️</div>
                </div>
                <div class="action-btn" onclick="shareChallenge()" title="Share">📤</div>
                <div class="action-btn" onclick="bookmarkChallenge()" title="Bookmark">🔖</div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="navigation">
            <div class="nav-item active" onclick="navTo(this, 'home')">
                <div class="nav-icon">🏠</div>
                <div>Home</div>
            </div>
            <div class="nav-item" onclick="navTo(this, 'leaderboard')">
                <div class="nav-icon">🏆</div>
                <div>Ranks</div>
            </div>
            <div class="nav-item" onclick="navTo(this, 'create')">
                <div class="nav-icon">➕</div>
                <div>Create</div>
            </div>
            <div class="nav-item" onclick="navTo(this, 'profile')">
                <div class="nav-icon">👤</div>
                <div>Profile</div>
            </div>
        </div>
    </div>

    <!-- Challenge Detail Page -->
    <div class="challenge-page" id="challengePage">
        <div class="page-header">
            <div class="back-btn" onclick="closePage()">←</div>
            <div class="page-title">Challenge Details</div>
            <div style="width: 40px;"></div>
        </div>

        <div class="detail-card">
            <div class="detail-title" id="detailTitle">Challenge Title</div>
            <div class="detail-description" id="detailDescription">Challenge description...</div>

            <div class="requirements">
                <h3>📋 Requirements:</h3>
                <ul id="requirementsList">
                    <li>Complete the challenge</li>
                </ul>
            </div>

            <div style="display: flex; gap: 16px; margin: 20px 0;">
                <div style="flex: 1; text-align: center; padding: 12px; background: rgba(0, 255, 150, 0.1); border-radius: 8px;">
                    <div style="font-size: 20px; color: var(--primary-color); font-weight: 700;" id="detailTokens">500</div>
                    <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Tokens</div>
                </div>
                <div style="flex: 1; text-align: center; padding: 12px; background: rgba(255, 215, 0, 0.1); border-radius: 8px;">
                    <div style="font-size: 20px; color: var(--accent-color); font-weight: 700;" id="detailDifficulty">Easy</div>
                    <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Level</div>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-primary" onclick="startChallenge()">🚀 Start Now</button>
                <button class="btn btn-secondary" onclick="closePage()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div class="profile-page" id="profilePage">
        <div class="page-header">
            <div class="back-btn" onclick="closeProfile()">←</div>
            <div class="page-title">My Profile</div>
            <div style="width: 40px;"></div>
        </div>

        <div class="profile-content">
            <div class="profile-avatar">👤</div>
            <div class="profile-name" id="profileName">Alexandra Stone</div>
            <div class="profile-username" id="profileUsername">@alexandra_stone</div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="profileTokens">15,247</div>
                    <div class="stat-label">🪙 Tokens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="profileChallenges">143</div>
                    <div class="stat-label">✅ Done</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="profileStreak">12</div>
                    <div class="stat-label">🔥 Streak</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div id="completionModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">📸 Complete Challenge</div>
            
            <div class="form-group">
                <label class="form-label">Upload Photo/Video</label>
                <input type="file" class="form-control" id="mediaFile" accept="image/*,video/*">
            </div>
            
            <div class="form-group">
                <label class="form-label">Describe Your Experience</label>
                <textarea class="form-control" id="experienceDesc" rows="3" 
                    placeholder="Tell us about your experience..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Rate Your Experience</label>
                <div class="rating-stars" id="ratingStars">
                    <span class="star" onclick="setRating(1)">⭐</span>
                    <span class="star" onclick="setRating(2)">⭐</span>
                    <span class="star" onclick="setRating(3)">⭐</span>
                    <span class="star" onclick="setRating(4)">⭐</span>
                    <span class="star" onclick="setRating(5)">⭐</span>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="submitCompletion()">🤖 Submit for Review</button>
            <button class="btn btn-secondary" onclick="hideModal('completion')">Cancel</button>
        </div>
    </div>

    <!-- Create Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">✨ Create Challenge</div>
            
            <div class="form-group">
                <label class="form-label">Title</label>
                <input type="text" class="form-control" id="newTitle" placeholder="Enter title...">
            </div>
            
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-control" id="newDesc" rows="3" placeholder="Describe your challenge..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Reward</label>
                <select class="form-control" id="newTokens">
                    <option value="500">500 Tokens (Easy)</option>
                    <option value="1200">1,200 Tokens (Medium)</option>
                    <option value="2500">2,500 Tokens (Hard)</option>
                </select>
            </div>
            
            <button class="btn btn-primary" onclick="createChallenge()">🚀 Create</button>
            <button class="btn btn-secondary" onclick="hideModal('create')">Cancel</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">⚙️ Settings</div>
            
            <div class="form-group">
                <label class="form-label">Display Name</label>
                <input type="text" class="form-control" id="displayName" value="Alexandra Stone">
            </div>
            
            <div class="form-group">
                <label class="form-label">Username</label>
                <input type="text" class="form-control" id="username" value="alexandra_stone">
            </div>
            
            <button class="btn btn-primary" onclick="saveSettings()">💾 Save</button>
            <button class="btn btn-secondary" onclick="hideModal('settings')">Cancel</button>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeModal" class="modal">
        <div class="modal-content">
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">🚀</div>
                <h2 style="color: var(--primary-color); margin-bottom: 12px;">Welcome to JomBro!</h2>
                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 20px;">
                    Complete real-world challenges, earn tokens, and have fun!
                </p>
            </div>
            
            <button class="btn btn-primary" onclick="startTutorial()">🎯 Let's Go!</button>
            <button class="btn btn-secondary" onclick="skipTutorial()">Skip</button>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast">
        <span id="toastText">Ready!</span>
    </div>

    <script>
        // ===== LIGHTWEIGHT JOMBRO SCRIPT =====

        // Cached DOM elements
        const elements = {};
        const cache = (id) => elements[id] || (elements[id] = document.getElementById(id));

        // Global state (simplified)
        let player = {
            name: 'Alexandra Stone',
            username: 'alexandra_stone',
            tokens: 15247,
            rank: 'Elite',
            completed: 143,
            streak: 12
        };

        let challenges = [];
        let currentIndex = 0;
        let currentChallenge = null;
        let selectedRating = 0;

        // ===== CHALLENGE DATA (simplified) =====
        function initChallenges() {
            challenges = [
                {
                    id: '1',
                    title: "Coffee Shop Poetry",
                    description: "Ask a barista to write a poem on your cup! Spread joy and connect with people in your community.",
                    tokens: 500,
                    difficulty: "easy",
                    type: "daily",
                    creator: "JomBro",
                    hashtags: ["#Coffee", "#Poetry", "#Connection"],
                    requirements: [
                        "Visit any coffee shop",
                        "Ask barista for a poem",
                        "Take a photo",
                        "Share the experience"
                    ]
                },
                {
                    id: '2',
                    title: "Random Menu Challenge",
                    description: "Close your eyes and point at a menu to order! Try something completely new and rate your surprise meal.",
                    tokens: 1200,
                    difficulty: "medium",
                    type: "business",
                    creator: "Food Explorer",
                    hashtags: ["#Food", "#Surprise", "#Adventure"],
                    requirements: [
                        "Go to any restaurant",
                        "Close eyes and point at menu",
                        "Order what you pointed at",
                        "Document your reaction"
                    ]
                },
                {
                    id: '3',
                    title: "Hidden Gems Hunt",
                    description: "Discover 3 hidden gems in your city that tourists don't know about. Share these secret spots!",
                    tokens: 2500,
                    difficulty: "hard",
                    type: "adventure",
                    creator: "City Explorer",
                    hashtags: ["#Hidden", "#Gems", "#Local"],
                    requirements: [
                        "Find 3 hidden local spots",
                        "Take photos at each location",
                        "Research their history",
                        "Create a mini guide"
                    ]
                },
                {
                    id: '4',
                    title: "Public Workout",
                    description: "Do 30 push-ups in a public place and inspire others to join you! Spread fitness motivation.",
                    tokens: 800,
                    difficulty: "medium",
                    type: "fitness",
                    creator: "Fit Coach",
                    hashtags: ["#Fitness", "#Public", "#Motivation"],
                    requirements: [
                        "Choose a public location",
                        "Do 30 push-ups",
                        "Invite others to join",
                        "Document reactions"
                    ]
                },
                {
                    id: '5',
                    title: "Compliment Challenge",
                    description: "Give genuine compliments to 5 strangers today. Spread positivity and brighten people's day!",
                    tokens: 600,
                    difficulty: "easy",
                    type: "social",
                    creator: "Positivity Pro",
                    hashtags: ["#Kindness", "#Compliments", "#Positive"],
                    requirements: [
                        "Approach 5 different people",
                        "Give genuine compliments",
                        "Note their reactions",
                        "Reflect on the experience"
                    ]
                }
            ];
        }

        // ===== UTILITY FUNCTIONS =====
        function showToast(message, isError = false) {
            const toast = cache('toast');
            const text = cache('toastText');
            if (!toast || !text) return;
            
            text.textContent = message;
            toast.className = `toast ${isError ? 'error' : ''}`;
            toast.classList.add('show');
            
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function showModal(id) {
            const modal = cache(id + 'Modal');
            if (modal) modal.classList.add('show');
        }

        function hideModal(id) {
            const modal = cache(id + 'Modal');
            if (modal) modal.classList.remove('show');
        }

        function updateElement(id, content) {
            const el = cache(id);
            if (el) el.textContent = content;
        }

        // ===== CHALLENGE DISPLAY =====
        function renderChallenge(challenge, index) {
            const isActive = index === currentIndex;
            
            return `
                <div class="challenge-card ${isActive ? 'active' : ''}" data-index="${index}">
                    <div class="challenge-header">
                        <div class="avatar">${getTypeIcon(challenge.type)}</div>
                        <div class="user-info">
                            <div class="username">${challenge.creator}</div>
                            <div class="challenge-type">${challenge.type.toUpperCase()}</div>
                        </div>
                    </div>
                    
                    <div class="content">
                        <div class="title">${challenge.title}</div>
                        <div class="description">${challenge.description}</div>
                        
                        <div class="hashtags">
                            ${challenge.hashtags.map(tag => `<span class="hashtag">${tag}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="reward">
                        🪙 ${challenge.tokens.toLocaleString()} Tokens • ${challenge.difficulty.toUpperCase()}
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-primary" onclick="acceptChallenge('${challenge.id}')">
                            🚀 Accept
                        </button>
                        <button class="btn btn-secondary" onclick="nextChallenge()">
                            Skip
                        </button>
                    </div>
                </div>
            `;
        }

        function getTypeIcon(type) {
            const icons = {
                daily: '☕',
                business: '🍟',
                adventure: '🗺️',
                fitness: '💪',
                social: '😊'
            };
            return icons[type] || '⭐';
        }

        function updateChallengeDisplay() {
            const container = cache('challengeContainer');
            if (!container) return;
            
            container.innerHTML = challenges.map((challenge, index) => 
                renderChallenge(challenge, index)
            ).join('');
            
            updateCounter();
            updatePoints();
        }

        function updateCounter() {
            updateElement('challengeCounter', `${currentIndex + 1}/${challenges.length}`);
        }

        function updatePoints() {
            if (challenges[currentIndex]) {
                const tokens = challenges[currentIndex].tokens;
                const display = tokens >= 1000 ? (tokens / 1000).toFixed(1) + 'K' : tokens;
                updateElement('currentPoints', display);
            }
        }

        // ===== NAVIGATION =====
        function nextChallenge() {
            currentIndex = (currentIndex + 1) % challenges.length;
            updateChallengeDisplay();
            showToast('⏭️ Next challenge');
        }

        function prevChallenge() {
            currentIndex = currentIndex === 0 ? challenges.length - 1 : currentIndex - 1;
            updateChallengeDisplay();
            showToast('⏮️ Previous challenge');
        }

        function acceptChallenge(id) {
            currentChallenge = challenges.find(c => c.id === id);
            if (!currentChallenge) return;
            
            updateElement('detailTitle', currentChallenge.title);
            updateElement('detailDescription', currentChallenge.description);
            updateElement('detailTokens', currentChallenge.tokens.toLocaleString());
            updateElement('detailDifficulty', currentChallenge.difficulty);
            
            const list = cache('requirementsList');
            if (list) {
                list.innerHTML = currentChallenge.requirements
                    .map(req => `<li>${req}</li>`)
                    .join('');
            }
            
            cache('challengePage').classList.add('show');
        }

        function closePage() {
            cache('challengePage').classList.remove('show');
        }

        function startChallenge() {
            closePage();
            showToast('🚀 Challenge started! Complete it and submit proof.');
            setTimeout(() => showModal('completion'), 2000);
        }

        // ===== CHALLENGE COMPLETION =====
        function setRating(rating) {
            selectedRating = rating;
            const stars = document.querySelectorAll('.star');
            stars.forEach((star, index) => {
                star.className = 'star';
                if (index < rating) star.classList.add('active');
            });
        }

        function submitCompletion() {
            const desc = cache('experienceDesc');
            if (!desc || !desc.value.trim()) {
                showToast('Please describe your experience', true);
                return;
            }
            
            if (selectedRating === 0) {
                showToast('Please rate the challenge', true);
                return;
            }
            
            showToast('🤖 AI reviewing submission...');
            
            setTimeout(() => {
                const score = calculateScore(desc.value);
                const tokens = Math.floor(currentChallenge.tokens * (score / 100));
                
                player.tokens += tokens;
                player.completed++;
                updatePlayerDisplay();
                
                showReviewResult(score, tokens);
                hideModal('completion');
                resetForm();
            }, 2000);
        }

        function calculateScore(description) {
            let score = 50;
            if (description.length > 50) score += 20;
            if (description.length > 100) score += 10;
            if (selectedRating >= 4) score += 10;
            if (/amazing|awesome|great|fun|love/.test(description.toLowerCase())) score += 10;
            return Math.min(score, 95);
        }

        function showReviewResult(score, tokens) {
            const emoji = score >= 80 ? '🎉' : score >= 60 ? '⭐' : '💪';
            const title = score >= 80 ? 'Excellent!' : score >= 60 ? 'Great Job!' : 'Good Try!';
            
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content" style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 16px;">${emoji}</div>
                    <h2 style="margin-bottom: 12px;">${title}</h2>
                    
                    <div style="background: rgba(0, 255, 150, 0.1); border: 1px solid var(--primary-color); padding: 16px; border-radius: 12px; margin: 16px 0;">
                        <div style="font-size: 20px; color: var(--primary-color); font-weight: 700;">
                            +${tokens.toLocaleString()} Tokens
                        </div>
                        <div style="font-size: 14px; color: rgba(255, 255, 255, 0.7);">
                            Score: ${score}/100
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="this.closest('.modal').remove(); nextChallenge();">
                        🚀 Next Challenge
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function resetForm() {
            selectedRating = 0;
            document.querySelectorAll('.star').forEach(star => star.className = 'star');
            
            const desc = cache('experienceDesc');
            const file = cache('mediaFile');
            if (desc) desc.value = '';
            if (file) file.value = '';
        }

        // ===== CREATE CHALLENGE =====
        function createChallenge() {
            const title = cache('newTitle');
            const desc = cache('newDesc');
            const tokens = cache('newTokens');
            
            if (!title || !title.value.trim()) {
                showToast('Please enter a title', true);
                return;
            }
            
            if (!desc || !desc.value.trim()) {
                showToast('Please enter a description', true);
                return;
            }
            
            const newChallenge = {
                id: Date.now().toString(),
                title: title.value,
                description: desc.value,
                tokens: parseInt(tokens.value),
                difficulty: tokens.value >= 2000 ? 'hard' : tokens.value >= 1000 ? 'medium' : 'easy',
                type: 'user',
                creator: player.name,
                hashtags: ['#UserChallenge', '#JomBro'],
                requirements: [
                    'Complete the challenge as described',
                    'Take photos/videos as proof',
                    'Share your experience'
                ]
            };
            
            challenges.unshift(newChallenge);
            currentIndex = 0;
            updateChallengeDisplay();
            
            hideModal('create');
            showToast('✨ Challenge created!');
            
            // Clear form
            title.value = '';
            desc.value = '';
        }

        // ===== SETTINGS =====
        function saveSettings() {
            const name = cache('displayName');
            const username = cache('username');
            
            if (name && name.value.trim()) {
                player.name = name.value.trim();
            }
            
            if (username && username.value.trim()) {
                player.username = username.value.trim();
            }
            
            updatePlayerDisplay();
            hideModal('settings');
            showToast('⚙️ Settings saved!');
        }

        // ===== PROFILE =====
        function showProfile() {
            updateElement('profileName', player.name);
            updateElement('profileUsername', `@${player.username}`);
            updateElement('profileTokens', player.tokens.toLocaleString());
            updateElement('profileChallenges', player.completed);
            updateElement('profileStreak', player.streak);
            
            cache('profilePage').classList.add('show');
        }

        function closeProfile() {
            cache('profilePage').classList.remove('show');
        }

        // ===== NAVIGATION =====
        function navTo(element, section) {
            document.querySelectorAll('.nav-item').forEach(item => 
                item.classList.remove('active')
            );
            element.classList.add('active');
            
            if (section === 'profile') {
                showProfile();
            } else if (section === 'create') {
                showModal('create');
            } else {
                showToast(`📱 ${section}`);
            }
        }

        // ===== PLAYER DISPLAY =====
        function updatePlayerDisplay() {
            updateElement('playerRank', player.rank);
            updateElement('playerTokens', `🪙 ${player.tokens.toLocaleString()}`);
        }

        // ===== ACTIONS =====
        function likeChallenge() {
            showToast('❤️ Liked!');
        }

        function shareChallenge() {
            if (navigator.share && currentChallenge) {
                navigator.share({
                    title: currentChallenge.title,
                    text: currentChallenge.description
                }).then(() => showToast('📤 Shared!'))
                .catch(() => showToast('📤 Share failed'));
            } else {
                showToast('📤 Shared!');
            }
        }

        function bookmarkChallenge() {
            showToast('🔖 Bookmarked!');
        }

        function showHelp() {
            showToast('❓ Help coming soon!');
        }

        // ===== ONBOARDING =====
        function checkFirstLaunch() {
            const hasLaunched = localStorage.getItem('jombro_launched');
            if (!hasLaunched) {
                setTimeout(() => showModal('welcome'), 1000);
            }
        }

        function startTutorial() {
            localStorage.setItem('jombro_launched', 'true');
            hideModal('welcome');
            showToast('🎯 Swipe up/down to browse challenges!');
        }

        function skipTutorial() {
            localStorage.setItem('jombro_launched', 'true');
            hideModal('welcome');
        }

        // ===== TOUCH HANDLING (optimized) =====
        let startY = 0;
        let startTime = 0;

        document.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            startTime = Date.now();
        }, { passive: true });

        document.addEventListener('touchend', (e) => {
            if (!startY) return;
            
            const endY = e.changedTouches[0].clientY;
            const deltaY = startY - endY;
            const deltaTime = Date.now() - startTime;
            
            // Only handle quick swipes (< 300ms) on feed
            if (Math.abs(deltaY) > 50 && deltaTime < 300 && e.target.closest('.feed')) {
                if (deltaY > 0) {
                    nextChallenge();
                } else {
                    prevChallenge();
                }
            }
            
            startY = 0;
        }, { passive: true });

        // ===== INITIALIZATION =====
        function init() {
            initChallenges();
            updatePlayerDisplay();
            updateChallengeDisplay();
            checkFirstLaunch();
            
            // Preload settings
            const name = localStorage.getItem('jombro_name');
            const username = localStorage.getItem('jombro_username');
            if (name) player.name = name;
            if (username) player.username = username;
            
            console.log('JomBro initialized');
        }

        // Initialize when ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Prevent zoom on double tap
        let lastTouch = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouch <= 300) {
                e.preventDefault();
            }
            lastTouch = now;
        });
    </script>
</body>
</html>
